var e=Object.create,t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),s=(e,i,o,s)=>{if(i&&typeof i==`object`||typeof i==`function`)for(var c=r(i),l=0,u=c.length,d;l<u;l++)d=c[l],!a.call(e,d)&&d!==o&&t(e,d,{get:(e=>i[e]).bind(null,d),enumerable:!(s=n(i,d))||s.enumerable});return e},c=(n,r,a)=>(a=n==null?{}:e(i(n)),s(r||!n||!n.__esModule?t(a,`default`,{value:n,enumerable:!0}):a,n));(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e){if(t.type!==`childList`)continue;for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var l=o((exports=>{var t=Symbol.for(`react.transitional.element`),n=Symbol.for(`react.portal`),r=Symbol.for(`react.fragment`),i=Symbol.for(`react.strict_mode`),a=Symbol.for(`react.profiler`),o=Symbol.for(`react.consumer`),s=Symbol.for(`react.context`),c=Symbol.for(`react.forward_ref`),l=Symbol.for(`react.suspense`),u=Symbol.for(`react.memo`),d=Symbol.for(`react.lazy`),f=Symbol.for(`react.activity`),p=Symbol.iterator;function m(e){return typeof e!=`object`||!e?null:(e=p&&e[p]||e[`@@iterator`],typeof e==`function`?e:null)}var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,_={};function v(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||h}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if(typeof e!=`object`&&typeof e!=`function`&&e!=null)throw Error(`takes an object of state variables to update or a function which returns an object of state variables.`);this.updater.enqueueSetState(this,e,t,`setState`)},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,`forceUpdate`)};function y(){}y.prototype=v.prototype;function b(e,t,n){this.props=e,this.context=t,this.refs=_,this.updater=n||h}var x=b.prototype=new y;x.constructor=b,g(x,v.prototype),x.isPureReactComponent=!0;var S=Array.isArray;function C(){}var w={H:null,A:null,T:null,S:null},T=Object.prototype.hasOwnProperty;function E(e,n,r){var i=r.ref;return{$$typeof:t,type:e,key:n,ref:i===void 0?null:i,props:r}}function D(e,t){return E(e.type,t,e.props)}function O(e){return typeof e==`object`&&!!e&&e.$$typeof===t}function ee(e){var t={"=":`=0`,":":`=2`};return`$`+e.replace(/[=:]/g,function(e){return t[e]})}var k=/\/+/g;function te(e,t){return typeof e==`object`&&e&&e.key!=null?ee(``+e.key):t.toString(36)}function ne(e){switch(e.status){case`fulfilled`:return e.value;case`rejected`:throw e.reason;default:switch(typeof e.status==`string`?e.then(C,C):(e.status=`pending`,e.then(function(t){e.status===`pending`&&(e.status=`fulfilled`,e.value=t)},function(t){e.status===`pending`&&(e.status=`rejected`,e.reason=t)})),e.status){case`fulfilled`:return e.value;case`rejected`:throw e.reason}}throw e}function re(e,r,i,a,o){var s=typeof e;(s===`undefined`||s===`boolean`)&&(e=null);var c=!1;if(e===null)c=!0;else switch(s){case`bigint`:case`string`:case`number`:c=!0;break;case`object`:switch(e.$$typeof){case t:case n:c=!0;break;case d:return c=e._init,re(c(e._payload),r,i,a,o)}}if(c)return o=o(e),c=a===``?`.`+te(e,0):a,S(o)?(i=``,c!=null&&(i=c.replace(k,`$&/`)+`/`),re(o,r,i,``,function(e){return e})):o!=null&&(O(o)&&(o=D(o,i+(o.key==null||e&&e.key===o.key?``:(``+o.key).replace(k,`$&/`)+`/`)+c)),r.push(o)),1;c=0;var l=a===``?`.`:a+`:`;if(S(e))for(var u=0;u<e.length;u++)a=e[u],s=l+te(a,u),c+=re(a,r,i,s,o);else if(u=m(e),typeof u==`function`)for(e=u.call(e),u=0;!(a=e.next()).done;)a=a.value,s=l+te(a,u++),c+=re(a,r,i,s,o);else if(s===`object`){if(typeof e.then==`function`)return re(ne(e),r,i,a,o);throw r=String(e),Error(`Objects are not valid as a React child (found: `+(r===`[object Object]`?`object with keys {`+Object.keys(e).join(`, `)+`}`:r)+`). If you meant to render a collection of children, use an array instead.`)}return c}function ie(e,t,n){if(e==null)return e;var r=[],i=0;return re(e,r,``,``,function(e){return t.call(n,e,i++)}),r}function ae(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(t){(e._status===0||e._status===-1)&&(e._status=1,e._result=t)},function(t){(e._status===0||e._status===-1)&&(e._status=2,e._result=t)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var A=typeof reportError==`function`?reportError:function(e){if(typeof window==`object`&&typeof window.ErrorEvent==`function`){var t=new window.ErrorEvent(`error`,{bubbles:!0,cancelable:!0,message:typeof e==`object`&&e&&typeof e.message==`string`?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process==`object`&&typeof process.emit==`function`){process.emit(`uncaughtException`,e);return}console.error(e)},j={map:ie,forEach:function(e,t,n){ie(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return ie(e,function(){t++}),t},toArray:function(e){return ie(e,function(e){return e})||[]},only:function(e){if(!O(e))throw Error(`React.Children.only expected to receive a single React element child.`);return e}};exports.Activity=f,exports.Children=j,exports.Component=v,exports.Fragment=r,exports.Profiler=a,exports.PureComponent=b,exports.StrictMode=i,exports.Suspense=l,exports.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=w,exports.__COMPILER_RUNTIME={__proto__:null,c:function(e){return w.H.useMemoCache(e)}},exports.cache=function(e){return function(){return e.apply(null,arguments)}},exports.cacheSignal=function(){return null},exports.cloneElement=function(e,t,n){if(e==null)throw Error(`The argument must be a React element, but you passed `+e+`.`);var r=g({},e.props),i=e.key;if(t!=null)for(a in t.key!==void 0&&(i=``+t.key),t)!T.call(t,a)||a===`key`||a===`__self`||a===`__source`||a===`ref`&&t.ref===void 0||(r[a]=t[a]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var o=Array(a),s=0;s<a;s++)o[s]=arguments[s+2];r.children=o}return E(e.type,i,r)},exports.createContext=function(e){return e={$$typeof:s,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:o,_context:e},e},exports.createElement=function(e,t,n){var r,i={},a=null;if(t!=null)for(r in t.key!==void 0&&(a=``+t.key),t)T.call(t,r)&&r!==`key`&&r!==`__self`&&r!==`__source`&&(i[r]=t[r]);var o=arguments.length-2;if(o===1)i.children=n;else if(1<o){for(var s=Array(o),c=0;c<o;c++)s[c]=arguments[c+2];i.children=s}if(e&&e.defaultProps)for(r in o=e.defaultProps,o)i[r]===void 0&&(i[r]=o[r]);return E(e,a,i)},exports.createRef=function(){return{current:null}},exports.forwardRef=function(e){return{$$typeof:c,render:e}},exports.isValidElement=O,exports.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:ae}},exports.memo=function(e,t){return{$$typeof:u,type:e,compare:t===void 0?null:t}},exports.startTransition=function(e){var t=w.T,n={};w.T=n;try{var r=e(),i=w.S;i!==null&&i(n,r),typeof r==`object`&&r&&typeof r.then==`function`&&r.then(C,A)}catch(e){A(e)}finally{t!==null&&n.types!==null&&(t.types=n.types),w.T=t}},exports.unstable_useCacheRefresh=function(){return w.H.useCacheRefresh()},exports.use=function(e){return w.H.use(e)},exports.useActionState=function(e,t,n){return w.H.useActionState(e,t,n)},exports.useCallback=function(e,t){return w.H.useCallback(e,t)},exports.useContext=function(e){return w.H.useContext(e)},exports.useDebugValue=function(){},exports.useDeferredValue=function(e,t){return w.H.useDeferredValue(e,t)},exports.useEffect=function(e,t){return w.H.useEffect(e,t)},exports.useEffectEvent=function(e){return w.H.useEffectEvent(e)},exports.useId=function(){return w.H.useId()},exports.useImperativeHandle=function(e,t,n){return w.H.useImperativeHandle(e,t,n)},exports.useInsertionEffect=function(e,t){return w.H.useInsertionEffect(e,t)},exports.useLayoutEffect=function(e,t){return w.H.useLayoutEffect(e,t)},exports.useMemo=function(e,t){return w.H.useMemo(e,t)},exports.useOptimistic=function(e,t){return w.H.useOptimistic(e,t)},exports.useReducer=function(e,t,n){return w.H.useReducer(e,t,n)},exports.useRef=function(e){return w.H.useRef(e)},exports.useState=function(e){return w.H.useState(e)},exports.useSyncExternalStore=function(e,t,n){return w.H.useSyncExternalStore(e,t,n)},exports.useTransition=function(){return w.H.useTransition()},exports.version=`19.2.0`})),u=o(((exports,t)=>{t.exports=l()})),d=o((exports=>{function t(e,t){var n=e.length;e.push(t);a:for(;0<n;){var r=n-1>>>1,a=e[r];if(0<i(a,t))e[r]=t,e[n]=a,n=r;else break a}}function n(e){return e.length===0?null:e[0]}function r(e){if(e.length===0)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;a:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,c=e[s],l=s+1,u=e[l];if(0>i(c,n))l<a&&0>i(u,c)?(e[r]=u,e[l]=n,r=l):(e[r]=c,e[s]=n,r=s);else if(l<a&&0>i(u,n))e[r]=u,e[l]=n,r=l;else break a}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return n===0?e.id-t.id:n}if(exports.unstable_now=void 0,typeof performance==`object`&&typeof performance.now==`function`){var a=performance;exports.unstable_now=function(){return a.now()}}else{var o=Date,s=o.now();exports.unstable_now=function(){return o.now()-s}}var c=[],l=[],u=1,d=null,f=3,p=!1,m=!1,h=!1,g=!1,_=typeof setTimeout==`function`?setTimeout:null,v=typeof clearTimeout==`function`?clearTimeout:null,y=typeof setImmediate<`u`?setImmediate:null;function b(e){for(var i=n(l);i!==null;){if(i.callback===null)r(l);else if(i.startTime<=e)r(l),i.sortIndex=i.expirationTime,t(c,i);else break;i=n(l)}}function x(e){if(h=!1,b(e),!m)if(n(c)!==null)m=!0,S||(S=!0,O());else{var t=n(l);t!==null&&te(x,t.startTime-e)}}var S=!1,C=-1,w=5,T=-1;function E(){return g?!0:!(exports.unstable_now()-T<w)}function D(){if(g=!1,S){var t=exports.unstable_now();T=t;var i=!0;try{a:{m=!1,h&&(h=!1,v(C),C=-1),p=!0;var a=f;try{b:{for(b(t),d=n(c);d!==null&&!(d.expirationTime>t&&E());){var o=d.callback;if(typeof o==`function`){d.callback=null,f=d.priorityLevel;var s=o(d.expirationTime<=t);if(t=exports.unstable_now(),typeof s==`function`){d.callback=s,b(t),i=!0;break b}d===n(c)&&r(c),b(t)}else r(c);d=n(c)}if(d!==null)i=!0;else{var u=n(l);u!==null&&te(x,u.startTime-t),i=!1}}break a}finally{d=null,f=a,p=!1}i=void 0}}finally{i?O():S=!1}}}var O;if(typeof y==`function`)O=function(){y(D)};else if(typeof MessageChannel<`u`){var ee=new MessageChannel,k=ee.port2;ee.port1.onmessage=D,O=function(){k.postMessage(null)}}else O=function(){_(D,0)};function te(t,n){C=_(function(){t(exports.unstable_now())},n)}exports.unstable_IdlePriority=5,exports.unstable_ImmediatePriority=1,exports.unstable_LowPriority=4,exports.unstable_NormalPriority=3,exports.unstable_Profiling=null,exports.unstable_UserBlockingPriority=2,exports.unstable_cancelCallback=function(e){e.callback=null},exports.unstable_forceFrameRate=function(e){0>e||125<e?console.error(`forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported`):w=0<e?Math.floor(1e3/e):5},exports.unstable_getCurrentPriorityLevel=function(){return f},exports.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},exports.unstable_requestPaint=function(){g=!0},exports.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},exports.unstable_scheduleCallback=function(r,i,a){var o=exports.unstable_now();switch(typeof a==`object`&&a?(a=a.delay,a=typeof a==`number`&&0<a?o+a:o):a=o,r){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return s=a+s,r={id:u++,callback:i,priorityLevel:r,startTime:a,expirationTime:s,sortIndex:-1},a>o?(r.sortIndex=a,t(l,r),n(c)===null&&r===n(l)&&(h?(v(C),C=-1):h=!0,te(x,a-o))):(r.sortIndex=s,t(c,r),m||p||(m=!0,S||(S=!0,O()))),r},exports.unstable_shouldYield=E,exports.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}})),f=o(((exports,t)=>{t.exports=d()})),p=o((exports=>{var t=u();function n(e){var t=`https://react.dev/errors/`+e;if(1<arguments.length){t+=`?args[]=`+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+=`&args[]=`+encodeURIComponent(arguments[n])}return`Minified React error #`+e+`; visit `+t+` for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`}function r(){}var i={d:{f:r,r:function(){throw Error(n(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},a=Symbol.for(`react.portal`);function o(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:r==null?null:``+r,children:e,containerInfo:t,implementation:n}}var s=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){if(e===`font`)return``;if(typeof t==`string`)return t===`use-credentials`?t:``}exports.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,exports.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)throw Error(n(299));return o(e,t,null,r)},exports.flushSync=function(e){var t=s.T,n=i.p;try{if(s.T=null,i.p=2,e)return e()}finally{s.T=t,i.p=n,i.d.f()}},exports.preconnect=function(e,t){typeof e==`string`&&(t?(t=t.crossOrigin,t=typeof t==`string`?t===`use-credentials`?t:``:void 0):t=null,i.d.C(e,t))},exports.prefetchDNS=function(e){typeof e==`string`&&i.d.D(e)},exports.preinit=function(e,t){if(typeof e==`string`&&t&&typeof t.as==`string`){var n=t.as,r=c(n,t.crossOrigin),a=typeof t.integrity==`string`?t.integrity:void 0,o=typeof t.fetchPriority==`string`?t.fetchPriority:void 0;n===`style`?i.d.S(e,typeof t.precedence==`string`?t.precedence:void 0,{crossOrigin:r,integrity:a,fetchPriority:o}):n===`script`&&i.d.X(e,{crossOrigin:r,integrity:a,fetchPriority:o,nonce:typeof t.nonce==`string`?t.nonce:void 0})}},exports.preinitModule=function(e,t){if(typeof e==`string`)if(typeof t==`object`&&t){if(t.as==null||t.as===`script`){var n=c(t.as,t.crossOrigin);i.d.M(e,{crossOrigin:n,integrity:typeof t.integrity==`string`?t.integrity:void 0,nonce:typeof t.nonce==`string`?t.nonce:void 0})}}else t??i.d.M(e)},exports.preload=function(e,t){if(typeof e==`string`&&typeof t==`object`&&t&&typeof t.as==`string`){var n=t.as,r=c(n,t.crossOrigin);i.d.L(e,n,{crossOrigin:r,integrity:typeof t.integrity==`string`?t.integrity:void 0,nonce:typeof t.nonce==`string`?t.nonce:void 0,type:typeof t.type==`string`?t.type:void 0,fetchPriority:typeof t.fetchPriority==`string`?t.fetchPriority:void 0,referrerPolicy:typeof t.referrerPolicy==`string`?t.referrerPolicy:void 0,imageSrcSet:typeof t.imageSrcSet==`string`?t.imageSrcSet:void 0,imageSizes:typeof t.imageSizes==`string`?t.imageSizes:void 0,media:typeof t.media==`string`?t.media:void 0})}},exports.preloadModule=function(e,t){if(typeof e==`string`)if(t){var n=c(t.as,t.crossOrigin);i.d.m(e,{as:typeof t.as==`string`&&t.as!==`script`?t.as:void 0,crossOrigin:n,integrity:typeof t.integrity==`string`?t.integrity:void 0})}else i.d.m(e)},exports.requestFormReset=function(e){i.d.r(e)},exports.unstable_batchedUpdates=function(e,t){return e(t)},exports.useFormState=function(e,t,n){return s.H.useFormState(e,t,n)},exports.useFormStatus=function(){return s.H.useHostTransitionStatus()},exports.version=`19.2.0`})),m=o(((exports,t)=>{function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>`u`||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!=`function`))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}n(),t.exports=p()})),h=o((exports=>{var t=f(),n=u(),r=m();function i(e){var t=`https://react.dev/errors/`+e;if(1<arguments.length){t+=`?args[]=`+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+=`&args[]=`+encodeURIComponent(arguments[n])}return`Minified React error #`+e+`; visit `+t+` for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`}function a(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function o(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function s(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function c(e){if(e.tag===31){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function l(e){if(o(e)!==e)throw Error(i(188))}function d(e){var t=e.alternate;if(!t){if(t=o(e),t===null)throw Error(i(188));return t===e?e:null}for(var n=e,r=t;;){var a=n.return;if(a===null)break;var s=a.alternate;if(s===null){if(r=a.return,r!==null){n=r;continue}break}if(a.child===s.child){for(s=a.child;s;){if(s===n)return l(a),e;if(s===r)return l(a),t;s=s.sibling}throw Error(i(188))}if(n.return!==r.return)n=a,r=s;else{for(var c=!1,u=a.child;u;){if(u===n){c=!0,n=a,r=s;break}if(u===r){c=!0,r=a,n=s;break}u=u.sibling}if(!c){for(u=s.child;u;){if(u===n){c=!0,n=s,r=a;break}if(u===r){c=!0,r=s,n=a;break}u=u.sibling}if(!c)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(n.tag!==3)throw Error(i(188));return n.stateNode.current===n?e:t}function p(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=p(e),t!==null)return t;e=e.sibling}return null}var h=Object.assign,g=Symbol.for(`react.element`),_=Symbol.for(`react.transitional.element`),v=Symbol.for(`react.portal`),y=Symbol.for(`react.fragment`),b=Symbol.for(`react.strict_mode`),x=Symbol.for(`react.profiler`),S=Symbol.for(`react.consumer`),C=Symbol.for(`react.context`),w=Symbol.for(`react.forward_ref`),T=Symbol.for(`react.suspense`),E=Symbol.for(`react.suspense_list`),D=Symbol.for(`react.memo`),O=Symbol.for(`react.lazy`),ee=Symbol.for(`react.activity`),k=Symbol.for(`react.memo_cache_sentinel`),te=Symbol.iterator;function ne(e){return typeof e!=`object`||!e?null:(e=te&&e[te]||e[`@@iterator`],typeof e==`function`?e:null)}var re=Symbol.for(`react.client.reference`);function ie(e){if(e==null)return null;if(typeof e==`function`)return e.$$typeof===re?null:e.displayName||e.name||null;if(typeof e==`string`)return e;switch(e){case y:return`Fragment`;case x:return`Profiler`;case b:return`StrictMode`;case T:return`Suspense`;case E:return`SuspenseList`;case ee:return`Activity`}if(typeof e==`object`)switch(e.$$typeof){case v:return`Portal`;case C:return e.displayName||`Context`;case S:return(e._context.displayName||`Context`)+`.Consumer`;case w:var t=e.render;return e=e.displayName,e||=(e=t.displayName||t.name||``,e===``?`ForwardRef`:`ForwardRef(`+e+`)`),e;case D:return t=e.displayName||null,t===null?ie(e.type)||`Memo`:t;case O:t=e._payload,e=e._init;try{return ie(e(t))}catch{}}return null}var ae=Array.isArray,A=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,j=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,oe={pending:!1,data:null,method:null,action:null},se=[],ce=-1;function le(e){return{current:e}}function ue(e){0>ce||(e.current=se[ce],se[ce]=null,ce--)}function M(e,t){ce++,se[ce]=e.current,e.current=t}var de=le(null),fe=le(null),N=le(null),P=le(null);function pe(e,t){switch(M(N,t),M(fe,e),M(de,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?lf(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=lf(t),e=uf(t,e);else switch(e){case`svg`:e=1;break;case`math`:e=2;break;default:e=0}}ue(de),M(de,e)}function F(){ue(de),ue(fe),ue(N)}function me(e){e.memoizedState!==null&&M(P,e);var t=de.current,n=uf(t,e.type);t!==n&&(M(fe,e),M(de,n))}function he(e){fe.current===e&&(ue(de),ue(fe)),P.current===e&&(ue(P),yp._currentValue=oe)}var ge,_e;function ve(e){if(ge===void 0)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);ge=t&&t[1]||``,_e=-1<e.stack.indexOf(`
    at`)?` (<anonymous>)`:-1<e.stack.indexOf(`@`)?`@unknown:0:0`:``}return`
`+ge+e+_e}var ye=!1;function be(e,t){if(!e||ye)return``;ye=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,`props`,{set:function(){throw Error()}}),typeof Reflect==`object`&&Reflect.construct){try{Reflect.construct(n,[])}catch(e){var r=e}Reflect.construct(e,[],n)}else{try{n.call()}catch(e){r=e}e.call(n.prototype)}}else{try{throw Error()}catch(e){r=e}(n=e())&&typeof n.catch==`function`&&n.catch(function(){})}}catch(e){if(e&&r&&typeof e.stack==`string`)return[e.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName=`DetermineComponentFrameRoot`;var i=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,`name`);i&&i.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,`name`,{value:`DetermineComponentFrameRoot`});var a=r.DetermineComponentFrameRoot(),o=a[0],s=a[1];if(o&&s){var c=o.split(`
`),l=s.split(`
`);for(i=r=0;r<c.length&&!c[r].includes(`DetermineComponentFrameRoot`);)r++;for(;i<l.length&&!l[i].includes(`DetermineComponentFrameRoot`);)i++;if(r===c.length||i===l.length)for(r=c.length-1,i=l.length-1;1<=r&&0<=i&&c[r]!==l[i];)i--;for(;1<=r&&0<=i;r--,i--)if(c[r]!==l[i]){if(r!==1||i!==1)do if(r--,i--,0>i||c[r]!==l[i]){var u=`
`+c[r].replace(` at new `,` at `);return e.displayName&&u.includes(`<anonymous>`)&&(u=u.replace(`<anonymous>`,e.displayName)),u}while(1<=r&&0<=i);break}}}finally{ye=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:``)?ve(n):``}function xe(e,t){switch(e.tag){case 26:case 27:case 5:return ve(e.type);case 16:return ve(`Lazy`);case 13:return e.child!==t&&t!==null?ve(`Suspense Fallback`):ve(`Suspense`);case 19:return ve(`SuspenseList`);case 0:case 15:return be(e.type,!1);case 11:return be(e.type.render,!1);case 1:return be(e.type,!0);case 31:return ve(`Activity`);default:return``}}function Se(e){try{var t=``,n=null;do t+=xe(e,n),n=e,e=e.return;while(e);return t}catch(e){return`
Error generating stack: `+e.message+`
`+e.stack}}var Ce=Object.prototype.hasOwnProperty,we=t.unstable_scheduleCallback,Te=t.unstable_cancelCallback,Ee=t.unstable_shouldYield,De=t.unstable_requestPaint,Oe=t.unstable_now,ke=t.unstable_getCurrentPriorityLevel,Ae=t.unstable_ImmediatePriority,je=t.unstable_UserBlockingPriority,Me=t.unstable_NormalPriority,Ne=t.unstable_LowPriority,Pe=t.unstable_IdlePriority,I=t.log,Fe=t.unstable_setDisableYieldValue,Ie=null,Le=null;function L(e){if(typeof I==`function`&&Fe(e),Le&&typeof Le.setStrictMode==`function`)try{Le.setStrictMode(Ie,e)}catch{}}var Re=Math.clz32?Math.clz32:Ve,ze=Math.log,Be=Math.LN2;function Ve(e){return e>>>=0,e===0?32:31-(ze(e)/Be|0)|0}var He=256,Ue=262144,We=4194304;function Ge(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Ke(e,t,n){var r=e.pendingLanes;if(r===0)return 0;var i=0,a=e.suspendedLanes,o=e.pingedLanes;e=e.warmLanes;var s=r&134217727;return s===0?(s=r&~a,s===0?o===0?n||(n=r&~e,n!==0&&(i=Ge(n))):i=Ge(o):i=Ge(s)):(r=s&~a,r===0?(o&=s,o===0?n||(n=s&~e,n!==0&&(i=Ge(n))):i=Ge(o)):i=Ge(r)),i===0?0:t!==0&&t!==i&&(t&a)===0&&(a=i&-i,n=t&-t,a>=n||a===32&&n&4194048)?t:i}function qe(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function Je(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function R(){var e=We;return We<<=1,!(We&62914560)&&(We=4194304),e}function Ye(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Xe(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ze(e,t,n,r,i,a){var o=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var s=e.entanglements,c=e.expirationTimes,l=e.hiddenUpdates;for(n=o&~n;0<n;){var u=31-Re(n),d=1<<u;s[u]=0,c[u]=-1;var f=l[u];if(f!==null)for(l[u]=null,u=0;u<f.length;u++){var p=f[u];p!==null&&(p.lane&=-536870913)}n&=~d}r!==0&&Qe(e,r,0),a!==0&&i===0&&e.tag!==0&&(e.suspendedLanes|=a&~(o&~t))}function Qe(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-Re(t);e.entangledLanes|=t,e.entanglements[r]=e.entanglements[r]|1073741824|n&261930}function $e(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Re(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}function et(e,t){var n=t&-t;return n=n&42?1:tt(n),(n&(e.suspendedLanes|t))===0?n:0}function tt(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function nt(e){return e&=-e,2<e?8<e?e&134217727?32:268435456:8:2}function rt(){var e=j.p;return e===0?(e=window.event,e===void 0?32:Fp(e.type)):e}function it(e,t){var n=j.p;try{return j.p=e,t()}finally{j.p=n}}var at=Math.random().toString(36).slice(2),ot=`__reactFiber$`+at,st=`__reactProps$`+at,ct=`__reactContainer$`+at,lt=`__reactEvents$`+at,ut=`__reactListeners$`+at,dt=`__reactHandles$`+at,ft=`__reactResources$`+at,pt=`__reactMarker$`+at;function mt(e){delete e[ot],delete e[st],delete e[lt],delete e[ut],delete e[dt]}function ht(e){var t=e[ot];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ct]||n[ot]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Mf(e);e!==null;){if(n=e[ot])return n;e=Mf(e)}return t}e=n,n=e.parentNode}return null}function gt(e){if(e=e[ot]||e[ct]){var t=e.tag;if(t===5||t===6||t===13||t===31||t===26||t===27||t===3)return e}return null}function _t(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(i(33))}function vt(e){var t=e[ft];return t||=e[ft]={hoistableStyles:new Map,hoistableScripts:new Map},t}function yt(e){e[pt]=!0}var bt=new Set,xt={};function St(e,t){z(e,t),z(e+`Capture`,t)}function z(e,t){for(xt[e]=t,e=0;e<t.length;e++)bt.add(t[e])}var Ct=RegExp(`^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$`),wt={},Tt={};function Et(e){return Ce.call(Tt,e)?!0:Ce.call(wt,e)?!1:Ct.test(e)?Tt[e]=!0:(wt[e]=!0,!1)}function Dt(e,t,n){if(Et(t))if(n===null)e.removeAttribute(t);else{switch(typeof n){case`undefined`:case`function`:case`symbol`:e.removeAttribute(t);return;case`boolean`:var r=t.toLowerCase().slice(0,5);if(r!==`data-`&&r!==`aria-`){e.removeAttribute(t);return}}e.setAttribute(t,``+n)}}function Ot(e,t,n){if(n===null)e.removeAttribute(t);else{switch(typeof n){case`undefined`:case`function`:case`symbol`:case`boolean`:e.removeAttribute(t);return}e.setAttribute(t,``+n)}}function kt(e,t,n,r){if(r===null)e.removeAttribute(n);else{switch(typeof r){case`undefined`:case`function`:case`symbol`:case`boolean`:e.removeAttribute(n);return}e.setAttributeNS(t,n,``+r)}}function At(e){switch(typeof e){case`bigint`:case`boolean`:case`number`:case`string`:case`undefined`:return e;case`object`:return e;default:return``}}function jt(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()===`input`&&(t===`checkbox`||t===`radio`)}function Mt(e,t,n){var r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&r!==void 0&&typeof r.get==`function`&&typeof r.set==`function`){var i=r.get,a=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){n=``+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(e){n=``+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Nt(e){if(!e._valueTracker){var t=jt(e)?`checked`:`value`;e._valueTracker=Mt(e,t,``+e[t])}}function Pt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r=``;return e&&(r=jt(e)?e.checked?`true`:`false`:e.value),e=r,e===n?!1:(t.setValue(e),!0)}function Ft(e){if(e||=typeof document<`u`?document:void 0,e===void 0)return null;try{return e.activeElement||e.body}catch{return e.body}}var It=/[\n"\\]/g;function Lt(e){return e.replace(It,function(e){return`\\`+e.charCodeAt(0).toString(16)+` `})}function Rt(e,t,n,r,i,a,o,s){e.name=``,o!=null&&typeof o!=`function`&&typeof o!=`symbol`&&typeof o!=`boolean`?e.type=o:e.removeAttribute(`type`),t==null?o!==`submit`&&o!==`reset`||e.removeAttribute(`value`):o===`number`?(t===0&&e.value===``||e.value!=t)&&(e.value=``+At(t)):e.value!==``+At(t)&&(e.value=``+At(t)),t==null?n==null?r!=null&&e.removeAttribute(`value`):B(e,o,At(n)):B(e,o,At(t)),i==null&&a!=null&&(e.defaultChecked=!!a),i!=null&&(e.checked=i&&typeof i!=`function`&&typeof i!=`symbol`),s!=null&&typeof s!=`function`&&typeof s!=`symbol`&&typeof s!=`boolean`?e.name=``+At(s):e.removeAttribute(`name`)}function zt(e,t,n,r,i,a,o,s){if(a!=null&&typeof a!=`function`&&typeof a!=`symbol`&&typeof a!=`boolean`&&(e.type=a),t!=null||n!=null){if(!(a!==`submit`&&a!==`reset`||t!=null)){Nt(e);return}n=n==null?``:``+At(n),t=t==null?n:``+At(t),s||t===e.value||(e.value=t),e.defaultValue=t}r??=i,r=typeof r!=`function`&&typeof r!=`symbol`&&!!r,e.checked=s?e.checked:!!r,e.defaultChecked=!!r,o!=null&&typeof o!=`function`&&typeof o!=`symbol`&&typeof o!=`boolean`&&(e.name=o),Nt(e)}function B(e,t,n){t===`number`&&Ft(e.ownerDocument)===e||e.defaultValue===``+n||(e.defaultValue=``+n)}function Bt(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t[`$`+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty(`$`+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=``+At(n),t=null,i=0;i<e.length;i++){if(e[i].value===n){e[i].selected=!0,r&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function Vt(e,t,n){if(t!=null&&(t=``+At(t),t!==e.value&&(e.value=t),n==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=n==null?``:``+At(n)}function Ht(e,t,n,r){if(t==null){if(r!=null){if(n!=null)throw Error(i(92));if(ae(r)){if(1<r.length)throw Error(i(93));r=r[0]}n=r}n??=``,t=n}n=At(t),e.defaultValue=n,r=e.textContent,r===n&&r!==``&&r!==null&&(e.value=r),Nt(e)}function Ut(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Wt=new Set(`animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp`.split(` `));function Gt(e,t,n){var r=t.indexOf(`--`)===0;n==null||typeof n==`boolean`||n===``?r?e.setProperty(t,``):t===`float`?e.cssFloat=``:e[t]=``:r?e.setProperty(t,n):typeof n!=`number`||n===0||Wt.has(t)?t===`float`?e.cssFloat=n:e[t]=(``+n).trim():e[t]=n+`px`}function Kt(e,t,n){if(t!=null&&typeof t!=`object`)throw Error(i(62));if(e=e.style,n!=null){for(var r in n)!n.hasOwnProperty(r)||t!=null&&t.hasOwnProperty(r)||(r.indexOf(`--`)===0?e.setProperty(r,``):r===`float`?e.cssFloat=``:e[r]=``);for(var a in t)r=t[a],t.hasOwnProperty(a)&&n[a]!==r&&Gt(e,a,r)}else for(var o in t)t.hasOwnProperty(o)&&Gt(e,o,t[o])}function qt(e){if(e.indexOf(`-`)===-1)return!1;switch(e){case`annotation-xml`:case`color-profile`:case`font-face`:case`font-face-src`:case`font-face-uri`:case`font-face-format`:case`font-face-name`:case`missing-glyph`:return!1;default:return!0}}var Jt=new Map([[`acceptCharset`,`accept-charset`],[`htmlFor`,`for`],[`httpEquiv`,`http-equiv`],[`crossOrigin`,`crossorigin`],[`accentHeight`,`accent-height`],[`alignmentBaseline`,`alignment-baseline`],[`arabicForm`,`arabic-form`],[`baselineShift`,`baseline-shift`],[`capHeight`,`cap-height`],[`clipPath`,`clip-path`],[`clipRule`,`clip-rule`],[`colorInterpolation`,`color-interpolation`],[`colorInterpolationFilters`,`color-interpolation-filters`],[`colorProfile`,`color-profile`],[`colorRendering`,`color-rendering`],[`dominantBaseline`,`dominant-baseline`],[`enableBackground`,`enable-background`],[`fillOpacity`,`fill-opacity`],[`fillRule`,`fill-rule`],[`floodColor`,`flood-color`],[`floodOpacity`,`flood-opacity`],[`fontFamily`,`font-family`],[`fontSize`,`font-size`],[`fontSizeAdjust`,`font-size-adjust`],[`fontStretch`,`font-stretch`],[`fontStyle`,`font-style`],[`fontVariant`,`font-variant`],[`fontWeight`,`font-weight`],[`glyphName`,`glyph-name`],[`glyphOrientationHorizontal`,`glyph-orientation-horizontal`],[`glyphOrientationVertical`,`glyph-orientation-vertical`],[`horizAdvX`,`horiz-adv-x`],[`horizOriginX`,`horiz-origin-x`],[`imageRendering`,`image-rendering`],[`letterSpacing`,`letter-spacing`],[`lightingColor`,`lighting-color`],[`markerEnd`,`marker-end`],[`markerMid`,`marker-mid`],[`markerStart`,`marker-start`],[`overlinePosition`,`overline-position`],[`overlineThickness`,`overline-thickness`],[`paintOrder`,`paint-order`],[`panose-1`,`panose-1`],[`pointerEvents`,`pointer-events`],[`renderingIntent`,`rendering-intent`],[`shapeRendering`,`shape-rendering`],[`stopColor`,`stop-color`],[`stopOpacity`,`stop-opacity`],[`strikethroughPosition`,`strikethrough-position`],[`strikethroughThickness`,`strikethrough-thickness`],[`strokeDasharray`,`stroke-dasharray`],[`strokeDashoffset`,`stroke-dashoffset`],[`strokeLinecap`,`stroke-linecap`],[`strokeLinejoin`,`stroke-linejoin`],[`strokeMiterlimit`,`stroke-miterlimit`],[`strokeOpacity`,`stroke-opacity`],[`strokeWidth`,`stroke-width`],[`textAnchor`,`text-anchor`],[`textDecoration`,`text-decoration`],[`textRendering`,`text-rendering`],[`transformOrigin`,`transform-origin`],[`underlinePosition`,`underline-position`],[`underlineThickness`,`underline-thickness`],[`unicodeBidi`,`unicode-bidi`],[`unicodeRange`,`unicode-range`],[`unitsPerEm`,`units-per-em`],[`vAlphabetic`,`v-alphabetic`],[`vHanging`,`v-hanging`],[`vIdeographic`,`v-ideographic`],[`vMathematical`,`v-mathematical`],[`vectorEffect`,`vector-effect`],[`vertAdvY`,`vert-adv-y`],[`vertOriginX`,`vert-origin-x`],[`vertOriginY`,`vert-origin-y`],[`wordSpacing`,`word-spacing`],[`writingMode`,`writing-mode`],[`xmlnsXlink`,`xmlns:xlink`],[`xHeight`,`x-height`]]),Yt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Xt(e){return Yt.test(``+e)?`javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')`:e}function Zt(){}var Qt=null;function $t(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var en=null,tn=null;function nn(e){var t=gt(e);if(t&&(e=t.stateNode)){var n=e[st]||null;a:switch(e=t.stateNode,t.type){case`input`:if(Rt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,n.type===`radio`&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll(`input[name="`+Lt(``+t)+`"][type="radio"]`),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=r[st]||null;if(!a)throw Error(i(90));Rt(r,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name)}}for(t=0;t<n.length;t++)r=n[t],r.form===e.form&&Pt(r)}break a;case`textarea`:Vt(e,n.value,n.defaultValue);break a;case`select`:t=n.value,t!=null&&Bt(e,!!n.multiple,t,!1)}}}var rn=!1;function an(e,t,n){if(rn)return e(t,n);rn=!0;try{return e(t)}finally{if(rn=!1,(en!==null||tn!==null)&&(Iu(),en&&(t=en,e=tn,tn=en=null,nn(t),e)))for(t=0;t<e.length;t++)nn(e[t])}}function on(e,t){var n=e.stateNode;if(n===null)return null;var r=n[st]||null;if(r===null)return null;n=r[t];a:switch(t){case`onClick`:case`onClickCapture`:case`onDoubleClick`:case`onDoubleClickCapture`:case`onMouseDown`:case`onMouseDownCapture`:case`onMouseMove`:case`onMouseMoveCapture`:case`onMouseUp`:case`onMouseUpCapture`:case`onMouseEnter`:(r=!r.disabled)||(e=e.type,r=!(e===`button`||e===`input`||e===`select`||e===`textarea`)),e=!r;break a;default:e=!1}if(e)return null;if(n&&typeof n!=`function`)throw Error(i(231,t,typeof n));return n}var sn=!(typeof window>`u`||window.document===void 0||window.document.createElement===void 0),cn=!1;if(sn)try{var ln={};Object.defineProperty(ln,`passive`,{get:function(){cn=!0}}),window.addEventListener(`test`,ln,ln),window.removeEventListener(`test`,ln,ln)}catch{cn=!1}var un=null,dn=null,fn=null;function pn(){if(fn)return fn;var e,t=dn,n=t.length,r,i=`value`in un?un.value:un.textContent,a=i.length;for(e=0;e<n&&t[e]===i[e];e++);var o=n-e;for(r=1;r<=o&&t[n-r]===i[a-r];r++);return fn=i.slice(e,1<r?1-r:void 0)}function mn(e){var t=e.keyCode;return`charCode`in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function hn(){return!0}function gn(){return!1}function _n(e){function t(t,n,r,i,a){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented==null?!1===i.returnValue:i.defaultPrevented)?hn:gn,this.isPropagationStopped=gn,this}return h(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():typeof e.returnValue!=`unknown`&&(e.returnValue=!1),this.isDefaultPrevented=hn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():typeof e.cancelBubble!=`unknown`&&(e.cancelBubble=!0),this.isPropagationStopped=hn)},persist:function(){},isPersistent:hn}),t}var vn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yn=_n(vn),bn=h({},vn,{view:0,detail:0}),xn=_n(bn),Sn,Cn,wn,Tn=h({},bn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Vn,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return`movementX`in e?e.movementX:(e!==wn&&(wn&&e.type===`mousemove`?(Sn=e.screenX-wn.screenX,Cn=e.screenY-wn.screenY):Cn=Sn=0,wn=e),Sn)},movementY:function(e){return`movementY`in e?e.movementY:Cn}}),En=_n(Tn),Dn=h({},Tn,{dataTransfer:0}),On=_n(Dn),kn=h({},bn,{relatedTarget:0}),An=_n(kn),jn=h({},vn,{animationName:0,elapsedTime:0,pseudoElement:0}),Mn=_n(jn),Nn=h({},vn,{clipboardData:function(e){return`clipboardData`in e?e.clipboardData:window.clipboardData}}),Pn=_n(Nn),Fn=h({},vn,{data:0}),In=_n(Fn),Ln={Esc:`Escape`,Spacebar:` `,Left:`ArrowLeft`,Up:`ArrowUp`,Right:`ArrowRight`,Down:`ArrowDown`,Del:`Delete`,Win:`OS`,Menu:`ContextMenu`,Apps:`ContextMenu`,Scroll:`ScrollLock`,MozPrintableKey:`Unidentified`},Rn={8:`Backspace`,9:`Tab`,12:`Clear`,13:`Enter`,16:`Shift`,17:`Control`,18:`Alt`,19:`Pause`,20:`CapsLock`,27:`Escape`,32:` `,33:`PageUp`,34:`PageDown`,35:`End`,36:`Home`,37:`ArrowLeft`,38:`ArrowUp`,39:`ArrowRight`,40:`ArrowDown`,45:`Insert`,46:`Delete`,112:`F1`,113:`F2`,114:`F3`,115:`F4`,116:`F5`,117:`F6`,118:`F7`,119:`F8`,120:`F9`,121:`F10`,122:`F11`,123:`F12`,144:`NumLock`,145:`ScrollLock`,224:`Meta`},zn={Alt:`altKey`,Control:`ctrlKey`,Meta:`metaKey`,Shift:`shiftKey`};function Bn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=zn[e])?!!t[e]:!1}function Vn(){return Bn}var Hn=h({},bn,{key:function(e){if(e.key){var t=Ln[e.key]||e.key;if(t!==`Unidentified`)return t}return e.type===`keypress`?(e=mn(e),e===13?`Enter`:String.fromCharCode(e)):e.type===`keydown`||e.type===`keyup`?Rn[e.keyCode]||`Unidentified`:``},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Vn,charCode:function(e){return e.type===`keypress`?mn(e):0},keyCode:function(e){return e.type===`keydown`||e.type===`keyup`?e.keyCode:0},which:function(e){return e.type===`keypress`?mn(e):e.type===`keydown`||e.type===`keyup`?e.keyCode:0}}),Un=_n(Hn),Wn=h({},Tn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Gn=_n(Wn),Kn=h({},bn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Vn}),qn=_n(Kn),Jn=h({},vn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Yn=_n(Jn),Xn=h({},Tn,{deltaX:function(e){return`deltaX`in e?e.deltaX:`wheelDeltaX`in e?-e.wheelDeltaX:0},deltaY:function(e){return`deltaY`in e?e.deltaY:`wheelDeltaY`in e?-e.wheelDeltaY:`wheelDelta`in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Zn=_n(Xn),Qn=h({},vn,{newState:0,oldState:0}),$n=_n(Qn),er=[9,13,27,32],tr=sn&&`CompositionEvent`in window,nr=null;sn&&`documentMode`in document&&(nr=document.documentMode);var rr=sn&&`TextEvent`in window&&!nr,ir=sn&&(!tr||nr&&8<nr&&11>=nr),ar=` `,or=!1;function sr(e,t){switch(e){case`keyup`:return er.indexOf(t.keyCode)!==-1;case`keydown`:return t.keyCode!==229;case`keypress`:case`mousedown`:case`focusout`:return!0;default:return!1}}function cr(e){return e=e.detail,typeof e==`object`&&`data`in e?e.data:null}var lr=!1;function ur(e,t){switch(e){case`compositionend`:return cr(t);case`keypress`:return t.which===32?(or=!0,ar):null;case`textInput`:return e=t.data,e===ar&&or?null:e;default:return null}}function dr(e,t){if(lr)return e===`compositionend`||!tr&&sr(e,t)?(e=pn(),fn=dn=un=null,lr=!1,e):null;switch(e){case`paste`:return null;case`keypress`:if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case`compositionend`:return ir&&t.locale!==`ko`?null:t.data;default:return null}}var fr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t===`input`?!!fr[e.type]:t===`textarea`}function mr(e,t,n,r){en?tn?tn.push(r):tn=[r]:en=r,t=Gd(t,`onChange`),0<t.length&&(n=new yn(`onChange`,`change`,null,n,r),e.push({event:n,listeners:t}))}var hr=null,gr=null;function _r(e){Rd(e,0)}function vr(e){var t=_t(e);if(Pt(t))return e}function yr(e,t){if(e===`change`)return t}var br=!1;if(sn){var xr;if(sn){var Sr=`oninput`in document;if(!Sr){var Cr=document.createElement(`div`);Cr.setAttribute(`oninput`,`return;`),Sr=typeof Cr.oninput==`function`}xr=Sr}else xr=!1;br=xr&&(!document.documentMode||9<document.documentMode)}function wr(){hr&&(hr.detachEvent(`onpropertychange`,Tr),gr=hr=null)}function Tr(e){if(e.propertyName===`value`&&vr(gr)){var t=[];mr(t,gr,e,$t(e)),an(_r,t)}}function V(e,t,n){e===`focusin`?(wr(),hr=t,gr=n,hr.attachEvent(`onpropertychange`,Tr)):e===`focusout`&&wr()}function Er(e){if(e===`selectionchange`||e===`keyup`||e===`keydown`)return vr(gr)}function Dr(e,t){if(e===`click`)return vr(t)}function Or(e,t){if(e===`input`||e===`change`)return vr(t)}function kr(e,t){return e===t&&(e!==0||1/e==1/t)||e!==e&&t!==t}var Ar=typeof Object.is==`function`?Object.is:kr;function jr(e,t){if(Ar(e,t))return!0;if(typeof e!=`object`||!e||typeof t!=`object`||!t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!Ce.call(t,i)||!Ar(e[i],t[i]))return!1}return!0}function Mr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Nr(e,t){var n=Mr(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}a:{for(;n;){if(n.nextSibling){n=n.nextSibling;break a}n=n.parentNode}n=void 0}n=Mr(n)}}function Pr(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Pr(e,t.parentNode):`contains`in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Fr(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=Ft(e.document);t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href==`string`}catch{n=!1}if(n)e=t.contentWindow;else break;t=Ft(e.document)}return t}function Ir(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t===`input`&&(e.type===`text`||e.type===`search`||e.type===`tel`||e.type===`url`||e.type===`password`)||t===`textarea`||e.contentEditable===`true`)}var Lr=sn&&`documentMode`in document&&11>=document.documentMode,Rr=null,zr=null,Br=null,Vr=!1;function Hr(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Vr||Rr==null||Rr!==Ft(r)||(r=Rr,`selectionStart`in r&&Ir(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Br&&jr(Br,r)||(Br=r,r=Gd(zr,`onSelect`),0<r.length&&(t=new yn(`onSelect`,`select`,null,t,n),e.push({event:t,listeners:r}),t.target=Rr)))}function Ur(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n[`Webkit`+e]=`webkit`+t,n[`Moz`+e]=`moz`+t,n}var Wr={animationend:Ur(`Animation`,`AnimationEnd`),animationiteration:Ur(`Animation`,`AnimationIteration`),animationstart:Ur(`Animation`,`AnimationStart`),transitionrun:Ur(`Transition`,`TransitionRun`),transitionstart:Ur(`Transition`,`TransitionStart`),transitioncancel:Ur(`Transition`,`TransitionCancel`),transitionend:Ur(`Transition`,`TransitionEnd`)},Gr={},Kr={};sn&&(Kr=document.createElement(`div`).style,`AnimationEvent`in window||(delete Wr.animationend.animation,delete Wr.animationiteration.animation,delete Wr.animationstart.animation),`TransitionEvent`in window||delete Wr.transitionend.transition);function qr(e){if(Gr[e])return Gr[e];if(!Wr[e])return e;var t=Wr[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in Kr)return Gr[e]=t[n];return e}var Jr=qr(`animationend`),Yr=qr(`animationiteration`),Xr=qr(`animationstart`),Zr=qr(`transitionrun`),Qr=qr(`transitionstart`),$r=qr(`transitioncancel`),ei=qr(`transitionend`),ti=new Map,ni=`abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel`.split(` `);ni.push(`scrollEnd`);function ri(e,t){ti.set(e,t),St(t,[e])}var ii=typeof reportError==`function`?reportError:function(e){if(typeof window==`object`&&typeof window.ErrorEvent==`function`){var t=new window.ErrorEvent(`error`,{bubbles:!0,cancelable:!0,message:typeof e==`object`&&e&&typeof e.message==`string`?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process==`object`&&typeof process.emit==`function`){process.emit(`uncaughtException`,e);return}console.error(e)},ai=[],oi=0,si=0;function ci(){for(var e=oi,t=si=oi=0;t<e;){var n=ai[t];ai[t++]=null;var r=ai[t];ai[t++]=null;var i=ai[t];ai[t++]=null;var a=ai[t];if(ai[t++]=null,r!==null&&i!==null){var o=r.pending;o===null?i.next=i:(i.next=o.next,o.next=i),r.pending=i}a!==0&&fi(n,i,a)}}function li(e,t,n,r){ai[oi++]=e,ai[oi++]=t,ai[oi++]=n,ai[oi++]=r,si|=r,e.lanes|=r,e=e.alternate,e!==null&&(e.lanes|=r)}function ui(e,t,n,r){return li(e,t,n,r),pi(e)}function di(e,t){return li(e,null,null,t),pi(e)}function fi(e,t,n){e.lanes|=n;var r=e.alternate;r!==null&&(r.lanes|=n);for(var i=!1,a=e.return;a!==null;)a.childLanes|=n,r=a.alternate,r!==null&&(r.childLanes|=n),a.tag===22&&(e=a.stateNode,e===null||e._visibility&1||(i=!0)),e=a,a=a.return;return e.tag===3?(a=e.stateNode,i&&t!==null&&(i=31-Re(n),e=a.hiddenUpdates,r=e[i],r===null?e[i]=[t]:r.push(t),t.lane=n|536870912),a):null}function pi(e){if(50<Du)throw Du=0,Ou=null,Error(i(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var mi={};function hi(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gi(e,t,n,r){return new hi(e,t,n,r)}function _i(e){return e=e.prototype,!(!e||!e.isReactComponent)}function vi(e,t){var n=e.alternate;return n===null?(n=gi(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&65011712,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function yi(e,t){e.flags&=65011714;var n=e.alternate;return n===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function bi(e,t,n,r,a,o){var s=0;if(r=e,typeof e==`function`)_i(e)&&(s=1);else if(typeof e==`string`)s=up(e,n,de.current)?26:e===`html`||e===`head`||e===`body`?27:5;else a:switch(e){case ee:return e=gi(31,n,t,a),e.elementType=ee,e.lanes=o,e;case y:return xi(n.children,a,o,t);case b:s=8,a|=24;break;case x:return e=gi(12,n,t,a|2),e.elementType=x,e.lanes=o,e;case T:return e=gi(13,n,t,a),e.elementType=T,e.lanes=o,e;case E:return e=gi(19,n,t,a),e.elementType=E,e.lanes=o,e;default:if(typeof e==`object`&&e)switch(e.$$typeof){case C:s=10;break a;case S:s=9;break a;case w:s=11;break a;case D:s=14;break a;case O:s=16,r=null;break a}s=29,n=Error(i(130,e===null?`null`:typeof e,``)),r=null}return t=gi(s,n,t,a),t.elementType=e,t.type=r,t.lanes=o,t}function xi(e,t,n,r){return e=gi(7,e,r,t),e.lanes=n,e}function Si(e,t,n){return e=gi(6,e,null,t),e.lanes=n,e}function Ci(e){var t=gi(18,null,null,0);return t.stateNode=e,t}function wi(e,t,n){return t=gi(4,e.children===null?[]:e.children,e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Ti=new WeakMap;function Ei(e,t){if(typeof e==`object`&&e){var n=Ti.get(e);return n===void 0?(t={value:e,source:t,stack:Se(t)},Ti.set(e,t),t):n}return{value:e,source:t,stack:Se(t)}}var Di=[],Oi=0,ki=null,Ai=0,ji=[],Mi=0,Ni=null,Pi=1,Fi=``;function Ii(e,t){Di[Oi++]=Ai,Di[Oi++]=ki,ki=e,Ai=t}function Li(e,t,n){ji[Mi++]=Pi,ji[Mi++]=Fi,ji[Mi++]=Ni,Ni=e;var r=Pi;e=Fi;var i=32-Re(r)-1;r&=~(1<<i),n+=1;var a=32-Re(t)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Pi=1<<32-Re(t)+i|n<<i|r,Fi=a+e}else Pi=1<<a|n<<i|r,Fi=e}function Ri(e){e.return!==null&&(Ii(e,1),Li(e,1,0))}function zi(e){for(;e===ki;)ki=Di[--Oi],Di[Oi]=null,Ai=Di[--Oi],Di[Oi]=null;for(;e===Ni;)Ni=ji[--Mi],ji[Mi]=null,Fi=ji[--Mi],ji[Mi]=null,Pi=ji[--Mi],ji[Mi]=null}function Bi(e,t){ji[Mi++]=Pi,ji[Mi++]=Fi,ji[Mi++]=Ni,Pi=t.id,Fi=t.overflow,Ni=e}var Vi=null,Hi=null,Ui=!1,Wi=null,Gi=!1,Ki=Error(i(519));function qi(e){var t=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?`text`:`HTML`,``));throw $i(Ei(t,e)),Ki}function Ji(e){var t=e.stateNode,n=e.type,r=e.memoizedProps;switch(t[ot]=e,t[st]=r,n){case`dialog`:J(`cancel`,t),J(`close`,t);break;case`iframe`:case`object`:case`embed`:J(`load`,t);break;case`video`:case`audio`:for(n=0;n<Id.length;n++)J(Id[n],t);break;case`source`:J(`error`,t);break;case`img`:case`image`:case`link`:J(`error`,t),J(`load`,t);break;case`details`:J(`toggle`,t);break;case`input`:J(`invalid`,t),zt(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0);break;case`select`:J(`invalid`,t);break;case`textarea`:J(`invalid`,t),Ht(t,r.value,r.defaultValue,r.children)}n=r.children,typeof n!=`string`&&typeof n!=`number`&&typeof n!=`bigint`||t.textContent===``+n||!0===r.suppressHydrationWarning||Zd(t.textContent,n)?(r.popover!=null&&(J(`beforetoggle`,t),J(`toggle`,t)),r.onScroll!=null&&J(`scroll`,t),r.onScrollEnd!=null&&J(`scrollend`,t),r.onClick!=null&&(t.onclick=Zt),t=!0):t=!1,t||qi(e,!0)}function Yi(e){for(Vi=e.return;Vi;)switch(Vi.tag){case 5:case 31:case 13:Gi=!1;return;case 27:case 3:Gi=!0;return;default:Vi=Vi.return}}function Xi(e){if(e!==Vi)return!1;if(!Ui)return Yi(e),Ui=!0,!1;var t=e.tag,n;if((n=t!==3&&t!==27)&&((n=t===5)&&(n=e.type,n=!(n!==`form`&&n!==`button`)||df(e.type,e.memoizedProps)),n=!n),n&&Hi&&qi(e),Yi(e),t===13){if(e=e.memoizedState,e=e===null?null:e.dehydrated,!e)throw Error(i(317));Hi=jf(e)}else if(t===31){if(e=e.memoizedState,e=e===null?null:e.dehydrated,!e)throw Error(i(317));Hi=jf(e)}else t===27?(t=Hi,yf(e.type)?(e=Af,Af=null,Hi=e):Hi=t):Hi=Vi?kf(e.stateNode.nextSibling):null;return!0}function Zi(){Hi=Vi=null,Ui=!1}function Qi(){var e=Wi;return e!==null&&(pu===null?pu=e:pu.push.apply(pu,e),Wi=null),e}function $i(e){Wi===null?Wi=[e]:Wi.push(e)}var ea=le(null),ta=null,na=null;function ra(e,t,n){M(ea,t._currentValue),t._currentValue=n}function ia(e){e._currentValue=ea.current,ue(ea)}function aa(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)===t?r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t):(e.childLanes|=t,r!==null&&(r.childLanes|=t)),e===n)break;e=e.return}}function oa(e,t,n,r){var a=e.child;for(a!==null&&(a.return=e);a!==null;){var o=a.dependencies;if(o!==null){var s=a.child;o=o.firstContext;a:for(;o!==null;){var c=o;o=a;for(var l=0;l<t.length;l++)if(c.context===t[l]){o.lanes|=n,c=o.alternate,c!==null&&(c.lanes|=n),aa(o.return,n,e),r||(s=null);break a}o=c.next}}else if(a.tag===18){if(s=a.return,s===null)throw Error(i(341));s.lanes|=n,o=s.alternate,o!==null&&(o.lanes|=n),aa(s,n,e),s=null}else s=a.child;if(s!==null)s.return=a;else for(s=a;s!==null;){if(s===e){s=null;break}if(a=s.sibling,a!==null){a.return=s.return,s=a;break}s=s.return}a=s}}function sa(e,t,n,r){e=null;for(var a=t,o=!1;a!==null;){if(!o){if(a.flags&524288)o=!0;else if(a.flags&262144)break}if(a.tag===10){var s=a.alternate;if(s===null)throw Error(i(387));if(s=s.memoizedProps,s!==null){var c=a.type;Ar(a.pendingProps.value,s.value)||(e===null?e=[c]:e.push(c))}}else if(a===P.current){if(s=a.alternate,s===null)throw Error(i(387));s.memoizedState.memoizedState!==a.memoizedState.memoizedState&&(e===null?e=[yp]:e.push(yp))}a=a.return}e!==null&&oa(t,e,n,r),t.flags|=262144}function ca(e){for(e=e.firstContext;e!==null;){if(!Ar(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function la(e){ta=e,na=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function ua(e){return fa(ta,e)}function da(e,t){return ta===null&&la(e),fa(e,t)}function fa(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},na===null){if(e===null)throw Error(i(308));na=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else na=na.next=t;return n}var pa=typeof AbortController<`u`?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},ma=t.unstable_scheduleCallback,ha=t.unstable_NormalPriority,ga={$$typeof:C,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function _a(){return{controller:new pa,data:new Map,refCount:0}}function va(e){e.refCount--,e.refCount===0&&ma(ha,function(){e.controller.abort()})}var ya=null,ba=0,xa=0,Sa=null;function Ca(e,t){if(ya===null){var n=ya=[];ba=0,xa=Od(),Sa={status:`pending`,value:void 0,then:function(e){n.push(e)}}}return ba++,t.then(wa,wa),t}function wa(){if(--ba===0&&ya!==null){Sa!==null&&(Sa.status=`fulfilled`);var e=ya;ya=null,xa=0,Sa=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function Ta(e,t){var n=[],r={status:`pending`,value:null,reason:null,then:function(e){n.push(e)}};return e.then(function(){r.status=`fulfilled`,r.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)},function(e){for(r.status=`rejected`,r.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)}),r}var Ea=A.S;A.S=function(e,t){gu=Oe(),typeof t==`object`&&t&&typeof t.then==`function`&&Ca(e,t),Ea!==null&&Ea(e,t)};var Da=le(null);function Oa(){var e=Da.current;return e===null?Zl.pooledCache:e}function ka(e,t){t===null?M(Da,Da.current):M(Da,t.pool)}function Aa(){var e=Oa();return e===null?null:{parent:ga._currentValue,pool:e}}var ja=Error(i(460)),Ma=Error(i(474)),Na=Error(i(542)),Pa={then:function(){}};function Fa(e){return e=e.status,e===`fulfilled`||e===`rejected`}function Ia(e,t,n){switch(n=e[n],n===void 0?e.push(t):n!==t&&(t.then(Zt,Zt),t=n),t.status){case`fulfilled`:return t.value;case`rejected`:throw e=t.reason,Ba(e),e;default:if(typeof t.status==`string`)t.then(Zt,Zt);else{if(e=Zl,e!==null&&100<e.shellSuspendCounter)throw Error(i(482));e=t,e.status=`pending`,e.then(function(e){if(t.status===`pending`){var n=t;n.status=`fulfilled`,n.value=e}},function(e){if(t.status===`pending`){var n=t;n.status=`rejected`,n.reason=e}})}switch(t.status){case`fulfilled`:return t.value;case`rejected`:throw e=t.reason,Ba(e),e}throw Ra=t,ja}}function La(e){try{var t=e._init;return t(e._payload)}catch(e){throw typeof e==`object`&&e&&typeof e.then==`function`?(Ra=e,ja):e}}var Ra=null;function za(){if(Ra===null)throw Error(i(459));var e=Ra;return Ra=null,e}function Ba(e){if(e===ja||e===Na)throw Error(i(483))}var Va=null,Ha=0;function Ua(e){var t=Ha;return Ha+=1,Va===null&&(Va=[]),Ia(Va,e,t)}function Wa(e,t){t=t.props.ref,e.ref=t===void 0?null:t}function Ga(e,t){throw t.$$typeof===g?Error(i(525)):(e=Object.prototype.toString.call(t),Error(i(31,e===`[object Object]`?`object with keys {`+Object.keys(t).join(`, `)+`}`:e)))}function Ka(e){function t(t,n){if(e){var r=t.deletions;r===null?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;r!==null;)t(n,r),r=r.sibling;return null}function r(e){for(var t=new Map;e!==null;)e.key===null?t.set(e.index,e):t.set(e.key,e),e=e.sibling;return t}function a(e,t){return e=vi(e,t),e.index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?(r=t.alternate,r===null?(t.flags|=67108866,n):(r=r.index,r<n?(t.flags|=67108866,n):r)):(t.flags|=1048576,n)}function s(t){return e&&t.alternate===null&&(t.flags|=67108866),t}function c(e,t,n,r){return t===null||t.tag!==6?(t=Si(n,e.mode,r),t.return=e,t):(t=a(t,n),t.return=e,t)}function l(e,t,n,r){var i=n.type;return i===y?d(e,t,n.props.children,r,n.key):t!==null&&(t.elementType===i||typeof i==`object`&&i&&i.$$typeof===O&&La(i)===t.type)?(t=a(t,n.props),Wa(t,n),t.return=e,t):(t=bi(n.type,n.key,n.props,null,e.mode,r),Wa(t,n),t.return=e,t)}function u(e,t,n,r){return t===null||t.tag!==4||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?(t=wi(n,e.mode,r),t.return=e,t):(t=a(t,n.children||[]),t.return=e,t)}function d(e,t,n,r,i){return t===null||t.tag!==7?(t=xi(n,e.mode,r,i),t.return=e,t):(t=a(t,n),t.return=e,t)}function f(e,t,n){if(typeof t==`string`&&t!==``||typeof t==`number`||typeof t==`bigint`)return t=Si(``+t,e.mode,n),t.return=e,t;if(typeof t==`object`&&t){switch(t.$$typeof){case _:return n=bi(t.type,t.key,t.props,null,e.mode,n),Wa(n,t),n.return=e,n;case v:return t=wi(t,e.mode,n),t.return=e,t;case O:return t=La(t),f(e,t,n)}if(ae(t)||ne(t))return t=xi(t,e.mode,n,null),t.return=e,t;if(typeof t.then==`function`)return f(e,Ua(t),n);if(t.$$typeof===C)return f(e,da(e,t),n);Ga(e,t)}return null}function p(e,t,n,r){var i=t===null?null:t.key;if(typeof n==`string`&&n!==``||typeof n==`number`||typeof n==`bigint`)return i===null?c(e,t,``+n,r):null;if(typeof n==`object`&&n){switch(n.$$typeof){case _:return n.key===i?l(e,t,n,r):null;case v:return n.key===i?u(e,t,n,r):null;case O:return n=La(n),p(e,t,n,r)}if(ae(n)||ne(n))return i===null?d(e,t,n,r,null):null;if(typeof n.then==`function`)return p(e,t,Ua(n),r);if(n.$$typeof===C)return p(e,t,da(e,n),r);Ga(e,n)}return null}function m(e,t,n,r,i){if(typeof r==`string`&&r!==``||typeof r==`number`||typeof r==`bigint`)return e=e.get(n)||null,c(t,e,``+r,i);if(typeof r==`object`&&r){switch(r.$$typeof){case _:return e=e.get(r.key===null?n:r.key)||null,l(t,e,r,i);case v:return e=e.get(r.key===null?n:r.key)||null,u(t,e,r,i);case O:return r=La(r),m(e,t,n,r,i)}if(ae(r)||ne(r))return e=e.get(n)||null,d(t,e,r,i,null);if(typeof r.then==`function`)return m(e,t,n,Ua(r),i);if(r.$$typeof===C)return m(e,t,n,da(t,r),i);Ga(t,r)}return null}function h(i,a,s,c){for(var l=null,u=null,d=a,h=a=0,g=null;d!==null&&h<s.length;h++){d.index>h?(g=d,d=null):g=d.sibling;var _=p(i,d,s[h],c);if(_===null){d===null&&(d=g);break}e&&d&&_.alternate===null&&t(i,d),a=o(_,a,h),u===null?l=_:u.sibling=_,u=_,d=g}if(h===s.length)return n(i,d),Ui&&Ii(i,h),l;if(d===null){for(;h<s.length;h++)d=f(i,s[h],c),d!==null&&(a=o(d,a,h),u===null?l=d:u.sibling=d,u=d);return Ui&&Ii(i,h),l}for(d=r(d);h<s.length;h++)g=m(d,i,h,s[h],c),g!==null&&(e&&g.alternate!==null&&d.delete(g.key===null?h:g.key),a=o(g,a,h),u===null?l=g:u.sibling=g,u=g);return e&&d.forEach(function(e){return t(i,e)}),Ui&&Ii(i,h),l}function g(a,s,c,l){if(c==null)throw Error(i(151));for(var u=null,d=null,h=s,g=s=0,_=null,v=c.next();h!==null&&!v.done;g++,v=c.next()){h.index>g?(_=h,h=null):_=h.sibling;var y=p(a,h,v.value,l);if(y===null){h===null&&(h=_);break}e&&h&&y.alternate===null&&t(a,h),s=o(y,s,g),d===null?u=y:d.sibling=y,d=y,h=_}if(v.done)return n(a,h),Ui&&Ii(a,g),u;if(h===null){for(;!v.done;g++,v=c.next())v=f(a,v.value,l),v!==null&&(s=o(v,s,g),d===null?u=v:d.sibling=v,d=v);return Ui&&Ii(a,g),u}for(h=r(h);!v.done;g++,v=c.next())v=m(h,a,g,v.value,l),v!==null&&(e&&v.alternate!==null&&h.delete(v.key===null?g:v.key),s=o(v,s,g),d===null?u=v:d.sibling=v,d=v);return e&&h.forEach(function(e){return t(a,e)}),Ui&&Ii(a,g),u}function b(e,r,o,c){if(typeof o==`object`&&o&&o.type===y&&o.key===null&&(o=o.props.children),typeof o==`object`&&o){switch(o.$$typeof){case _:a:{for(var l=o.key;r!==null;){if(r.key===l){if(l=o.type,l===y){if(r.tag===7){n(e,r.sibling),c=a(r,o.props.children),c.return=e,e=c;break a}}else if(r.elementType===l||typeof l==`object`&&l&&l.$$typeof===O&&La(l)===r.type){n(e,r.sibling),c=a(r,o.props),Wa(c,o),c.return=e,e=c;break a}n(e,r);break}else t(e,r);r=r.sibling}o.type===y?(c=xi(o.props.children,e.mode,c,o.key),c.return=e,e=c):(c=bi(o.type,o.key,o.props,null,e.mode,c),Wa(c,o),c.return=e,e=c)}return s(e);case v:a:{for(l=o.key;r!==null;){if(r.key===l)if(r.tag===4&&r.stateNode.containerInfo===o.containerInfo&&r.stateNode.implementation===o.implementation){n(e,r.sibling),c=a(r,o.children||[]),c.return=e,e=c;break a}else{n(e,r);break}else t(e,r);r=r.sibling}c=wi(o,e.mode,c),c.return=e,e=c}return s(e);case O:return o=La(o),b(e,r,o,c)}if(ae(o))return h(e,r,o,c);if(ne(o)){if(l=ne(o),typeof l!=`function`)throw Error(i(150));return o=l.call(o),g(e,r,o,c)}if(typeof o.then==`function`)return b(e,r,Ua(o),c);if(o.$$typeof===C)return b(e,r,da(e,o),c);Ga(e,o)}return typeof o==`string`&&o!==``||typeof o==`number`||typeof o==`bigint`?(o=``+o,r!==null&&r.tag===6?(n(e,r.sibling),c=a(r,o),c.return=e,e=c):(n(e,r),c=Si(o,e.mode,c),c.return=e,e=c),s(e)):n(e,r)}return function(e,t,n,r){try{Ha=0;var i=b(e,t,n,r);return Va=null,i}catch(t){if(t===ja||t===Na)throw t;var a=gi(29,t,null,e.mode);return a.lanes=r,a.return=e,a}}}var qa=Ka(!0),Ja=Ka(!1),Ya=!1;function Xa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Za(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Qa(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function $a(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,q&2){var i=r.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),r.pending=t,t=pi(e),fi(e,null,n),t}return li(e,r,t,n),pi(e)}function eo(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,n&4194048)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,$e(e,n)}}function to(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var o={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};a===null?i=a=o:a=a.next=o,n=n.next}while(n!==null);a===null?i=a=t:a=a.next=t}else i=a=t;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,callbacks:r.callbacks},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var no=!1;function ro(){if(no){var e=Sa;if(e!==null)throw e}}function io(e,t,n,r){no=!1;var i=e.updateQueue;Ya=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,s=i.shared.pending;if(s!==null){i.shared.pending=null;var c=s,l=c.next;c.next=null,o===null?a=l:o.next=l,o=c;var u=e.alternate;u!==null&&(u=u.updateQueue,s=u.lastBaseUpdate,s!==o&&(s===null?u.firstBaseUpdate=l:s.next=l,u.lastBaseUpdate=c))}if(a!==null){var d=i.baseState;o=0,u=l=c=null,s=a;do{var f=s.lane&-536870913,p=f!==s.lane;if(p?($l&f)===f:(r&f)===f){f!==0&&f===xa&&(no=!0),u!==null&&(u=u.next={lane:0,tag:s.tag,payload:s.payload,callback:null,next:null});a:{var m=e,g=s;f=t;var _=n;switch(g.tag){case 1:if(m=g.payload,typeof m==`function`){d=m.call(_,d,f);break a}d=m;break a;case 3:m.flags=m.flags&-65537|128;case 0:if(m=g.payload,f=typeof m==`function`?m.call(_,d,f):m,f==null)break a;d=h({},d,f);break a;case 2:Ya=!0}}f=s.callback,f!==null&&(e.flags|=64,p&&(e.flags|=8192),p=i.callbacks,p===null?i.callbacks=[f]:p.push(f))}else p={lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},u===null?(l=u=p,c=d):u=u.next=p,o|=f;if(s=s.next,s===null){if(s=i.shared.pending,s===null)break;p=s,s=p.next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}while(1);u===null&&(c=d),i.baseState=c,i.firstBaseUpdate=l,i.lastBaseUpdate=u,a===null&&(i.shared.lanes=0),su|=o,e.lanes=o,e.memoizedState=d}}function ao(e,t){if(typeof e!=`function`)throw Error(i(191,e));e.call(t)}function oo(e,t){var n=e.callbacks;if(n!==null)for(e.callbacks=null,e=0;e<n.length;e++)ao(n[e],t)}var so=le(null),co=le(0);function lo(e,t){e=au,M(co,e),M(so,t),au=e|t.baseLanes}function uo(){M(co,au),M(so,so.current)}function fo(){au=co.current,ue(so),ue(co)}var po=le(null),mo=null;function ho(e){var t=e.alternate;M(bo,bo.current&1),M(po,e),mo===null&&(t===null||so.current!==null||t.memoizedState!==null)&&(mo=e)}function go(e){M(bo,bo.current),M(po,e),mo===null&&(mo=e)}function _o(e){e.tag===22?(M(bo,bo.current),M(po,e),mo===null&&(mo=e)):vo(e)}function vo(){M(bo,bo.current),M(po,po.current)}function yo(e){ue(po),mo===e&&(mo=null),ue(bo)}var bo=le(0);function xo(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||Ef(n)||Df(n)))return t}else if(t.tag===19&&(t.memoizedProps.revealOrder===`forwards`||t.memoizedProps.revealOrder===`backwards`||t.memoizedProps.revealOrder===`unstable_legacy-backwards`||t.memoizedProps.revealOrder===`together`)){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var So=0,H=null,Co=null,wo=null,To=!1,Eo=!1,Do=!1,Oo=0,ko=0,Ao=null,jo=0;function Mo(){throw Error(i(321))}function No(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Ar(e[n],t[n]))return!1;return!0}function Po(e,t,n,r,i,a){return So=a,H=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,A.H=e===null||e.memoizedState===null?$s:ec,Do=!1,a=n(r,i),Do=!1,Eo&&(a=Io(t,n,r,i)),Fo(e),a}function Fo(e){A.H=Qs;var t=Co!==null&&Co.next!==null;if(So=0,wo=Co=H=null,To=!1,ko=0,Ao=null,t)throw Error(i(300));e===null||_c||(e=e.dependencies,e!==null&&ca(e)&&(_c=!0))}function Io(e,t,n,r){H=e;var a=0;do{if(Eo&&(Ao=null),ko=0,Eo=!1,25<=a)throw Error(i(301));if(a+=1,wo=Co=null,e.updateQueue!=null){var o=e.updateQueue;o.lastEffect=null,o.events=null,o.stores=null,o.memoCache!=null&&(o.memoCache.index=0)}A.H=tc,o=t(n,r)}while(Eo);return o}function Lo(){var e=A.H,t=e.useState()[0];return t=typeof t.then==`function`?Wo(t):t,e=e.useState()[0],(Co===null?null:Co.memoizedState)!==e&&(H.flags|=1024),t}function Ro(){var e=Oo!==0;return Oo=0,e}function zo(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function Bo(e){if(To){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}To=!1}So=0,wo=Co=H=null,Eo=!1,ko=Oo=0,Ao=null}function Vo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return wo===null?H.memoizedState=wo=e:wo=wo.next=e,wo}function Ho(){if(Co===null){var e=H.alternate;e=e===null?null:e.memoizedState}else e=Co.next;var t=wo===null?H.memoizedState:wo.next;if(t!==null)wo=t,Co=e;else{if(e===null)throw H.alternate===null?Error(i(467)):Error(i(310));Co=e,e={memoizedState:Co.memoizedState,baseState:Co.baseState,baseQueue:Co.baseQueue,queue:Co.queue,next:null},wo===null?H.memoizedState=wo=e:wo=wo.next=e}return wo}function Uo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Wo(e){var t=ko;return ko+=1,Ao===null&&(Ao=[]),e=Ia(Ao,e,t),t=H,(wo===null?t.memoizedState:wo.next)===null&&(t=t.alternate,A.H=t===null||t.memoizedState===null?$s:ec),e}function Go(e){if(typeof e==`object`&&e){if(typeof e.then==`function`)return Wo(e);if(e.$$typeof===C)return ua(e)}throw Error(i(438,String(e)))}function Ko(e){var t=null,n=H.updateQueue;if(n!==null&&(t=n.memoCache),t==null){var r=H.alternate;r!==null&&(r=r.updateQueue,r!==null&&(r=r.memoCache,r!=null&&(t={data:r.data.map(function(e){return e.slice()}),index:0})))}if(t??={data:[],index:0},n===null&&(n=Uo(),H.updateQueue=n),n.memoCache=t,n=t.data[t.index],n===void 0)for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=k;return t.index++,n}function qo(e,t){return typeof t==`function`?t(e):t}function Jo(e){var t=Ho();return Yo(t,Co,e)}function Yo(e,t,n){var r=e.queue;if(r===null)throw Error(i(311));r.lastRenderedReducer=n;var a=e.baseQueue,o=r.pending;if(o!==null){if(a!==null){var s=a.next;a.next=o.next,o.next=s}t.baseQueue=a=o,r.pending=null}if(o=e.baseState,a===null)e.memoizedState=o;else{t=a.next;var c=s=null,l=null,u=t,d=!1;do{var f=u.lane&-536870913;if(f===u.lane?(So&f)===f:($l&f)===f){var p=u.revertLane;if(p===0)l!==null&&(l=l.next={lane:0,revertLane:0,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),f===xa&&(d=!0);else if((So&p)===p){u=u.next,p===xa&&(d=!0);continue}else f={lane:0,revertLane:u.revertLane,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},l===null?(c=l=f,s=o):l=l.next=f,H.lanes|=p,su|=p;f=u.action,Do&&n(o,f),o=u.hasEagerState?u.eagerState:n(o,f)}else p={lane:f,revertLane:u.revertLane,gesture:u.gesture,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},l===null?(c=l=p,s=o):l=l.next=p,H.lanes|=f,su|=f;u=u.next}while(u!==null&&u!==t);if(l===null?s=o:l.next=c,!Ar(o,e.memoizedState)&&(_c=!0,d&&(n=Sa,n!==null)))throw n;e.memoizedState=o,e.baseState=s,e.baseQueue=l,r.lastRenderedState=o}return a===null&&(r.lanes=0),[e.memoizedState,r.dispatch]}function Xo(e){var t=Ho(),n=t.queue;if(n===null)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,o=t.memoizedState;if(a!==null){n.pending=null;var s=a=a.next;do o=e(o,s.action),s=s.next;while(s!==a);Ar(o,t.memoizedState)||(_c=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Zo(e,t,n){var r=H,a=Ho(),o=Ui;if(o){if(n===void 0)throw Error(i(407));n=n()}else n=t();var s=!Ar((Co||a).memoizedState,n);if(s&&(a.memoizedState=n,_c=!0),a=a.queue,ws(es.bind(null,r,a,e),[e]),a.getSnapshot!==t||s||wo!==null&&wo.memoizedState.tag&1){if(r.flags|=2048,ys(9,{destroy:void 0},$o.bind(null,r,a,n,t),null),Zl===null)throw Error(i(349));o||So&127||Qo(r,t,n)}return n}function Qo(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=H.updateQueue,t===null?(t=Uo(),H.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function $o(e,t,n,r){t.value=n,t.getSnapshot=r,ts(t)&&ns(e)}function es(e,t,n){return n(function(){ts(t)&&ns(e)})}function ts(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Ar(e,n)}catch{return!0}}function ns(e){var t=di(e,2);t!==null&&ju(t,e,2)}function rs(e){var t=Vo();if(typeof e==`function`){var n=e;if(e=n(),Do){L(!0);try{n()}finally{L(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:qo,lastRenderedState:e},t}function os(e,t,n,r){return e.baseState=n,Yo(e,Co,typeof r==`function`?r:qo)}function ss(e,t,n,r,a){if(Ys(e))throw Error(i(485));if(e=t.action,e!==null){var o={payload:a,action:e,next:null,isTransition:!0,status:`pending`,value:null,reason:null,listeners:[],then:function(e){o.listeners.push(e)}};A.T===null?o.isTransition=!1:n(!0),r(o),n=t.pending,n===null?(o.next=t.pending=o,cs(t,o)):(o.next=n.next,t.pending=n.next=o)}}function cs(e,t){var n=t.action,r=t.payload,i=e.state;if(t.isTransition){var a=A.T,o={};A.T=o;try{var s=n(i,r),c=A.S;c!==null&&c(o,s),ls(e,t,s)}catch(n){ds(e,t,n)}finally{a!==null&&o.types!==null&&(a.types=o.types),A.T=a}}else try{a=n(i,r),ls(e,t,a)}catch(n){ds(e,t,n)}}function ls(e,t,n){typeof n==`object`&&n&&typeof n.then==`function`?n.then(function(n){us(e,t,n)},function(n){return ds(e,t,n)}):us(e,t,n)}function us(e,t,n){t.status=`fulfilled`,t.value=n,fs(t),e.state=n,t=e.pending,t!==null&&(n=t.next,n===t?e.pending=null:(n=n.next,t.next=n,cs(e,n)))}function ds(e,t,n){var r=e.pending;if(e.pending=null,r!==null){r=r.next;do t.status=`rejected`,t.reason=n,fs(t),t=t.next;while(t!==r)}e.action=null}function fs(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function ps(e,t){return t}function ms(e,t){if(Ui){var n=Zl.formState;if(n!==null){a:{var r=H;if(Ui){if(Hi){b:{for(var i=Hi,a=Gi;i.nodeType!==8;){if(!a){i=null;break b}if(i=kf(i.nextSibling),i===null){i=null;break b}}a=i.data,i=a===`F!`||a===`F`?i:null}if(i){Hi=kf(i.nextSibling),r=i.data===`F!`;break a}}qi(r)}r=!1}r&&(t=n[0])}}return n=Vo(),n.memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ps,lastRenderedState:t},n.queue=r,n=Ks.bind(null,H,r),r.dispatch=n,r=rs(!1),a=Js.bind(null,H,!1,r.queue),r=Vo(),i={state:t,dispatch:null,action:e,pending:null},r.queue=i,n=ss.bind(null,H,i,a,n),i.dispatch=n,r.memoizedState=e,[t,n,!1]}function hs(e){var t=Ho();return gs(t,Co,e)}function gs(e,t,n){if(t=Yo(e,t,ps)[0],e=Jo(qo)[0],typeof t==`object`&&t&&typeof t.then==`function`)try{var r=Wo(t)}catch(e){throw e===ja?Na:e}else r=t;t=Ho();var i=t.queue,a=i.dispatch;return n!==t.memoizedState&&(H.flags|=2048,ys(9,{destroy:void 0},_s.bind(null,i,n),null)),[r,a,e]}function _s(e,t){e.action=t}function vs(e){var t=Ho(),n=Co;if(n!==null)return gs(t,n,e);Ho(),t=t.memoizedState,n=Ho();var r=n.queue.dispatch;return n.memoizedState=e,[t,r,!1]}function ys(e,t,n,r){return e={tag:e,create:n,deps:r,inst:t,next:null},t=H.updateQueue,t===null&&(t=Uo(),H.updateQueue=t),n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function bs(){return Ho().memoizedState}function xs(e,t,n,r){var i=Vo();H.flags|=e,i.memoizedState=ys(1|t,{destroy:void 0},n,r===void 0?null:r)}function Ss(e,t,n,r){var i=Ho();r=r===void 0?null:r;var a=i.memoizedState.inst;Co!==null&&r!==null&&No(r,Co.memoizedState.deps)?i.memoizedState=ys(t,a,n,r):(H.flags|=e,i.memoizedState=ys(1|t,a,n,r))}function Cs(e,t){xs(8390656,8,e,t)}function ws(e,t){Ss(2048,8,e,t)}function Ts(e){H.flags|=4;var t=H.updateQueue;if(t===null)t=Uo(),H.updateQueue=t,t.events=[e];else{var n=t.events;n===null?t.events=[e]:n.push(e)}}function Es(e){var t=Ho().memoizedState;return Ts({ref:t,nextImpl:e}),function(){if(q&2)throw Error(i(440));return t.impl.apply(void 0,arguments)}}function Ds(e,t){return Ss(4,2,e,t)}function Os(e,t){return Ss(4,4,e,t)}function ks(e,t){if(typeof t==`function`){e=e();var n=t(e);return function(){typeof n==`function`?n():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function As(e,t,n){n=n==null?null:n.concat([e]),Ss(4,4,ks.bind(null,t,e),n)}function js(){}function Ms(e,t){var n=Ho();t=t===void 0?null:t;var r=n.memoizedState;return t!==null&&No(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Ns(e,t){var n=Ho();t=t===void 0?null:t;var r=n.memoizedState;if(t!==null&&No(t,r[1]))return r[0];if(r=e(),Do){L(!0);try{e()}finally{L(!1)}}return n.memoizedState=[r,t],r}function Ps(e,t,n){return n===void 0||So&1073741824&&!($l&261930)?e.memoizedState=t:(e.memoizedState=n,e=Au(),H.lanes|=e,su|=e,n)}function Fs(e,t,n,r){return Ar(n,t)?n:so.current===null?!(So&42)||So&1073741824&&!($l&261930)?(_c=!0,e.memoizedState=n):(e=Au(),H.lanes|=e,su|=e,t):(e=Ps(e,n,r),Ar(e,t)||(_c=!0),e)}function Is(e,t,n,r,i){var a=j.p;j.p=a!==0&&8>a?a:8;var o=A.T,s={};A.T=s,Js(e,!1,t,n);try{var c=i(),l=A.S;if(l!==null&&l(s,c),typeof c==`object`&&c&&typeof c.then==`function`){var u=Ta(c,r);qs(e,t,u,ku(e))}else qs(e,t,r,ku(e))}catch(n){qs(e,t,{then:function(){},status:`rejected`,reason:n},ku())}finally{j.p=a,o!==null&&s.types!==null&&(o.types=s.types),A.T=o}}function Ls(){}function Rs(e,t,n,r){if(e.tag!==5)throw Error(i(476));var a=zs(e).queue;Is(e,a,t,oe,n===null?Ls:function(){return Bs(e),n(r)})}function zs(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:oe,baseState:oe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:qo,lastRenderedState:oe},next:null};var n={};return t.next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:qo,lastRenderedState:n},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function Bs(e){var t=zs(e);t.next===null&&(t=e.alternate.memoizedState),qs(e,t.next.queue,{},ku())}function Vs(){return ua(yp)}function Hs(){return Ho().memoizedState}function Us(){return Ho().memoizedState}function Ws(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var n=ku();e=Qa(n);var r=$a(t,e,n);r!==null&&(ju(r,t,n),eo(r,t,n)),t={cache:_a()},e.payload=t;return}t=t.return}}function Gs(e,t,n){var r=ku();n={lane:r,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},Ys(e)?Xs(t,n):(n=ui(e,t,n,r),n!==null&&(ju(n,e,r),Zs(n,t,r)))}function Ks(e,t,n){var r=ku();qs(e,t,n,r)}function qs(e,t,n,r){var i={lane:r,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ys(e))Xs(t,i);else{var a=e.alternate;if(e.lanes===0&&(a===null||a.lanes===0)&&(a=t.lastRenderedReducer,a!==null))try{var o=t.lastRenderedState,s=a(o,n);if(i.hasEagerState=!0,i.eagerState=s,Ar(s,o))return li(e,t,i,0),Zl===null&&ci(),!1}catch{}if(n=ui(e,t,i,r),n!==null)return ju(n,e,r),Zs(n,t,r),!0}return!1}function Js(e,t,n,r){if(r={lane:2,revertLane:Od(),gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null},Ys(e)){if(t)throw Error(i(479))}else t=ui(e,n,r,2),t!==null&&ju(t,e,2)}function Ys(e){var t=e.alternate;return e===H||t!==null&&t===H}function Xs(e,t){Eo=To=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Zs(e,t,n){if(n&4194048){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,$e(e,n)}}var Qs={readContext:ua,use:Go,useCallback:Mo,useContext:Mo,useEffect:Mo,useImperativeHandle:Mo,useLayoutEffect:Mo,useInsertionEffect:Mo,useMemo:Mo,useReducer:Mo,useRef:Mo,useState:Mo,useDebugValue:Mo,useDeferredValue:Mo,useTransition:Mo,useSyncExternalStore:Mo,useId:Mo,useHostTransitionStatus:Mo,useFormState:Mo,useActionState:Mo,useOptimistic:Mo,useMemoCache:Mo,useCacheRefresh:Mo};Qs.useEffectEvent=Mo;var $s={readContext:ua,use:Go,useCallback:function(e,t){return Vo().memoizedState=[e,t===void 0?null:t],e},useContext:ua,useEffect:Cs,useImperativeHandle:function(e,t,n){n=n==null?null:n.concat([e]),xs(4194308,4,ks.bind(null,t,e),n)},useLayoutEffect:function(e,t){return xs(4194308,4,e,t)},useInsertionEffect:function(e,t){xs(4,2,e,t)},useMemo:function(e,t){var n=Vo();t=t===void 0?null:t;var r=e();if(Do){L(!0);try{e()}finally{L(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=Vo();if(n!==void 0){var i=n(t);if(Do){L(!0);try{n(t)}finally{L(!1)}}}else i=t;return r.memoizedState=r.baseState=i,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},r.queue=e,e=e.dispatch=Gs.bind(null,H,e),[r.memoizedState,e]},useRef:function(e){var t=Vo();return e={current:e},t.memoizedState=e},useState:function(e){e=rs(e);var t=e.queue,n=Ks.bind(null,H,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:js,useDeferredValue:function(e,t){var n=Vo();return Ps(n,e,t)},useTransition:function(){var e=rs(!1);return e=Is.bind(null,H,e.queue,!0,!1),Vo().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var r=H,a=Vo();if(Ui){if(n===void 0)throw Error(i(407));n=n()}else{if(n=t(),Zl===null)throw Error(i(349));$l&127||Qo(r,t,n)}a.memoizedState=n;var o={value:n,getSnapshot:t};return a.queue=o,Cs(es.bind(null,r,o,e),[e]),r.flags|=2048,ys(9,{destroy:void 0},$o.bind(null,r,o,n,t),null),n},useId:function(){var e=Vo(),t=Zl.identifierPrefix;if(Ui){var n=Fi,r=Pi;n=(r&~(1<<32-Re(r)-1)).toString(32)+n,t=`_`+t+`R_`+n,n=Oo++,0<n&&(t+=`H`+n.toString(32)),t+=`_`}else n=jo++,t=`_`+t+`r_`+n.toString(32)+`_`;return e.memoizedState=t},useHostTransitionStatus:Vs,useFormState:ms,useActionState:ms,useOptimistic:function(e){var t=Vo();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=Js.bind(null,H,!0,n),n.dispatch=t,[e,t]},useMemoCache:Ko,useCacheRefresh:function(){return Vo().memoizedState=Ws.bind(null,H)},useEffectEvent:function(e){var t=Vo(),n={impl:e};return t.memoizedState=n,function(){if(q&2)throw Error(i(440));return n.impl.apply(void 0,arguments)}}},ec={readContext:ua,use:Go,useCallback:Ms,useContext:ua,useEffect:ws,useImperativeHandle:As,useInsertionEffect:Ds,useLayoutEffect:Os,useMemo:Ns,useReducer:Jo,useRef:bs,useState:function(){return Jo(qo)},useDebugValue:js,useDeferredValue:function(e,t){var n=Ho();return Fs(n,Co.memoizedState,e,t)},useTransition:function(){var e=Jo(qo)[0],t=Ho().memoizedState;return[typeof e==`boolean`?e:Wo(e),t]},useSyncExternalStore:Zo,useId:Hs,useHostTransitionStatus:Vs,useFormState:hs,useActionState:hs,useOptimistic:function(e,t){var n=Ho();return os(n,Co,e,t)},useMemoCache:Ko,useCacheRefresh:Us};ec.useEffectEvent=Es;var tc={readContext:ua,use:Go,useCallback:Ms,useContext:ua,useEffect:ws,useImperativeHandle:As,useInsertionEffect:Ds,useLayoutEffect:Os,useMemo:Ns,useReducer:Xo,useRef:bs,useState:function(){return Xo(qo)},useDebugValue:js,useDeferredValue:function(e,t){var n=Ho();return Co===null?Ps(n,e,t):Fs(n,Co.memoizedState,e,t)},useTransition:function(){var e=Xo(qo)[0],t=Ho().memoizedState;return[typeof e==`boolean`?e:Wo(e),t]},useSyncExternalStore:Zo,useId:Hs,useHostTransitionStatus:Vs,useFormState:vs,useActionState:vs,useOptimistic:function(e,t){var n=Ho();return Co===null?(n.baseState=e,[e,n.queue.dispatch]):os(n,Co,e,t)},useMemoCache:Ko,useCacheRefresh:Us};tc.useEffectEvent=Es;function nc(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:h({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var rc={enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ku(),i=Qa(r);i.payload=t,n!=null&&(i.callback=n),t=$a(e,i,r),t!==null&&(ju(t,e,r),eo(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ku(),i=Qa(r);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=$a(e,i,r),t!==null&&(ju(t,e,r),eo(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ku(),r=Qa(n);r.tag=2,t!=null&&(r.callback=t),t=$a(e,r,n),t!==null&&(ju(t,e,n),eo(t,e,n))}};function ic(e,t,n,r,i,a,o){return e=e.stateNode,typeof e.shouldComponentUpdate==`function`?e.shouldComponentUpdate(r,a,o):t.prototype&&t.prototype.isPureReactComponent?!jr(n,r)||!jr(i,a):!0}function ac(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps==`function`&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps==`function`&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&rc.enqueueReplaceState(t,t.state,null)}function oc(e,t){var n=t;if(`ref`in t)for(var r in n={},t)r!==`ref`&&(n[r]=t[r]);if(e=e.defaultProps)for(var i in n===t&&(n=h({},n)),e)n[i]===void 0&&(n[i]=e[i]);return n}function sc(e){ii(e)}function cc(e){console.error(e)}function lc(e){ii(e)}function uc(e,t){try{var n=e.onUncaughtError;n(t.value,{componentStack:t.stack})}catch(e){setTimeout(function(){throw e})}}function dc(e,t,n){try{var r=e.onCaughtError;r(n.value,{componentStack:n.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(e){setTimeout(function(){throw e})}}function fc(e,t,n){return n=Qa(n),n.tag=3,n.payload={element:null},n.callback=function(){uc(e,t)},n}function pc(e){return e=Qa(e),e.tag=3,e}function mc(e,t,n,r){var i=n.type.getDerivedStateFromError;if(typeof i==`function`){var a=r.value;e.payload=function(){return i(a)},e.callback=function(){dc(t,n,r)}}var o=n.stateNode;o!==null&&typeof o.componentDidCatch==`function`&&(e.callback=function(){dc(t,n,r),typeof i!=`function`&&(yu===null?yu=new Set([this]):yu.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:e===null?``:e})})}function hc(e,t,n,r,a){if(n.flags|=32768,typeof r==`object`&&r&&typeof r.then==`function`){if(t=n.alternate,t!==null&&sa(t,n,a,!0),n=po.current,n!==null){switch(n.tag){case 31:case 13:return mo===null?Uu():n.alternate===null&&ou===0&&(ou=3),n.flags&=-257,n.flags|=65536,n.lanes=a,r===Pa?n.flags|=16384:(t=n.updateQueue,t===null?n.updateQueue=new Set([r]):t.add(r),cd(e,r,a)),!1;case 22:return n.flags|=65536,r===Pa?n.flags|=16384:(t=n.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=t):(n=t.retryQueue,n===null?t.retryQueue=new Set([r]):n.add(r)),cd(e,r,a)),!1}throw Error(i(435,n.tag))}return cd(e,r,a),Uu(),!1}if(Ui)return t=po.current,t===null?(r!==Ki&&(t=Error(i(423),{cause:r}),$i(Ei(t,n))),e=e.current.alternate,e.flags|=65536,a&=-a,e.lanes|=a,r=Ei(r,n),a=fc(e.stateNode,r,a),to(e,a),ou!==4&&(ou=2)):(!(t.flags&65536)&&(t.flags|=256),t.flags|=65536,t.lanes=a,r!==Ki&&(e=Error(i(422),{cause:r}),$i(Ei(e,n)))),!1;var o=Error(i(520),{cause:r});if(o=Ei(o,n),fu===null?fu=[o]:fu.push(o),ou!==4&&(ou=2),t===null)return!0;r=Ei(r,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=a&-a,n.lanes|=e,e=fc(n.stateNode,r,e),to(n,e),!1;case 1:if(t=n.type,o=n.stateNode,!(n.flags&128)&&(typeof t.getDerivedStateFromError==`function`||o!==null&&typeof o.componentDidCatch==`function`&&(yu===null||!yu.has(o))))return n.flags|=65536,a&=-a,n.lanes|=a,a=pc(a),mc(a,e,n,r),to(n,a),!1}n=n.return}while(n!==null);return!1}var gc=Error(i(461)),_c=!1;function vc(e,t,n,r){t.child=e===null?Ja(t,null,n,r):qa(t,e.child,n,r)}function yc(e,t,n,r,i){n=n.render;var a=t.ref;if(`ref`in r){var o={};for(var s in r)s!==`ref`&&(o[s]=r[s])}else o=r;return la(t),r=Po(e,t,n,o,a,i),s=Ro(),e!==null&&!_c?(zo(e,t,i),Vc(e,t,i)):(Ui&&s&&Ri(t),t.flags|=1,vc(e,t,r,i),t.child)}function bc(e,t,n,r,i){if(e===null){var a=n.type;return typeof a==`function`&&!_i(a)&&a.defaultProps===void 0&&n.compare===null?(t.tag=15,t.type=a,xc(e,t,a,r,i)):(e=bi(n.type,null,r,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(a=e.child,!Hc(e,i)){var o=a.memoizedProps;if(n=n.compare,n=n===null?jr:n,n(o,r)&&e.ref===t.ref)return Vc(e,t,i)}return t.flags|=1,e=vi(a,r),e.ref=t.ref,e.return=t,t.child=e}function xc(e,t,n,r,i){if(e!==null){var a=e.memoizedProps;if(jr(a,r)&&e.ref===t.ref)if(_c=!1,t.pendingProps=r=a,Hc(e,i))e.flags&131072&&(_c=!0);else return t.lanes=e.lanes,Vc(e,t,i)}return Oc(e,t,n,r,i)}function Sc(e,t,n,r){var i=r.children,a=e===null?null:e.memoizedState;if(e===null&&t.stateNode===null&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.mode===`hidden`){if(t.flags&128){if(a=a===null?n:a.baseLanes|n,e!==null){for(r=t.child=e.child,i=0;r!==null;)i=i|r.lanes|r.childLanes,r=r.sibling;r=i&~a}else r=0,t.child=null;return Cc(e,t,a,n,r)}if(n&536870912)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&ka(t,a===null?null:a.cachePool),a===null?uo():lo(t,a),_o(t);else return r=t.lanes=536870912,Cc(e,t,a===null?n:a.baseLanes|n,n,r)}else a===null?(e!==null&&ka(t,null),uo(),vo(t)):(ka(t,a.cachePool),lo(t,a),vo(t),t.memoizedState=null);return vc(e,t,i,n),t.child}function U(e,t){return e!==null&&e.tag===22||t.stateNode!==null||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function Cc(e,t,n,r,i){var a=Oa();return a=a===null?null:{parent:ga._currentValue,pool:a},t.memoizedState={baseLanes:n,cachePool:a},e!==null&&ka(t,null),uo(),_o(t),e!==null&&sa(e,t,r,!0),t.childLanes=i,null}function wc(e,t){return t=Ic({mode:t.mode,children:t.children},e.mode),t.ref=e.ref,e.child=t,t.return=e,t}function Tc(e,t,n){return qa(t,e.child,null,n),e=wc(t,t.pendingProps),e.flags|=2,yo(t),t.memoizedState=null,e}function Ec(e,t,n){var r=t.pendingProps,a=(t.flags&128)!=0;if(t.flags&=-129,e===null){if(Ui){if(r.mode===`hidden`)return e=wc(t,r),t.lanes=536870912,U(null,e);if(go(t),(e=Hi)?(e=Tf(e,Gi),e=e!==null&&e.data===`&`?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:Ni===null?null:{id:Pi,overflow:Fi},retryLane:536870912,hydrationErrors:null},n=Ci(e),n.return=t,t.child=n,Vi=t,Hi=null)):e=null,e===null)throw qi(t);return t.lanes=536870912,null}return wc(t,r)}var o=e.memoizedState;if(o!==null){var s=o.dehydrated;if(go(t),a)if(t.flags&256)t.flags&=-257,t=Tc(e,t,n);else if(t.memoizedState!==null)t.child=e.child,t.flags|=128,t=null;else throw Error(i(558));else if(_c||sa(e,t,n,!1),a=(n&e.childLanes)!==0,_c||a){if(r=Zl,r!==null&&(s=et(r,n),s!==0&&s!==o.retryLane))throw o.retryLane=s,di(e,s),ju(r,e,s),gc;Uu(),t=Tc(e,t,n)}else e=o.treeContext,Hi=kf(s.nextSibling),Vi=t,Ui=!0,Wi=null,Gi=!1,e!==null&&Bi(t,e),t=wc(t,r),t.flags|=4096;return t}return e=vi(e.child,{mode:r.mode,children:r.children}),e.ref=t.ref,t.child=e,e.return=t,e}function Dc(e,t){var n=t.ref;if(n===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof n!=`function`&&typeof n!=`object`)throw Error(i(284));(e===null||e.ref!==n)&&(t.flags|=4194816)}}function Oc(e,t,n,r,i){return la(t),n=Po(e,t,n,r,void 0,i),r=Ro(),e!==null&&!_c?(zo(e,t,i),Vc(e,t,i)):(Ui&&r&&Ri(t),t.flags|=1,vc(e,t,n,i),t.child)}function kc(e,t,n,r,i,a){return la(t),t.updateQueue=null,n=Io(t,r,n,i),Fo(e),r=Ro(),e!==null&&!_c?(zo(e,t,a),Vc(e,t,a)):(Ui&&r&&Ri(t),t.flags|=1,vc(e,t,n,a),t.child)}function W(e,t,n,r,i){if(la(t),t.stateNode===null){var a=mi,o=n.contextType;typeof o==`object`&&o&&(a=ua(o)),a=new n(r,a),t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=rc,t.stateNode=a,a._reactInternals=t,a=t.stateNode,a.props=r,a.state=t.memoizedState,a.refs={},Xa(t),o=n.contextType,a.context=typeof o==`object`&&o?ua(o):mi,a.state=t.memoizedState,o=n.getDerivedStateFromProps,typeof o==`function`&&(nc(t,n,o,r),a.state=t.memoizedState),typeof n.getDerivedStateFromProps==`function`||typeof a.getSnapshotBeforeUpdate==`function`||typeof a.UNSAFE_componentWillMount!=`function`&&typeof a.componentWillMount!=`function`||(o=a.state,typeof a.componentWillMount==`function`&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount==`function`&&a.UNSAFE_componentWillMount(),o!==a.state&&rc.enqueueReplaceState(a,a.state,null),io(t,r,a,i),ro(),a.state=t.memoizedState),typeof a.componentDidMount==`function`&&(t.flags|=4194308),r=!0}else if(e===null){a=t.stateNode;var s=t.memoizedProps,c=oc(n,s);a.props=c;var l=a.context,u=n.contextType;o=mi,typeof u==`object`&&u&&(o=ua(u));var d=n.getDerivedStateFromProps;u=typeof d==`function`||typeof a.getSnapshotBeforeUpdate==`function`,s=t.pendingProps!==s,u||typeof a.UNSAFE_componentWillReceiveProps!=`function`&&typeof a.componentWillReceiveProps!=`function`||(s||l!==o)&&ac(t,a,r,o),Ya=!1;var f=t.memoizedState;a.state=f,io(t,r,a,i),ro(),l=t.memoizedState,s||f!==l||Ya?(typeof d==`function`&&(nc(t,n,d,r),l=t.memoizedState),(c=Ya||ic(t,n,c,r,f,l,o))?(u||typeof a.UNSAFE_componentWillMount!=`function`&&typeof a.componentWillMount!=`function`||(typeof a.componentWillMount==`function`&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount==`function`&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount==`function`&&(t.flags|=4194308)):(typeof a.componentDidMount==`function`&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=o,r=c):(typeof a.componentDidMount==`function`&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Za(e,t),o=t.memoizedProps,u=oc(n,o),a.props=u,d=t.pendingProps,f=a.context,l=n.contextType,c=mi,typeof l==`object`&&l&&(c=ua(l)),s=n.getDerivedStateFromProps,(l=typeof s==`function`||typeof a.getSnapshotBeforeUpdate==`function`)||typeof a.UNSAFE_componentWillReceiveProps!=`function`&&typeof a.componentWillReceiveProps!=`function`||(o!==d||f!==c)&&ac(t,a,r,c),Ya=!1,f=t.memoizedState,a.state=f,io(t,r,a,i),ro();var p=t.memoizedState;o!==d||f!==p||Ya||e!==null&&e.dependencies!==null&&ca(e.dependencies)?(typeof s==`function`&&(nc(t,n,s,r),p=t.memoizedState),(u=Ya||ic(t,n,u,r,f,p,c)||e!==null&&e.dependencies!==null&&ca(e.dependencies))?(l||typeof a.UNSAFE_componentWillUpdate!=`function`&&typeof a.componentWillUpdate!=`function`||(typeof a.componentWillUpdate==`function`&&a.componentWillUpdate(r,p,c),typeof a.UNSAFE_componentWillUpdate==`function`&&a.UNSAFE_componentWillUpdate(r,p,c)),typeof a.componentDidUpdate==`function`&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate==`function`&&(t.flags|=1024)):(typeof a.componentDidUpdate!=`function`||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!=`function`||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),a.props=r,a.state=p,a.context=c,r=u):(typeof a.componentDidUpdate!=`function`||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!=`function`||o===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return a=r,Dc(e,t),r=(t.flags&128)!=0,a||r?(a=t.stateNode,n=r&&typeof n.getDerivedStateFromError!=`function`?null:a.render(),t.flags|=1,e!==null&&r?(t.child=qa(t,e.child,null,i),t.child=qa(t,null,n,i)):vc(e,t,n,i),t.memoizedState=a.state,e=t.child):e=Vc(e,t,i),e}function Ac(e,t,n,r){return Zi(),t.flags|=256,vc(e,t,n,r),t.child}var jc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Mc(e){return{baseLanes:e,cachePool:Aa()}}function Nc(e,t,n){return e=e===null?0:e.childLanes&~n,t&&(e|=uu),e}function Pc(e,t,n){var r=t.pendingProps,a=!1,o=(t.flags&128)!=0,s;if((s=o)||(s=e!==null&&e.memoizedState===null?!1:(bo.current&2)!=0),s&&(a=!0,t.flags&=-129),s=(t.flags&32)!=0,t.flags&=-33,e===null){if(Ui){if(a?ho(t):vo(t),(e=Hi)?(e=Tf(e,Gi),e=e!==null&&e.data!==`&`?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:Ni===null?null:{id:Pi,overflow:Fi},retryLane:536870912,hydrationErrors:null},n=Ci(e),n.return=t,t.child=n,Vi=t,Hi=null)):e=null,e===null)throw qi(t);return Df(e)?t.lanes=32:t.lanes=536870912,null}var c=r.children;return r=r.fallback,a?(vo(t),a=t.mode,c=Ic({mode:`hidden`,children:c},a),r=xi(r,a,n,null),c.return=t,r.return=t,c.sibling=r,t.child=c,r=t.child,r.memoizedState=Mc(n),r.childLanes=Nc(e,s,n),t.memoizedState=jc,U(null,r)):(ho(t),Fc(t,c))}var l=e.memoizedState;if(l!==null&&(c=l.dehydrated,c!==null)){if(o)t.flags&256?(ho(t),t.flags&=-257,t=Lc(e,t,n)):t.memoizedState===null?(vo(t),c=r.fallback,a=t.mode,r=Ic({mode:`visible`,children:r.children},a),c=xi(c,a,n,null),c.flags|=2,r.return=t,c.return=t,r.sibling=c,t.child=r,qa(t,e.child,null,n),r=t.child,r.memoizedState=Mc(n),r.childLanes=Nc(e,s,n),t.memoizedState=jc,t=U(null,r)):(vo(t),t.child=e.child,t.flags|=128,t=null);else if(ho(t),Df(c)){if(s=c.nextSibling&&c.nextSibling.dataset,s)var u=s.dgst;s=u,r=Error(i(419)),r.stack=``,r.digest=s,$i({value:r,source:null,stack:null}),t=Lc(e,t,n)}else if(_c||sa(e,t,n,!1),s=(n&e.childLanes)!==0,_c||s){if(s=Zl,s!==null&&(r=et(s,n),r!==0&&r!==l.retryLane))throw l.retryLane=r,di(e,r),ju(s,e,r),gc;Ef(c)||Uu(),t=Lc(e,t,n)}else Ef(c)?(t.flags|=192,t.child=e.child,t=null):(e=l.treeContext,Hi=kf(c.nextSibling),Vi=t,Ui=!0,Wi=null,Gi=!1,e!==null&&Bi(t,e),t=Fc(t,r.children),t.flags|=4096);return t}return a?(vo(t),c=r.fallback,a=t.mode,l=e.child,u=l.sibling,r=vi(l,{mode:`hidden`,children:r.children}),r.subtreeFlags=l.subtreeFlags&65011712,u===null?(c=xi(c,a,n,null),c.flags|=2):c=vi(u,c),c.return=t,r.return=t,r.sibling=c,t.child=r,U(null,r),r=t.child,c=e.child.memoizedState,c===null?c=Mc(n):(a=c.cachePool,a===null?a=Aa():(l=ga._currentValue,a=a.parent===l?a:{parent:l,pool:l}),c={baseLanes:c.baseLanes|n,cachePool:a}),r.memoizedState=c,r.childLanes=Nc(e,s,n),t.memoizedState=jc,U(e.child,r)):(ho(t),n=e.child,e=n.sibling,n=vi(n,{mode:`visible`,children:r.children}),n.return=t,n.sibling=null,e!==null&&(s=t.deletions,s===null?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=n,t.memoizedState=null,n)}function Fc(e,t){return t=Ic({mode:`visible`,children:t},e.mode),t.return=e,e.child=t}function Ic(e,t){return e=gi(22,e,null,t),e.lanes=0,e}function Lc(e,t,n){return qa(t,e.child,null,n),e=Fc(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Rc(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),aa(e.return,t,n)}function zc(e,t,n,r,i,a){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,treeForkCount:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i,o.treeForkCount=a)}function Bc(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;r=r.children;var o=bo.current,s=(o&2)!=0;if(s?(o=o&1|2,t.flags|=128):o&=1,M(bo,o),vc(e,t,r,n),r=Ui?Ai:0,!s&&e!==null&&e.flags&128)a:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Rc(e,n,t);else if(e.tag===19)Rc(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break a;for(;e.sibling===null;){if(e.return===null||e.return===t)break a;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(i){case`forwards`:for(n=t.child,i=null;n!==null;)e=n.alternate,e!==null&&xo(e)===null&&(i=n),n=n.sibling;n=i,n===null?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),zc(t,!1,i,n,a,r);break;case`backwards`:case`unstable_legacy-backwards`:for(n=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&xo(e)===null){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}zc(t,!0,n,null,a,r);break;case`together`:zc(t,!1,null,null,void 0,r);break;default:t.memoizedState=null}return t.child}function Vc(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),su|=t.lanes,(n&t.childLanes)===0)if(e!==null){if(sa(e,t,n,!1),(n&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(i(153));if(t.child!==null){for(e=t.child,n=vi(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=vi(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function Hc(e,t){return(e.lanes&t)===0?(e=e.dependencies,!!(e!==null&&ca(e))):!0}function Uc(e,t,n){switch(t.tag){case 3:pe(t,t.stateNode.containerInfo),ra(t,ga,e.memoizedState.cache),Zi();break;case 27:case 5:me(t);break;case 4:pe(t,t.stateNode.containerInfo);break;case 10:ra(t,t.type,t.memoizedProps.value);break;case 31:if(t.memoizedState!==null)return t.flags|=128,go(t),null;break;case 13:var r=t.memoizedState;if(r!==null)return r.dehydrated===null?(n&t.child.childLanes)===0?(ho(t),e=Vc(e,t,n),e===null?null:e.sibling):Pc(e,t,n):(ho(t),t.flags|=128,null);ho(t);break;case 19:var i=(e.flags&128)!=0;if(r=(n&t.childLanes)!==0,r||=(sa(e,t,n,!1),(n&t.childLanes)!==0),i){if(r)return Bc(e,t,n);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),M(bo,bo.current),r)break;return null;case 22:return t.lanes=0,Sc(e,t,n,t.pendingProps);case 24:ra(t,ga,e.memoizedState.cache)}return Vc(e,t,n)}function Wc(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps)_c=!0;else{if(!Hc(e,n)&&!(t.flags&128))return _c=!1,Uc(e,t,n);_c=!!(e.flags&131072)}else _c=!1,Ui&&t.flags&1048576&&Li(t,Ai,t.index);switch(t.lanes=0,t.tag){case 16:a:{var r=t.pendingProps;if(e=La(t.elementType),t.type=e,typeof e==`function`)_i(e)?(r=oc(e,r),t.tag=1,t=W(null,t,e,r,n)):(t.tag=0,t=Oc(null,t,e,r,n));else{if(e!=null){var a=e.$$typeof;if(a===w){t.tag=11,t=yc(null,t,e,r,n);break a}else if(a===D){t.tag=14,t=bc(null,t,e,r,n);break a}}throw t=ie(e)||e,Error(i(306,t,``))}}return t;case 0:return Oc(e,t,t.type,t.pendingProps,n);case 1:return r=t.type,a=oc(r,t.pendingProps),W(e,t,r,a,n);case 3:a:{if(pe(t,t.stateNode.containerInfo),e===null)throw Error(i(387));r=t.pendingProps;var o=t.memoizedState;a=o.element,Za(e,t),io(t,r,null,n);var s=t.memoizedState;if(r=s.cache,ra(t,ga,r),r!==o.cache&&oa(t,[ga],n,!0),ro(),r=s.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:s.cache},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){t=Ac(e,t,r,n);break a}else if(r!==a){a=Ei(Error(i(424)),t),$i(a),t=Ac(e,t,r,n);break a}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName===`HTML`?e.ownerDocument.body:e}for(Hi=kf(e.firstChild),Vi=t,Ui=!0,Wi=null,Gi=!0,n=Ja(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling}else{if(Zi(),r===a){t=Vc(e,t,n);break a}vc(e,t,r,n)}t=t.child}return t;case 26:return Dc(e,t),e===null?(n=Xf(t.type,null,t.pendingProps,null))?t.memoizedState=n:Ui||(n=t.type,e=t.pendingProps,r=cf(N.current).createElement(n),r[ot]=t,r[st]=e,ef(r,n,e),yt(r),t.stateNode=r):t.memoizedState=Xf(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return me(t),e===null&&Ui&&(r=t.stateNode=Nf(t.type,t.pendingProps,N.current),Vi=t,Gi=!0,a=Hi,yf(t.type)?(Af=a,Hi=kf(r.firstChild)):Hi=a),vc(e,t,t.pendingProps.children,n),Dc(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&Ui&&((a=r=Hi)&&(r=Cf(r,t.type,t.pendingProps,Gi),r===null?a=!1:(t.stateNode=r,Vi=t,Hi=kf(r.firstChild),Gi=!1,a=!0)),a||qi(t)),me(t),a=t.type,o=t.pendingProps,s=e===null?null:e.memoizedProps,r=o.children,df(a,o)?r=null:s!==null&&df(a,s)&&(t.flags|=32),t.memoizedState!==null&&(a=Po(e,t,Lo,null,null,n),yp._currentValue=a),Dc(e,t),vc(e,t,r,n),t.child;case 6:return e===null&&Ui&&((e=n=Hi)&&(n=wf(n,t.pendingProps,Gi),n===null?e=!1:(t.stateNode=n,Vi=t,Hi=null,e=!0)),e||qi(t)),null;case 13:return Pc(e,t,n);case 4:return pe(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=qa(t,null,r,n):vc(e,t,r,n),t.child;case 11:return yc(e,t,t.type,t.pendingProps,n);case 7:return vc(e,t,t.pendingProps,n),t.child;case 8:return vc(e,t,t.pendingProps.children,n),t.child;case 12:return vc(e,t,t.pendingProps.children,n),t.child;case 10:return r=t.pendingProps,ra(t,t.type,r.value),vc(e,t,r.children,n),t.child;case 9:return a=t.type._context,r=t.pendingProps.children,la(t),a=ua(a),r=r(a),t.flags|=1,vc(e,t,r,n),t.child;case 14:return bc(e,t,t.type,t.pendingProps,n);case 15:return xc(e,t,t.type,t.pendingProps,n);case 19:return Bc(e,t,n);case 31:return Ec(e,t,n);case 22:return Sc(e,t,n,t.pendingProps);case 24:return la(t),r=ua(ga),e===null?(a=Oa(),a===null&&(a=Zl,o=_a(),a.pooledCache=o,o.refCount++,o!==null&&(a.pooledCacheLanes|=n),a=o),t.memoizedState={parent:r,cache:a},Xa(t),ra(t,ga,a)):((e.lanes&n)!==0&&(Za(e,t),io(t,null,null,n),ro()),a=e.memoizedState,o=t.memoizedState,a.parent===r?(r=o.cache,ra(t,ga,r),r!==a.cache&&oa(t,[ga],n,!0)):(a={parent:r,cache:r},t.memoizedState=a,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=a),ra(t,ga,r))),vc(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(i(156,t.tag))}function Gc(e){e.flags|=4}function Kc(e,t,n,r,i){if((t=(e.mode&32)!=0)&&(t=!1),t){if(e.flags|=16777216,(i&335544128)===i)if(e.stateNode.complete)e.flags|=8192;else if(Bu())e.flags|=8192;else throw Ra=Pa,Ma}else e.flags&=-16777217}function qc(e,t){if(t.type!==`stylesheet`||t.state.loading&4)e.flags&=-16777217;else if(e.flags|=16777216,!dp(t))if(Bu())e.flags|=8192;else throw Ra=Pa,Ma}function G(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag===22?536870912:R(),e.lanes|=t,du|=t)}function Jc(e,t){if(!Ui)switch(e.tailMode){case`hidden`:t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case`collapsed`:n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Yc(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&65011712,r|=i.flags&65011712,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Xc(e,t,n){var r=t.pendingProps;switch(zi(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yc(t),null;case 1:return Yc(t),null;case 3:return n=t.stateNode,r=null,e!==null&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),ia(ga),F(),n.pendingContext&&=(n.context=n.pendingContext,null),(e===null||e.child===null)&&(Xi(t)?Gc(t):e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Qi())),Yc(t),null;case 26:var a=t.type,o=t.memoizedState;return e===null?(Gc(t),o===null?(Yc(t),Kc(t,a,null,r,n)):(Yc(t),qc(t,o))):o?o===e.memoizedState?(Yc(t),t.flags&=-16777217):(Gc(t),Yc(t),qc(t,o)):(e=e.memoizedProps,e!==r&&Gc(t),Yc(t),Kc(t,a,e,r,n)),null;case 27:if(he(t),n=N.current,a=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==r&&Gc(t);else{if(!r){if(t.stateNode===null)throw Error(i(166));return Yc(t),null}e=de.current,Xi(t)?Ji(t,e):(e=Nf(a,r,n),t.stateNode=e,Gc(t))}return Yc(t),null;case 5:if(he(t),a=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==r&&Gc(t);else{if(!r){if(t.stateNode===null)throw Error(i(166));return Yc(t),null}if(o=de.current,Xi(t))Ji(t,o);else{var s=cf(N.current);switch(o){case 1:o=s.createElementNS(`http://www.w3.org/2000/svg`,a);break;case 2:o=s.createElementNS(`http://www.w3.org/1998/Math/MathML`,a);break;default:switch(a){case`svg`:o=s.createElementNS(`http://www.w3.org/2000/svg`,a);break;case`math`:o=s.createElementNS(`http://www.w3.org/1998/Math/MathML`,a);break;case`script`:o=s.createElement(`div`),o.innerHTML=`<script><\/script>`,o=o.removeChild(o.firstChild);break;case`select`:o=typeof r.is==`string`?s.createElement(`select`,{is:r.is}):s.createElement(`select`),r.multiple?o.multiple=!0:r.size&&(o.size=r.size);break;default:o=typeof r.is==`string`?s.createElement(a,{is:r.is}):s.createElement(a)}}o[ot]=t,o[st]=r;a:for(s=t.child;s!==null;){if(s.tag===5||s.tag===6)o.appendChild(s.stateNode);else if(s.tag!==4&&s.tag!==27&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break a;for(;s.sibling===null;){if(s.return===null||s.return===t)break a;s=s.return}s.sibling.return=s.return,s=s.sibling}t.stateNode=o;a:switch(ef(o,a,r),a){case`button`:case`input`:case`select`:case`textarea`:r=!!r.autoFocus;break a;case`img`:r=!0;break a;default:r=!1}r&&Gc(t)}}return Yc(t),Kc(t,t.type,e===null?null:e.memoizedProps,t.pendingProps,n),null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==r&&Gc(t);else{if(typeof r!=`string`&&t.stateNode===null)throw Error(i(166));if(e=N.current,Xi(t)){if(e=t.stateNode,n=t.memoizedProps,r=null,a=Vi,a!==null)switch(a.tag){case 27:case 5:r=a.memoizedProps}e[ot]=t,e=!!(e.nodeValue===n||r!==null&&!0===r.suppressHydrationWarning||Zd(e.nodeValue,n)),e||qi(t,!0)}else e=cf(e).createTextNode(r),e[ot]=t,t.stateNode=e}return Yc(t),null;case 31:if(n=t.memoizedState,e===null||e.memoizedState!==null){if(r=Xi(t),n!==null){if(e===null){if(!r)throw Error(i(318));if(e=t.memoizedState,e=e===null?null:e.dehydrated,!e)throw Error(i(557));e[ot]=t}else Zi(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Yc(t),e=!1}else n=Qi(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=n),e=!0;if(!e)return t.flags&256?(yo(t),t):(yo(t),null);if(t.flags&128)throw Error(i(558))}return Yc(t),null;case 13:if(r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(a=Xi(t),r!==null&&r.dehydrated!==null){if(e===null){if(!a)throw Error(i(318));if(a=t.memoizedState,a=a===null?null:a.dehydrated,!a)throw Error(i(317));a[ot]=t}else Zi(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Yc(t),a=!1}else a=Qi(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=a),a=!0;if(!a)return t.flags&256?(yo(t),t):(yo(t),null)}return yo(t),t.flags&128?(t.lanes=n,t):(n=r!==null,e=e!==null&&e.memoizedState!==null,n&&(r=t.child,a=null,r.alternate!==null&&r.alternate.memoizedState!==null&&r.alternate.memoizedState.cachePool!==null&&(a=r.alternate.memoizedState.cachePool.pool),o=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(o=r.memoizedState.cachePool.pool),o!==a&&(r.flags|=2048)),n!==e&&n&&(t.child.flags|=8192),G(t,t.updateQueue),Yc(t),null);case 4:return F(),e===null&&Vd(t.stateNode.containerInfo),Yc(t),null;case 10:return ia(t.type),Yc(t),null;case 19:if(ue(bo),r=t.memoizedState,r===null)return Yc(t),null;if(a=(t.flags&128)!=0,o=r.rendering,o===null)if(a)Jc(r,!1);else{if(ou!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=xo(e),o!==null){for(t.flags|=128,Jc(r,!1),e=o.updateQueue,t.updateQueue=e,G(t,e),t.subtreeFlags=0,e=n,n=t.child;n!==null;)yi(n,e),n=n.sibling;return M(bo,bo.current&1|2),Ui&&Ii(t,r.treeForkCount),t.child}e=e.sibling}r.tail!==null&&Oe()>_u&&(t.flags|=128,a=!0,Jc(r,!1),t.lanes=4194304)}else{if(!a)if(e=xo(o),e!==null){if(t.flags|=128,a=!0,e=e.updateQueue,t.updateQueue=e,G(t,e),Jc(r,!0),r.tail===null&&r.tailMode===`hidden`&&!o.alternate&&!Ui)return Yc(t),null}else 2*Oe()-r.renderingStartTime>_u&&n!==536870912&&(t.flags|=128,a=!0,Jc(r,!1),t.lanes=4194304);r.isBackwards?(o.sibling=t.child,t.child=o):(e=r.last,e===null?t.child=o:e.sibling=o,r.last=o)}return r.tail===null?(Yc(t),null):(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=Oe(),e.sibling=null,n=bo.current,M(bo,a?n&1|2:n&1),Ui&&Ii(t,r.treeForkCount),e);case 22:case 23:return yo(t),fo(),r=t.memoizedState!==null,e===null?r&&(t.flags|=8192):e.memoizedState!==null!==r&&(t.flags|=8192),r?n&536870912&&!(t.flags&128)&&(Yc(t),t.subtreeFlags&6&&(t.flags|=8192)):Yc(t),n=t.updateQueue,n!==null&&G(t,n.retryQueue),n=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(n=e.memoizedState.cachePool.pool),r=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(r=t.memoizedState.cachePool.pool),r!==n&&(t.flags|=2048),e!==null&&ue(Da),null;case 24:return n=null,e!==null&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),ia(ga),Yc(t),null;case 25:return null;case 30:return null}throw Error(i(156,t.tag))}function Zc(e,t){switch(zi(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return ia(ga),F(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return he(t),null;case 31:if(t.memoizedState!==null){if(yo(t),t.alternate===null)throw Error(i(340));Zi()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 13:if(yo(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(i(340));Zi()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return ue(bo),null;case 4:return F(),null;case 10:return ia(t.type),null;case 22:case 23:return yo(t),fo(),e!==null&&ue(Da),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return ia(ga),null;case 25:return null;default:return null}}function Qc(e,t){switch(zi(t),t.tag){case 3:ia(ga),F();break;case 26:case 27:case 5:he(t);break;case 4:F();break;case 31:t.memoizedState!==null&&yo(t);break;case 13:yo(t);break;case 19:ue(bo);break;case 10:ia(t.type);break;case 22:case 23:yo(t),fo(),e!==null&&ue(Da);break;case 24:ia(ga)}}function $c(e,t){try{var n=t.updateQueue,r=n===null?null:n.lastEffect;if(r!==null){var i=r.next;n=i;do{if((n.tag&e)===e){r=void 0;var a=n.create,o=n.inst;r=a(),o.destroy=r}n=n.next}while(n!==i)}}catch(e){sd(t,t.return,e)}}function el(e,t,n){try{var r=t.updateQueue,i=r===null?null:r.lastEffect;if(i!==null){var a=i.next;r=a;do{if((r.tag&e)===e){var o=r.inst,s=o.destroy;if(s!==void 0){o.destroy=void 0,i=t;var c=n,l=s;try{l()}catch(e){sd(i,c,e)}}}r=r.next}while(r!==a)}}catch(e){sd(t,t.return,e)}}function tl(e){var t=e.updateQueue;if(t!==null){var n=e.stateNode;try{oo(t,n)}catch(t){sd(e,e.return,t)}}}function nl(e,t,n){n.props=oc(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(n){sd(e,t,n)}}function rl(e,t){try{var n=e.ref;if(n!==null){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode;break;case 30:r=e.stateNode;break;default:r=e.stateNode}typeof n==`function`?e.refCleanup=n(r):n.current=r}}catch(n){sd(e,t,n)}}function il(e,t){var n=e.ref,r=e.refCleanup;if(n!==null)if(typeof r==`function`)try{r()}catch(n){sd(e,t,n)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof n==`function`)try{n(null)}catch(n){sd(e,t,n)}else n.current=null}function al(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{a:switch(t){case`button`:case`input`:case`select`:case`textarea`:n.autoFocus&&r.focus();break a;case`img`:n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(t){sd(e,e.return,t)}}function ol(e,t,n){try{var r=e.stateNode;tf(r,e.type,n,t),r[st]=t}catch(t){sd(e,e.return,t)}}function sl(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&yf(e.type)||e.tag===4}function cl(e){a:for(;;){for(;e.sibling===null;){if(e.return===null||sl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&yf(e.type)||e.flags&2||e.child===null||e.tag===4)continue a;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function ll(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?(n.nodeType===9?n.body:n.nodeName===`HTML`?n.ownerDocument.body:n).insertBefore(e,t):(t=n.nodeType===9?n.body:n.nodeName===`HTML`?n.ownerDocument.body:n,t.appendChild(e),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Zt));else if(r!==4&&(r===27&&yf(e.type)&&(n=e.stateNode,t=null),e=e.child,e!==null))for(ll(e,t,n),e=e.sibling;e!==null;)ll(e,t,n),e=e.sibling}function ul(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(r===27&&yf(e.type)&&(n=e.stateNode),e=e.child,e!==null))for(ul(e,t,n),e=e.sibling;e!==null;)ul(e,t,n),e=e.sibling}function dl(e){var t=e.stateNode,n=e.memoizedProps;try{for(var r=e.type,i=t.attributes;i.length;)t.removeAttributeNode(i[0]);ef(t,r,n),t[ot]=e,t[st]=n}catch(t){sd(e,e.return,t)}}var fl=!1,pl=!1,ml=!1,hl=typeof WeakSet==`function`?WeakSet:Set,gl=null;function _l(e,t){if(e=e.containerInfo,af=Op,e=Fr(e),Ir(e)){if(`selectionStart`in e)var n={start:e.selectionStart,end:e.selectionEnd};else a:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break a}var s=0,c=-1,l=-1,u=0,d=0,f=e,p=null;b:for(;;){for(var m;f!==n||a!==0&&f.nodeType!==3||(c=s+a),f!==o||r!==0&&f.nodeType!==3||(l=s+r),f.nodeType===3&&(s+=f.nodeValue.length),(m=f.firstChild)!==null;)p=f,f=m;for(;;){if(f===e)break b;if(p===n&&++u===a&&(c=s),p===o&&++d===r&&(l=s),(m=f.nextSibling)!==null)break;f=p,p=f.parentNode}f=m}n=c===-1||l===-1?null:{start:c,end:l}}else n=null}n||={start:0,end:0}}else n=null;for(sf={focusedElem:e,selectionRange:n},Op=!1,gl=t;gl!==null;)if(t=gl,e=t.child,t.subtreeFlags&1028&&e!==null)e.return=t,gl=e;else for(;gl!==null;){switch(t=gl,o=t.alternate,e=t.flags,t.tag){case 0:if(e&4&&(e=t.updateQueue,e=e===null?null:e.events,e!==null))for(n=0;n<e.length;n++)a=e[n],a.ref.impl=a.nextImpl;break;case 11:case 15:break;case 1:if(e&1024&&o!==null){e=void 0,n=t,a=o.memoizedProps,o=o.memoizedState,r=n.stateNode;try{var h=oc(n.type,a);e=r.getSnapshotBeforeUpdate(h,o),r.__reactInternalSnapshotBeforeUpdate=e}catch(e){sd(n,n.return,e)}}break;case 3:if(e&1024){if(e=t.stateNode.containerInfo,n=e.nodeType,n===9)Sf(e);else if(n===1)switch(e.nodeName){case`HEAD`:case`HTML`:case`BODY`:Sf(e);break;default:e.textContent=``}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(e&1024)throw Error(i(163))}if(e=t.sibling,e!==null){e.return=t.return,gl=e;break}gl=t.return}}function vl(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:Ml(e,n),r&4&&$c(5,n);break;case 1:if(Ml(e,n),r&4)if(e=n.stateNode,t===null)try{e.componentDidMount()}catch(e){sd(n,n.return,e)}else{var i=oc(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(i,t,e.__reactInternalSnapshotBeforeUpdate)}catch(e){sd(n,n.return,e)}}r&64&&tl(n),r&512&&rl(n,n.return);break;case 3:if(Ml(e,n),r&64&&(e=n.updateQueue,e!==null)){if(t=null,n.child!==null)switch(n.child.tag){case 27:case 5:t=n.child.stateNode;break;case 1:t=n.child.stateNode}try{oo(e,t)}catch(e){sd(n,n.return,e)}}break;case 27:t===null&&r&4&&dl(n);case 26:case 5:Ml(e,n),t===null&&r&4&&al(n),r&512&&rl(n,n.return);break;case 12:Ml(e,n);break;case 31:Ml(e,n),r&4&&Cl(e,n);break;case 13:Ml(e,n),r&4&&wl(e,n),r&64&&(e=n.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(n=dd.bind(null,n),Of(e,n))));break;case 22:if(r=n.memoizedState!==null||fl,!r){t=t!==null&&t.memoizedState!==null||pl,i=fl;var a=pl;fl=r,(pl=t)&&!a?Pl(e,n,(n.subtreeFlags&8772)!=0):Ml(e,n),fl=i,pl=a}break;case 30:break;default:Ml(e,n)}}function yl(e){var t=e.alternate;t!==null&&(e.alternate=null,yl(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&mt(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var bl=null,xl=!1;function K(e,t,n){for(n=n.child;n!==null;)Sl(e,t,n),n=n.sibling}function Sl(e,t,n){if(Le&&typeof Le.onCommitFiberUnmount==`function`)try{Le.onCommitFiberUnmount(Ie,n)}catch{}switch(n.tag){case 26:pl||il(n,t),K(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode,n.parentNode.removeChild(n));break;case 27:pl||il(n,t);var r=bl,i=xl;yf(n.type)&&(bl=n.stateNode,xl=!1),K(e,t,n),Pf(n.stateNode),bl=r,xl=i;break;case 5:pl||il(n,t);case 6:if(r=bl,i=xl,bl=null,K(e,t,n),bl=r,xl=i,bl!==null)if(xl)try{(bl.nodeType===9?bl.body:bl.nodeName===`HTML`?bl.ownerDocument.body:bl).removeChild(n.stateNode)}catch(e){sd(n,t,e)}else try{bl.removeChild(n.stateNode)}catch(e){sd(n,t,e)}break;case 18:bl!==null&&(xl?(e=bl,bf(e.nodeType===9?e.body:e.nodeName===`HTML`?e.ownerDocument.body:e,n.stateNode),em(e)):bf(bl,n.stateNode));break;case 4:r=bl,i=xl,bl=n.stateNode.containerInfo,xl=!0,K(e,t,n),bl=r,xl=i;break;case 0:case 11:case 14:case 15:el(2,n,t),pl||el(4,n,t),K(e,t,n);break;case 1:pl||(il(n,t),r=n.stateNode,typeof r.componentWillUnmount==`function`&&nl(n,t,r)),K(e,t,n);break;case 21:K(e,t,n);break;case 22:pl=(r=pl)||n.memoizedState!==null,K(e,t,n),pl=r;break;default:K(e,t,n)}}function Cl(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{em(e)}catch(e){sd(t,t.return,e)}}}function wl(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{em(e)}catch(e){sd(t,t.return,e)}}function Tl(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new hl),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new hl),t;default:throw Error(i(435,e.tag))}}function El(e,t){var n=Tl(e);t.forEach(function(t){if(!n.has(t)){n.add(t);var r=fd.bind(null,e,t);t.then(r,r)}})}function Dl(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var a=n[r],o=e,s=t,c=s;a:for(;c!==null;){switch(c.tag){case 27:if(yf(c.type)){bl=c.stateNode,xl=!1;break a}break;case 5:bl=c.stateNode,xl=!1;break a;case 3:case 4:bl=c.stateNode.containerInfo,xl=!0;break a}c=c.return}if(bl===null)throw Error(i(160));Sl(o,s,a),bl=null,xl=!1,o=a.alternate,o!==null&&(o.return=null),a.return=null}if(t.subtreeFlags&13886)for(t=t.child;t!==null;)kl(t,e),t=t.sibling}var Ol=null;function kl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Dl(t,e),Al(e),r&4&&(el(3,e,e.return),$c(3,e),el(5,e,e.return));break;case 1:Dl(t,e),Al(e),r&512&&(pl||n===null||il(n,n.return)),r&64&&fl&&(e=e.updateQueue,e!==null&&(r=e.callbacks,r!==null&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=n===null?r:n.concat(r))));break;case 26:var a=Ol;if(Dl(t,e),Al(e),r&512&&(pl||n===null||il(n,n.return)),r&4){var o=n===null?null:n.memoizedState;if(r=e.memoizedState,n===null)if(r===null)if(e.stateNode===null){a:{r=e.type,n=e.memoizedProps,a=a.ownerDocument||a;b:switch(r){case`title`:o=a.getElementsByTagName(`title`)[0],(!o||o[pt]||o[ot]||o.namespaceURI===`http://www.w3.org/2000/svg`||o.hasAttribute(`itemprop`))&&(o=a.createElement(r),a.head.insertBefore(o,a.querySelector(`head > title`))),ef(o,r,n),o[ot]=e,yt(o),r=o;break a;case`link`:var s=cp(`link`,`href`,a).get(r+(n.href||``));if(s){for(var c=0;c<s.length;c++)if(o=s[c],o.getAttribute(`href`)===(n.href==null||n.href===``?null:n.href)&&o.getAttribute(`rel`)===(n.rel==null?null:n.rel)&&o.getAttribute(`title`)===(n.title==null?null:n.title)&&o.getAttribute(`crossorigin`)===(n.crossOrigin==null?null:n.crossOrigin)){s.splice(c,1);break b}}o=a.createElement(r),ef(o,r,n),a.head.appendChild(o);break;case`meta`:if(s=cp(`meta`,`content`,a).get(r+(n.content||``))){for(c=0;c<s.length;c++)if(o=s[c],o.getAttribute(`content`)===(n.content==null?null:``+n.content)&&o.getAttribute(`name`)===(n.name==null?null:n.name)&&o.getAttribute(`property`)===(n.property==null?null:n.property)&&o.getAttribute(`http-equiv`)===(n.httpEquiv==null?null:n.httpEquiv)&&o.getAttribute(`charset`)===(n.charSet==null?null:n.charSet)){s.splice(c,1);break b}}o=a.createElement(r),ef(o,r,n),a.head.appendChild(o);break;default:throw Error(i(468,r))}o[ot]=e,yt(o),r=o}e.stateNode=r}else lp(a,e.type,e.stateNode);else e.stateNode=rp(a,r,e.memoizedProps);else o===r?r===null&&e.stateNode!==null&&ol(e,e.memoizedProps,n.memoizedProps):(o===null?n.stateNode!==null&&(n=n.stateNode,n.parentNode.removeChild(n)):o.count--,r===null?lp(a,e.type,e.stateNode):rp(a,r,e.memoizedProps))}break;case 27:Dl(t,e),Al(e),r&512&&(pl||n===null||il(n,n.return)),n!==null&&r&4&&ol(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Dl(t,e),Al(e),r&512&&(pl||n===null||il(n,n.return)),e.flags&32){a=e.stateNode;try{Ut(a,``)}catch(t){sd(e,e.return,t)}}r&4&&e.stateNode!=null&&(a=e.memoizedProps,ol(e,a,n===null?a:n.memoizedProps)),r&1024&&(ml=!0);break;case 6:if(Dl(t,e),Al(e),r&4){if(e.stateNode===null)throw Error(i(162));r=e.memoizedProps,n=e.stateNode;try{n.nodeValue=r}catch(t){sd(e,e.return,t)}}break;case 3:if(sp=null,a=Ol,Ol=Lf(t.containerInfo),Dl(t,e),Ol=a,Al(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{em(t.containerInfo)}catch(t){sd(e,e.return,t)}ml&&(ml=!1,jl(e));break;case 4:r=Ol,Ol=Lf(e.stateNode.containerInfo),Dl(t,e),Al(e),Ol=r;break;case 12:Dl(t,e),Al(e);break;case 31:Dl(t,e),Al(e),r&4&&(r=e.updateQueue,r!==null&&(e.updateQueue=null,El(e,r)));break;case 13:Dl(t,e),Al(e),e.child.flags&8192&&e.memoizedState!==null!=(n!==null&&n.memoizedState!==null)&&(hu=Oe()),r&4&&(r=e.updateQueue,r!==null&&(e.updateQueue=null,El(e,r)));break;case 22:a=e.memoizedState!==null;var l=n!==null&&n.memoizedState!==null,u=fl,d=pl;if(fl=u||a,pl=d||l,Dl(t,e),pl=d,fl=u,Al(e),r&8192)a:for(t=e.stateNode,t._visibility=a?t._visibility&-2:t._visibility|1,a&&(n===null||l||fl||pl||Nl(e)),n=null,t=e;;){if(t.tag===5||t.tag===26){if(n===null){l=n=t;try{if(o=l.stateNode,a)s=o.style,typeof s.setProperty==`function`?s.setProperty(`display`,`none`,`important`):s.display=`none`;else{c=l.stateNode;var f=l.memoizedProps.style,p=f!=null&&f.hasOwnProperty(`display`)?f.display:null;c.style.display=p==null||typeof p==`boolean`?``:(``+p).trim()}}catch(e){sd(l,l.return,e)}}}else if(t.tag===6){if(n===null){l=t;try{l.stateNode.nodeValue=a?``:l.memoizedProps}catch(e){sd(l,l.return,e)}}}else if(t.tag===18){if(n===null){l=t;try{var m=l.stateNode;a?xf(m,!0):xf(l.stateNode,!1)}catch(e){sd(l,l.return,e)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break a;for(;t.sibling===null;){if(t.return===null||t.return===e)break a;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}r&4&&(r=e.updateQueue,r!==null&&(n=r.retryQueue,n!==null&&(r.retryQueue=null,El(e,n))));break;case 19:Dl(t,e),Al(e),r&4&&(r=e.updateQueue,r!==null&&(e.updateQueue=null,El(e,r)));break;case 30:break;case 21:break;default:Dl(t,e),Al(e)}}function Al(e){var t=e.flags;if(t&2){try{for(var n,r=e.return;r!==null;){if(sl(r)){n=r;break}r=r.return}if(n==null)throw Error(i(160));switch(n.tag){case 27:var a=n.stateNode,o=cl(e);ul(e,o,a);break;case 5:var s=n.stateNode;n.flags&32&&(Ut(s,``),n.flags&=-33);var c=cl(e);ul(e,c,s);break;case 3:case 4:var l=n.stateNode.containerInfo,u=cl(e);ll(e,u,l);break;default:throw Error(i(161))}}catch(t){sd(e,e.return,t)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function jl(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;jl(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function Ml(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)vl(e,t.alternate,t),t=t.sibling}function Nl(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:el(4,t,t.return),Nl(t);break;case 1:il(t,t.return);var n=t.stateNode;typeof n.componentWillUnmount==`function`&&nl(t,t.return,n),Nl(t);break;case 27:Pf(t.stateNode);case 26:case 5:il(t,t.return),Nl(t);break;case 22:t.memoizedState===null&&Nl(t);break;case 30:Nl(t);break;default:Nl(t)}e=e.sibling}}function Pl(e,t,n){for(n&&=(t.subtreeFlags&8772)!=0,t=t.child;t!==null;){var r=t.alternate,i=e,a=t,o=a.flags;switch(a.tag){case 0:case 11:case 15:Pl(i,a,n),$c(4,a);break;case 1:if(Pl(i,a,n),r=a,i=r.stateNode,typeof i.componentDidMount==`function`)try{i.componentDidMount()}catch(e){sd(r,r.return,e)}if(r=a,i=r.updateQueue,i!==null){var s=r.stateNode;try{var c=i.shared.hiddenCallbacks;if(c!==null)for(i.shared.hiddenCallbacks=null,i=0;i<c.length;i++)ao(c[i],s)}catch(e){sd(r,r.return,e)}}n&&o&64&&tl(a),rl(a,a.return);break;case 27:dl(a);case 26:case 5:Pl(i,a,n),n&&r===null&&o&4&&al(a),rl(a,a.return);break;case 12:Pl(i,a,n);break;case 31:Pl(i,a,n),n&&o&4&&Cl(i,a);break;case 13:Pl(i,a,n),n&&o&4&&wl(i,a);break;case 22:a.memoizedState===null&&Pl(i,a,n),rl(a,a.return);break;case 30:break;default:Pl(i,a,n)}t=t.sibling}}function Fl(e,t){var n=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(n=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==n&&(e!=null&&e.refCount++,n!=null&&va(n))}function Il(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&va(e))}function Ll(e,t,n,r){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Rl(e,t,n,r),t=t.sibling}function Rl(e,t,n,r){var i=t.flags;switch(t.tag){case 0:case 11:case 15:Ll(e,t,n,r),i&2048&&$c(9,t);break;case 1:Ll(e,t,n,r);break;case 3:Ll(e,t,n,r),i&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&va(e)));break;case 12:if(i&2048){Ll(e,t,n,r),e=t.stateNode;try{var a=t.memoizedProps,o=a.id,s=a.onPostCommit;typeof s==`function`&&s(o,t.alternate===null?`mount`:`update`,e.passiveEffectDuration,-0)}catch(e){sd(t,t.return,e)}}else Ll(e,t,n,r);break;case 31:Ll(e,t,n,r);break;case 13:Ll(e,t,n,r);break;case 23:break;case 22:a=t.stateNode,o=t.alternate,t.memoizedState===null?a._visibility&2?Ll(e,t,n,r):(a._visibility|=2,zl(e,t,n,r,(t.subtreeFlags&10256)!=0||!1)):a._visibility&2?Ll(e,t,n,r):Bl(e,t),i&2048&&Fl(o,t);break;case 24:Ll(e,t,n,r),i&2048&&Il(t.alternate,t);break;default:Ll(e,t,n,r)}}function zl(e,t,n,r,i){for(i&&=(t.subtreeFlags&10256)!=0||!1,t=t.child;t!==null;){var a=e,o=t,s=n,c=r,l=o.flags;switch(o.tag){case 0:case 11:case 15:zl(a,o,s,c,i),$c(8,o);break;case 23:break;case 22:var u=o.stateNode;o.memoizedState===null?(u._visibility|=2,zl(a,o,s,c,i)):u._visibility&2?zl(a,o,s,c,i):Bl(a,o),i&&l&2048&&Fl(o.alternate,o);break;case 24:zl(a,o,s,c,i),i&&l&2048&&Il(o.alternate,o);break;default:zl(a,o,s,c,i)}t=t.sibling}}function Bl(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var n=e,r=t,i=r.flags;switch(r.tag){case 22:Bl(n,r),i&2048&&Fl(r.alternate,r);break;case 24:Bl(n,r),i&2048&&Il(r.alternate,r);break;default:Bl(n,r)}t=t.sibling}}var Vl=8192;function Hl(e,t,n){if(e.subtreeFlags&Vl)for(e=e.child;e!==null;)Ul(e,t,n),e=e.sibling}function Ul(e,t,n){switch(e.tag){case 26:Hl(e,t,n),e.flags&Vl&&e.memoizedState!==null&&fp(n,Ol,e.memoizedState,e.memoizedProps);break;case 5:Hl(e,t,n);break;case 3:case 4:var r=Ol;Ol=Lf(e.stateNode.containerInfo),Hl(e,t,n),Ol=r;break;case 22:e.memoizedState===null&&(r=e.alternate,r!==null&&r.memoizedState!==null?(r=Vl,Vl=16777216,Hl(e,t,n),Vl=r):Hl(e,t,n));break;default:Hl(e,t,n)}}function Wl(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function Gl(e){var t=e.deletions;if(e.flags&16){if(t!==null)for(var n=0;n<t.length;n++){var r=t[n];gl=r,Jl(r,e)}Wl(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Kl(e),e=e.sibling}function Kl(e){switch(e.tag){case 0:case 11:case 15:Gl(e),e.flags&2048&&el(9,e,e.return);break;case 3:Gl(e);break;case 12:Gl(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,ql(e)):Gl(e);break;default:Gl(e)}}function ql(e){var t=e.deletions;if(e.flags&16){if(t!==null)for(var n=0;n<t.length;n++){var r=t[n];gl=r,Jl(r,e)}Wl(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:el(8,t,t.return),ql(t);break;case 22:n=t.stateNode,n._visibility&2&&(n._visibility&=-3,ql(t));break;default:ql(t)}e=e.sibling}}function Jl(e,t){for(;gl!==null;){var n=gl;switch(n.tag){case 0:case 11:case 15:el(8,n,t);break;case 23:case 22:if(n.memoizedState!==null&&n.memoizedState.cachePool!==null){var r=n.memoizedState.cachePool.pool;r!=null&&r.refCount++}break;case 24:va(n.memoizedState.cache)}if(r=n.child,r!==null)r.return=n,gl=r;else a:for(n=e;gl!==null;){r=gl;var i=r.sibling,a=r.return;if(yl(r),r===n){gl=null;break a}if(i!==null){i.return=a,gl=i;break a}gl=a}}}var Yl={getCacheForType:function(e){var t=ua(ga),n=t.data.get(e);return n===void 0&&(n=e(),t.data.set(e,n)),n},cacheSignal:function(){return ua(ga).controller.signal}},Xl=typeof WeakMap==`function`?WeakMap:Map,q=0,Zl=null,Ql=null,$l=0,eu=0,tu=null,nu=!1,ru=!1,iu=!1,au=0,ou=0,su=0,cu=0,lu=0,uu=0,du=0,fu=null,pu=null,mu=!1,hu=0,gu=0,_u=1/0,vu=null,yu=null,bu=0,xu=null,Su=null,Cu=0,wu=0,Tu=null,Eu=null,Du=0,Ou=null;function ku(){return q&2&&$l!==0?$l&-$l:A.T===null?rt():Od()}function Au(){if(uu===0)if(!($l&536870912)||Ui){var e=Ue;Ue<<=1,!(Ue&3932160)&&(Ue=262144),uu=e}else uu=536870912;return e=po.current,e!==null&&(e.flags|=32),uu}function ju(e,t,n){(e===Zl&&(eu===2||eu===9)||e.cancelPendingCommit!==null)&&(Ru(e,0),Fu(e,$l,uu,!1)),Xe(e,n),(!(q&2)||e!==Zl)&&(e===Zl&&(!(q&2)&&(cu|=n),ou===4&&Fu(e,$l,uu,!1)),bd(e))}function Mu(e,t,n){if(q&6)throw Error(i(327));var r=!n&&(t&127)==0&&(t&e.expiredLanes)===0||qe(e,t),a=r?Ku(e,t):Wu(e,t,!0),o=r;do{if(a===0){ru&&!r&&Fu(e,t,0,!1);break}else{if(n=e.current.alternate,o&&!Pu(n)){a=Wu(e,t,!1),o=!1;continue}if(a===2){if(o=t,e.errorRecoveryDisabledLanes&o)var s=0;else s=e.pendingLanes&-536870913,s=s===0?s&536870912?536870912:0:s;if(s!==0){t=s;a:{var c=e;a=fu;var l=c.current.memoizedState.isDehydrated;if(l&&(Ru(c,s).flags|=256),s=Wu(c,s,!1),s!==2){if(iu&&!l){c.errorRecoveryDisabledLanes|=o,cu|=o,a=4;break a}o=pu,pu=a,o!==null&&(pu===null?pu=o:pu.push.apply(pu,o))}a=s}if(o=!1,a!==2)continue}}if(a===1){Ru(e,0),Fu(e,t,0,!0);break}a:{switch(r=e,o=a,o){case 0:case 1:throw Error(i(345));case 4:if((t&4194048)!==t)break;case 6:Fu(r,t,uu,!nu);break a;case 2:pu=null;break;case 3:case 5:break;default:throw Error(i(329))}if((t&62914560)===t&&(a=hu+300-Oe(),10<a)){if(Fu(r,t,uu,!nu),Ke(r,0,!0)!==0)break a;Cu=t,r.timeoutHandle=mf(Nu.bind(null,r,n,pu,vu,mu,t,uu,cu,du,nu,o,`Throttled`,-0,0),a);break a}Nu(r,n,pu,vu,mu,t,uu,cu,du,nu,o,null,-0,0)}}break}while(1);bd(e)}function Nu(e,t,n,r,i,a,o,s,c,l,u,d,f,p){if(e.timeoutHandle=-1,d=t.subtreeFlags,d&8192||(d&16785408)==16785408){d={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Zt},Ul(t,a,d);var m=(a&62914560)===a?hu-Oe():(a&4194048)===a?gu-Oe():0;if(m=mp(d,m),m!==null){Cu=a,e.cancelPendingCommit=m($u.bind(null,e,t,a,n,r,i,o,s,c,u,d,null,f,p)),Fu(e,a,o,!l);return}}$u(e,t,a,n,r,i,o,s,c)}function Pu(e){for(var t=e;;){var n=t.tag;if((n===0||n===11||n===15)&&t.flags&16384&&(n=t.updateQueue,n!==null&&(n=n.stores,n!==null)))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!Ar(a(),i))return!1}catch{return!1}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Fu(e,t,n,r){t&=~lu,t&=~cu,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var i=t;0<i;){var a=31-Re(i),o=1<<a;r[a]=-1,i&=~o}n!==0&&Qe(e,n,t)}function Iu(){return q&6?!0:(xd(0,!1),!1)}function Lu(){if(Ql!==null){if(eu===0)var e=Ql.return;else e=Ql,na=ta=null,Bo(e),Va=null,Ha=0,e=Ql;for(;e!==null;)Qc(e.alternate,e),e=e.return;Ql=null}}function Ru(e,t){var n=e.timeoutHandle;n!==-1&&(e.timeoutHandle=-1,hf(n)),n=e.cancelPendingCommit,n!==null&&(e.cancelPendingCommit=null,n()),Cu=0,Lu(),Zl=e,Ql=n=vi(e.current,null),$l=t,eu=0,tu=null,nu=!1,ru=qe(e,t),iu=!1,du=uu=lu=cu=su=ou=0,pu=fu=null,mu=!1,t&8&&(t|=t&32);var r=e.entangledLanes;if(r!==0)for(e=e.entanglements,r&=t;0<r;){var i=31-Re(r),a=1<<i;t|=e[i],r&=~a}return au=t,ci(),n}function zu(e,t){H=null,A.H=Qs,t===ja||t===Na?(t=za(),eu=3):t===Ma?(t=za(),eu=4):eu=t===gc?8:typeof t==`object`&&t&&typeof t.then==`function`?6:1,tu=t,Ql===null&&(ou=1,uc(e,Ei(t,e.current)))}function Bu(){var e=po.current;return e===null?!0:($l&4194048)===$l?mo===null:($l&62914560)===$l||$l&536870912?e===mo:!1}function Vu(){var e=A.H;return A.H=Qs,e===null?Qs:e}function Hu(){var e=A.A;return A.A=Yl,e}function Uu(){ou=4,nu||($l&4194048)!==$l&&po.current!==null||(ru=!0),!(su&134217727)&&!(cu&134217727)||Zl===null||Fu(Zl,$l,uu,!1)}function Wu(e,t,n){var r=q;q|=2;var i=Vu(),a=Hu();(Zl!==e||$l!==t)&&(vu=null,Ru(e,t)),t=!1;var o=ou;a:do try{if(eu!==0&&Ql!==null){var s=Ql,c=tu;switch(eu){case 8:Lu(),o=6;break a;case 3:case 2:case 9:case 6:po.current===null&&(t=!0);var l=eu;if(eu=0,tu=null,Xu(e,s,c,l),n&&ru){o=0;break a}break;default:l=eu,eu=0,tu=null,Xu(e,s,c,l)}}Gu(),o=ou;break}catch(t){zu(e,t)}while(1);return t&&e.shellSuspendCounter++,na=ta=null,q=r,A.H=i,A.A=a,Ql===null&&(Zl=null,$l=0,ci()),o}function Gu(){for(;Ql!==null;)Ju(Ql)}function Ku(e,t){var n=q;q|=2;var r=Vu(),a=Hu();Zl!==e||$l!==t?(vu=null,_u=Oe()+500,Ru(e,t)):ru=qe(e,t);a:do try{if(eu!==0&&Ql!==null){t=Ql;var o=tu;b:switch(eu){case 1:eu=0,tu=null,Xu(e,t,o,1);break;case 2:case 9:if(Fa(o)){eu=0,tu=null,Yu(t);break}t=function(){eu!==2&&eu!==9||Zl!==e||(eu=7),bd(e)},o.then(t,t);break a;case 3:eu=7;break a;case 4:eu=5;break a;case 7:Fa(o)?(eu=0,tu=null,Yu(t)):(eu=0,tu=null,Xu(e,t,o,7));break;case 5:var s=null;switch(Ql.tag){case 26:s=Ql.memoizedState;case 5:case 27:var c=Ql;if(s?dp(s):c.stateNode.complete){eu=0,tu=null;var l=c.sibling;if(l!==null)Ql=l;else{var u=c.return;u===null?Ql=null:(Ql=u,Zu(u))}break b}}eu=0,tu=null,Xu(e,t,o,5);break;case 6:eu=0,tu=null,Xu(e,t,o,6);break;case 8:Lu(),ou=6;break a;default:throw Error(i(462))}}qu();break}catch(t){zu(e,t)}while(1);return na=ta=null,A.H=r,A.A=a,q=n,Ql===null?(Zl=null,$l=0,ci(),ou):0}function qu(){for(;Ql!==null&&!Ee();)Ju(Ql)}function Ju(e){var t=Wc(e.alternate,e,au);e.memoizedProps=e.pendingProps,t===null?Zu(e):Ql=t}function Yu(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=kc(n,t,t.pendingProps,t.type,void 0,$l);break;case 11:t=kc(n,t,t.pendingProps,t.type.render,t.ref,$l);break;case 5:Bo(t);default:Qc(n,t),t=Ql=yi(t,au),t=Wc(n,t,au)}e.memoizedProps=e.pendingProps,t===null?Zu(e):Ql=t}function Xu(e,t,n,r){na=ta=null,Bo(t),Va=null,Ha=0;var i=t.return;try{if(hc(e,i,t,n,$l)){ou=1,uc(e,Ei(n,e.current)),Ql=null;return}}catch(t){if(i!==null)throw Ql=i,t;ou=1,uc(e,Ei(n,e.current)),Ql=null;return}t.flags&32768?(Ui||r===1?e=!0:ru||$l&536870912?e=!1:(nu=e=!0,(r===2||r===9||r===3||r===6)&&(r=po.current,r!==null&&r.tag===13&&(r.flags|=16384))),Qu(t,e)):Zu(t)}function Zu(e){var t=e;do{if(t.flags&32768){Qu(t,nu);return}e=t.return;var n=Xc(t.alternate,t,au);if(n!==null){Ql=n;return}if(t=t.sibling,t!==null){Ql=t;return}Ql=t=e}while(t!==null);ou===0&&(ou=5)}function Qu(e,t){do{var n=Zc(e.alternate,e);if(n!==null){n.flags&=32767,Ql=n;return}if(n=e.return,n!==null&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&(e=e.sibling,e!==null)){Ql=e;return}Ql=e=n}while(e!==null);ou=6,Ql=null}function $u(e,t,n,r,a,o,s,c,l){e.cancelPendingCommit=null;do id();while(bu!==0);if(q&6)throw Error(i(327));if(t!==null){if(t===e.current)throw Error(i(177));if(o=t.lanes|t.childLanes,o|=si,Ze(e,n,o,s,c,l),e===Zl&&(Ql=Zl=null,$l=0),Su=t,xu=e,Cu=n,wu=o,Tu=a,Eu=r,t.subtreeFlags&10256||t.flags&10256?(e.callbackNode=null,e.callbackPriority=0,pd(Me,function(){return ad(),null})):(e.callbackNode=null,e.callbackPriority=0),r=(t.flags&13878)!=0,t.subtreeFlags&13878||r){r=A.T,A.T=null,a=j.p,j.p=2,s=q,q|=4;try{_l(e,t,n)}finally{q=s,j.p=a,A.T=r}}bu=1,ed(),td(),nd()}}function ed(){if(bu===1){bu=0;var e=xu,t=Su,n=(t.flags&13878)!=0;if(t.subtreeFlags&13878||n){n=A.T,A.T=null;var r=j.p;j.p=2;var i=q;q|=4;try{kl(t,e);var a=sf,o=Fr(e.containerInfo),s=a.focusedElem,c=a.selectionRange;if(o!==s&&s&&s.ownerDocument&&Pr(s.ownerDocument.documentElement,s)){if(c!==null&&Ir(s)){var l=c.start,u=c.end;if(u===void 0&&(u=l),`selectionStart`in s)s.selectionStart=l,s.selectionEnd=Math.min(u,s.value.length);else{var d=s.ownerDocument||document,f=d&&d.defaultView||window;if(f.getSelection){var p=f.getSelection(),m=s.textContent.length,h=Math.min(c.start,m),g=c.end===void 0?h:Math.min(c.end,m);!p.extend&&h>g&&(o=g,g=h,h=o);var _=Nr(s,h),v=Nr(s,g);if(_&&v&&(p.rangeCount!==1||p.anchorNode!==_.node||p.anchorOffset!==_.offset||p.focusNode!==v.node||p.focusOffset!==v.offset)){var y=d.createRange();y.setStart(_.node,_.offset),p.removeAllRanges(),h>g?(p.addRange(y),p.extend(v.node,v.offset)):(y.setEnd(v.node,v.offset),p.addRange(y))}}}}for(d=[],p=s;p=p.parentNode;)p.nodeType===1&&d.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof s.focus==`function`&&s.focus(),s=0;s<d.length;s++){var b=d[s];b.element.scrollLeft=b.left,b.element.scrollTop=b.top}}Op=!!af,sf=af=null}finally{q=i,j.p=r,A.T=n}}e.current=t,bu=2}}function td(){if(bu===2){bu=0;var e=xu,t=Su,n=(t.flags&8772)!=0;if(t.subtreeFlags&8772||n){n=A.T,A.T=null;var r=j.p;j.p=2;var i=q;q|=4;try{vl(e,t.alternate,t)}finally{q=i,j.p=r,A.T=n}}bu=3}}function nd(){if(bu===4||bu===3){bu=0,De();var e=xu,t=Su,n=Cu,r=Eu;t.subtreeFlags&10256||t.flags&10256?bu=5:(bu=0,Su=xu=null,rd(e,e.pendingLanes));var i=e.pendingLanes;if(i===0&&(yu=null),nt(n),t=t.stateNode,Le&&typeof Le.onCommitFiberRoot==`function`)try{Le.onCommitFiberRoot(Ie,t,void 0,(t.current.flags&128)==128)}catch{}if(r!==null){t=A.T,i=j.p,j.p=2,A.T=null;try{for(var a=e.onRecoverableError,o=0;o<r.length;o++){var s=r[o];a(s.value,{componentStack:s.stack})}}finally{A.T=t,j.p=i}}Cu&3&&id(),bd(e),i=e.pendingLanes,n&261930&&i&42?e===Ou?Du++:(Du=0,Ou=e):Du=0,xd(0,!1)}}function rd(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,va(t)))}function id(){return ed(),td(),nd(),ad()}function ad(){if(bu!==5)return!1;var e=xu,t=wu;wu=0;var n=nt(Cu),r=A.T,a=j.p;try{j.p=32>n?32:n,A.T=null,n=Tu,Tu=null;var o=xu,s=Cu;if(bu=0,Su=xu=null,Cu=0,q&6)throw Error(i(331));var c=q;if(q|=4,Kl(o.current),Rl(o,o.current,s,n),q=c,xd(0,!1),Le&&typeof Le.onPostCommitFiberRoot==`function`)try{Le.onPostCommitFiberRoot(Ie,o)}catch{}return!0}finally{j.p=a,A.T=r,rd(e,t)}}function od(e,t,n){t=Ei(n,t),t=fc(e.stateNode,t,2),e=$a(e,t,2),e!==null&&(Xe(e,2),bd(e))}function sd(e,t,n){if(e.tag===3)od(e,e,n);else for(;t!==null;){if(t.tag===3){od(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError==`function`||typeof r.componentDidCatch==`function`&&(yu===null||!yu.has(r))){e=Ei(n,e),n=pc(2),r=$a(t,n,2),r!==null&&(mc(n,r,t,e),Xe(r,2),bd(r));break}}t=t.return}}function cd(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new Xl;var i=new Set;r.set(t,i)}else i=r.get(t),i===void 0&&(i=new Set,r.set(t,i));i.has(n)||(iu=!0,i.add(n),e=ld.bind(null,e,t,n),t.then(e,e))}function ld(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,Zl===e&&($l&n)===n&&(ou===4||ou===3&&($l&62914560)===$l&&300>Oe()-hu?!(q&2)&&Ru(e,0):lu|=n,du===$l&&(du=0)),bd(e)}function ud(e,t){t===0&&(t=R()),e=di(e,t),e!==null&&(Xe(e,t),bd(e))}function dd(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),ud(e,n)}function fd(e,t){var n=0;switch(e.tag){case 31:case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(n=a.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(i(314))}r!==null&&r.delete(t),ud(e,n)}function pd(e,t){return we(e,t)}var md=null,hd=null,gd=!1,_d=!1,vd=!1,yd=0;function bd(e){e!==hd&&e.next===null&&(hd===null?md=hd=e:hd=hd.next=e),_d=!0,gd||(gd=!0,Dd())}function xd(e,t){if(!vd&&_d){vd=!0;do for(var n=!1,r=md;r!==null;){if(!t)if(e!==0){var i=r.pendingLanes;if(i===0)var a=0;else{var o=r.suspendedLanes,s=r.pingedLanes;a=(1<<31-Re(42|e)+1)-1,a&=i&~(o&~s),a=a&201326741?a&201326741|1:a?a|2:0}a!==0&&(n=!0,Ed(r,a))}else a=$l,a=Ke(r,r===Zl?a:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),!(a&3)||qe(r,a)||(n=!0,Ed(r,a));r=r.next}while(n);vd=!1}}function Sd(){Cd()}function Cd(){_d=gd=!1;var e=0;yd!==0&&pf()&&(e=yd);for(var t=Oe(),n=null,r=md;r!==null;){var i=r.next,a=wd(r,t);a===0?(r.next=null,n===null?md=i:n.next=i,i===null&&(hd=n)):(n=r,(e!==0||a&3)&&(_d=!0)),r=i}bu!==0&&bu!==5||xd(e,!1),yd!==0&&(yd=0)}function wd(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes&-62914561;0<a;){var o=31-Re(a),s=1<<o,c=i[o];c===-1?((s&n)===0||(s&r)!==0)&&(i[o]=Je(s,t)):c<=t&&(e.expiredLanes|=s),a&=~s}if(t=Zl,n=$l,n=Ke(e,e===t?n:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),r=e.callbackNode,n===0||e===t&&(eu===2||eu===9)||e.cancelPendingCommit!==null)return r!==null&&r!==null&&Te(r),e.callbackNode=null,e.callbackPriority=0;if(!(n&3)||qe(e,n)){if(t=n&-n,t===e.callbackPriority)return t;switch(r!==null&&Te(r),nt(n)){case 2:case 8:n=je;break;case 32:n=Me;break;case 268435456:n=Pe;break;default:n=Me}return r=Td.bind(null,e),n=we(n,r),e.callbackPriority=t,e.callbackNode=n,t}return r!==null&&r!==null&&Te(r),e.callbackPriority=2,e.callbackNode=null,2}function Td(e,t){if(bu!==0&&bu!==5)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(id()&&e.callbackNode!==n)return null;var r=$l;return r=Ke(e,e===Zl?r:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),r===0?null:(Mu(e,r,t),wd(e,Oe()),e.callbackNode!=null&&e.callbackNode===n?Td.bind(null,e):null)}function Ed(e,t){if(id())return null;Mu(e,t,!0)}function Dd(){_f(function(){q&6?we(Ae,Sd):Cd()})}function Od(){if(yd===0){var e=xa;e===0&&(e=He,He<<=1,!(He&261888)&&(He=256)),yd=e}return yd}function kd(e){return e==null||typeof e==`symbol`||typeof e==`boolean`?null:typeof e==`function`?e:Xt(``+e)}function Ad(e,t){var n=t.ownerDocument.createElement(`input`);return n.name=t.name,n.value=t.value,e.id&&n.setAttribute(`form`,e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}function jd(e,t,n,r,i){if(t===`submit`&&n&&n.stateNode===i){var a=kd((i[st]||null).action),o=r.submitter;o&&(t=(t=o[st]||null)?kd(t.formAction):o.getAttribute(`formAction`),t!==null&&(a=t,o=null));var s=new yn(`action`,`action`,null,r,i);e.push({event:s,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(yd!==0){var e=o?Ad(i,o):new FormData(i);Rs(n,{pending:!0,data:e,method:i.method,action:a},null,e)}}else typeof a==`function`&&(s.preventDefault(),e=o?Ad(i,o):new FormData(i),Rs(n,{pending:!0,data:e,method:i.method,action:a},a,e))},currentTarget:i}]})}}for(var Md=0;Md<ni.length;Md++){var Nd=ni[Md],Pd=Nd.toLowerCase(),Fd=Nd[0].toUpperCase()+Nd.slice(1);ri(Pd,`on`+Fd)}ri(Jr,`onAnimationEnd`),ri(Yr,`onAnimationIteration`),ri(Xr,`onAnimationStart`),ri(`dblclick`,`onDoubleClick`),ri(`focusin`,`onFocus`),ri(`focusout`,`onBlur`),ri(Zr,`onTransitionRun`),ri(Qr,`onTransitionStart`),ri($r,`onTransitionCancel`),ri(ei,`onTransitionEnd`),z(`onMouseEnter`,[`mouseout`,`mouseover`]),z(`onMouseLeave`,[`mouseout`,`mouseover`]),z(`onPointerEnter`,[`pointerout`,`pointerover`]),z(`onPointerLeave`,[`pointerout`,`pointerover`]),St(`onChange`,`change click focusin focusout input keydown keyup selectionchange`.split(` `)),St(`onSelect`,`focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange`.split(` `)),St(`onBeforeInput`,[`compositionend`,`keypress`,`textInput`,`paste`]),St(`onCompositionEnd`,`compositionend focusout keydown keypress keyup mousedown`.split(` `)),St(`onCompositionStart`,`compositionstart focusout keydown keypress keyup mousedown`.split(` `)),St(`onCompositionUpdate`,`compositionupdate focusout keydown keypress keyup mousedown`.split(` `));var Id=`abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting`.split(` `),Ld=new Set(`beforetoggle cancel close invalid load scroll scrollend toggle`.split(` `).concat(Id));function Rd(e,t){t=(t&4)!=0;for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;a:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],c=s.instance,l=s.currentTarget;if(s=s.listener,c!==a&&i.isPropagationStopped())break a;a=s,i.currentTarget=l;try{a(i)}catch(e){ii(e)}i.currentTarget=null,a=c}else for(o=0;o<r.length;o++){if(s=r[o],c=s.instance,l=s.currentTarget,s=s.listener,c!==a&&i.isPropagationStopped())break a;a=s,i.currentTarget=l;try{a(i)}catch(e){ii(e)}i.currentTarget=null,a=c}}}}function J(e,t){var n=t[lt];n===void 0&&(n=t[lt]=new Set);var r=e+`__bubble`;n.has(r)||(Hd(t,e,2,!1),n.add(r))}function zd(e,t,n){var r=0;t&&(r|=4),Hd(n,e,r,t)}var Bd=`_reactListening`+Math.random().toString(36).slice(2);function Vd(e){if(!e[Bd]){e[Bd]=!0,bt.forEach(function(t){t!==`selectionchange`&&(Ld.has(t)||zd(t,!1,e),zd(t,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Bd]||(t[Bd]=!0,zd(`selectionchange`,!1,t))}}function Hd(e,t,n,r){switch(Fp(t)){case 2:var i=kp;break;case 8:i=Ap;break;default:i=jp}n=i.bind(null,t,n,e),i=void 0,!cn||t!==`touchstart`&&t!==`touchmove`&&t!==`wheel`||(i=!0),r?i===void 0?e.addEventListener(t,n,!0):e.addEventListener(t,n,{capture:!0,passive:i}):i===void 0?e.addEventListener(t,n,!1):e.addEventListener(t,n,{passive:i})}function Ud(e,t,n,r,i){var a=r;if(!(t&1)&&!(t&2)&&r!==null)a:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var c=r.stateNode.containerInfo;if(c===i)break;if(s===4)for(s=r.return;s!==null;){var l=s.tag;if((l===3||l===4)&&s.stateNode.containerInfo===i)return;s=s.return}for(;c!==null;){if(s=ht(c),s===null)return;if(l=s.tag,l===5||l===6||l===26||l===27){r=a=s;continue a}c=c.parentNode}}r=r.return}an(function(){var r=a,i=$t(n),s=[];a:{var c=ti.get(e);if(c!==void 0){var l=yn,u=e;switch(e){case`keypress`:if(mn(n)===0)break a;case`keydown`:case`keyup`:l=Un;break;case`focusin`:u=`focus`,l=An;break;case`focusout`:u=`blur`,l=An;break;case`beforeblur`:case`afterblur`:l=An;break;case`click`:if(n.button===2)break a;case`auxclick`:case`dblclick`:case`mousedown`:case`mousemove`:case`mouseup`:case`mouseout`:case`mouseover`:case`contextmenu`:l=En;break;case`drag`:case`dragend`:case`dragenter`:case`dragexit`:case`dragleave`:case`dragover`:case`dragstart`:case`drop`:l=On;break;case`touchcancel`:case`touchend`:case`touchmove`:case`touchstart`:l=qn;break;case Jr:case Yr:case Xr:l=Mn;break;case ei:l=Yn;break;case`scroll`:case`scrollend`:l=xn;break;case`wheel`:l=Zn;break;case`copy`:case`cut`:case`paste`:l=Pn;break;case`gotpointercapture`:case`lostpointercapture`:case`pointercancel`:case`pointerdown`:case`pointermove`:case`pointerout`:case`pointerover`:case`pointerup`:l=Gn;break;case`toggle`:case`beforetoggle`:l=$n}var d=(t&4)!=0,f=!d&&(e===`scroll`||e===`scrollend`),p=d?c===null?null:c+`Capture`:c;d=[];for(var m=r,h;m!==null;){var g=m;if(h=g.stateNode,g=g.tag,g!==5&&g!==26&&g!==27||h===null||p===null||(g=on(m,p),g!=null&&d.push(Wd(m,g,h))),f)break;m=m.return}0<d.length&&(c=new l(c,u,null,n,i),s.push({event:c,listeners:d}))}}if(!(t&7)){a:{if(c=e===`mouseover`||e===`pointerover`,l=e===`mouseout`||e===`pointerout`,c&&n!==Qt&&(u=n.relatedTarget||n.fromElement)&&(ht(u)||u[ct]))break a;if((l||c)&&(c=i.window===i?i:(c=i.ownerDocument)?c.defaultView||c.parentWindow:window,l?(u=n.relatedTarget||n.toElement,l=r,u=u?ht(u):null,u!==null&&(f=o(u),d=u.tag,u!==f||d!==5&&d!==27&&d!==6)&&(u=null)):(l=null,u=r),l!==u)){if(d=En,g=`onMouseLeave`,p=`onMouseEnter`,m=`mouse`,(e===`pointerout`||e===`pointerover`)&&(d=Gn,g=`onPointerLeave`,p=`onPointerEnter`,m=`pointer`),f=l==null?c:_t(l),h=u==null?c:_t(u),c=new d(g,m+`leave`,l,n,i),c.target=f,c.relatedTarget=h,g=null,ht(i)===r&&(d=new d(p,m+`enter`,u,n,i),d.target=h,d.relatedTarget=f,g=d),f=g,l&&u)b:{for(d=Kd,p=l,m=u,h=0,g=p;g;g=d(g))h++;g=0;for(var _=m;_;_=d(_))g++;for(;0<h-g;)p=d(p),h--;for(;0<g-h;)m=d(m),g--;for(;h--;){if(p===m||m!==null&&p===m.alternate){d=p;break b}p=d(p),m=d(m)}d=null}else d=null;l!==null&&qd(s,c,l,d,!1),u!==null&&f!==null&&qd(s,f,u,d,!0)}}a:{if(c=r?_t(r):window,l=c.nodeName&&c.nodeName.toLowerCase(),l===`select`||l===`input`&&c.type===`file`)var v=yr;else if(pr(c))if(br)v=Or;else{v=Er;var y=V}else l=c.nodeName,!l||l.toLowerCase()!==`input`||c.type!==`checkbox`&&c.type!==`radio`?r&&qt(r.elementType)&&(v=yr):v=Dr;if(v&&=v(e,r)){mr(s,v,n,i);break a}y&&y(e,c,r),e===`focusout`&&r&&c.type===`number`&&r.memoizedProps.value!=null&&B(c,`number`,c.value)}switch(y=r?_t(r):window,e){case`focusin`:(pr(y)||y.contentEditable===`true`)&&(Rr=y,zr=r,Br=null);break;case`focusout`:Br=zr=Rr=null;break;case`mousedown`:Vr=!0;break;case`contextmenu`:case`mouseup`:case`dragend`:Vr=!1,Hr(s,n,i);break;case`selectionchange`:if(Lr)break;case`keydown`:case`keyup`:Hr(s,n,i)}var b;if(tr)b:{switch(e){case`compositionstart`:var x=`onCompositionStart`;break b;case`compositionend`:x=`onCompositionEnd`;break b;case`compositionupdate`:x=`onCompositionUpdate`;break b}x=void 0}else lr?sr(e,n)&&(x=`onCompositionEnd`):e===`keydown`&&n.keyCode===229&&(x=`onCompositionStart`);x&&(ir&&n.locale!==`ko`&&(lr||x!==`onCompositionStart`?x===`onCompositionEnd`&&lr&&(b=pn()):(un=i,dn=`value`in un?un.value:un.textContent,lr=!0)),y=Gd(r,x),0<y.length&&(x=new In(x,e,null,n,i),s.push({event:x,listeners:y}),b?x.data=b:(b=cr(n),b!==null&&(x.data=b)))),(b=rr?ur(e,n):dr(e,n))&&(x=Gd(r,`onBeforeInput`),0<x.length&&(y=new In(`onBeforeInput`,`beforeinput`,null,n,i),s.push({event:y,listeners:x}),y.data=b)),jd(s,e,r,n,i)}Rd(s,t)})}function Wd(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Gd(e,t){for(var n=t+`Capture`,r=[];e!==null;){var i=e,a=i.stateNode;if(i=i.tag,i!==5&&i!==26&&i!==27||a===null||(i=on(e,n),i!=null&&r.unshift(Wd(e,i,a)),i=on(e,t),i!=null&&r.push(Wd(e,i,a))),e.tag===3)return r;e=e.return}return[]}function Kd(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function qd(e,t,n,r,i){for(var a=t._reactName,o=[];n!==null&&n!==r;){var s=n,c=s.alternate,l=s.stateNode;if(s=s.tag,c!==null&&c===r)break;s!==5&&s!==26&&s!==27||l===null||(c=l,i?(l=on(n,a),l!=null&&o.unshift(Wd(n,l,c))):i||(l=on(n,a),l!=null&&o.push(Wd(n,l,c)))),n=n.return}o.length!==0&&e.push({event:t,listeners:o})}var Jd=/\r\n?/g,Yd=/\u0000|\uFFFD/g;function Xd(e){return(typeof e==`string`?e:``+e).replace(Jd,`
`).replace(Yd,``)}function Zd(e,t){return t=Xd(t),Xd(e)===t}function Qd(e,t,n,r,a,o){switch(n){case`children`:typeof r==`string`?t===`body`||t===`textarea`&&r===``||Ut(e,r):(typeof r==`number`||typeof r==`bigint`)&&t!==`body`&&Ut(e,``+r);break;case`className`:Ot(e,`class`,r);break;case`tabIndex`:Ot(e,`tabindex`,r);break;case`dir`:case`role`:case`viewBox`:case`width`:case`height`:Ot(e,n,r);break;case`style`:Kt(e,r,o);break;case`data`:if(t!==`object`){Ot(e,`data`,r);break}case`src`:case`href`:if(r===``&&(t!==`a`||n!==`href`)){e.removeAttribute(n);break}if(r==null||typeof r==`function`||typeof r==`symbol`||typeof r==`boolean`){e.removeAttribute(n);break}r=Xt(``+r),e.setAttribute(n,r);break;case`action`:case`formAction`:if(typeof r==`function`){e.setAttribute(n,`javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')`);break}else typeof o==`function`&&(n===`formAction`?(t!==`input`&&Qd(e,t,`name`,a.name,a,null),Qd(e,t,`formEncType`,a.formEncType,a,null),Qd(e,t,`formMethod`,a.formMethod,a,null),Qd(e,t,`formTarget`,a.formTarget,a,null)):(Qd(e,t,`encType`,a.encType,a,null),Qd(e,t,`method`,a.method,a,null),Qd(e,t,`target`,a.target,a,null)));if(r==null||typeof r==`symbol`||typeof r==`boolean`){e.removeAttribute(n);break}r=Xt(``+r),e.setAttribute(n,r);break;case`onClick`:r!=null&&(e.onclick=Zt);break;case`onScroll`:r!=null&&J(`scroll`,e);break;case`onScrollEnd`:r!=null&&J(`scrollend`,e);break;case`dangerouslySetInnerHTML`:if(r!=null){if(typeof r!=`object`||!(`__html`in r))throw Error(i(61));if(n=r.__html,n!=null){if(a.children!=null)throw Error(i(60));e.innerHTML=n}}break;case`multiple`:e.multiple=r&&typeof r!=`function`&&typeof r!=`symbol`;break;case`muted`:e.muted=r&&typeof r!=`function`&&typeof r!=`symbol`;break;case`suppressContentEditableWarning`:case`suppressHydrationWarning`:case`defaultValue`:case`defaultChecked`:case`innerHTML`:case`ref`:break;case`autoFocus`:break;case`xlinkHref`:if(r==null||typeof r==`function`||typeof r==`boolean`||typeof r==`symbol`){e.removeAttribute(`xlink:href`);break}n=Xt(``+r),e.setAttributeNS(`http://www.w3.org/1999/xlink`,`xlink:href`,n);break;case`contentEditable`:case`spellCheck`:case`draggable`:case`value`:case`autoReverse`:case`externalResourcesRequired`:case`focusable`:case`preserveAlpha`:r!=null&&typeof r!=`function`&&typeof r!=`symbol`?e.setAttribute(n,``+r):e.removeAttribute(n);break;case`inert`:case`allowFullScreen`:case`async`:case`autoPlay`:case`controls`:case`default`:case`defer`:case`disabled`:case`disablePictureInPicture`:case`disableRemotePlayback`:case`formNoValidate`:case`hidden`:case`loop`:case`noModule`:case`noValidate`:case`open`:case`playsInline`:case`readOnly`:case`required`:case`reversed`:case`scoped`:case`seamless`:case`itemScope`:r&&typeof r!=`function`&&typeof r!=`symbol`?e.setAttribute(n,``):e.removeAttribute(n);break;case`capture`:case`download`:!0===r?e.setAttribute(n,``):!1!==r&&r!=null&&typeof r!=`function`&&typeof r!=`symbol`?e.setAttribute(n,r):e.removeAttribute(n);break;case`cols`:case`rows`:case`size`:case`span`:r!=null&&typeof r!=`function`&&typeof r!=`symbol`&&!isNaN(r)&&1<=r?e.setAttribute(n,r):e.removeAttribute(n);break;case`rowSpan`:case`start`:r==null||typeof r==`function`||typeof r==`symbol`||isNaN(r)?e.removeAttribute(n):e.setAttribute(n,r);break;case`popover`:J(`beforetoggle`,e),J(`toggle`,e),Dt(e,`popover`,r);break;case`xlinkActuate`:kt(e,`http://www.w3.org/1999/xlink`,`xlink:actuate`,r);break;case`xlinkArcrole`:kt(e,`http://www.w3.org/1999/xlink`,`xlink:arcrole`,r);break;case`xlinkRole`:kt(e,`http://www.w3.org/1999/xlink`,`xlink:role`,r);break;case`xlinkShow`:kt(e,`http://www.w3.org/1999/xlink`,`xlink:show`,r);break;case`xlinkTitle`:kt(e,`http://www.w3.org/1999/xlink`,`xlink:title`,r);break;case`xlinkType`:kt(e,`http://www.w3.org/1999/xlink`,`xlink:type`,r);break;case`xmlBase`:kt(e,`http://www.w3.org/XML/1998/namespace`,`xml:base`,r);break;case`xmlLang`:kt(e,`http://www.w3.org/XML/1998/namespace`,`xml:lang`,r);break;case`xmlSpace`:kt(e,`http://www.w3.org/XML/1998/namespace`,`xml:space`,r);break;case`is`:Dt(e,`is`,r);break;case`innerText`:case`textContent`:break;default:(!(2<n.length)||n[0]!==`o`&&n[0]!==`O`||n[1]!==`n`&&n[1]!==`N`)&&(n=Jt.get(n)||n,Dt(e,n,r))}}function $d(e,t,n,r,a,o){switch(n){case`style`:Kt(e,r,o);break;case`dangerouslySetInnerHTML`:if(r!=null){if(typeof r!=`object`||!(`__html`in r))throw Error(i(61));if(n=r.__html,n!=null){if(a.children!=null)throw Error(i(60));e.innerHTML=n}}break;case`children`:typeof r==`string`?Ut(e,r):(typeof r==`number`||typeof r==`bigint`)&&Ut(e,``+r);break;case`onScroll`:r!=null&&J(`scroll`,e);break;case`onScrollEnd`:r!=null&&J(`scrollend`,e);break;case`onClick`:r!=null&&(e.onclick=Zt);break;case`suppressContentEditableWarning`:case`suppressHydrationWarning`:case`innerHTML`:case`ref`:break;case`innerText`:case`textContent`:break;default:if(!xt.hasOwnProperty(n))a:{if(n[0]===`o`&&n[1]===`n`&&(a=n.endsWith(`Capture`),t=n.slice(2,a?n.length-7:void 0),o=e[st]||null,o=o==null?null:o[n],typeof o==`function`&&e.removeEventListener(t,o,a),typeof r==`function`)){typeof o!=`function`&&o!==null&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,r,a);break a}n in e?e[n]=r:!0===r?e.setAttribute(n,``):Dt(e,n,r)}}}function ef(e,t,n){switch(t){case`div`:case`span`:case`svg`:case`path`:case`a`:case`g`:case`p`:case`li`:break;case`img`:J(`error`,e),J(`load`,e);var r=!1,a=!1,o;for(o in n)if(n.hasOwnProperty(o)){var s=n[o];if(s!=null)switch(o){case`src`:r=!0;break;case`srcSet`:a=!0;break;case`children`:case`dangerouslySetInnerHTML`:throw Error(i(137,t));default:Qd(e,t,o,s,n,null)}}a&&Qd(e,t,`srcSet`,n.srcSet,n,null),r&&Qd(e,t,`src`,n.src,n,null);return;case`input`:J(`invalid`,e);var c=o=s=a=null,l=null,u=null;for(r in n)if(n.hasOwnProperty(r)){var d=n[r];if(d!=null)switch(r){case`name`:a=d;break;case`type`:s=d;break;case`checked`:l=d;break;case`defaultChecked`:u=d;break;case`value`:o=d;break;case`defaultValue`:c=d;break;case`children`:case`dangerouslySetInnerHTML`:if(d!=null)throw Error(i(137,t));break;default:Qd(e,t,r,d,n,null)}}zt(e,o,c,l,u,s,a,!1);return;case`select`:for(a in J(`invalid`,e),r=s=o=null,n)if(n.hasOwnProperty(a)&&(c=n[a],c!=null))switch(a){case`value`:o=c;break;case`defaultValue`:s=c;break;case`multiple`:r=c;default:Qd(e,t,a,c,n,null)}t=o,n=s,e.multiple=!!r,t==null?n!=null&&Bt(e,!!r,n,!0):Bt(e,!!r,t,!1);return;case`textarea`:for(s in J(`invalid`,e),o=a=r=null,n)if(n.hasOwnProperty(s)&&(c=n[s],c!=null))switch(s){case`value`:r=c;break;case`defaultValue`:a=c;break;case`children`:o=c;break;case`dangerouslySetInnerHTML`:if(c!=null)throw Error(i(91));break;default:Qd(e,t,s,c,n,null)}Ht(e,r,a,o);return;case`option`:for(l in n)if(n.hasOwnProperty(l)&&(r=n[l],r!=null))switch(l){case`selected`:e.selected=r&&typeof r!=`function`&&typeof r!=`symbol`;break;default:Qd(e,t,l,r,n,null)}return;case`dialog`:J(`beforetoggle`,e),J(`toggle`,e),J(`cancel`,e),J(`close`,e);break;case`iframe`:case`object`:J(`load`,e);break;case`video`:case`audio`:for(r=0;r<Id.length;r++)J(Id[r],e);break;case`image`:J(`error`,e),J(`load`,e);break;case`details`:J(`toggle`,e);break;case`embed`:case`source`:case`link`:J(`error`,e),J(`load`,e);case`area`:case`base`:case`br`:case`col`:case`hr`:case`keygen`:case`meta`:case`param`:case`track`:case`wbr`:case`menuitem`:for(u in n)if(n.hasOwnProperty(u)&&(r=n[u],r!=null))switch(u){case`children`:case`dangerouslySetInnerHTML`:throw Error(i(137,t));default:Qd(e,t,u,r,n,null)}return;default:if(qt(t)){for(d in n)n.hasOwnProperty(d)&&(r=n[d],r!==void 0&&$d(e,t,d,r,n,void 0));return}}for(c in n)n.hasOwnProperty(c)&&(r=n[c],r!=null&&Qd(e,t,c,r,n,null))}function tf(e,t,n,r){switch(t){case`div`:case`span`:case`svg`:case`path`:case`a`:case`g`:case`p`:case`li`:break;case`input`:var a=null,o=null,s=null,c=null,l=null,u=null,d=null;for(m in n){var f=n[m];if(n.hasOwnProperty(m)&&f!=null)switch(m){case`checked`:break;case`value`:break;case`defaultValue`:l=f;default:r.hasOwnProperty(m)||Qd(e,t,m,null,r,f)}}for(var p in r){var m=r[p];if(f=n[p],r.hasOwnProperty(p)&&(m!=null||f!=null))switch(p){case`type`:o=m;break;case`name`:a=m;break;case`checked`:u=m;break;case`defaultChecked`:d=m;break;case`value`:s=m;break;case`defaultValue`:c=m;break;case`children`:case`dangerouslySetInnerHTML`:if(m!=null)throw Error(i(137,t));break;default:m!==f&&Qd(e,t,p,m,r,f)}}Rt(e,s,c,l,u,d,o,a);return;case`select`:for(o in m=s=c=p=null,n)if(l=n[o],n.hasOwnProperty(o)&&l!=null)switch(o){case`value`:break;case`multiple`:m=l;default:r.hasOwnProperty(o)||Qd(e,t,o,null,r,l)}for(a in r)if(o=r[a],l=n[a],r.hasOwnProperty(a)&&(o!=null||l!=null))switch(a){case`value`:p=o;break;case`defaultValue`:c=o;break;case`multiple`:s=o;default:o!==l&&Qd(e,t,a,o,r,l)}t=c,n=s,r=m,p==null?!!r!=!!n&&(t==null?Bt(e,!!n,n?[]:``,!1):Bt(e,!!n,t,!0)):Bt(e,!!n,p,!1);return;case`textarea`:for(c in m=p=null,n)if(a=n[c],n.hasOwnProperty(c)&&a!=null&&!r.hasOwnProperty(c))switch(c){case`value`:break;case`children`:break;default:Qd(e,t,c,null,r,a)}for(s in r)if(a=r[s],o=n[s],r.hasOwnProperty(s)&&(a!=null||o!=null))switch(s){case`value`:p=a;break;case`defaultValue`:m=a;break;case`children`:break;case`dangerouslySetInnerHTML`:if(a!=null)throw Error(i(91));break;default:a!==o&&Qd(e,t,s,a,r,o)}Vt(e,p,m);return;case`option`:for(var h in n)if(p=n[h],n.hasOwnProperty(h)&&p!=null&&!r.hasOwnProperty(h))switch(h){case`selected`:e.selected=!1;break;default:Qd(e,t,h,null,r,p)}for(l in r)if(p=r[l],m=n[l],r.hasOwnProperty(l)&&p!==m&&(p!=null||m!=null))switch(l){case`selected`:e.selected=p&&typeof p!=`function`&&typeof p!=`symbol`;break;default:Qd(e,t,l,p,r,m)}return;case`img`:case`link`:case`area`:case`base`:case`br`:case`col`:case`embed`:case`hr`:case`keygen`:case`meta`:case`param`:case`source`:case`track`:case`wbr`:case`menuitem`:for(var g in n)p=n[g],n.hasOwnProperty(g)&&p!=null&&!r.hasOwnProperty(g)&&Qd(e,t,g,null,r,p);for(u in r)if(p=r[u],m=n[u],r.hasOwnProperty(u)&&p!==m&&(p!=null||m!=null))switch(u){case`children`:case`dangerouslySetInnerHTML`:if(p!=null)throw Error(i(137,t));break;default:Qd(e,t,u,p,r,m)}return;default:if(qt(t)){for(var _ in n)p=n[_],n.hasOwnProperty(_)&&p!==void 0&&!r.hasOwnProperty(_)&&$d(e,t,_,void 0,r,p);for(d in r)p=r[d],m=n[d],!r.hasOwnProperty(d)||p===m||p===void 0&&m===void 0||$d(e,t,d,p,r,m);return}}for(var v in n)p=n[v],n.hasOwnProperty(v)&&p!=null&&!r.hasOwnProperty(v)&&Qd(e,t,v,null,r,p);for(f in r)p=r[f],m=n[f],!r.hasOwnProperty(f)||p===m||p==null&&m==null||Qd(e,t,f,p,r,m)}function nf(e){switch(e){case`css`:case`script`:case`font`:case`img`:case`image`:case`input`:case`link`:return!0;default:return!1}}function rf(){if(typeof performance.getEntriesByType==`function`){for(var e=0,t=0,n=performance.getEntriesByType(`resource`),r=0;r<n.length;r++){var i=n[r],a=i.transferSize,o=i.initiatorType,s=i.duration;if(a&&s&&nf(o)){for(o=0,s=i.responseEnd,r+=1;r<n.length;r++){var c=n[r],l=c.startTime;if(l>s)break;var u=c.transferSize,d=c.initiatorType;u&&nf(d)&&(c=c.responseEnd,o+=u*(c<s?1:(s-l)/(c-l)))}if(--r,t+=8*(a+o)/(i.duration/1e3),e++,10<e)break}}if(0<e)return t/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e==`number`)?e:5}var af=null,sf=null;function cf(e){return e.nodeType===9?e:e.ownerDocument}function lf(e){switch(e){case`http://www.w3.org/2000/svg`:return 1;case`http://www.w3.org/1998/Math/MathML`:return 2;default:return 0}}function uf(e,t){if(e===0)switch(t){case`svg`:return 1;case`math`:return 2;default:return 0}return e===1&&t===`foreignObject`?0:e}function df(e,t){return e===`textarea`||e===`noscript`||typeof t.children==`string`||typeof t.children==`number`||typeof t.children==`bigint`||typeof t.dangerouslySetInnerHTML==`object`&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var ff=null;function pf(){var e=window.event;return e&&e.type===`popstate`?e===ff?!1:(ff=e,!0):(ff=null,!1)}var mf=typeof setTimeout==`function`?setTimeout:void 0,hf=typeof clearTimeout==`function`?clearTimeout:void 0,gf=typeof Promise==`function`?Promise:void 0,_f=typeof queueMicrotask==`function`?queueMicrotask:gf===void 0?mf:function(e){return gf.resolve(null).then(e).catch(vf)};function vf(e){setTimeout(function(){throw e})}function yf(e){return e===`head`}function bf(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&i.nodeType===8)if(n=i.data,n===`/$`||n===`/&`){if(r===0){e.removeChild(i),em(t);return}r--}else if(n===`$`||n===`$?`||n===`$~`||n===`$!`||n===`&`)r++;else if(n===`html`)Pf(e.ownerDocument.documentElement);else if(n===`head`){n=e.ownerDocument.head,Pf(n);for(var a=n.firstChild;a;){var o=a.nextSibling,s=a.nodeName;a[pt]||s===`SCRIPT`||s===`STYLE`||s===`LINK`&&a.rel.toLowerCase()===`stylesheet`||n.removeChild(a),a=o}}else n===`body`&&Pf(e.ownerDocument.body);n=i}while(n);em(t)}function xf(e,t){var n=e;e=0;do{var r=n.nextSibling;if(n.nodeType===1?t?(n._stashedDisplay=n.style.display,n.style.display=`none`):(n.style.display=n._stashedDisplay||``,n.getAttribute(`style`)===``&&n.removeAttribute(`style`)):n.nodeType===3&&(t?(n._stashedText=n.nodeValue,n.nodeValue=``):n.nodeValue=n._stashedText||``),r&&r.nodeType===8)if(n=r.data,n===`/$`){if(e===0)break;e--}else n!==`$`&&n!==`$?`&&n!==`$~`&&n!==`$!`||e++;n=r}while(n)}function Sf(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case`HTML`:case`HEAD`:case`BODY`:Sf(n),mt(n);continue;case`SCRIPT`:case`STYLE`:continue;case`LINK`:if(n.rel.toLowerCase()===`stylesheet`)continue}e.removeChild(n)}}function Cf(e,t,n,r){for(;e.nodeType===1;){var i=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&(e.nodeName!==`INPUT`||e.type!==`hidden`))break}else if(r){if(!e[pt])switch(t){case`meta`:if(!e.hasAttribute(`itemprop`))break;return e;case`link`:if(a=e.getAttribute(`rel`),a===`stylesheet`&&e.hasAttribute(`data-precedence`)||a!==i.rel||e.getAttribute(`href`)!==(i.href==null||i.href===``?null:i.href)||e.getAttribute(`crossorigin`)!==(i.crossOrigin==null?null:i.crossOrigin)||e.getAttribute(`title`)!==(i.title==null?null:i.title))break;return e;case`style`:if(e.hasAttribute(`data-precedence`))break;return e;case`script`:if(a=e.getAttribute(`src`),(a!==(i.src==null?null:i.src)||e.getAttribute(`type`)!==(i.type==null?null:i.type)||e.getAttribute(`crossorigin`)!==(i.crossOrigin==null?null:i.crossOrigin))&&a&&e.hasAttribute(`async`)&&!e.hasAttribute(`itemprop`))break;return e;default:return e}}else if(t===`input`&&e.type===`hidden`){var a=i.name==null?null:``+i.name;if(i.type===`hidden`&&e.getAttribute(`name`)===a)return e}else return e;if(e=kf(e.nextSibling),e===null)break}return null}function wf(e,t,n){if(t===``)return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!==`INPUT`||e.type!==`hidden`)&&!n||(e=kf(e.nextSibling),e===null))return null;return e}function Tf(e,t){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!==`INPUT`||e.type!==`hidden`)&&!t||(e=kf(e.nextSibling),e===null))return null;return e}function Ef(e){return e.data===`$?`||e.data===`$~`}function Df(e){return e.data===`$!`||e.data===`$?`&&e.ownerDocument.readyState!==`loading`}function Of(e,t){var n=e.ownerDocument;if(e.data===`$~`)e._reactRetry=t;else if(e.data!==`$?`||n.readyState!==`loading`)t();else{var r=function(){t(),n.removeEventListener(`DOMContentLoaded`,r)};n.addEventListener(`DOMContentLoaded`,r),e._reactRetry=r}}function kf(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t===`$`||t===`$!`||t===`$?`||t===`$~`||t===`&`||t===`F!`||t===`F`)break;if(t===`/$`||t===`/&`)return null}}return e}var Af=null;function jf(e){e=e.nextSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n===`/$`||n===`/&`){if(t===0)return kf(e.nextSibling);t--}else n!==`$`&&n!==`$!`&&n!==`$?`&&n!==`$~`&&n!==`&`||t++}e=e.nextSibling}return null}function Mf(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n===`$`||n===`$!`||n===`$?`||n===`$~`||n===`&`){if(t===0)return e;t--}else n!==`/$`&&n!==`/&`||t++}e=e.previousSibling}return null}function Nf(e,t,n){switch(t=cf(n),e){case`html`:if(e=t.documentElement,!e)throw Error(i(452));return e;case`head`:if(e=t.head,!e)throw Error(i(453));return e;case`body`:if(e=t.body,!e)throw Error(i(454));return e;default:throw Error(i(451))}}function Pf(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);mt(e)}var Ff=new Map,If=new Set;function Lf(e){return typeof e.getRootNode==`function`?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var Rf=j.d;j.d={f:zf,r:Bf,D:Uf,C:Wf,L:Gf,m:Kf,X:Jf,S:qf,M:Yf};function zf(){var e=Rf.f(),t=Iu();return e||t}function Bf(e){var t=gt(e);t!==null&&t.tag===5&&t.type===`form`?Bs(t):Rf.r(e)}var Vf=typeof document>`u`?null:document;function Hf(e,t,n){var r=Vf;if(r&&typeof t==`string`&&t){var i=Lt(t);i=`link[rel="`+e+`"][href="`+i+`"]`,typeof n==`string`&&(i+=`[crossorigin="`+n+`"]`),If.has(i)||(If.add(i),e={rel:e,crossOrigin:n,href:t},r.querySelector(i)===null&&(t=r.createElement(`link`),ef(t,`link`,e),yt(t),r.head.appendChild(t)))}}function Uf(e){Rf.D(e),Hf(`dns-prefetch`,e,null)}function Wf(e,t){Rf.C(e,t),Hf(`preconnect`,e,t)}function Gf(e,t,n){Rf.L(e,t,n);var r=Vf;if(r&&e&&t){var i=`link[rel="preload"][as="`+Lt(t)+`"]`;t===`image`&&n&&n.imageSrcSet?(i+=`[imagesrcset="`+Lt(n.imageSrcSet)+`"]`,typeof n.imageSizes==`string`&&(i+=`[imagesizes="`+Lt(n.imageSizes)+`"]`)):i+=`[href="`+Lt(e)+`"]`;var a=i;switch(t){case`style`:a=Zf(e);break;case`script`:a=tp(e)}Ff.has(a)||(e=h({rel:`preload`,href:t===`image`&&n&&n.imageSrcSet?void 0:e,as:t},n),Ff.set(a,e),r.querySelector(i)!==null||t===`style`&&r.querySelector(Qf(a))||t===`script`&&r.querySelector(np(a))||(t=r.createElement(`link`),ef(t,`link`,e),yt(t),r.head.appendChild(t)))}}function Kf(e,t){Rf.m(e,t);var n=Vf;if(n&&e){var r=t&&typeof t.as==`string`?t.as:`script`,i=`link[rel="modulepreload"][as="`+Lt(r)+`"][href="`+Lt(e)+`"]`,a=i;switch(r){case`audioworklet`:case`paintworklet`:case`serviceworker`:case`sharedworker`:case`worker`:case`script`:a=tp(e)}if(!Ff.has(a)&&(e=h({rel:`modulepreload`,href:e},t),Ff.set(a,e),n.querySelector(i)===null)){switch(r){case`audioworklet`:case`paintworklet`:case`serviceworker`:case`sharedworker`:case`worker`:case`script`:if(n.querySelector(np(a)))return}r=n.createElement(`link`),ef(r,`link`,e),yt(r),n.head.appendChild(r)}}}function qf(e,t,n){Rf.S(e,t,n);var r=Vf;if(r&&e){var i=vt(r).hoistableStyles,a=Zf(e);t||=`default`;var o=i.get(a);if(!o){var s={loading:0,preload:null};if(o=r.querySelector(Qf(a)))s.loading=5;else{e=h({rel:`stylesheet`,href:e,"data-precedence":t},n),(n=Ff.get(a))&&ap(e,n);var c=o=r.createElement(`link`);yt(c),ef(c,`link`,e),c._p=new Promise(function(e,t){c.onload=e,c.onerror=t}),c.addEventListener(`load`,function(){s.loading|=1}),c.addEventListener(`error`,function(){s.loading|=2}),s.loading|=4,ip(o,t,r)}o={type:`stylesheet`,instance:o,count:1,state:s},i.set(a,o)}}}function Jf(e,t){Rf.X(e,t);var n=Vf;if(n&&e){var r=vt(n).hoistableScripts,i=tp(e),a=r.get(i);a||(a=n.querySelector(np(i)),a||(e=h({src:e,async:!0},t),(t=Ff.get(i))&&op(e,t),a=n.createElement(`script`),yt(a),ef(a,`link`,e),n.head.appendChild(a)),a={type:`script`,instance:a,count:1,state:null},r.set(i,a))}}function Yf(e,t){Rf.M(e,t);var n=Vf;if(n&&e){var r=vt(n).hoistableScripts,i=tp(e),a=r.get(i);a||(a=n.querySelector(np(i)),a||(e=h({src:e,async:!0,type:`module`},t),(t=Ff.get(i))&&op(e,t),a=n.createElement(`script`),yt(a),ef(a,`link`,e),n.head.appendChild(a)),a={type:`script`,instance:a,count:1,state:null},r.set(i,a))}}function Xf(e,t,n,r){var a=(a=N.current)?Lf(a):null;if(!a)throw Error(i(446));switch(e){case`meta`:case`title`:return null;case`style`:return typeof n.precedence==`string`&&typeof n.href==`string`?(t=Zf(n.href),n=vt(a).hoistableStyles,r=n.get(t),r||(r={type:`style`,instance:null,count:0,state:null},n.set(t,r)),r):{type:`void`,instance:null,count:0,state:null};case`link`:if(n.rel===`stylesheet`&&typeof n.href==`string`&&typeof n.precedence==`string`){e=Zf(n.href);var o=vt(a).hoistableStyles,s=o.get(e);if(s||(a=a.ownerDocument||a,s={type:`stylesheet`,instance:null,count:0,state:{loading:0,preload:null}},o.set(e,s),(o=a.querySelector(Qf(e)))&&!o._p&&(s.instance=o,s.state.loading=5),Ff.has(e)||(n={rel:`preload`,as:`style`,href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Ff.set(e,n),o||ep(a,e,n,s.state))),t&&r===null)throw Error(i(528,``));return s}if(t&&r!==null)throw Error(i(529,``));return null;case`script`:return t=n.async,n=n.src,typeof n==`string`&&t&&typeof t!=`function`&&typeof t!=`symbol`?(t=tp(n),n=vt(a).hoistableScripts,r=n.get(t),r||(r={type:`script`,instance:null,count:0,state:null},n.set(t,r)),r):{type:`void`,instance:null,count:0,state:null};default:throw Error(i(444,e))}}function Zf(e){return`href="`+Lt(e)+`"`}function Qf(e){return`link[rel="stylesheet"][`+e+`]`}function $f(e){return h({},e,{"data-precedence":e.precedence,precedence:null})}function ep(e,t,n,r){e.querySelector(`link[rel="preload"][as="style"][`+t+`]`)?r.loading=1:(t=e.createElement(`link`),r.preload=t,t.addEventListener(`load`,function(){return r.loading|=1}),t.addEventListener(`error`,function(){return r.loading|=2}),ef(t,`link`,n),yt(t),e.head.appendChild(t))}function tp(e){return`[src="`+Lt(e)+`"]`}function np(e){return`script[async]`+e}function rp(e,t,n){if(t.count++,t.instance===null)switch(t.type){case`style`:var r=e.querySelector(`style[data-href~="`+Lt(n.href)+`"]`);if(r)return t.instance=r,yt(r),r;var a=h({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return r=(e.ownerDocument||e).createElement(`style`),yt(r),ef(r,`style`,a),ip(r,n.precedence,e),t.instance=r;case`stylesheet`:a=Zf(n.href);var o=e.querySelector(Qf(a));if(o)return t.state.loading|=4,t.instance=o,yt(o),o;r=$f(n),(a=Ff.get(a))&&ap(r,a),o=(e.ownerDocument||e).createElement(`link`),yt(o);var s=o;return s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),ef(o,`link`,r),t.state.loading|=4,ip(o,n.precedence,e),t.instance=o;case`script`:return o=tp(n.src),(a=e.querySelector(np(o)))?(t.instance=a,yt(a),a):(r=n,(a=Ff.get(o))&&(r=h({},n),op(r,a)),e=e.ownerDocument||e,a=e.createElement(`script`),yt(a),ef(a,`link`,r),e.head.appendChild(a),t.instance=a);case`void`:return null;default:throw Error(i(443,t.type))}else t.type===`stylesheet`&&!(t.state.loading&4)&&(r=t.instance,t.state.loading|=4,ip(r,n.precedence,e));return t.instance}function ip(e,t,n){for(var r=n.querySelectorAll(`link[rel="stylesheet"][data-precedence],style[data-precedence]`),i=r.length?r[r.length-1]:null,a=i,o=0;o<r.length;o++){var s=r[o];if(s.dataset.precedence===t)a=s;else if(a!==i)break}a?a.parentNode.insertBefore(e,a.nextSibling):(t=n.nodeType===9?n.head:n,t.insertBefore(e,t.firstChild))}function ap(e,t){e.crossOrigin??=t.crossOrigin,e.referrerPolicy??=t.referrerPolicy,e.title??=t.title}function op(e,t){e.crossOrigin??=t.crossOrigin,e.referrerPolicy??=t.referrerPolicy,e.integrity??=t.integrity}var sp=null;function cp(e,t,n){if(sp===null){var r=new Map,i=sp=new Map;i.set(n,r)}else i=sp,r=i.get(n),r||(r=new Map,i.set(n,r));if(r.has(e))return r;for(r.set(e,null),n=n.getElementsByTagName(e),i=0;i<n.length;i++){var a=n[i];if(!(a[pt]||a[ot]||e===`link`&&a.getAttribute(`rel`)===`stylesheet`)&&a.namespaceURI!==`http://www.w3.org/2000/svg`){var o=a.getAttribute(t)||``;o=e+o;var s=r.get(o);s?s.push(a):r.set(o,[a])}}return r}function lp(e,t,n){e=e.ownerDocument||e,e.head.insertBefore(n,t===`title`?e.querySelector(`head > title`):null)}function up(e,t,n){if(n===1||t.itemProp!=null)return!1;switch(e){case`meta`:case`title`:return!0;case`style`:if(typeof t.precedence!=`string`||typeof t.href!=`string`||t.href===``)break;return!0;case`link`:if(typeof t.rel!=`string`||typeof t.href!=`string`||t.href===``||t.onLoad||t.onError)break;switch(t.rel){case`stylesheet`:return e=t.disabled,typeof t.precedence==`string`&&e==null;default:return!0}case`script`:if(t.async&&typeof t.async!=`function`&&typeof t.async!=`symbol`&&!t.onLoad&&!t.onError&&t.src&&typeof t.src==`string`)return!0}return!1}function dp(e){return!(e.type===`stylesheet`&&!(e.state.loading&3))}function fp(e,t,n,r){if(n.type===`stylesheet`&&(typeof r.media!=`string`||!1!==matchMedia(r.media).matches)&&!(n.state.loading&4)){if(n.instance===null){var i=Zf(r.href),a=t.querySelector(Qf(i));if(a){t=a._p,typeof t==`object`&&t&&typeof t.then==`function`&&(e.count++,e=hp.bind(e),t.then(e,e)),n.state.loading|=4,n.instance=a,yt(a);return}a=t.ownerDocument||t,r=$f(r),(i=Ff.get(i))&&ap(r,i),a=a.createElement(`link`),yt(a);var o=a;o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),ef(a,`link`,r),n.instance=a}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(n,t),(t=n.state.preload)&&!(n.state.loading&3)&&(e.count++,n=hp.bind(e),t.addEventListener(`load`,n),t.addEventListener(`error`,n))}}var pp=0;function mp(e,t){return e.stylesheets&&e.count===0&&_p(e,e.stylesheets),0<e.count||0<e.imgCount?function(n){var r=setTimeout(function(){if(e.stylesheets&&_p(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4+t);0<e.imgBytes&&pp===0&&(pp=62500*rf());var i=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&_p(e,e.stylesheets),e.unsuspend)){var t=e.unsuspend;e.unsuspend=null,t()}},(e.imgBytes>pp?50:800)+t);return e.unsuspend=n,function(){e.unsuspend=null,clearTimeout(r),clearTimeout(i)}}:null}function hp(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)_p(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var gp=null;function _p(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,gp=new Map,t.forEach(vp,e),gp=null,hp.call(e))}function vp(e,t){if(!(t.state.loading&4)){var n=gp.get(e);if(n)var r=n.get(null);else{n=new Map,gp.set(e,n);for(var i=e.querySelectorAll(`link[data-precedence],style[data-precedence]`),a=0;a<i.length;a++){var o=i[a];(o.nodeName===`LINK`||o.getAttribute(`media`)!==`not all`)&&(n.set(o.dataset.precedence,o),r=o)}r&&n.set(null,r)}i=t.instance,o=i.getAttribute(`data-precedence`),a=n.get(o)||r,a===r&&n.set(null,i),n.set(o,i),this.count++,r=hp.bind(this),i.addEventListener(`load`,r),i.addEventListener(`error`,r),a?a.parentNode.insertBefore(i,a.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(i,e.firstChild)),t.state.loading|=4}}var yp={$$typeof:C,Provider:null,Consumer:null,_currentValue:oe,_currentValue2:oe,_threadCount:0};function bp(e,t,n,r,i,a,o,s,c){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ye(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ye(0),this.hiddenUpdates=Ye(null),this.identifierPrefix=r,this.onUncaughtError=i,this.onCaughtError=a,this.onRecoverableError=o,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=c,this.incompleteTransitions=new Map}function xp(e,t,n,r,i,a,o,s,c,l,u,d){return e=new bp(e,t,n,o,c,l,u,d,s),t=1,!0===a&&(t|=24),a=gi(3,null,null,t),e.current=a,a.stateNode=e,t=_a(),t.refCount++,e.pooledCache=t,t.refCount++,a.memoizedState={element:r,isDehydrated:n,cache:t},Xa(a),e}function Sp(e){return e?(e=mi,e):mi}function Cp(e,t,n,r,i,a){i=Sp(i),r.context===null?r.context=i:r.pendingContext=i,r=Qa(t),r.payload={element:n},a=a===void 0?null:a,a!==null&&(r.callback=a),n=$a(e,r,t),n!==null&&(ju(n,e,t),eo(n,e,t))}function wp(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Tp(e,t){wp(e,t),(e=e.alternate)&&wp(e,t)}function Ep(e){if(e.tag===13||e.tag===31){var t=di(e,67108864);t!==null&&ju(t,e,67108864),Tp(e,67108864)}}function Dp(e){if(e.tag===13||e.tag===31){var t=ku();t=tt(t);var n=di(e,t);n!==null&&ju(n,e,t),Tp(e,t)}}var Op=!0;function kp(e,t,n,r){var i=A.T;A.T=null;var a=j.p;try{j.p=2,jp(e,t,n,r)}finally{j.p=a,A.T=i}}function Ap(e,t,n,r){var i=A.T;A.T=null;var a=j.p;try{j.p=8,jp(e,t,n,r)}finally{j.p=a,A.T=i}}function jp(e,t,n,r){if(Op){var i=Mp(r);if(i===null)Ud(e,t,r,Np,n),Wp(e,r);else if(Kp(i,e,t,n,r))r.stopPropagation();else if(Wp(e,r),t&4&&-1<Up.indexOf(e)){for(;i!==null;){var a=gt(i);if(a!==null)switch(a.tag){case 3:if(a=a.stateNode,a.current.memoizedState.isDehydrated){var o=Ge(a.pendingLanes);if(o!==0){var s=a;for(s.pendingLanes|=2,s.entangledLanes|=2;o;){var c=1<<31-Re(o);s.entanglements[1]|=c,o&=~c}bd(a),!(q&6)&&(_u=Oe()+500,xd(0,!1))}}break;case 31:case 13:s=di(a,2),s!==null&&ju(s,a,2),Iu(),Tp(a,2)}if(a=Mp(r),a===null&&Ud(e,t,r,Np,n),a===i)break;i=a}i!==null&&r.stopPropagation()}else Ud(e,t,r,null,n)}}function Mp(e){return e=$t(e),Pp(e)}var Np=null;function Pp(e){if(Np=null,e=ht(e),e!==null){var t=o(e);if(t===null)e=null;else{var n=t.tag;if(n===13){if(e=s(t),e!==null)return e;e=null}else if(n===31){if(e=c(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Np=e,null}function Fp(e){switch(e){case`beforetoggle`:case`cancel`:case`click`:case`close`:case`contextmenu`:case`copy`:case`cut`:case`auxclick`:case`dblclick`:case`dragend`:case`dragstart`:case`drop`:case`focusin`:case`focusout`:case`input`:case`invalid`:case`keydown`:case`keypress`:case`keyup`:case`mousedown`:case`mouseup`:case`paste`:case`pause`:case`play`:case`pointercancel`:case`pointerdown`:case`pointerup`:case`ratechange`:case`reset`:case`resize`:case`seeked`:case`submit`:case`toggle`:case`touchcancel`:case`touchend`:case`touchstart`:case`volumechange`:case`change`:case`selectionchange`:case`textInput`:case`compositionstart`:case`compositionend`:case`compositionupdate`:case`beforeblur`:case`afterblur`:case`beforeinput`:case`blur`:case`fullscreenchange`:case`focus`:case`hashchange`:case`popstate`:case`select`:case`selectstart`:return 2;case`drag`:case`dragenter`:case`dragexit`:case`dragleave`:case`dragover`:case`mousemove`:case`mouseout`:case`mouseover`:case`pointermove`:case`pointerout`:case`pointerover`:case`scroll`:case`touchmove`:case`wheel`:case`mouseenter`:case`mouseleave`:case`pointerenter`:case`pointerleave`:return 8;case`message`:switch(ke()){case Ae:return 2;case je:return 8;case Me:case Ne:return 32;case Pe:return 268435456;default:return 32}default:return 32}}var Ip=!1,Lp=null,Rp=null,zp=null,Bp=new Map,Vp=new Map,Hp=[],Up=`mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset`.split(` `);function Wp(e,t){switch(e){case`focusin`:case`focusout`:Lp=null;break;case`dragenter`:case`dragleave`:Rp=null;break;case`mouseover`:case`mouseout`:zp=null;break;case`pointerover`:case`pointerout`:Bp.delete(t.pointerId);break;case`gotpointercapture`:case`lostpointercapture`:Vp.delete(t.pointerId)}}function Gp(e,t,n,r,i,a){return e===null||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},t!==null&&(t=gt(t),t!==null&&Ep(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function Kp(e,t,n,r,i){switch(t){case`focusin`:return Lp=Gp(Lp,e,t,n,r,i),!0;case`dragenter`:return Rp=Gp(Rp,e,t,n,r,i),!0;case`mouseover`:return zp=Gp(zp,e,t,n,r,i),!0;case`pointerover`:var a=i.pointerId;return Bp.set(a,Gp(Bp.get(a)||null,e,t,n,r,i)),!0;case`gotpointercapture`:return a=i.pointerId,Vp.set(a,Gp(Vp.get(a)||null,e,t,n,r,i)),!0}return!1}function qp(e){var t=ht(e.target);if(t!==null){var n=o(t);if(n!==null){if(t=n.tag,t===13){if(t=s(n),t!==null){e.blockedOn=t,it(e.priority,function(){Dp(n)});return}}else if(t===31){if(t=c(n),t!==null){e.blockedOn=t,it(e.priority,function(){Dp(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Jp(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Mp(e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);Qt=r,n.target.dispatchEvent(r),Qt=null}else return t=gt(n),t!==null&&Ep(t),e.blockedOn=n,!1;t.shift()}return!0}function Yp(e,t,n){Jp(e)&&n.delete(t)}function Xp(){Ip=!1,Lp!==null&&Jp(Lp)&&(Lp=null),Rp!==null&&Jp(Rp)&&(Rp=null),zp!==null&&Jp(zp)&&(zp=null),Bp.forEach(Yp),Vp.forEach(Yp)}function Zp(e,n){e.blockedOn===n&&(e.blockedOn=null,Ip||(Ip=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Xp)))}var Qp=null;function $p(e){Qp!==e&&(Qp=e,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Qp===e&&(Qp=null);for(var t=0;t<e.length;t+=3){var n=e[t],r=e[t+1],i=e[t+2];if(typeof r!=`function`){if(Pp(r||n)===null)continue;break}var a=gt(n);a!==null&&(e.splice(t,3),t-=3,Rs(a,{pending:!0,data:i,method:n.method,action:r},r,i))}}))}function em(e){function t(t){return Zp(t,e)}Lp!==null&&Zp(Lp,e),Rp!==null&&Zp(Rp,e),zp!==null&&Zp(zp,e),Bp.forEach(t),Vp.forEach(t);for(var n=0;n<Hp.length;n++){var r=Hp[n];r.blockedOn===e&&(r.blockedOn=null)}for(;0<Hp.length&&(n=Hp[0],n.blockedOn===null);)qp(n),n.blockedOn===null&&Hp.shift();if(n=(e.ownerDocument||e).$$reactFormReplay,n!=null)for(r=0;r<n.length;r+=3){var i=n[r],a=n[r+1],o=i[st]||null;if(typeof a==`function`)o||$p(n);else if(o){var s=null;if(a&&a.hasAttribute(`formAction`)){if(i=a,o=a[st]||null)s=o.formAction;else if(Pp(i)!==null)continue}else s=o.action;typeof s==`function`?n[r+1]=s:(n.splice(r,3),r-=3),$p(n)}}}function tm(){function e(e){e.canIntercept&&e.info===`react-transition`&&e.intercept({handler:function(){return new Promise(function(e){return i=e})},focusReset:`manual`,scroll:`manual`})}function t(){i!==null&&(i(),i=null),r||setTimeout(n,20)}function n(){if(!r&&!navigation.transition){var e=navigation.currentEntry;e&&e.url!=null&&navigation.navigate(e.url,{state:e.getState(),info:`react-transition`,history:`replace`})}}if(typeof navigation==`object`){var r=!1,i=null;return navigation.addEventListener(`navigate`,e),navigation.addEventListener(`navigatesuccess`,t),navigation.addEventListener(`navigateerror`,t),setTimeout(n,100),function(){r=!0,navigation.removeEventListener(`navigate`,e),navigation.removeEventListener(`navigatesuccess`,t),navigation.removeEventListener(`navigateerror`,t),i!==null&&(i(),i=null)}}}function nm(e){this._internalRoot=e}rm.prototype.render=nm.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(i(409));var n=t.current,r=ku();Cp(n,r,e,t,null,null)},rm.prototype.unmount=nm.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Cp(e.current,2,null,e,null,null),Iu(),t[ct]=null}};function rm(e){this._internalRoot=e}rm.prototype.unstable_scheduleHydration=function(e){if(e){var t=rt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Hp.length&&t!==0&&t<Hp[n].priority;n++);Hp.splice(n,0,e),n===0&&qp(e)}};var im=n.version;if(im!==`19.2.0`)throw Error(i(527,im,`19.2.0`));j.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render==`function`?Error(i(188)):(e=Object.keys(e).join(`,`),Error(i(268,e)));return e=d(t),e=e===null?null:p(e),e=e===null?null:e.stateNode,e};var am={bundleType:0,version:`19.2.0`,rendererPackageName:`react-dom`,currentDispatcherRef:A,reconcilerVersion:`19.2.0`};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<`u`){var om=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!om.isDisabled&&om.supportsFiber)try{Ie=om.inject(am),Le=om}catch{}}exports.createRoot=function(e,t){if(!a(e))throw Error(i(299));var n=!1,r=``,o=sc,s=cc,c=lc;return t!=null&&(!0===t.unstable_strictMode&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onUncaughtError!==void 0&&(o=t.onUncaughtError),t.onCaughtError!==void 0&&(s=t.onCaughtError),t.onRecoverableError!==void 0&&(c=t.onRecoverableError)),t=xp(e,1,!1,null,null,n,r,null,o,s,c,tm),e[ct]=t.current,Vd(e),new nm(t)}})),g=c(o(((exports,t)=>{function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>`u`||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!=`function`))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}n(),t.exports=h()}))()),_=c(u(),1),v=`modulepreload`,y=function(e){return`/WatchTaskV2/`+e},b={};const x=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let e=document.getElementsByTagName(`link`),i=document.querySelector(`meta[property=csp-nonce]`),a=i?.nonce||i?.getAttribute(`nonce`);function o(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:`fulfilled`,value:e}),e=>({status:`rejected`,reason:e}))))}r=o(t.map(t=>{if(t=y(t,n),t in b)return;b[t]=!0;let r=t.endsWith(`.css`),i=r?`[rel="stylesheet"]`:``;if(n)for(let n=e.length-1;n>=0;n--){let i=e[n];if(i.href===t&&(!r||i.rel===`stylesheet`))return}else if(document.querySelector(`link[href="${t}"]${i}`))return;let o=document.createElement(`link`);if(o.rel=r?`stylesheet`:v,r||(o.as=`script`),o.crossOrigin=``,o.href=t,a&&o.setAttribute(`nonce`,a),document.head.appendChild(o),r)return new Promise((e,n)=>{o.addEventListener(`load`,e),o.addEventListener(`error`,()=>n(Error(`Unable to preload CSS for ${t}`)))})}))}function i(e){let t=new Event(`vite:preloadError`,{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(let e of t||[]){if(e.status!==`rejected`)continue;i(e.reason)}return e().catch(i)})};var S=`true`,C=`false`,w=S===`true`,T=C===`true`;function E(e={}){let{immediate:t=!1,onNeedRefresh:n,onOfflineReady:r,onRegistered:i,onRegisteredSW:a,onRegisterError:o}=e,s,c,l,u=async(e=!0)=>{await c,w||l?.()};async function d(){if(`serviceWorker`in navigator){if(s=await x(async()=>{let{Workbox:e}=await import(`./workbox-window.prod.es5-C4ympd13.js`);return{Workbox:e}},[]).then(({Workbox:e})=>new e(`/WatchTaskV2/sw.js`,{scope:`/WatchTaskV2/`,type:`classic`})).catch(e=>{o?.(e)}),!s)return;if(l=()=>{s?.messageSkipWaiting()},!T)if(w)s.addEventListener(`activated`,e=>{(e.isUpdate||e.isExternal)&&window.location.reload()}),s.addEventListener(`installed`,e=>{e.isUpdate||r?.()});else{let e=!1,t=()=>{e=!0,s?.addEventListener(`controlling`,e=>{e.isUpdate&&window.location.reload()}),n?.()};s.addEventListener(`installed`,n=>{n.isUpdate===void 0?n.isExternal===void 0?!e&&r?.():n.isExternal?t():!e&&r?.():n.isUpdate||r?.()}),s.addEventListener(`waiting`,t)}s.register({immediate:t}).then(e=>{a?a(`/WatchTaskV2/sw.js`,e):i?.(e)}).catch(e=>{o?.(e)})}}return c=d(),u}var D=c(o(((exports,t)=>{(function(n,r){typeof exports==`object`&&t!==void 0?t.exports=r():typeof define==`function`&&define.amd?define(r):(n=typeof globalThis<`u`?globalThis:n||self).Dexie=r()})(exports,function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)},t=function(){return(t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function n(e,t,n){if(n||arguments.length===2)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||((r||=Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var r=typeof globalThis<`u`?globalThis:typeof self<`u`?self:typeof window<`u`?window:global,i=Object.keys,a=Array.isArray;function o(e,t){return typeof t!=`object`||i(t).forEach(function(n){e[n]=t[n]}),e}typeof Promise>`u`||r.Promise||(r.Promise=Promise);var s=Object.getPrototypeOf,c={}.hasOwnProperty;function l(e,t){return c.call(e,t)}function u(e,t){typeof t==`function`&&(t=t(s(e))),(typeof Reflect>`u`?i:Reflect.ownKeys)(t).forEach(function(n){f(e,n,t[n])})}var d=Object.defineProperty;function f(e,t,n,r){d(e,t,o(n&&l(n,`get`)&&typeof n.get==`function`?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function p(e){return{from:function(t){return e.prototype=Object.create(t.prototype),f(e.prototype,`constructor`,e),{extend:u.bind(null,e.prototype)}}}}var m=Object.getOwnPropertyDescriptor,h=[].slice;function g(e,t,n){return h.call(e,t,n)}function _(e,t){return t(e)}function v(e){if(!e)throw Error(`Assertion Failed`)}function y(e){r.setImmediate?setImmediate(e):setTimeout(e,0)}function b(e,t){if(typeof t==`string`&&l(e,t))return e[t];if(!t)return e;if(typeof t!=`string`){for(var n=[],r=0,i=t.length;r<i;++r){var a=b(e,t[r]);n.push(a)}return n}var o=t.indexOf(`.`);if(o!==-1){var s=e[t.substr(0,o)];return s==null?void 0:b(s,t.substr(o+1))}}function x(e,t,n){if(e&&t!==void 0&&!(`isFrozen`in Object&&Object.isFrozen(e)))if(typeof t!=`string`&&`length`in t){v(typeof n!=`string`&&`length`in n);for(var r=0,i=t.length;r<i;++r)x(e,t[r],n[r])}else{var o,s,c=t.indexOf(`.`);c===-1?n===void 0?a(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n:(o=t.substr(0,c),(s=t.substr(c+1))===``?n===void 0?a(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=n:x(c=!(c=e[o])||!l(e,o)?e[o]={}:c,s,n))}}function S(e){var t,n={};for(t in e)l(e,t)&&(n[t]=e[t]);return n}var C=[].concat;function w(e){return C.apply([],e)}var T=`BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey`.split(`,`).concat(w([8,16,32,64].map(function(e){return[`Int`,`Uint`,`Float`].map(function(t){return t+e+`Array`})}))).filter(function(e){return r[e]}),E=new Set(T.map(function(e){return r[e]})),D=null;function O(e){return D=new WeakMap,e=function e(t){if(!t||typeof t!=`object`)return t;var n=D.get(t);if(n)return n;if(a(t)){n=[],D.set(t,n);for(var r=0,i=t.length;r<i;++r)n.push(e(t[r]))}else if(E.has(t.constructor))n=t;else{var o,c=s(t);for(o in n=c===Object.prototype?{}:Object.create(c),D.set(t,n),t)l(t,o)&&(n[o]=e(t[o]))}return n}(e),D=null,e}var ee={}.toString;function k(e){return ee.call(e).slice(8,-1)}var te=typeof Symbol<`u`?Symbol.iterator:`@@iterator`,ne=typeof te==`symbol`?function(e){var t;return e!=null&&(t=e[te])&&t.apply(e)}:function(){return null};function re(e,t){return t=e.indexOf(t),0<=t&&e.splice(t,1),0<=t}var ie={};function ae(e){var t,n,r,i;if(arguments.length===1){if(a(e))return e.slice();if(this===ie&&typeof e==`string`)return[e];if(i=ne(e)){for(n=[];!(r=i.next()).done;)n.push(r.value);return n}if(e==null||typeof(t=e.length)!=`number`)return[e];for(n=Array(t);t--;)n[t]=e[t];return n}for(t=arguments.length,n=Array(t);t--;)n[t]=arguments[t];return n}var A=typeof Symbol<`u`?function(e){return e[Symbol.toStringTag]===`AsyncFunction`}:function(){return!1},j=[`Unknown`,`Constraint`,`Data`,`TransactionInactive`,`ReadOnly`,`Version`,`NotFound`,`InvalidState`,`InvalidAccess`,`Abort`,`Timeout`,`QuotaExceeded`,`Syntax`,`DataClone`],oe=[`Modify`,`Bulk`,`OpenFailed`,`VersionChange`,`Schema`,`Upgrade`,`InvalidTable`,`MissingAPI`,`NoSuchDatabase`,`InvalidArgument`,`SubTransaction`,`Unsupported`,`Internal`,`DatabaseClosed`,`PrematureCommit`,`ForeignAwait`].concat(j),se={VersionChanged:`Database version changed by other database connection`,DatabaseClosed:`Database has been closed`,Abort:`Transaction aborted`,TransactionInactive:`Transaction has already completed or failed`,MissingAPI:`IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb`};function ce(e,t){this.name=e,this.message=t}function le(e,t){return e+`. Errors: `+Object.keys(t).map(function(e){return t[e].toString()}).filter(function(e,t,n){return n.indexOf(e)===t}).join(`
`)}function ue(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=le(e,t)}function M(e,t){this.name=`BulkError`,this.failures=Object.keys(t).map(function(e){return t[e]}),this.failuresByPos=t,this.message=le(e,this.failures)}p(ce).from(Error).extend({toString:function(){return this.name+`: `+this.message}}),p(ue).from(ce),p(M).from(ce);var de=oe.reduce(function(e,t){return e[t]=t+`Error`,e},{}),fe=ce,N=oe.reduce(function(e,t){var n=t+`Error`;function r(e,r){this.name=n,e?typeof e==`string`?(this.message=`${e}${r?`
 `+r:``}`,this.inner=r||null):typeof e==`object`&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=se[t]||n,this.inner=null)}return p(r).from(fe),e[t]=r,e},{});N.Syntax=SyntaxError,N.Type=TypeError,N.Range=RangeError;var P=j.reduce(function(e,t){return e[t+`Error`]=N[t],e},{}),pe=oe.reduce(function(e,t){return[`Syntax`,`Type`,`Range`].indexOf(t)===-1&&(e[t+`Error`]=N[t]),e},{});function F(){}function me(e){return e}function he(e,t){return e==null||e===me?t:function(n){return t(e(n))}}function ge(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function _e(e,t){return e===F?t:function(){var n=e.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?ge(r,this.onsuccess):r),i&&(this.onerror=this.onerror?ge(i,this.onerror):i),a===void 0?n:a}}function ve(e,t){return e===F?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?ge(n,this.onsuccess):n),r&&(this.onerror=this.onerror?ge(r,this.onerror):r)}}function ye(e,t){return e===F?t:function(n){var r=e.apply(this,arguments);o(n,r);var i=this.onsuccess,a=this.onerror;return this.onsuccess=null,this.onerror=null,n=t.apply(this,arguments),i&&(this.onsuccess=this.onsuccess?ge(i,this.onsuccess):i),a&&(this.onerror=this.onerror?ge(a,this.onerror):a),r===void 0?n===void 0?void 0:n:o(r,n)}}function be(e,t){return e===F?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function xe(e,t){return e===F?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then==`function`){for(var r=this,i=arguments.length,a=Array(i);i--;)a[i]=arguments[i];return n.then(function(){return t.apply(r,a)})}return t.apply(this,arguments)}}pe.ModifyError=ue,pe.DexieError=ce,pe.BulkError=M;var Se=typeof location<`u`&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ce(e){Se=e}var we={},Te=100,T=typeof Promise>`u`?[]:function(){var e=Promise.resolve();if(typeof crypto>`u`||!crypto.subtle)return[e,s(e),e];var t=crypto.subtle.digest(`SHA-512`,new Uint8Array([0]));return[t,s(t),e]}(),j=T[0],oe=T[1],T=T[2],oe=oe&&oe.then,Ee=j&&j.constructor,De=!!T,Oe=function(e,t){Fe.push([e,t]),Ae&&=(queueMicrotask(We),!1)},ke=!0,Ae=!0,je=[],Me=[],Ne=me,Pe={id:`global`,global:!0,ref:0,unhandleds:[],onunhandled:F,pgp:!1,env:{},finalize:F},I=Pe,Fe=[],Ie=0,Le=[];function L(e){if(typeof this!=`object`)throw TypeError(`Promises must be constructed via new`);this._listeners=[],this._lib=!1;var t=this._PSD=I;if(typeof e!=`function`){if(e!==we)throw TypeError(`Not a function`);this._state=arguments[1],this._value=arguments[2],!1===this._state&&Be(this,this._value);return}this._state=null,this._value=null,++t.ref,function e(t,n){try{n(function(n){if(t._state===null){if(n===t)throw TypeError(`A promise cannot be resolved with itself.`);var r=t._lib&&Ge();n&&typeof n.then==`function`?e(t,function(e,t){n instanceof L?n._then(e,t):n.then(e,t)}):(t._state=!0,t._value=n,Ve(t)),r&&Ke()}},Be.bind(null,t))}catch(e){Be(t,e)}}(this,e)}var Re={get:function(){var e=I,t=$e;function n(n,r){var i=this,a=!e.global&&(e!==I||t!==$e),o=a&&!rt(),s=new L(function(t,s){He(i,new ze(lt(n,e,a,o),lt(r,e,a,o),t,s,e))});return this._consoleTask&&(s._consoleTask=this._consoleTask),s}return n.prototype=we,n},set:function(e){f(this,`then`,e&&e.prototype===we?Re:{get:function(){return e},set:Re.set})}};function ze(e,t,n,r,i){this.onFulfilled=typeof e==`function`?e:null,this.onRejected=typeof t==`function`?t:null,this.resolve=n,this.reject=r,this.psd=i}function Be(e,t){var n,r;Me.push(t),e._state===null&&(n=e._lib&&Ge(),t=Ne(t),e._state=!1,e._value=t,r=e,je.some(function(e){return e._value===r._value})||je.push(r),Ve(e),n&&Ke())}function Ve(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)He(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),Ie===0&&(++Ie,Oe(function(){--Ie==0&&qe()},[]))}function He(e,t){if(e._state!==null){var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Ie,Oe(Ue,[n,e,t])}else e._listeners.push(t)}function Ue(e,t,n){try{var r,i=t._value;!t._state&&Me.length&&(Me=[]),r=Se&&t._consoleTask?t._consoleTask.run(function(){return e(i)}):e(i),t._state||Me.indexOf(i)!==-1||function(e){for(var t=je.length;t;)if(je[--t]._value===e._value)return je.splice(t,1)}(t),n.resolve(r)}catch(e){n.reject(e)}finally{--Ie==0&&qe(),--n.psd.ref||n.psd.finalize()}}function We(){ct(Pe,function(){Ge()&&Ke()})}function Ge(){var e=ke;return Ae=ke=!1,e}function Ke(){var e,t,n;do for(;0<Fe.length;)for(e=Fe,Fe=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}while(0<Fe.length);Ae=ke=!0}function qe(){var e=je;je=[],e.forEach(function(e){e._PSD.onunhandled.call(null,e._value,e)});for(var t=Le.slice(0),n=t.length;n;)t[--n]()}function Je(e){return new L(we,!1,e)}function R(e,t){var n=I;return function(){var r=Ge(),i=I;try{return ot(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{ot(i,!1),r&&Ke()}}}u(L.prototype,{then:Re,_then:function(e,t){He(this,new ze(null,null,e,t,I))},catch:function(e){if(arguments.length===1)return this.then(null,e);var t=e,n=arguments[1];return typeof t==`function`?this.then(null,function(e){return(e instanceof t?n:Je)(e)}):this.then(null,function(e){return(e&&e.name===t?n:Je)(e)})},finally:function(e){return this.then(function(t){return L.resolve(e()).then(function(){return t})},function(t){return L.resolve(e()).then(function(){return Je(t)})})},timeout:function(e,t){var n=this;return e<1/0?new L(function(r,i){var a=setTimeout(function(){return i(new N.Timeout(t))},e);n.then(r,i).finally(clearTimeout.bind(null,a))}):this}}),typeof Symbol<`u`&&Symbol.toStringTag&&f(L.prototype,Symbol.toStringTag,`Dexie.Promise`),Pe.env=st(),u(L,{all:function(){var e=ae.apply(null,arguments).map(it);return new L(function(t,n){e.length===0&&t([]);var r=e.length;e.forEach(function(i,a){return L.resolve(i).then(function(n){e[a]=n,--r||t(e)},n)})})},resolve:function(e){return e instanceof L?e:e&&typeof e.then==`function`?new L(function(t,n){e.then(t,n)}):new L(we,!0,e)},reject:Je,race:function(){var e=ae.apply(null,arguments).map(it);return new L(function(t,n){e.map(function(e){return L.resolve(e).then(t,n)})})},PSD:{get:function(){return I},set:function(e){return I=e}},totalEchoes:{get:function(){return $e}},newPSD:tt,usePSD:ct,scheduler:{get:function(){return Oe},set:function(e){Oe=e}},rejectionMapper:{get:function(){return Ne},set:function(e){Ne=e}},follow:function(e,t){return new L(function(n,r){return tt(function(t,n){var r=I;r.unhandleds=[],r.onunhandled=n,r.finalize=ge(function(){var e,r=this;e=function(){r.unhandleds.length===0?t():n(r.unhandleds[0])},Le.push(function t(){e(),Le.splice(Le.indexOf(t),1)}),++Ie,Oe(function(){--Ie==0&&qe()},[])},r.finalize),e()},t,n,r)})}}),Ee&&(Ee.allSettled&&f(L,`allSettled`,function(){var e=ae.apply(null,arguments).map(it);return new L(function(t){e.length===0&&t([]);var n=e.length,r=Array(n);e.forEach(function(e,i){return L.resolve(e).then(function(e){return r[i]={status:`fulfilled`,value:e}},function(e){return r[i]={status:`rejected`,reason:e}}).then(function(){return--n||t(r)})})})}),Ee.any&&typeof AggregateError<`u`&&f(L,`any`,function(){var e=ae.apply(null,arguments).map(it);return new L(function(t,n){e.length===0&&n(AggregateError([]));var r=e.length,i=Array(r);e.forEach(function(e,a){return L.resolve(e).then(function(e){return t(e)},function(e){i[a]=e,--r||n(AggregateError(i))})})})}),Ee.withResolvers&&(L.withResolvers=Ee.withResolvers));var Ye={awaits:0,echoes:0,id:0},Xe=0,Ze=[],Qe=0,$e=0,et=0;function tt(e,t,n,r){var i=I,a=Object.create(i);return a.parent=i,a.ref=0,a.global=!1,a.id=++et,Pe.env,a.env=De?{Promise:L,PromiseProp:{value:L,configurable:!0,writable:!0},all:L.all,race:L.race,allSettled:L.allSettled,any:L.any,resolve:L.resolve,reject:L.reject}:{},t&&o(a,t),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()},r=ct(a,e,n,r),a.ref===0&&a.finalize(),r}function nt(){return Ye.id||=++Xe,++Ye.awaits,Ye.echoes+=Te,Ye.id}function rt(){return!!Ye.awaits&&(--Ye.awaits==0&&(Ye.id=0),Ye.echoes=Ye.awaits*Te,!0)}function it(e){return Ye.echoes&&e&&e.constructor===Ee?(nt(),e.then(function(e){return rt(),e},function(e){return rt(),dt(e)})):e}function at(){var e=Ze[Ze.length-1];Ze.pop(),ot(e,!1)}function ot(e,t){var n,i=I;(t?!Ye.echoes||Qe++&&e===I:!Qe||--Qe&&e===I)||queueMicrotask(t?function(e){++$e,Ye.echoes&&--Ye.echoes!=0||(Ye.echoes=Ye.awaits=Ye.id=0),Ze.push(I),ot(e,!0)}.bind(null,e):at),e!==I&&(I=e,i===Pe&&(Pe.env=st()),De&&(n=Pe.env.Promise,t=e.env,(i.global||e.global)&&(Object.defineProperty(r,`Promise`,t.PromiseProp),n.all=t.all,n.race=t.race,n.resolve=t.resolve,n.reject=t.reject,t.allSettled&&(n.allSettled=t.allSettled),t.any&&(n.any=t.any))))}function st(){var e=r.Promise;return De?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(r,`Promise`),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function ct(e,t,n,r,i){var a=I;try{return ot(e,!0),t(n,r,i)}finally{ot(a,!1)}}function lt(e,t,n,r){return typeof e==`function`?function(){var i=I;n&&nt(),ot(t,!0);try{return e.apply(this,arguments)}finally{ot(i,!1),r&&queueMicrotask(rt)}}:e}function ut(e){Promise===Ee&&Ye.echoes===0?Qe===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(``+oe).indexOf(`[native code]`)===-1&&(nt=rt=F);var dt=L.reject,ft=``,pt=`Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.`,mt=`String expected.`,ht=[],gt=`__dbnames`,_t=`readonly`,vt=`readwrite`;function yt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var bt={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function xt(e){return typeof e!=`string`||/\./.test(e)?function(e){return e}:function(t){return t[e]===void 0&&e in t&&delete(t=O(t))[e],t}}function St(){throw N.Type(`Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.`)}function z(e,t){try{var n=Ct(e),r=Ct(t);if(n!==r)return n===`Array`?1:r===`Array`?-1:n===`binary`?1:r===`binary`?-1:n===`string`?1:r===`string`?-1:n===`Date`?1:r===`Date`?-1:NaN;switch(n){case`number`:case`Date`:case`string`:return t<e?1:e<t?-1:0;case`binary`:return function(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,a=0;a<i;++a)if(e[a]!==t[a])return e[a]<t[a]?-1:1;return n===r?0:n<r?-1:1}(wt(e),wt(t));case`Array`:return function(e,t){for(var n=e.length,r=t.length,i=n<r?n:r,a=0;a<i;++a){var o=z(e[a],t[a]);if(o!==0)return o}return n===r?0:n<r?-1:1}(e,t)}}catch{}return NaN}function Ct(e){var t=typeof e;return t==`object`?ArrayBuffer.isView(e)?`binary`:(e=k(e),e===`ArrayBuffer`?`binary`:e):t}function wt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function Tt(e,t,n){var r=e.schema.yProps;return r?(t&&0<n.numFailures&&(t=t.filter(function(e,t){return!n.failures[t]})),Promise.all(r.map(function(n){return n=n.updatesTable,t?e.db.table(n).where(`k`).anyOf(t).delete():e.db.table(n).clear()})).then(function(){return n})):n}var Et=(Dt.prototype._trans=function(e,t,n){var r=this._tx||I.trans,i=this.name,a=Se&&typeof console<`u`&&console.createTask&&console.createTask(`Dexie: ${e===`readonly`?`read`:`write`} ${this.name}`);function o(e,n,r){if(!r.schema[i])throw new N.NotFound(`Table `+i+` not part of transaction`);return t(r.idbtrans,r)}var s=Ge();try{var c=r&&r.db._novip===this.db._novip?r===I.trans?r._promise(e,o,n):tt(function(){return r._promise(e,o,n)},{trans:r,transless:I.transless||I}):function e(t,n,r,i){if(t.idbdb&&(t._state.openComplete||I.letThrough||t._vip)){var a=t._createTransaction(n,r,t._dbSchema);try{a.create(),t._state.PR1398_maxLoop=3}catch(a){return a.name===de.InvalidState&&t.isOpen()&&0<--t._state.PR1398_maxLoop?(console.warn(`Dexie: Need to reopen db`),t.close({disableAutoOpen:!1}),t.open().then(function(){return e(t,n,r,i)})):dt(a)}return a._promise(n,function(e,t){return tt(function(){return I.trans=a,i(e,t,a)})}).then(function(e){if(n===`readwrite`)try{a.idbtrans.commit()}catch{}return n===`readonly`?e:a._completion.then(function(){return e})})}if(t._state.openComplete)return dt(new N.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return dt(new N.DatabaseClosed);t.open().catch(F)}return t._state.dbReadyPromise.then(function(){return e(t,n,r,i)})}(this.db,e,[this.name],o);return a&&(c._consoleTask=a,c=c.catch(function(e){return console.trace(e),dt(e)})),c}finally{s&&Ke()}},Dt.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?dt(new N.Type(`Invalid argument to Table.get()`)):this._trans(`readonly`,function(t){return n.core.get({trans:t,key:e}).then(function(e){return n.hook.reading.fire(e)})}).then(t)},Dt.prototype.where=function(e){if(typeof e==`string`)return new this.db.WhereClause(this,e);if(a(e))return new this.db.WhereClause(this,`[${e.join(`+`)}]`);var t=i(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(e){if(e.compound&&t.every(function(t){return 0<=e.keyPath.indexOf(t)})){for(var n=0;n<t.length;++n)if(t.indexOf(e.keyPath[n])===-1)return!1;return!0}return!1}).sort(function(e,t){return e.keyPath.length-t.keyPath.length})[0];if(n&&this.db._maxKey!==ft){var r=n.keyPath.slice(0,t.length);return this.where(r).equals(r.map(function(t){return e[t]}))}!n&&Se&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit from a compound index [${t.join(`+`)}]`);var o=this.schema.idxByName;function s(e,t){return z(e,t)===0}var c=t.reduce(function(t,n){var r=t[0],i=t[1],t=o[n],c=e[n];return[r||t,r||!t?yt(i,t&&t.multi?function(e){return e=b(e,n),a(e)&&e.some(function(e){return s(c,e)})}:function(e){return s(c,b(e,n))}):i]},[null,null]),r=c[0],c=c[1];return r?this.where(r.name).equals(e[r.keyPath]).filter(c):n?this.filter(c):this.where(t).equals(``)},Dt.prototype.filter=function(e){return this.toCollection().and(e)},Dt.prototype.count=function(e){return this.toCollection().count(e)},Dt.prototype.offset=function(e){return this.toCollection().offset(e)},Dt.prototype.limit=function(e){return this.toCollection().limit(e)},Dt.prototype.each=function(e){return this.toCollection().each(e)},Dt.prototype.toArray=function(e){return this.toCollection().toArray(e)},Dt.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Dt.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,a(e)?`[${e.join(`+`)}]`:e))},Dt.prototype.reverse=function(){return this.toCollection().reverse()},Dt.prototype.mapToClass=function(t){var n,r=this.db,i=this.name;function a(){return n!==null&&n.apply(this,arguments)||this}(this.schema.mappedClass=t).prototype instanceof St&&(function(t,n){if(typeof n!=`function`&&n!==null)throw TypeError(`Class extends value `+String(n)+` is not a constructor or null`);function r(){this.constructor=t}e(t,n),t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}(a,n=t),Object.defineProperty(a.prototype,`db`,{get:function(){return r},enumerable:!1,configurable:!0}),a.prototype.table=function(){return i},t=a);for(var o=new Set,c=t.prototype;c;c=s(c))Object.getOwnPropertyNames(c).forEach(function(e){return o.add(e)});function l(e){if(!e)return e;var n,r=Object.create(t.prototype);for(n in e)if(!o.has(n))try{r[n]=e[n]}catch{}return r}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=l,this.hook(`reading`,l),t},Dt.prototype.defineClass=function(){return this.mapToClass(function(e){o(this,e)})},Dt.prototype.add=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,a=r.keyPath,o=e;return a&&i&&(o=xt(a)(e)),this._trans(`readwrite`,function(e){return n.core.mutate({trans:e,type:`add`,keys:t==null?null:[t],values:[o]})}).then(function(e){return e.numFailures?L.reject(e.failures[0]):e.lastResult}).then(function(t){if(a)try{x(e,a,t)}catch{}return t})},Dt.prototype.update=function(e,t){return typeof e!=`object`||a(e)?this.where(`:id`).equals(e).modify(t):(e=b(e,this.schema.primKey.keyPath),e===void 0?dt(new N.InvalidArgument(`Given object does not contain its primary key`)):this.where(`:id`).equals(e).modify(t))},Dt.prototype.put=function(e,t){var n=this,r=this.schema.primKey,i=r.auto,a=r.keyPath,o=e;return a&&i&&(o=xt(a)(e)),this._trans(`readwrite`,function(e){return n.core.mutate({trans:e,type:`put`,values:[o],keys:t==null?null:[t]})}).then(function(e){return e.numFailures?L.reject(e.failures[0]):e.lastResult}).then(function(t){if(a)try{x(e,a,t)}catch{}return t})},Dt.prototype.delete=function(e){var t=this;return this._trans(`readwrite`,function(n){return t.core.mutate({trans:n,type:`delete`,keys:[e]}).then(function(n){return Tt(t,[e],n)}).then(function(e){return e.numFailures?L.reject(e.failures[0]):void 0})})},Dt.prototype.clear=function(){var e=this;return this._trans(`readwrite`,function(t){return e.core.mutate({trans:t,type:`deleteRange`,range:bt}).then(function(t){return Tt(e,null,t)})}).then(function(e){return e.numFailures?L.reject(e.failures[0]):void 0})},Dt.prototype.bulkGet=function(e){var t=this;return this._trans(`readonly`,function(n){return t.core.getMany({keys:e,trans:n}).then(function(e){return e.map(function(e){return t.hook.reading.fire(e)})})})},Dt.prototype.bulkAdd=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,a=(n||=i?void 0:t)?n.allKeys:void 0;return this._trans(`readwrite`,function(t){var n=r.schema.primKey,o=n.auto,n=n.keyPath;if(n&&i)throw new N.InvalidArgument(`bulkAdd(): keys argument invalid on tables with inbound keys`);if(i&&i.length!==e.length)throw new N.InvalidArgument(`Arguments objects and keys must have the same length`);var s=e.length,n=n&&o?e.map(xt(n)):e;return r.core.mutate({trans:t,type:`add`,keys:i,values:n,wantResults:a}).then(function(e){var t=e.numFailures,n=e.results,i=e.lastResult,e=e.failures;if(t===0)return a?n:i;throw new M(`${r.name}.bulkAdd(): ${t} of ${s} operations failed`,e)})})},Dt.prototype.bulkPut=function(e,t,n){var r=this,i=Array.isArray(t)?t:void 0,a=(n||=i?void 0:t)?n.allKeys:void 0;return this._trans(`readwrite`,function(t){var n=r.schema.primKey,o=n.auto,n=n.keyPath;if(n&&i)throw new N.InvalidArgument(`bulkPut(): keys argument invalid on tables with inbound keys`);if(i&&i.length!==e.length)throw new N.InvalidArgument(`Arguments objects and keys must have the same length`);var s=e.length,n=n&&o?e.map(xt(n)):e;return r.core.mutate({trans:t,type:`put`,keys:i,values:n,wantResults:a}).then(function(e){var t=e.numFailures,n=e.results,i=e.lastResult,e=e.failures;if(t===0)return a?n:i;throw new M(`${r.name}.bulkPut(): ${t} of ${s} operations failed`,e)})})},Dt.prototype.bulkUpdate=function(e){var t=this,n=this.core,r=e.map(function(e){return e.key}),i=e.map(function(e){return e.changes}),a=[];return this._trans(`readwrite`,function(o){return n.getMany({trans:o,keys:r,cache:`clone`}).then(function(s){var c=[],l=[];e.forEach(function(e,n){var r=e.key,i=e.changes,o=s[n];if(o){for(var u=0,d=Object.keys(i);u<d.length;u++){var f=d[u],p=i[f];if(f===t.schema.primKey.keyPath){if(z(p,r)!==0)throw new N.Constraint(`Cannot update primary key in bulkUpdate()`)}else x(o,f,p)}a.push(n),c.push(r),l.push(o)}});var u=c.length;return n.mutate({trans:o,type:`put`,keys:c,values:l,updates:{keys:r,changeSpecs:i}}).then(function(e){var n=e.numFailures,r=e.failures;if(n===0)return u;for(var i=0,o=Object.keys(r);i<o.length;i++){var s,c=o[i],l=a[Number(c)];l!=null&&(s=r[c],delete r[c],r[l]=s)}throw new M(`${t.name}.bulkUpdate(): ${n} of ${u} operations failed`,r)})})})},Dt.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans(`readwrite`,function(n){return t.core.mutate({trans:n,type:`delete`,keys:e}).then(function(n){return Tt(t,e,n)})}).then(function(e){var r=e.numFailures,i=e.lastResult,e=e.failures;if(r===0)return i;throw new M(`${t.name}.bulkDelete(): ${r} of ${n} operations failed`,e)})},Dt);function Dt(){}function Ot(e){function t(t,r){if(r){for(var i=arguments.length,a=Array(i-1);--i;)a[i-1]=arguments[i];return n[t].subscribe.apply(null,a),e}if(typeof t==`string`)return n[t]}var n={};t.addEventType=s;for(var r=1,o=arguments.length;r<o;++r)s(arguments[r]);return t;function s(e,r,o){if(typeof e!=`object`){var c;r||=be;var l={subscribers:[],fire:o||=F,subscribe:function(e){l.subscribers.indexOf(e)===-1&&(l.subscribers.push(e),l.fire=r(l.fire,e))},unsubscribe:function(e){l.subscribers=l.subscribers.filter(function(t){return t!==e}),l.fire=l.subscribers.reduce(r,o)}};return n[e]=t[e]=l}i(c=e).forEach(function(e){var t=c[e];if(a(t))s(e,c[e][0],c[e][1]);else{if(t!==`asap`)throw new N.InvalidArgument(`Invalid event config`);var n=s(e,me,function(){for(var e=arguments.length,t=Array(e);e--;)t[e]=arguments[e];n.subscribers.forEach(function(e){y(function(){e.apply(null,t)})})})}})}}function kt(e,t){return p(t).from({prototype:e}),t}function At(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function jt(e,t){e.filter=yt(e.filter,t)}function Mt(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return yt(r(),t())}:t,e.justLimit=n&&!r}function Nt(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new N.Schema(`KeyPath `+e.index+` on object store `+t.name+` is not indexed`);return n}function Pt(e,t,n){var r=Nt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir===`prev`,unique:!!e.unique,query:{index:r,range:e.range}})}function Ft(e,t,n,r){var i=e.replayFilter?yt(e.filter,e.replayFilter()):e.filter;if(e.or){var a={},o=function(e,n,r){var o,s;i&&!i(n,r,function(e){return n.stop(e)},function(e){return n.fail(e)})||((s=``+(o=n.primaryKey))==`[object ArrayBuffer]`&&(s=``+new Uint8Array(o)),l(a,s)||(a[s]=!0,t(e,n,r)))};return Promise.all([e.or._iterate(o,n),It(Pt(e,r,n),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return It(Pt(e,r,n),yt(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function It(e,t,n,r){var i=R(r?function(e,t,i){return n(r(e),t,i)}:n);return e.then(function(e){if(e)return e.start(function(){var n=function(){return e.continue()};t&&!t(e,function(e){return n=e},function(t){e.stop(t),n=F},function(t){e.fail(t),n=F})||i(e.value,e,function(e){return n=e}),n()})})}var Lt=(Rt.prototype.execute=function(e){var t=this[`@@propmod`];if(t.add!==void 0){var r=t.add;if(a(r))return n(n([],a(e)?e:[],!0),r,!0).sort();if(typeof r==`number`)return(Number(e)||0)+r;if(typeof r==`bigint`)try{return BigInt(e)+r}catch{return BigInt(0)+r}throw TypeError(`Invalid term ${r}`)}if(t.remove!==void 0){var i=t.remove;if(a(i))return a(e)?e.filter(function(e){return!i.includes(e)}).sort():[];if(typeof i==`number`)return Number(e)-i;if(typeof i==`bigint`)try{return BigInt(e)-i}catch{return BigInt(0)-i}throw TypeError(`Invalid subtrahend ${i}`)}return r=(r=t.replacePrefix)?.[0],r&&typeof e==`string`&&e.startsWith(r)?t.replacePrefix[1]+e.substring(r.length):e},Rt);function Rt(e){this[`@@propmod`]=e}var zt=(B.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,dt.bind(null,n.error)):n.table._trans(`readonly`,e).then(t)},B.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,dt.bind(null,t.error)):t.table._trans(`readwrite`,e,`locked`)},B.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=yt(t.algorithm,e)},B.prototype._iterate=function(e,t){return Ft(this._ctx,e,t,this._ctx.table.core)},B.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&o(n,e),t._ctx=n,t},B.prototype.raw=function(){return this._ctx.valueMapper=null,this},B.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return Ft(t,e,n,t.table.core)})},B.prototype.count=function(e){var t=this;return this._read(function(e){var n=t._ctx,r=n.table.core;if(At(n,!0))return r.count({trans:e,query:{index:Nt(n,r.schema),range:n.range}}).then(function(e){return Math.min(e,n.limit)});var i=0;return Ft(n,function(){return++i,!1},e,r).then(function(){return i})}).then(e)},B.prototype.sortBy=function(e,t){var n=e.split(`.`).reverse(),r=n[0],i=n.length-1;function a(e,t){return t?a(e[n[t]],t-1):e[r]}var o=this._ctx.dir===`next`?1:-1;function s(e,t){return z(a(e,i),a(t,i))*o}return this.toArray(function(e){return e.sort(s)}).then(t)},B.prototype.toArray=function(e){var t=this;return this._read(function(e){var n=t._ctx;if(n.dir===`next`&&At(n,!0)&&0<n.limit){var r=n.valueMapper,i=Nt(n,n.table.core.schema);return n.table.core.query({trans:e,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then(function(e){return e=e.result,r?e.map(r):e})}var a=[];return Ft(n,function(e){return a.push(e)},e,n.table.core).then(function(){return a})},e)},B.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,At(t)?Mt(t,function(){var t=e;return function(e,n){return t===0||(t===1?--t:n(function(){e.advance(t),t=0}),!1)}}):Mt(t,function(){var t=e;return function(){return--t<0}})),this},B.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Mt(this._ctx,function(){var t=e;return function(e,n,r){return--t<=0&&n(r),0<=t}},!0),this},B.prototype.until=function(e,t){return jt(this._ctx,function(n,r,i){return!e(n.value)||(r(i),t)}),this},B.prototype.first=function(e){return this.limit(1).toArray(function(e){return e[0]}).then(e)},B.prototype.last=function(e){return this.reverse().first(e)},B.prototype.filter=function(e){var t;return jt(this._ctx,function(t){return e(t.value)}),(t=this._ctx).isMatch=yt(t.isMatch,e),this},B.prototype.and=function(e){return this.filter(e)},B.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},B.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir===`prev`?`next`:`prev`,this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},B.prototype.desc=function(){return this.reverse()},B.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.key,n)})},B.prototype.eachUniqueKey=function(e){return this._ctx.unique=`unique`,this.eachKey(e)},B.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.primaryKey,n)})},B.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.key)}).then(function(){return n}).then(e)},B.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir===`next`&&At(t,!0)&&0<t.limit)return this._read(function(e){var n=Nt(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})}).then(function(e){return e.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.primaryKey)}).then(function(){return n}).then(e)},B.prototype.uniqueKeys=function(e){return this._ctx.unique=`unique`,this.keys(e)},B.prototype.firstKey=function(e){return this.limit(1).keys(function(e){return e[0]}).then(e)},B.prototype.lastKey=function(e){return this.reverse().firstKey(e)},B.prototype.distinct=function(){var e=this._ctx,e=e.index&&e.table.schema.idxByName[e.index];if(!e||!e.multi)return this;var t={};return jt(this._ctx,function(e){var n=e.primaryKey.toString(),e=l(t,n);return t[n]=!0,!e}),this},B.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(r){var a,o,s=typeof e==`function`?e:(a=i(e),o=a.length,function(t){for(var n=!1,r=0;r<o;++r){var i=a[r],s=e[i],c=b(t,i);s instanceof Lt?(x(t,i,s.execute(c)),n=!0):c!==s&&(x(t,i,s),n=!0)}return n}),c=n.table.core,l=c.schema.primaryKey,u=l.outbound,d=l.extractKey,f=200,l=t.db._options.modifyChunkSize;l&&(f=typeof l==`object`?l[c.name]||l[`*`]||200:l);function p(e,t){var n=t.failures,t=t.numFailures;h+=e-t;for(var r=0,a=i(n);r<a.length;r++){var o=a[r];m.push(n[o])}}var m=[],h=0,g=[],_=e===Bt;return t.clone().primaryKeys().then(function(t){function i(o){var l=Math.min(f,t.length-o),m=t.slice(o,o+l);return(_?Promise.resolve([]):c.getMany({trans:r,keys:m,cache:`immutable`})).then(function(h){var g=[],v=[],y=u?[]:null,b=_?m:[];if(!_)for(var x=0;x<l;++x){var S=h[x],C={value:O(S),primKey:t[o+x]};!1!==s.call(C,C.value,C)&&(C.value==null?b.push(t[o+x]):u||z(d(S),d(C.value))===0?(v.push(C.value),u&&y.push(t[o+x])):(b.push(t[o+x]),g.push(C.value)))}return Promise.resolve(0<g.length&&c.mutate({trans:r,type:`add`,values:g}).then(function(e){for(var t in e.failures)b.splice(parseInt(t),1);p(g.length,e)})).then(function(){return(0<v.length||a&&typeof e==`object`)&&c.mutate({trans:r,type:`put`,keys:y,values:v,criteria:a,changeSpec:typeof e!=`function`&&e,isAdditionalChunk:0<o}).then(function(e){return p(v.length,e)})}).then(function(){return(0<b.length||a&&_)&&c.mutate({trans:r,type:`delete`,keys:b,criteria:a,isAdditionalChunk:0<o}).then(function(e){return Tt(n.table,b,e)}).then(function(e){return p(b.length,e)})}).then(function(){return t.length>o+l&&i(o+f)})})}var a=At(n)&&n.limit===1/0&&(typeof e!=`function`||_)&&{index:n.index,range:n.range};return i(0).then(function(){if(0<m.length)throw new ue(`Error modifying one or more objects`,m,h,g);return t.length})})})},B.prototype.delete=function(){var e=this._ctx,t=e.range;return!At(e)||e.table.schema.yProps||!e.isPrimKey&&t.type!==3?this.modify(Bt):this._write(function(n){var r=e.table.core.schema.primaryKey,i=t;return e.table.core.count({trans:n,query:{index:r,range:i}}).then(function(t){return e.table.core.mutate({trans:n,type:`deleteRange`,range:i}).then(function(e){var n=e.failures,e=e.numFailures;if(e)throw new ue(`Could not delete some values`,Object.keys(n).map(function(e){return n[e]}),t-e);return t-e})})})},B);function B(){}var Bt=function(e,t){return t.value=null};function Vt(e,t){return e<t?-1:e===t?0:1}function Ht(e,t){return t<e?-1:e===t?0:1}function Ut(e,t,n){return e=e instanceof Jt?new e.Collection(e):e,e._ctx.error=new(n||TypeError)(t),e}function Wt(e){return new e.Collection(e,function(){return qt(``)}).limit(0)}function Gt(e,t,n,r){var i,a,o,s,c,l,u,d=n.length;if(!n.every(function(e){return typeof e==`string`}))return Ut(e,mt);function f(e){i=e===`next`?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()},a=e===`next`?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()},o=e===`next`?Vt:Ht;var t=n.map(function(e){return{lower:a(e),upper:i(e)}}).sort(function(e,t){return o(e.lower,t.lower)});s=t.map(function(e){return e.upper}),c=t.map(function(e){return e.lower}),u=(l=e)===`next`?``:r}f(`next`),e=new e.Collection(e,function(){return Kt(s[0],c[d-1]+r)}),e._ondirectionchange=function(e){f(e)};var p=0;return e._addAlgorithm(function(e,n,r){var i=e.key;if(typeof i!=`string`)return!1;var f=a(i);if(t(f,c,p))return!0;for(var m=null,h=p;h<d;++h){var g=function(e,t,n,r,i,a){for(var o=Math.min(e.length,r.length),s=-1,c=0;c<o;++c){var l=t[c];if(l!==r[c])return i(e[c],n[c])<0?e.substr(0,c)+n[c]+n.substr(c+1):i(e[c],r[c])<0?e.substr(0,c)+r[c]+n.substr(c+1):0<=s?e.substr(0,s)+t[s]+n.substr(s+1):null;i(e[c],l)<0&&(s=c)}return o<r.length&&a===`next`?e+n.substr(e.length):o<e.length&&a===`prev`?e.substr(0,n.length):s<0?null:e.substr(0,s)+r[s]+n.substr(s+1)}(i,f,s[h],c[h],o,l);g===null&&m===null?p=h+1:(m===null||0<o(m,g))&&(m=g)}return n(m===null?r:function(){e.continue(m+u)}),!1}),e}function Kt(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function qt(e){return{type:1,lower:e,upper:e}}var Jt=(Object.defineProperty(Yt.prototype,`Collection`,{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Yt.prototype.between=function(e,t,n,r){n=!1!==n,r=!0===r;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(n||r)&&(!n||!r)?Wt(this):new this.Collection(this,function(){return Kt(e,t,!n,!r)})}catch{return Ut(this,pt)}},Yt.prototype.equals=function(e){return e==null?Ut(this,pt):new this.Collection(this,function(){return qt(e)})},Yt.prototype.above=function(e){return e==null?Ut(this,pt):new this.Collection(this,function(){return Kt(e,void 0,!0)})},Yt.prototype.aboveOrEqual=function(e){return e==null?Ut(this,pt):new this.Collection(this,function(){return Kt(e,void 0,!1)})},Yt.prototype.below=function(e){return e==null?Ut(this,pt):new this.Collection(this,function(){return Kt(void 0,e,!1,!0)})},Yt.prototype.belowOrEqual=function(e){return e==null?Ut(this,pt):new this.Collection(this,function(){return Kt(void 0,e)})},Yt.prototype.startsWith=function(e){return typeof e==`string`?this.between(e,e+ft,!0,!0):Ut(this,mt)},Yt.prototype.startsWithIgnoreCase=function(e){return e===``?this.startsWith(e):Gt(this,function(e,t){return e.indexOf(t[0])===0},[e],ft)},Yt.prototype.equalsIgnoreCase=function(e){return Gt(this,function(e,t){return e===t[0]},[e],``)},Yt.prototype.anyOfIgnoreCase=function(){var e=ae.apply(ie,arguments);return e.length===0?Wt(this):Gt(this,function(e,t){return t.indexOf(e)!==-1},e,``)},Yt.prototype.startsWithAnyOfIgnoreCase=function(){var e=ae.apply(ie,arguments);return e.length===0?Wt(this):Gt(this,function(e,t){return t.some(function(t){return e.indexOf(t)===0})},e,ft)},Yt.prototype.anyOf=function(){var e=this,t=ae.apply(ie,arguments),n=this._cmp;try{t.sort(n)}catch{return Ut(this,pt)}if(t.length===0)return Wt(this);var r=new this.Collection(this,function(){return Kt(t[0],t[t.length-1])});r._ondirectionchange=function(r){n=r===`next`?e._ascending:e._descending,t.sort(n)};var i=0;return r._addAlgorithm(function(e,r,a){for(var o=e.key;0<n(o,t[i]);)if(++i===t.length)return r(a),!1;return n(o,t[i])===0||(r(function(){e.continue(t[i])}),!1)}),r},Yt.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Yt.prototype.noneOf=function(){var e=ae.apply(ie,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Ut(this,pt)}var t=e.reduce(function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[-1/0,t]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},Yt.prototype.inAnyRange=function(e,t){var n=this,r=this._cmp,i=this._ascending,a=this._descending,o=this._min,s=this._max;if(e.length===0)return Wt(this);if(!e.every(function(e){return e[0]!==void 0&&e[1]!==void 0&&i(e[0],e[1])<=0}))return Ut(this,`First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower`,N.InvalidArgument);var c=!t||!1!==t.includeLowers,l=t&&!0===t.includeUppers,u,d=i;function f(e,t){return d(e[0],t[0])}try{(u=e.reduce(function(e,t){for(var n=0,i=e.length;n<i;++n){var a=e[n];if(r(t[0],a[1])<0&&0<r(t[1],a[0])){a[0]=o(a[0],t[0]),a[1]=s(a[1],t[1]);break}}return n===i&&e.push(t),e},[])).sort(f)}catch{return Ut(this,pt)}var p=0,m=l?function(e){return 0<i(e,u[p][1])}:function(e){return 0<=i(e,u[p][1])},h=c?function(e){return 0<a(e,u[p][0])}:function(e){return 0<=a(e,u[p][0])},g=m,e=new this.Collection(this,function(){return Kt(u[0][0],u[u.length-1][1],!c,!l)});return e._ondirectionchange=function(e){d=e===`next`?(g=m,i):(g=h,a),u.sort(f)},e._addAlgorithm(function(e,t,r){for(var a,o=e.key;g(o);)if(++p===u.length)return t(r),!1;return!m(a=o)&&!h(a)||(n._cmp(o,u[p][1])===0||n._cmp(o,u[p][0])===0||t(function(){d===i?e.continue(u[p][0]):e.continue(u[p][1])}),!1)}),e},Yt.prototype.startsWithAnyOf=function(){var e=ae.apply(ie,arguments);return e.every(function(e){return typeof e==`string`})?e.length===0?Wt(this):this.inAnyRange(e.map(function(e){return[e,e+ft]})):Ut(this,`startsWithAnyOf() only works with strings`)},Yt);function Yt(){}function Xt(e){return R(function(t){return Zt(t),e(t.target.error),!1})}function Zt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Qt=`storagemutated`,$t=`x-storagemutated-1`,en=Ot(null,Qt),tn=(nn.prototype._lock=function(){return v(!I.global),++this._reculock,this._reculock!==1||I.global||(I.lockOwnerFor=this),this},nn.prototype._unlock=function(){if(v(!I.global),--this._reculock==0)for(I.global||(I.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{ct(e[1],e[0])}catch{}}return this},nn.prototype._locked=function(){return this._reculock&&I.lockOwnerFor!==this},nn.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(v(!this.idbtrans),!e&&!n)switch(r&&r.name){case`DatabaseClosedError`:throw new N.DatabaseClosed(r);case`MissingAPIError`:throw new N.MissingAPI(r.message,r);default:throw new N.OpenFailed(r)}if(!this.active)throw new N.TransactionInactive;return v(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=R(function(n){Zt(n),t._reject(e.error)}),e.onabort=R(function(n){Zt(n),t.active&&t._reject(new N.Abort(e.error)),t.active=!1,t.on(`abort`).fire(n)}),e.oncomplete=R(function(){t.active=!1,t._resolve(),`mutatedParts`in e&&en.storagemutated.fire(e.mutatedParts)}),this},nn.prototype._promise=function(e,t,n){var r=this;if(e===`readwrite`&&this.mode!==`readwrite`)return dt(new N.ReadOnly(`Transaction is readonly`));if(!this.active)return dt(new N.TransactionInactive);if(this._locked())return new L(function(i,a){r._blockedFuncs.push([function(){r._promise(e,t,n).then(i,a)},I])});if(n)return tt(function(){var e=new L(function(e,n){r._lock();var i=t(e,n,r);i&&i.then&&i.then(e,n)});return e.finally(function(){return r._unlock()}),e._lib=!0,e});var i=new L(function(e,n){var i=t(e,n,r);i&&i.then&&i.then(e,n)});return i._lib=!0,i},nn.prototype._root=function(){return this.parent?this.parent._root():this},nn.prototype.waitFor=function(e){var t,n=this._root(),r=L.resolve(e);n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return r}):(n._waitingFor=r,n._waitingQueue=[],t=n.idbtrans.objectStore(n.storeNames[0]),function e(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(t.get(-1/0).onsuccess=e)}());var i=n._waitingFor;return new L(function(e,t){r.then(function(t){return n._waitingQueue.push(R(e.bind(null,t)))},function(e){return n._waitingQueue.push(R(t.bind(null,e)))}).finally(function(){n._waitingFor===i&&(n._waitingFor=null)})})},nn.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new N.Abort))},nn.prototype.table=function(e){var t=this._memoizedTables||={};if(l(t,e))return t[e];var n=this.schema[e];if(!n)throw new N.NotFound(`Table `+e+` not part of transaction`);return n=new this.db.Table(e,n,this),n.core=this.db.core.table(e),t[e]=n},nn);function nn(){}function rn(e,t,n,r,i,a,o,s){return{name:e,keyPath:t,unique:n,multi:r,auto:i,compound:a,src:(n&&!o?`&`:``)+(r?`*`:``)+(i?`++`:``)+an(t),type:s}}function an(e){return typeof e==`string`?e:e?`[`+[].join.call(e,`+`)+`]`:``}function on(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:(r=function(e){return[e.name,e]},n.reduce(function(e,t,n){return n=r(t,n),n&&(e[n[0]]=n[1]),e},{}))};var r}var sn=function(e){try{return e.only([[]]),sn=function(){return[[]]},[[]]}catch{return sn=function(){return ft},ft}};function cn(e){return e==null?function(){}:typeof e==`string`?(t=e).split(`.`).length===1?function(e){return e[t]}:function(e){return b(e,t)}:function(t){return b(t,e)};var t}function ln(e){return[].slice.call(e)}var un=0;function dn(e){return e==null?`:id`:typeof e==`string`?e:`[${e.join(`+`)}]`}function fn(e,t,n){function r(e){if(e.type===3)return null;if(e.type===4)throw Error(`Cannot convert never type to IDBKeyRange`);var n=e.lower,r=e.upper,i=e.lowerOpen,e=e.upperOpen;return n===void 0?r===void 0?null:t.upperBound(r,!!e):r===void 0?t.lowerBound(n,!!i):t.bound(n,r,!!i,!!e)}function i(e){var t,n=e.name;return{name:n,schema:e,mutate:function(e){var t=e.trans,i=e.type,a=e.keys,o=e.values,s=e.range;return new Promise(function(e,c){e=R(e);var l=t.objectStore(n),u=l.keyPath==null,d=i===`put`||i===`add`;if(!d&&i!==`delete`&&i!==`deleteRange`)throw Error(`Invalid operation type: `+i);var f,p=(a||o||{length:1}).length;if(a&&o&&a.length!==o.length)throw Error(`Given keys array must have same length as given values array.`);if(p===0)return e({numFailures:0,failures:{},results:[],lastResult:void 0});function m(e){++_,Zt(e)}var h=[],g=[],_=0;if(i===`deleteRange`){if(s.type===4)return e({numFailures:_,failures:g,results:[],lastResult:void 0});s.type===3?h.push(f=l.clear()):h.push(f=l.delete(r(s)))}else{var u=d?u?[o,a]:[o,null]:[a,null],v=u[0],y=u[1];if(d)for(var b=0;b<p;++b)h.push(f=y&&y[b]!==void 0?l[i](v[b],y[b]):l[i](v[b])),f.onerror=m;else for(b=0;b<p;++b)h.push(f=l[i](v[b])),f.onerror=m}function x(t){t=t.target.result,h.forEach(function(e,t){return e.error!=null&&(g[t]=e.error)}),e({numFailures:_,failures:g,results:i===`delete`?a:h.map(function(e){return e.result}),lastResult:t})}f.onerror=function(e){m(e),x(e)},f.onsuccess=x})},getMany:function(e){var t=e.trans,r=e.keys;return new Promise(function(e,i){e=R(e);for(var a,o=t.objectStore(n),s=r.length,c=Array(s),l=0,u=0,d=function(t){t=t.target,c[t._pos]=t.result,++u===l&&e(c)},f=Xt(i),p=0;p<s;++p)r[p]!=null&&((a=o.get(r[p]))._pos=p,a.onsuccess=d,a.onerror=f,++l);l===0&&e(c)})},get:function(e){var t=e.trans,r=e.key;return new Promise(function(e,i){e=R(e);var a=t.objectStore(n).get(r);a.onsuccess=function(t){return e(t.target.result)},a.onerror=Xt(i)})},query:(t=u,function(e){return new Promise(function(i,a){i=R(i);var o,s,c,l=e.trans,u=e.values,d=e.limit,f=e.query,p=d===1/0?void 0:d,m=f.index,f=f.range,l=l.objectStore(n),m=m.isPrimaryKey?l:l.index(m.name),f=r(f);if(d===0)return i({result:[]});t?((p=u?m.getAll(f,p):m.getAllKeys(f,p)).onsuccess=function(e){return i({result:e.target.result})},p.onerror=Xt(a)):(o=0,s=!u&&`openKeyCursor`in m?m.openKeyCursor(f):m.openCursor(f),c=[],s.onsuccess=function(e){var t=s.result;return t?(c.push(u?t.value:t.primaryKey),++o===d?i({result:c}):void t.continue()):i({result:c})},s.onerror=Xt(a))})}),openCursor:function(e){var t=e.trans,i=e.values,a=e.query,o=e.reverse,s=e.unique;return new Promise(function(e,c){e=R(e);var l=a.index,u=a.range,d=t.objectStore(n),d=l.isPrimaryKey?d:d.index(l.name),l=o?s?`prevunique`:`prev`:s?`nextunique`:`next`,f=!i&&`openKeyCursor`in d?d.openKeyCursor(r(u),l):d.openCursor(r(u),l);f.onerror=Xt(c),f.onsuccess=R(function(n){var r,i,a,o,s=f.result;s?(s.___id=++un,s.done=!1,r=s.continue.bind(s),i=(i=s.continuePrimaryKey)&&i.bind(s),a=s.advance.bind(s),o=function(){throw Error(`Cursor not stopped`)},s.trans=t,s.stop=s.continue=s.continuePrimaryKey=s.advance=function(){throw Error(`Cursor not started`)},s.fail=R(c),s.next=function(){var e=this,t=1;return this.start(function(){return t--?e.continue():e.stop()}).then(function(){return e})},s.start=function(e){function t(){if(f.result)try{e()}catch(e){s.fail(e)}else s.done=!0,s.start=function(){throw Error(`Cursor behind last entry`)},s.stop()}var n=new Promise(function(e,t){e=R(e),f.onerror=Xt(t),s.fail=t,s.stop=function(t){s.stop=s.continue=s.continuePrimaryKey=s.advance=o,e(t)}});return f.onsuccess=R(function(e){f.onsuccess=t,t()}),s.continue=r,s.continuePrimaryKey=i,s.advance=a,t(),n},e(s)):e(null)},c)})},count:function(e){var t=e.query,i=e.trans,a=t.index,o=t.range;return new Promise(function(e,t){var s=i.objectStore(n),c=a.isPrimaryKey?s:s.index(a.name),s=r(o),c=s?c.count(s):c.count();c.onsuccess=R(function(t){return e(t.target.result)}),c.onerror=Xt(t)})}}}var o,s,c,l=(s=n,c=ln((o=e).objectStoreNames),{schema:{name:o.name,tables:c.map(function(e){return s.objectStore(e)}).map(function(e){var t=e.keyPath,n=e.autoIncrement,r=a(t),i={},n={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:t==null,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:cn(t)},indexes:ln(e.indexNames).map(function(t){return e.index(t)}).map(function(e){var t=e.name,n=e.unique,r=e.multiEntry,e=e.keyPath,r={name:t,compound:a(e),keyPath:e,unique:n,multiEntry:r,extractKey:cn(e)};return i[dn(e)]=r}),getIndexByKeyPath:function(e){return i[dn(e)]}};return i[`:id`]=n.primaryKey,t!=null&&(i[dn(t)]=n.primaryKey),n})},hasGetAll:0<c.length&&`getAll`in s.objectStore(c[0])&&!(typeof navigator<`u`&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),n=l.schema,u=l.hasGetAll,l=n.tables.map(i),d={};return l.forEach(function(e){return d[e.name]=e}),{stack:`dbcore`,transaction:e.transaction.bind(e),table:function(e){if(!d[e])throw Error(`Table '${e}' not found`);return d[e]},MIN_KEY:-1/0,MAX_KEY:sn(t),schema:n}}function pn(e,n,r,i){var a=r.IDBKeyRange;return r.indexedDB,{dbcore:(i=fn(n,a,i),e.dbcore.reduce(function(e,n){return n=n.create,t(t({},e),n(e))},i))}}function mn(e,t){var n=t.db,t=pn(e._middlewares,n,e._deps,t);e.core=t.dbcore,e.tables.forEach(function(t){var n=t.name;e.core.schema.tables.some(function(e){return e.name===n})&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))})}function hn(e,t,n,r){n.forEach(function(n){var i=r[n];t.forEach(function(t){var r=function e(t,n){return m(t,n)||(t=s(t))&&e(t,n)}(t,n);(!r||`value`in r&&r.value===void 0)&&(t===e.Transaction.prototype||t instanceof e.Transaction?f(t,n,{get:function(){return this.table(n)},set:function(e){d(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,i))})})}function gn(e,t){t.forEach(function(t){for(var n in t)t[n]instanceof e.Table&&delete t[n]})}function _n(e,t){return e._cfg.version-t._cfg.version}function vn(e,t,n,r){var a=e._dbSchema;n.objectStoreNames.contains(`$meta`)&&!a.$meta&&(a.$meta=on(`$meta`,En(``)[0],[]),e._storeNames.push(`$meta`));var o=e._createTransaction(`readwrite`,e._storeNames,a);o.create(n),o._completion.catch(r);var s=o._reject.bind(o),c=I.transless||I;tt(function(){return I.trans=o,I.transless=c,t===0?(i(a).forEach(function(e){xn(n,e,a[e].primKey,a[e].indexes)}),mn(e,n),void L.follow(function(){return e.on.populate.fire(o)}).catch(s)):(mn(e,n),l=t,((r=o).storeNames.includes(`$meta`)?r.table(`$meta`).get(`version`).then(function(e){return e??l}):L.resolve(l)).then(function(t){return a=t,s=o,c=n,l=[],t=(r=e)._versions,u=r._dbSchema=wn(0,r.idbdb,c),(t=t.filter(function(e){return e._cfg.version>=a})).length===0?L.resolve():(t.forEach(function(e){l.push(function(){var t=u,n=e._cfg.dbschema;Tn(r,t,c),Tn(r,n,c),u=r._dbSchema=n;var o=bn(t,n);o.add.forEach(function(e){xn(c,e[0],e[1].primKey,e[1].indexes)}),o.change.forEach(function(e){if(e.recreate)throw new N.Upgrade(`Not yet support for changing primary key`);var t=c.objectStore(e.name);e.add.forEach(function(e){return Cn(t,e)}),e.change.forEach(function(e){t.deleteIndex(e.name),Cn(t,e)}),e.del.forEach(function(e){return t.deleteIndex(e)})});var l=e._cfg.contentUpgrade;if(l&&e._cfg.version>a){mn(r,c),s._memoizedTables={};var d=S(n);o.del.forEach(function(e){d[e]=t[e]}),gn(r,[r.Transaction.prototype]),hn(r,[r.Transaction.prototype],i(d),d),s.schema=d;var f,p=A(l);return p&&nt(),o=L.follow(function(){var e;(f=l(s))&&p&&(e=rt.bind(null,null),f.then(e,e))}),f&&typeof f.then==`function`?L.resolve(f):o.then(function(){return f})}}),l.push(function(t){var n=e._cfg.dbschema,i=t;[].slice.call(i.db.objectStoreNames).forEach(function(e){return n[e]==null&&i.db.deleteObjectStore(e)}),gn(r,[r.Transaction.prototype]),hn(r,[r.Transaction.prototype],r._storeNames,r._dbSchema),s.schema=r._dbSchema}),l.push(function(t){r.idbdb.objectStoreNames.contains(`$meta`)&&(Math.ceil(r.idbdb.version/10)===e._cfg.version?(r.idbdb.deleteObjectStore(`$meta`),delete r._dbSchema.$meta,r._storeNames=r._storeNames.filter(function(e){return e!==`$meta`})):t.objectStore(`$meta`).put(e._cfg.version,`version`))})}),function e(){return l.length?L.resolve(l.shift()(s.idbtrans)).then(e):L.resolve()}().then(function(){Sn(u,c)}));var r,a,s,c,l,u}).catch(s));var r,l})}function yn(e,t){Sn(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains(`$meta`)||t.db.createObjectStore(`$meta`).add(Math.ceil(t.db.version/10-1),`version`);var n=wn(0,e.idbdb,t);Tn(e,e._dbSchema,t);for(var r=0,i=bn(n,e._dbSchema).change;r<i.length;r++){var a=function(e){if(e.change.length||e.recreate)return console.warn(`Unable to patch indexes of table ${e.name} because it has changes on the type of index or primary key.`),{value:void 0};var n=t.objectStore(e.name);e.add.forEach(function(t){Se&&console.debug(`Dexie upgrade patch: Creating missing index ${e.name}.${t.src}`),Cn(n,t)})}(i[r]);if(typeof a==`object`)return a.value}}function bn(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var i=e[n],a=t[n];if(i){var o={name:n,def:a,recreate:!1,del:[],add:[],change:[]};if(``+(i.primKey.keyPath||``)!=``+(a.primKey.keyPath||``)||i.primKey.auto!==a.primKey.auto)o.recreate=!0,r.change.push(o);else{var s=i.idxByName,c=a.idxByName,l=void 0;for(l in s)c[l]||o.del.push(l);for(l in c){var u=s[l],d=c[l];u?u.src!==d.src&&o.change.push(d):o.add.push(d)}(0<o.del.length||0<o.add.length||0<o.change.length)&&r.change.push(o)}}else r.add.push([n,a])}return r}function xn(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(e){return Cn(i,e)}),i}function Sn(e,t){i(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(Se&&console.debug(`Dexie: Creating missing table`,n),xn(t,n,e[n].primKey,e[n].indexes))})}function Cn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function wn(e,t,n){var r={};return g(t.objectStoreNames,0).forEach(function(e){for(var t=n.objectStore(e),i=rn(an(c=t.keyPath),c||``,!0,!1,!!t.autoIncrement,c&&typeof c!=`string`,!0),a=[],o=0;o<t.indexNames.length;++o){var s=t.index(t.indexNames[o]),c=s.keyPath,s=rn(s.name,c,!!s.unique,!!s.multiEntry,!1,c&&typeof c!=`string`,!1);a.push(s)}r[e]=on(e,i,a)}),r}function Tn(e,t,n){for(var i=n.db.objectStoreNames,a=0;a<i.length;++a){var o=i[a],s=n.objectStore(o);e._hasGetAll=`getAll`in s;for(var c=0;c<s.indexNames.length;++c){var l=s.indexNames[c],u=s.index(l).keyPath,d=typeof u==`string`?u:`[`+g(u).join(`+`)+`]`;!t[o]||(u=t[o].idxByName[d])&&(u.name=l,delete t[o].idxByName[d],t[o].idxByName[l]=u)}}typeof navigator<`u`&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&r.WorkerGlobalScope&&r instanceof r.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function En(e){return e.split(`,`).map(function(e,t){var n=e.split(`:`),r=(i=n[1])?.trim(),i=(e=n[0].trim()).replace(/([&*]|\+\+)/g,``),n=/^\[/.test(i)?i.match(/^\[(.*)\]$/)[1].split(`+`):i;return rn(i,n||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),a(n),t===0,r)})}var Dn=(On.prototype._createTableSchema=on,On.prototype._parseIndexSyntax=En,On.prototype._parseStoresSpec=function(e,t){var n=this;i(e).forEach(function(r){if(e[r]!==null){var i=n._parseIndexSyntax(e[r]),a=i.shift();if(!a)throw new N.Schema(`Invalid schema for table `+r+`: `+e[r]);if(a.unique=!0,a.multi)throw new N.Schema(`Primary key cannot be multiEntry*`);i.forEach(function(e){if(e.auto)throw new N.Schema(`Only primary key can be marked as autoIncrement (++)`);if(!e.keyPath)throw new N.Schema(`Index must have a name and cannot be an empty string`)}),i=n._createTableSchema(r,a,i),t[r]=i}})},On.prototype.stores=function(e){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?o(this._cfg.storesSource,e):e;var e=t._versions,n={},r={};return e.forEach(function(e){o(n,e._cfg.storesSource),r=e._cfg.dbschema={},e._parseStoresSpec(n,r)}),t._dbSchema=r,gn(t,[t._allTables,t,t.Transaction.prototype]),hn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],i(r),r),t._storeNames=i(r),this},On.prototype.upgrade=function(e){return this._cfg.contentUpgrade=xe(this._cfg.contentUpgrade||F,e),this},On);function On(){}function kn(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new mr(gt,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:`name`}),n.table(`dbnames`)}function An(e){return e&&typeof e.databases==`function`}function jn(e){return tt(function(){return I.letThrough=!0,e()})}function Mn(e){return!(`from`in e)}var Nn=function(e,t){if(!this){var n=new Nn;return e&&`d`in e&&o(n,e),n}o(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function Pn(e,t,n){var r=z(t,n);if(!isNaN(r)){if(0<r)throw RangeError();if(Mn(e))return o(e,{from:t,to:n,d:1});var i=e.l,r=e.r;if(z(n,e.from)<0)return i?Pn(i,t,n):e.l={from:t,to:n,d:1,l:null,r:null},Rn(e);if(0<z(t,e.to))return r?Pn(r,t,n):e.r={from:t,to:n,d:1,l:null,r:null},Rn(e);z(t,e.from)<0&&(e.from=t,e.l=null,e.d=r?r.d+1:1),0<z(n,e.to)&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1),n=!e.r,i&&!e.l&&Fn(e,i),r&&n&&Fn(e,r)}}function Fn(e,t){Mn(t)||function e(t,n){var r=n.from,i=n.to,a=n.l,n=n.r;Pn(t,r,i),a&&e(t,a),n&&e(t,n)}(e,t)}function In(e,t){var n=Ln(t),r=n.next();if(r.done)return!1;for(var i=r.value,a=Ln(e),o=a.next(i.from),s=o.value;!r.done&&!o.done;){if(z(s.from,i.to)<=0&&0<=z(s.to,i.from))return!0;z(i.from,s.from)<0?i=(r=n.next(s.from)).value:s=(o=a.next(i.from)).value}return!1}function Ln(e){var t=Mn(e)?null:{s:0,n:e};return{next:function(e){for(var n=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&z(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||z(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function Rn(e){var n,r,i=((n=e.r)?.d||0)-((r=e.l)?.d||0),a=1<i?`r`:i<-1?`l`:``;a&&(n=a==`r`?`l`:`r`,r=t({},e),i=e[a],e.from=i.from,e.to=i.to,e[a]=i[a],r[a]=i[n],(e[n]=r).d=zn(r)),e.d=zn(e)}function zn(e){var t=e.r,e=e.l;return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}function Bn(e,t){return i(t).forEach(function(n){e[n]?Fn(e[n],t[n]):e[n]=function e(t){var n,r,i={};for(n in t)l(t,n)&&(r=t[n],i[n]=!r||typeof r!=`object`||E.has(r.constructor)?r:e(r));return i}(t[n])}),e}function Vn(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&In(t[n],e[n])})}u(Nn.prototype,((oe={add:function(e){return Fn(this,e),this},addKey:function(e){return Pn(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(e){return Pn(t,e,e)}),this},hasKey:function(e){var t=Ln(this).next(e).value;return t&&z(t.from,e)<=0&&0<=z(t.to,e)}})[te]=function(){return Ln(this)},oe));var Hn={},Un={},Wn=!1;function Gn(e){Bn(Un,e),Wn||(Wn=!0,setTimeout(function(){Wn=!1,Kn(Un,!(Un={}))},0))}function Kn(e,t){t===void 0&&(t=!1);var n=new Set;if(e.all)for(var r=0,i=Object.values(Hn);r<i.length;r++)qn(o=i[r],e,n,t);else for(var a in e){var o,s=/^idb\:\/\/(.*)\/(.*)\//.exec(a);s&&(a=s[1],s=s[2],(o=Hn[`idb://${a}/${s}`])&&qn(o,e,n,t))}n.forEach(function(e){return e()})}function qn(e,t,n,r){for(var i=[],a=0,o=Object.entries(e.queries.query);a<o.length;a++){for(var s=o[a],c=s[0],l=[],u=0,d=s[1];u<d.length;u++){var f=d[u];Vn(t,f.obsSet)?f.subscribers.forEach(function(e){return n.add(e)}):r&&l.push(f)}r&&i.push([c,l])}if(r)for(var p=0,m=i;p<m.length;p++){var h=m[p],c=h[0],l=h[1];e.queries.query[c]=l}}function Jn(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?dt(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,a=Math.round(10*e.verno),o=!1;function s(){if(t.openCanceller!==r)throw new N.DatabaseClosed(`db.open() was cancelled`)}function c(){return new L(function(r,l){if(s(),!n)throw new N.MissingAPI;var u=e.name,p=t.autoSchema||!a?n.open(u):n.open(u,a);if(!p)throw new N.MissingAPI;p.onerror=Xt(l),p.onblocked=R(e._fireOnBlocked),p.onupgradeneeded=R(function(r){var i;d=p.transaction,t.autoSchema&&!e._options.allowEmptyDB?(p.onerror=Zt,d.abort(),p.result.close(),(i=n.deleteDatabase(u)).onsuccess=i.onerror=R(function(){l(new N.NoSuchDatabase(`Database ${u} doesnt exist`))})):(d.onerror=Xt(l),r=r.oldVersion>2**62?0:r.oldVersion,f=r<1,e.idbdb=p.result,o&&yn(e,d),vn(e,r/10,d,l))},l),p.onsuccess=R(function(){d=null;var n,s,l,m,h,_=e.idbdb=p.result,v=g(_.objectStoreNames);if(0<v.length)try{var y=_.transaction((m=v).length===1?m[0]:m,`readonly`);if(t.autoSchema)s=_,l=y,(n=e).verno=s.version/10,l=n._dbSchema=wn(0,s,l),n._storeNames=g(s.objectStoreNames,0),hn(n,[n._allTables],i(l),l);else if(Tn(e,e._dbSchema,y),((h=bn(wn(0,(h=e).idbdb,y),h._dbSchema)).add.length||h.change.some(function(e){return e.add.length||e.change.length}))&&!o)return console.warn(`Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this.`),_.close(),a=_.version+1,o=!0,r(c());mn(e,y)}catch{}ht.push(e),_.onversionchange=R(function(n){t.vcFired=!0,e.on(`versionchange`).fire(n)}),_.onclose=R(function(t){e.on(`close`).fire(t)}),f&&(h=e._deps,y=u,_=h.indexedDB,h=h.IDBKeyRange,An(_)||y===gt||kn(_,h).put({name:y}).catch(F)),r()},l)}).catch(function(e){switch(e?.name){case`UnknownError`:if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn(`Dexie: Workaround for Chrome UnknownError on open()`),c();break;case`VersionError`:if(0<a)return a=0,c()}return L.reject(e)})}var l,u=t.dbReadyResolve,d=null,f=!1;return L.race([r,(typeof navigator>`u`?L.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){function t(){return indexedDB.databases().finally(e)}l=setInterval(t,100),t()}).finally(function(){return clearInterval(l)}):Promise.resolve()).then(c)]).then(function(){return s(),t.onReadyBeingFired=[],L.resolve(jn(function(){return e.on.ready.fire(e.vip)})).then(function n(){if(0<t.onReadyBeingFired.length){var r=t.onReadyBeingFired.reduce(xe,F);return t.onReadyBeingFired=[],L.resolve(jn(function(){return r(e.vip)})).then(n)}})}).finally(function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(n){t.dbOpenError=n;try{d&&d.abort()}catch{}return r===t.openCanceller&&e._close(),dt(n)}).finally(function(){t.openComplete=!0,u()}).then(function(){var t;return f&&(t={},e.tables.forEach(function(n){n.schema.indexes.forEach(function(r){r.name&&(t[`idb://${e.name}/${n.name}/${r.name}`]=new Nn(-1/0,[[[]]]))}),t[`idb://${e.name}/${n.name}/`]=t[`idb://${e.name}/${n.name}/:dels`]=new Nn(-1/0,[[[]]])}),en(Qt).fire(t),Kn(t,!0)),e})}function Yn(e){function t(t){return e.next(t)}var n=i(t),r=i(function(t){return e.throw(t)});function i(e){return function(t){var i=e(t),t=i.value;return i.done?t:t&&typeof t.then==`function`?t.then(n,r):a(t)?Promise.all(t).then(n,r):n(t)}}return i(t)()}function Xn(e,t,n){for(var r=a(e)?e.slice():[e],i=0;i<n;++i)r.push(t);return r}var Zn={stack:`dbcore`,name:`VirtualIndexMiddleware`,level:1,create:function(e){return t(t({},e),{table:function(n){var r=e.table(n),i=r.schema,a={},o=[];function s(e,n,r){var i=dn(e),c=a[i]=a[i]||[],l=e==null?0:typeof e==`string`?1:e.length,u=0<n,u=t(t({},r),{name:u?`${i}(virtual-from:${r.name})`:r.name,lowLevelIndex:r,isVirtual:u,keyTail:n,keyLength:l,extractKey:cn(e),unique:!u&&r.unique});return c.push(u),u.isPrimaryKey||o.push(u),1<l&&s(l===2?e[0]:e.slice(0,l-1),n+1,r),c.sort(function(e,t){return e.keyTail-t.keyTail}),u}n=s(i.primaryKey.keyPath,0,i.primaryKey),a[`:id`]=[n];for(var c=0,l=i.indexes;c<l.length;c++){var u=l[c];s(u.keyPath,0,u)}function d(n){var r,i=n.query.index;return i.isVirtual?t(t({},n),{query:{index:i.lowLevelIndex,range:(r=n.query.range,i=i.keyTail,{type:r.type===1?2:r.type,lower:Xn(r.lower,r.lowerOpen?e.MAX_KEY:e.MIN_KEY,i),lowerOpen:!0,upper:Xn(r.upper,r.upperOpen?e.MIN_KEY:e.MAX_KEY,i),upperOpen:!0})}}):n}return t(t({},r),{schema:t(t({},i),{primaryKey:n,indexes:o,getIndexByKeyPath:function(e){return(e=a[dn(e)])&&e[0]}}),count:function(e){return r.count(d(e))},query:function(e){return r.query(d(e))},openCursor:function(t){var n=t.query.index,i=n.keyTail,a=n.isVirtual,o=n.keyLength;return a?r.openCursor(d(t)).then(function(e){return e&&s(e)}):r.openCursor(t);function s(n){return Object.create(n,{continue:{value:function(r){r==null?t.unique?n.continue(n.key.slice(0,o).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,i)):n.continue():n.continue(Xn(r,t.reverse?e.MAX_KEY:e.MIN_KEY,i))}},continuePrimaryKey:{value:function(t,r){n.continuePrimaryKey(Xn(t,e.MAX_KEY,i),r)}},primaryKey:{get:function(){return n.primaryKey}},key:{get:function(){var e=n.key;return o===1?e[0]:e.slice(0,o)}},value:{get:function(){return n.value}}})}}})}})}};function Qn(e,t,n,r){return n||={},r||=``,i(e).forEach(function(i){var a,o,s;l(t,i)?(a=e[i],o=t[i],typeof a==`object`&&typeof o==`object`&&a&&o?(s=k(a))===k(o)?s===`Object`?Qn(a,o,n,r+i+`.`):a!==o&&(n[r+i]=t[i]):n[r+i]=t[i]:a!==o&&(n[r+i]=t[i])):n[r+i]=void 0}),i(t).forEach(function(i){l(e,i)||(n[r+i]=t[i])}),n}function $n(e,t){return t.type===`delete`?t.keys:t.keys||t.values.map(e.extractKey)}var er={stack:`dbcore`,name:`HooksMiddleware`,level:2,create:function(e){return t(t({},e),{table:function(r){var i=e.table(r),a=i.schema.primaryKey;return t(t({},i),{mutate:function(e){var o=I.trans,s=o.table(r).hook,c=s.deleting,u=s.creating,d=s.updating;switch(e.type){case`add`:if(u.fire===F)break;return o._promise(`readwrite`,function(){return f(e)},!0);case`put`:if(u.fire===F&&d.fire===F)break;return o._promise(`readwrite`,function(){return f(e)},!0);case`delete`:if(c.fire===F)break;return o._promise(`readwrite`,function(){return f(e)},!0);case`deleteRange`:if(c.fire===F)break;return o._promise(`readwrite`,function(){return function e(n,r,o){return i.query({trans:n,values:!1,query:{index:a,range:r},limit:o}).then(function(i){var a=i.result;return f({type:`delete`,keys:a,trans:n}).then(function(i){return 0<i.numFailures?Promise.reject(i.failures[0]):a.length<o?{failures:[],numFailures:0,lastResult:void 0}:e(n,t(t({},r),{lower:a[a.length-1],lowerOpen:!0}),o)})})}(e.trans,e.range,1e4)},!0)}return i.mutate(e);function f(e){var r,o,s,f=I.trans,p=e.keys||$n(a,e);if(!p)throw Error(`Keys missing`);return(e=e.type===`add`||e.type===`put`?t(t({},e),{keys:p}):t({},e)).type!==`delete`&&(e.values=n([],e.values,!0)),e.keys&&=n([],e.keys,!0),r=i,s=p,((o=e).type===`add`?Promise.resolve([]):r.getMany({trans:o.trans,keys:s,cache:`immutable`})).then(function(t){var n=p.map(function(n,r){var i,o,s,p=t[r],m={onerror:null,onsuccess:null};return e.type===`delete`?c.fire.call(m,n,p,f):e.type===`add`||p===void 0?(i=u.fire.call(m,n,e.values[r],f),n==null&&i!=null&&(e.keys[r]=n=i,a.outbound||x(e.values[r],a.keyPath,n))):(i=Qn(p,e.values[r]),(o=d.fire.call(m,i,n,p,f))&&(s=e.values[r],Object.keys(o).forEach(function(e){l(s,e)?s[e]=o[e]:x(s,e,o[e])}))),m});return i.mutate(e).then(function(r){for(var i=r.failures,a=r.results,o=r.numFailures,r=r.lastResult,s=0;s<p.length;++s){var c=(a||p)[s],l=n[s];c==null?l.onerror&&l.onerror(i[s]):l.onsuccess&&l.onsuccess(e.type===`put`&&t[s]?e.values[s]:c)}return{failures:i,results:a,numFailures:o,lastResult:r}}).catch(function(e){return n.forEach(function(t){return t.onerror&&t.onerror(e)}),Promise.reject(e)})})}}})}})}};function tr(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var r=[],i=0,a=0;i<t.keys.length&&a<e.length;++i)z(t.keys[i],e[a])===0&&(r.push(n?O(t.values[i]):t.values[i]),++a);return r.length===e.length?r:null}catch{return null}}var nr={stack:`dbcore`,level:-1,create:function(e){return{table:function(n){var r=e.table(n);return t(t({},r),{getMany:function(e){if(!e.cache)return r.getMany(e);var t=tr(e.keys,e.trans._cache,e.cache===`clone`);return t?L.resolve(t):r.getMany(e).then(function(t){return e.trans._cache={keys:e.keys,values:e.cache===`clone`?O(t):t},t})},mutate:function(e){return e.type!==`add`&&(e.trans._cache=null),r.mutate(e)}})}}}};function rr(e,t){return e.trans.mode===`readonly`&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!==`disabled`&&!t.schema.primaryKey.outbound}function ir(e,t){switch(e){case`query`:return t.values&&!t.unique;case`get`:case`getMany`:case`count`:case`openCursor`:return!1}}var ar={stack:`dbcore`,level:0,name:`Observability`,create:function(e){var n=e.schema.name,r=new Nn(e.MIN_KEY,e.MAX_KEY);return t(t({},e),{transaction:function(t,n,r){if(I.subscr&&n!==`readonly`)throw new N.ReadOnly(`Readwrite transaction in liveQuery context. Querier source: ${I.querier}`);return e.transaction(t,n,r)},table:function(o){var s=e.table(o),c=s.schema,l=c.primaryKey,u=c.indexes,d=l.extractKey,f=l.outbound,p=l.autoIncrement&&u.filter(function(e){return e.compound&&e.keyPath.includes(l.keyPath)}),m=t(t({},s),{mutate:function(t){function i(e){return e=`idb://${n}/${o}/${e}`,h[e]||(h[e]=new Nn)}var u,d,f,m=t.trans,h=t.mutatedParts||={},g=i(``),_=i(`:dels`),v=t.type,y=t.type===`deleteRange`?[t.range]:t.type===`delete`?[t.keys]:t.values.length<50?[$n(l,t).filter(function(e){return e}),t.values]:[],b=y[0],x=y[1],y=t.trans._cache;return a(b)?(g.addKeys(b),(y=v===`delete`||b.length===x.length?tr(b,y):null)||_.addKeys(b),(y||x)&&(u=i,d=y,f=x,c.indexes.forEach(function(e){var t=u(e.name||``);function n(t){return t==null?null:e.extractKey(t)}function r(n){return e.multiEntry&&a(n)?n.forEach(function(e){return t.addKey(e)}):t.addKey(n)}(d||f).forEach(function(e,t){var i=d&&n(d[t]),t=f&&n(f[t]);z(i,t)!==0&&(i!=null&&r(i),t!=null&&r(t))})}))):b?(x={from:(x=b.lower)??e.MIN_KEY,to:(x=b.upper)??e.MAX_KEY},_.add(x),g.add(x)):(g.add(r),_.add(r),c.indexes.forEach(function(e){return i(e.name).add(r)})),s.mutate(t).then(function(e){return!b||t.type!==`add`&&t.type!==`put`||(g.addKeys(e.results),p&&p.forEach(function(n){for(var r=t.values.map(function(e){return n.extractKey(e)}),a=n.keyPath.findIndex(function(e){return e===l.keyPath}),o=0,s=e.results.length;o<s;++o)r[o][a]=e.results[o];i(n.name).addKeys(r)})),m.mutatedParts=Bn(m.mutatedParts||{},h),e})}}),u=function(t){var n=t.query,t=n.index,n=n.range;return[t,new Nn((t=n.lower)??e.MIN_KEY,(n=n.upper)??e.MAX_KEY)]},h={get:function(e){return[l,new Nn(e.key)]},getMany:function(e){return[l,new Nn().addKeys(e.keys)]},count:u,query:u,openCursor:u};return i(h).forEach(function(e){m[e]=function(i){var a=I.subscr,c=!!a,l=rr(I,s)&&ir(e,i)?i.obsSet={}:a;if(c){var u=function(e){return e=`idb://${n}/${o}/${e}`,l[e]||(l[e]=new Nn)},p=u(``),m=u(`:dels`),a=h[e](i),c=a[0],a=a[1];if((e===`query`&&c.isPrimaryKey&&!i.values?m:u(c.name||``)).add(a),!c.isPrimaryKey){if(e!==`count`){var g=e===`query`&&f&&i.values&&s.query(t(t({},i),{values:!1}));return s[e].apply(this,arguments).then(function(t){if(e===`query`){if(f&&i.values)return g.then(function(e){return e=e.result,p.addKeys(e),t});var n=i.values?t.result.map(d):t.result;(i.values?p:m).addKeys(n)}else if(e===`openCursor`){var r=t,a=i.values;return r&&Object.create(r,{key:{get:function(){return m.addKey(r.primaryKey),r.key}},primaryKey:{get:function(){var e=r.primaryKey;return m.addKey(e),e}},value:{get:function(){return a&&p.addKey(r.primaryKey),r.value}}})}return t})}m.add(r)}}return s[e].apply(this,arguments)}}),m}})}};function or(e,n,r){if(r.numFailures===0)return n;if(n.type===`deleteRange`)return null;var i=n.keys?n.keys.length:`values`in n&&n.values?n.values.length:1;return r.numFailures===i?null:(n=t({},n),a(n.keys)&&(n.keys=n.keys.filter(function(e,t){return!(t in r.failures)})),`values`in n&&a(n.values)&&(n.values=n.values.filter(function(e,t){return!(t in r.failures)})),n)}function sr(e,t){return n=e,((r=t).lower===void 0||(r.lowerOpen?0<z(n,r.lower):0<=z(n,r.lower)))&&(e=e,(t=t).upper===void 0||(t.upperOpen?z(e,t.upper)<0:z(e,t.upper)<=0));var n,r}function cr(e,t,n,r,i,o){if(!n||n.length===0)return e;var s=t.query.index,c=s.multiEntry,l=t.query.range,u=r.schema.primaryKey.extractKey,d=s.extractKey,f=(s.lowLevelIndex||s).extractKey,n=n.reduce(function(e,n){var r=e,i=[];if(n.type===`add`||n.type===`put`)for(var o=new Nn,s=n.values.length-1;0<=s;--s){var f,p=n.values[s],m=u(p);o.hasKey(m)||(f=d(p),(c&&a(f)?f.some(function(e){return sr(e,l)}):sr(f,l))&&(o.addKey(m),i.push(p)))}switch(n.type){case`add`:var h=new Nn().addKeys(t.values?e.map(function(e){return u(e)}):e),r=e.concat(t.values?i.filter(function(e){return e=u(e),!h.hasKey(e)&&(h.addKey(e),!0)}):i.map(function(e){return u(e)}).filter(function(e){return!h.hasKey(e)&&(h.addKey(e),!0)}));break;case`put`:var g=new Nn().addKeys(n.values.map(function(e){return u(e)}));r=e.filter(function(e){return!g.hasKey(t.values?u(e):e)}).concat(t.values?i:i.map(function(e){return u(e)}));break;case`delete`:var _=new Nn().addKeys(n.keys);r=e.filter(function(e){return!_.hasKey(t.values?u(e):e)});break;case`deleteRange`:var v=n.range;r=e.filter(function(e){return!sr(u(e),v)})}return r},e);return n===e?e:(n.sort(function(e,t){return z(f(e),f(t))||z(u(e),u(t))}),t.limit&&t.limit<1/0&&(n.length>t.limit?n.length=t.limit:e.length===t.limit&&n.length<t.limit&&(i.dirty=!0)),o?Object.freeze(n):n)}function lr(e,t){return z(e.lower,t.lower)===0&&z(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function ur(e,t){return function(e,t,n,r){if(e===void 0)return t===void 0?0:-1;if(t===void 0)return 1;if((t=z(e,t))===0){if(n&&r)return 0;if(n)return 1;if(r)return-1}return t}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=function(e,t,n,r){if(e===void 0)return t===void 0?0:1;if(t===void 0)return-1;if((t=z(e,t))===0){if(n&&r)return 0;if(n)return-1;if(r)return 1}return t}(e.upper,t.upper,e.upperOpen,t.upperOpen)}function dr(e,t,n,r){e.subscribers.add(n),r.addEventListener(`abort`,function(){var r,i;e.subscribers.delete(n),e.subscribers.size===0&&(r=e,i=t,setTimeout(function(){r.subscribers.size===0&&re(i,r)},3e3))})}var fr={stack:`dbcore`,level:0,name:`Cache`,create:function(e){var n=e.schema.name;return t(t({},e),{transaction:function(t,r,i){var a,o,s=e.transaction(t,r,i);return r===`readwrite`&&(o=(a=new AbortController).signal,i=function(i){return function(){if(a.abort(),r===`readwrite`){for(var o=new Set,c=0,l=t;c<l.length;c++){var u=l[c],d=Hn[`idb://${n}/${u}`];if(d){var f=e.table(u),p=d.optimisticOps.filter(function(e){return e.trans===s});if(s._explicit&&i&&s.mutatedParts)for(var m=0,h=Object.values(d.queries.query);m<h.length;m++)for(var g=0,_=(b=h[m]).slice();g<_.length;g++)Vn((x=_[g]).obsSet,s.mutatedParts)&&(re(b,x),x.subscribers.forEach(function(e){return o.add(e)}));else if(0<p.length){d.optimisticOps=d.optimisticOps.filter(function(e){return e.trans!==s});for(var v=0,y=Object.values(d.queries.query);v<y.length;v++)for(var b,x,S,C=0,w=(b=y[v]).slice();C<w.length;C++)(x=w[C]).res!=null&&s.mutatedParts&&(i&&!x.dirty?(S=Object.isFrozen(x.res),S=cr(x.res,x.req,p,f,x,S),x.dirty?(re(b,x),x.subscribers.forEach(function(e){return o.add(e)})):S!==x.res&&(x.res=S,x.promise=L.resolve({result:S}))):(x.dirty&&re(b,x),x.subscribers.forEach(function(e){return o.add(e)})))}}}o.forEach(function(e){return e()})}}},s.addEventListener(`abort`,i(!1),{signal:o}),s.addEventListener(`error`,i(!1),{signal:o}),s.addEventListener(`complete`,i(!0),{signal:o})),s},table:function(r){var i=e.table(r),a=i.schema.primaryKey;return t(t({},i),{mutate:function(e){var o=I.trans;if(a.outbound||o.db._options.cache===`disabled`||o.explicit||o.idbtrans.mode!==`readwrite`)return i.mutate(e);var s=Hn[`idb://${n}/${r}`];return s?(o=i.mutate(e),e.type!==`add`&&e.type!==`put`||!(50<=e.values.length||$n(a,e).some(function(e){return e==null}))?(s.optimisticOps.push(e),e.mutatedParts&&Gn(e.mutatedParts),o.then(function(t){0<t.numFailures&&(re(s.optimisticOps,e),(t=or(0,e,t))&&s.optimisticOps.push(t),e.mutatedParts&&Gn(e.mutatedParts))}),o.catch(function(){re(s.optimisticOps,e),e.mutatedParts&&Gn(e.mutatedParts)})):o.then(function(n){var r=or(0,t(t({},e),{values:e.values.map(function(e,r){var i;return n.failures[r]?e:(e=(i=a.keyPath)!=null&&i.includes(`.`)?O(e):t({},e),x(e,a.keyPath,n.results[r]),e)})}),n);s.optimisticOps.push(r),queueMicrotask(function(){return e.mutatedParts&&Gn(e.mutatedParts)})}),o):i.mutate(e)},query:function(e){if(!rr(I,i)||!ir(`query`,e))return i.query(e);var t=(c=I.trans)?.db._options.cache===`immutable`,a=I,o=a.requery,s=a.signal,c=function(e,t,n,r){var i=Hn[`idb://${e}/${t}`];if(!i)return[];if(!(t=i.queries[n]))return[null,!1,i,null];var a=t[(r.query?r.query.index.name:null)||``];if(!a)return[null,!1,i,null];switch(n){case`query`:var o=a.find(function(e){return e.req.limit===r.limit&&e.req.values===r.values&&lr(e.req.query.range,r.query.range)});return o?[o,!0,i,a]:[a.find(function(e){return(`limit`in e.req?e.req.limit:1/0)>=r.limit&&(!r.values||e.req.values)&&ur(e.req.query.range,r.query.range)}),!1,i,a];case`count`:return o=a.find(function(e){return lr(e.req.query.range,r.query.range)}),[o,!!o,i,a]}}(n,r,`query`,e),l=c[0],a=c[1],u=c[2],d=c[3];return l&&a?l.obsSet=e.obsSet:(a=i.query(e).then(function(e){var n=e.result;if(l&&(l.res=n),t){for(var r=0,i=n.length;r<i;++r)Object.freeze(n[r]);Object.freeze(n)}else e.result=O(n);return e}).catch(function(e){return d&&l&&re(d,l),Promise.reject(e)}),l={obsSet:e.obsSet,promise:a,subscribers:new Set,type:`query`,req:e,dirty:!1},d?d.push(l):(d=[l],(u||=Hn[`idb://${n}/${r}`]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}}).queries.query[e.query.index.name||``]=d)),dr(l,d,o,s),l.promise.then(function(n){return{result:cr(n.result,e,u?.optimisticOps,i,l,t)}})}})}})}};function pr(e,t){return new Proxy(e,{get:function(e,n,r){return n===`db`?t:Reflect.get(e,n,r)}})}var mr=(hr.prototype.version=function(e){if(isNaN(e)||e<.1)throw new N.Type(`Given version is not a positive number`);if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new N.Schema(`Cannot add version when database is open`);this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(t){return t._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(_n),n.stores({}),this._state.autoSchema=!1,n)},hr.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||I.letThrough||this._vip)?e():new L(function(e,n){if(t._state.openComplete)return n(new N.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void n(new N.DatabaseClosed);t.open().catch(F)}t._state.dbReadyPromise.then(e,n)}).then(e)},hr.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,i=e.name;return i&&this.unuse({stack:t,name:i}),e=this._middlewares[t]||(this._middlewares[t]=[]),e.push({stack:t,create:n,level:r??10,name:i}),e.sort(function(e,t){return e.level-t.level}),this},hr.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(e){return r?e.create!==r:!!n&&e.name!==n})),this},hr.prototype.open=function(){var e=this;return ct(Pe,function(){return Jn(e)})},hr.prototype._close=function(){this.on.close.fire(new CustomEvent(`close`));var e=this._state,t=ht.indexOf(this);if(0<=t&&ht.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new L(function(t){e.dbReadyResolve=t}),e.openCanceller=new L(function(t,n){e.cancelOpen=n}))},hr.prototype.close=function(e){var t=(e===void 0?{disableAutoOpen:!0}:e).disableAutoOpen,e=this._state;t?(e.isBeingOpened&&e.cancelOpen(new N.DatabaseClosed),this._close(),e.autoOpen=!1,e.dbOpenError=new N.DatabaseClosed):(this._close(),e.autoOpen=this._options.autoOpen||e.isBeingOpened,e.openComplete=!1,e.dbOpenError=null)},hr.prototype.delete=function(e){var t=this;e===void 0&&(e={disableAutoOpen:!0});var n=0<arguments.length&&typeof arguments[0]!=`object`,r=this._state;return new L(function(i,a){function o(){t.close(e);var n=t._deps.indexedDB.deleteDatabase(t.name);n.onsuccess=R(function(){var e=t._deps,n=t.name,r=e.indexedDB;e=e.IDBKeyRange,An(r)||n===gt||kn(r,e).delete(n).catch(F),i()}),n.onerror=Xt(a),n.onblocked=t._fireOnBlocked}if(n)throw new N.InvalidArgument(`Invalid closeOptions argument to db.delete()`);r.isBeingOpened?r.dbReadyPromise.then(o):o()})},hr.prototype.backendDB=function(){return this.idbdb},hr.prototype.isOpen=function(){return this.idbdb!==null},hr.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name===`DatabaseClosed`},hr.prototype.hasFailed=function(){return this._state.dbOpenError!==null},hr.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(hr.prototype,`tables`,{get:function(){var e=this;return i(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),hr.prototype.transaction=function(){var e=function(e,t,n){var r=arguments.length;if(r<2)throw new N.InvalidArgument(`Too few arguments`);for(var i=Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[e,w(i),n]}.apply(this,arguments);return this._transaction.apply(this,e)},hr.prototype._transaction=function(e,t,n){var r=this,i=I.trans;i&&i.db===this&&e.indexOf(`!`)===-1||(i=null);var a,o,s=e.indexOf(`?`)!==-1;e=e.replace(`!`,``).replace(`?`,``);try{if(o=t.map(function(e){if(e=e instanceof r.Table?e.name:e,typeof e!=`string`)throw TypeError(`Invalid table argument to Dexie.transaction(). Only Table or String are allowed`);return e}),e==`r`||e===_t)a=_t;else{if(e!=`rw`&&e!=vt)throw new N.InvalidArgument(`Invalid transaction mode: `+e);a=vt}if(i){if(i.mode===_t&&a===vt){if(!s)throw new N.SubTransaction(`Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY`);i=null}i&&o.forEach(function(e){if(i&&i.storeNames.indexOf(e)===-1){if(!s)throw new N.SubTransaction(`Table `+e+` not included in parent transaction.`);i=null}}),s&&i&&!i.active&&(i=null)}}catch(e){return i?i._promise(null,function(t,n){n(e)}):dt(e)}var c=function e(t,n,r,i,a){return L.resolve().then(function(){var o=I.transless||I,s=t._createTransaction(n,r,t._dbSchema,i);if(s.explicit=!0,o={trans:s,transless:o},i)s.idbtrans=i.idbtrans;else try{s.create(),s.idbtrans._explicit=!0,t._state.PR1398_maxLoop=3}catch(i){return i.name===de.InvalidState&&t.isOpen()&&0<--t._state.PR1398_maxLoop?(console.warn(`Dexie: Need to reopen db`),t.close({disableAutoOpen:!1}),t.open().then(function(){return e(t,n,r,null,a)})):dt(i)}var c,l=A(a);return l&&nt(),o=L.follow(function(){var e;(c=a.call(s,s))&&(l?(e=rt.bind(null,null),c.then(e,e)):typeof c.next==`function`&&typeof c.throw==`function`&&(c=Yn(c)))},o),(c&&typeof c.then==`function`?L.resolve(c).then(function(e){return s.active?e:dt(new N.PrematureCommit(`Transaction committed too early. See http://bit.ly/2kdckMn`))}):o.then(function(){return c})).then(function(e){return i&&s._resolve(),s._completion.then(function(){return e})}).catch(function(e){return s._reject(e),dt(e)})})}.bind(null,this,a,o,i,n);return i?i._promise(a,c,`lock`):I.trans?ct(I.transless,function(){return r._whenReady(c)}):this._whenReady(c)},hr.prototype.table=function(e){if(!l(this._allTables,e))throw new N.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]},hr);function hr(e,n){var r=this;this._middlewares={},this.verno=0;var i=hr.dependencies;this._options=n=t({addons:hr.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange,cache:`cloned`},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange},i=n.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var a,o,s,c,l,u={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:F,dbReadyPromise:null,cancelOpen:F,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:n.autoOpen};u.dbReadyPromise=new L(function(e){u.dbReadyResolve=e}),u.openCanceller=new L(function(e,t){u.cancelOpen=t}),this._state=u,this.name=e,this.on=Ot(this,`populate`,`blocked`,`versionchange`,`close`,{ready:[xe,F]}),this.once=function(e,t){var n=function(){var i=[...arguments];r.on(e).unsubscribe(n),t.apply(r,i)};return r.on(e,n)},this.on.ready.subscribe=_(this.on.ready.subscribe,function(e){return function(t,n){hr.vip(function(){var i,a=r._state;a.openComplete?(a.dbOpenError||L.resolve().then(t),n&&e(t)):a.onReadyBeingFired?(a.onReadyBeingFired.push(t),n&&e(t)):(e(t),i=r,n||e(function e(){i.on.ready.unsubscribe(t),i.on.ready.unsubscribe(e)}))})}}),this.Collection=(a=this,kt(zt.prototype,function(e,t){this.db=a;var n=bt,r=null;if(t)try{n=t()}catch(e){r=e}var i=e._ctx,t=i.table,e=t.hook.reading.fire;this._ctx={table:t,index:i.index,isPrimKey:!i.index||t.schema.primKey.keyPath&&i.index===t.schema.primKey.name,range:n,keysOnly:!1,dir:`next`,unique:``,algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:e===me?null:e}})),this.Table=(o=this,kt(Et.prototype,function(e,t,n){this.db=o,this._tx=n,this.name=e,this.schema=t,this.hook=o._allTables[e]?o._allTables[e].hook:Ot(null,{creating:[_e,F],reading:[he,me],updating:[ye,F],deleting:[ve,F]})})),this.Transaction=(s=this,kt(tn.prototype,function(e,t,n,r,i){var a=this;e!==`readonly`&&t.forEach(function(e){e=(e=n[e])?.yProps,e&&(t=t.concat(e.map(function(e){return e.updatesTable})))}),this.db=s,this.mode=e,this.storeNames=t,this.schema=n,this.chromeTransactionDurability=r,this.idbtrans=null,this.on=Ot(this,`complete`,`error`,`abort`),this.parent=i||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new L(function(e,t){a._resolve=e,a._reject=t}),this._completion.then(function(){a.active=!1,a.on.complete.fire()},function(e){var t=a.active;return a.active=!1,a.on.error.fire(e),a.parent?a.parent._reject(e):t&&a.idbtrans&&a.idbtrans.abort(),dt(e)})})),this.Version=(c=this,kt(Dn.prototype,function(e){this.db=c,this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(l=this,kt(Jt.prototype,function(e,t,n){if(this.db=l,this._ctx={table:e,index:t===`:id`?null:t,or:n},this._cmp=this._ascending=z,this._descending=function(e,t){return z(t,e)},this._max=function(e,t){return 0<z(e,t)?e:t},this._min=function(e,t){return z(e,t)<0?e:t},this._IDBKeyRange=l._deps.IDBKeyRange,!this._IDBKeyRange)throw new N.MissingAPI})),this.on(`versionchange`,function(e){0<e.newVersion?console.warn(`Another connection wants to upgrade database '${r.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${r.name}'. Closing db now to resume the delete request.`),r.close({disableAutoOpen:!1})}),this.on(`blocked`,function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn(`Dexie.delete('${r.name}') was blocked`):console.warn(`Upgrade '${r.name}' blocked by other connection holding version ${e.oldVersion/10}`)}),this._maxKey=sn(n.IDBKeyRange),this._createTransaction=function(e,t,n,i){return new r.Transaction(e,t,n,r._options.chromeTransactionDurability,i)},this._fireOnBlocked=function(e){r.on(`blocked`).fire(e),ht.filter(function(e){return e.name===r.name&&e!==r&&!e._state.vcFired}).map(function(t){return t.on(`versionchange`).fire(e)})},this.use(nr),this.use(fr),this.use(ar),this.use(Zn),this.use(er);var d=new Proxy(this,{get:function(e,t,n){if(t===`_vip`)return!0;if(t===`table`)return function(e){return pr(r.table(e),d)};var i=Reflect.get(e,t,n);return i instanceof Et?pr(i,d):t===`tables`?i.map(function(e){return pr(e,d)}):t===`_createTransaction`?function(){return pr(i.apply(this,arguments),d)}:i}});this.vip=d,i.forEach(function(e){return e(r)})}var gr,oe=typeof Symbol<`u`&&`observable`in Symbol?Symbol.observable:`@@observable`,_r=(vr.prototype.subscribe=function(e,t,n){return this._subscribe(e&&typeof e!=`function`?e:{next:e,error:t,complete:n})},vr.prototype[oe]=function(){return this},vr);function vr(e){this._subscribe=e}try{gr={indexedDB:r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB,IDBKeyRange:r.IDBKeyRange||r.webkitIDBKeyRange}}catch{gr={indexedDB:null,IDBKeyRange:null}}function yr(e){var t,n=!1,r=new _r(function(r){var i=A(e),a,o=!1,s={},c={},u={get closed(){return o},unsubscribe:function(){o||(o=!0,a&&a.abort(),d&&en.storagemutated.unsubscribe(p))}};r.start&&r.start(u);var d=!1,f=function(){return ut(m)},p=function(e){Bn(s,e),Vn(c,s)&&f()},m=function(){var u,m,h;!o&&gr.indexedDB&&(s={},u={},a&&a.abort(),a=new AbortController,h=function(t){var n=Ge();try{i&&nt();var r=tt(e,t);return r=i?r.finally(rt):r}finally{n&&Ke()}}(m={subscr:u,signal:a.signal,requery:f,querier:e,trans:null}),Promise.resolve(h).then(function(e){n=!0,t=e,o||m.signal.aborted||(s={},function(e){for(var t in e)if(l(e,t))return;return 1}(c=u)||d||(en(Qt,p),d=!0),ut(function(){return!o&&r.next&&r.next(e)}))},function(e){n=!1,[`DatabaseClosedError`,`AbortError`].includes(e?.name)||o||ut(function(){o||r.error&&r.error(e)})}))};return setTimeout(f,0),u});return r.hasValue=function(){return n},r.getValue=function(){return t},r}var br=mr;function xr(e){var t=Cr;try{Cr=!0,en.storagemutated.fire(e),Kn(e,!0)}finally{Cr=t}}u(br,t(t({},pe),{delete:function(e){return new br(e,{addons:[]}).delete()},exists:function(e){return new br(e,{addons:[]}).open().then(function(e){return e.close(),!0}).catch(`NoSuchDatabaseError`,function(){return!1})},getDatabaseNames:function(e){try{return t=br.dependencies,n=t.indexedDB,t=t.IDBKeyRange,(An(n)?Promise.resolve(n.databases()).then(function(e){return e.map(function(e){return e.name}).filter(function(e){return e!==gt})}):kn(n,t).toCollection().primaryKeys()).then(e)}catch{return dt(new N.MissingAPI)}var t,n},defineClass:function(){return function(e){o(this,e)}},ignoreTransaction:function(e){return I.trans?ct(I.transless,e):e()},vip:jn,async:function(e){return function(){try{var t=Yn(e.apply(this,arguments));return t&&typeof t.then==`function`?t:L.resolve(t)}catch(e){return dt(e)}}},spawn:function(e,t,n){try{var r=Yn(e.apply(n,t||[]));return r&&typeof r.then==`function`?r:L.resolve(r)}catch(e){return dt(e)}},currentTransaction:{get:function(){return I.trans||null}},waitFor:function(e,t){return t=L.resolve(typeof e==`function`?br.ignoreTransaction(e):e).timeout(t||6e4),I.trans?I.trans.waitFor(t):t},Promise:L,debug:{get:function(){return Se},set:function(e){Ce(e)}},derive:p,extend:o,props:u,override:_,Events:Ot,on:en,liveQuery:yr,extendObservabilitySet:Bn,getByKeyPath:b,setByKeyPath:x,delByKeyPath:function(e,t){typeof t==`string`?x(e,t,void 0):`length`in t&&[].map.call(t,function(t){x(e,t,void 0)})},shallowClone:S,deepClone:O,getObjectDiff:Qn,cmp:z,asap:y,minKey:-1/0,addons:[],connections:ht,errnames:de,dependencies:gr,cache:Hn,semVer:`4.2.0`,version:`4.2.0`.split(`.`).map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/10**(2*n)})})),br.maxKey=sn(br.dependencies.IDBKeyRange),typeof dispatchEvent<`u`&&typeof addEventListener<`u`&&(en(Qt,function(e){Cr||=(e=new CustomEvent($t,{detail:e}),Cr=!0,dispatchEvent(e),!1)}),addEventListener($t,function(e){e=e.detail,Cr||xr(e)}));var Sr,Cr=!1,wr=function(){};return typeof BroadcastChannel<`u`&&((wr=function(){(Sr=new BroadcastChannel($t)).onmessage=function(e){return e.data&&xr(e.data)}})(),typeof Sr.unref==`function`&&Sr.unref(),en(Qt,function(e){Cr||Sr.postMessage(e)})),typeof addEventListener<`u`&&(addEventListener(`pagehide`,function(e){if(!mr.disableBfCache&&e.persisted){Se&&console.debug(`Dexie: handling persisted pagehide`),Sr?.close();for(var t=0,n=ht;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener(`pageshow`,function(e){!mr.disableBfCache&&e.persisted&&(Se&&console.debug(`Dexie: handling persisted pageshow`),wr(),xr({all:new Nn(-1/0,[[]])}))})),L.rejectionMapper=function(e,t){return!e||e instanceof ce||e instanceof TypeError||e instanceof SyntaxError||!e.name||!P[e.name]?e:(t=new P[e.name](t||e.message,e),`stack`in e&&f(t,`stack`,{get:function(){return this.inner.stack}}),t)},Ce(Se),t(mr,Object.freeze({__proto__:null,Dexie:mr,liveQuery:yr,Entity:St,cmp:z,PropModification:Lt,replacePrefix:function(e,t){return new Lt({replacePrefix:[e,t]})},add:function(e){return new Lt({add:e})},remove:function(e){return new Lt({remove:e})},default:mr,RangeSet:Nn,mergeRanges:Fn,rangesOverlap:In}),{default:mr}),mr})}))(),1),O=Symbol.for(`Dexie`),ee=globalThis[O]||(globalThis[O]=D.default);if(D.default.semVer!==ee.semVer)throw Error(`Two different versions of Dexie loaded in the same app: ${D.default.semVer} and ${ee.semVer}`);var{liveQuery:k,mergeRanges:te,rangesOverlap:ne,RangeSet:re,cmp:ie,Entity:ae,PropModification:A,replacePrefix:j,add:oe,remove:se,DexieYProvider:ce}=ee,le=ee,ue,M={supported:!1,persisted:!1,reason:`unknown`};function de(){return{...M}}async function fe({force:e=!1}={}){return!e&&M.persisted?{...M}:(!e&&ue||(ue=(async()=>{if(typeof navigator>`u`)return M={supported:!1,persisted:!1,reason:`no-navigator`},M;let e=navigator.storage,t=typeof e?.persist==`function`,n=typeof e?.persisted==`function`;if(!e||!t&&!n)return M={supported:!1,persisted:!1,reason:`storage-api-missing`},M;try{if(n&&await e.persisted())return M={supported:!0,persisted:!0,reason:`already-persisted`},M;if(!t)return M={supported:!0,persisted:!1,reason:`persist-unsupported`},M;let r=await e.persist();return M={supported:!0,persisted:r===!0,reason:r?`granted`:`denied`},r||console.warn(`WatchTask: el navegador deneg la solicitud de almacenamiento persistente.`),M}catch(e){return console.warn(`WatchTask: no fue posible solicitar almacenamiento persistente.`,e),M={supported:t||n,persisted:!1,reason:`error`,error:e},M}})().finally(()=>{(!M.persisted||e)&&(ue=null)})),ue)}const N=new le(`WatchTaskDB`);N.version(3).stores({users:`&code, name, role, speciality, active`,usersMeta:`&version`,orders:`&code`,ordersMeta:`&version`,publicDB:null,publicDBMeta:null,publicUsersMeta:null,ordersByCode:null}).upgrade(async e=>{await e.table(`usersMeta`).count()===0&&await e.table(`usersMeta`).put({version:1,changeLog:[`${new Date().toISOString()} - init users meta v1`]}),await e.table(`ordersMeta`).count()===0&&await e.table(`ordersMeta`).put({version:1,changeLog:[`${new Date().toISOString()} - init orders meta v1`]});try{let t=e.table(`orders`),n=e.table(`ordersByCode`),r=e.table(`orders`),i=0;if(await n?.count?.()){let e=(await n.toArray()).map(e=>Number.isFinite(e.code)?e:null).filter(Boolean);e.length&&await t.bulkPut(e),i+=e.length}else if(await r?.count?.()){let e=(await r.toArray()).map(e=>{let t=[e.code,e.id,e?.info?.[`Numero orden`],e?.[`Numero orden`],e?.Numero];for(let n of t){let t=Number.parseInt?.(String(n||``).trim(),10);if(Number.isFinite(t))return{...e,code:t}}return null}).filter(Boolean);e.length&&await t.bulkPut(e),i+=e.length}if(i>0){let t=e.table(`ordersMeta`),n=await t.orderBy(`version`).last(),r=n?n.version+1:1,a=n?.changeLog?[...n.changeLog]:[];a.push(`${new Date().toISOString()} - migrated orders to code PK (${i})`),await t.put({version:r,changeLog:a})}}catch{}});var P=e=>{let t=parseInt(String(e).trim(),10);return Number.isFinite(t)?t:void 0},pe=()=>new Date().toISOString();async function F(e){let t=new TextEncoder().encode(e),n=await crypto.subtle.digest(`SHA-256`,t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,`0`)).join(``)}function me(e){let t=e.map(e=>{let{passwordHash:t,...n}=e;return n}).sort((e,t)=>(e.code||0)-(t.code||0));return JSON.stringify(t)}var he=e=>Array.isArray(e)?e.every(e=>Number(e.status)===2)?2:e.some(e=>Number(e.status)===1||Number(e.status)===2)?1:0:0;async function ge(){try{await fe()}catch{}return await N.open(),await N.usersMeta.count()===0&&await N.usersMeta.put({version:1,changeLog:[`${pe()} - init users meta v1`]}),await N.ordersMeta.count()===0&&await N.ordersMeta.put({version:1,changeLog:[`${pe()} - init orders meta v1`]}),N}var _e=`wt-users-changes`,ve=null;function ye(){try{!ve&&`BroadcastChannel`in self&&(ve=new BroadcastChannel(_e))}catch{}return ve}function be(e=`users-updated`){try{let t=new CustomEvent(`users:changed`,{detail:{reason:e,ts:Date.now()}});window.dispatchEvent(t)}catch{}try{ye()?.postMessage?.({type:`users:changed`,reason:e,ts:Date.now()})}catch{}}var xe=`wt-orders-changes`,Se=null;function Ce(){try{!Se&&`BroadcastChannel`in self&&(Se=new BroadcastChannel(xe))}catch{}return Se}function we(e=`orders-updated`){try{let t=new CustomEvent(`orders:changed`,{detail:{reason:e,ts:Date.now()}});window.dispatchEvent(t)}catch{}try{Ce()?.postMessage?.({type:`orders:changed`,reason:e,ts:Date.now()})}catch{}}async function Te(e){let t=await N.usersMeta.orderBy(`version`).last(),n=t?t.version+1:1,r=t?.changeLog?[...t.changeLog]:[];return r.push(`${pe()} - ${e}`),await N.usersMeta.put({version:n,changeLog:r}),n}async function Ee(e){let t=await N.ordersMeta.orderBy(`version`).last(),n=t?t.version+1:1,r=t?.changeLog?[...t.changeLog]:[];return r.push(`${pe()} - ${e}`),await N.ordersMeta.put({version:n,changeLog:r}),n}async function De(){return await ge(),P(``),!1}function Oe(e){let t=0;for(let n=0;n<e.length;n++)t=t*31+e.charCodeAt(n)>>>0;return t.toString(16)}async function ke(){return await ge(),N.users.orderBy(`code`).toArray()}async function Ae({code:e,name:t,role:n,speciality:r=null,active:i=!0,password:a}){await ge();let o=P(e);if(!Number.isFinite(o))throw Error(`code must be an integer`);if(!t||!n)throw Error(`name and role are required`);let s=typeof a==`string`&&a.length?Oe(a):void 0;await N.transaction(`rw`,N.users,N.usersMeta,async()=>{await N.users.put({code:o,name:String(t).trim(),role:n,speciality:r??null,active:!!i,...s?{passwordHash:s}:{}}),await Te(`add user ${o}`)});try{be(`add-user`)}catch{}}async function je(e,t){await ge();let n=P(e),r=await N.users.get(n);if(!r)throw Error(`user not found`);let i={...r,...t};await N.transaction(`rw`,N.users,N.usersMeta,async()=>{await N.users.put(i),await Te(`update user ${n}`)});try{be(`update-user`)}catch{}}async function Me(e){await ge();let t=P(e);await N.transaction(`rw`,N.users,N.usersMeta,async()=>{await N.users.delete(t),await Te(`delete user ${t}`)});try{be(`delete-user`)}catch{}}async function Ne(e){if(await ge(),!Array.isArray(e))return 0;let t=e.map(e=>{let t=[e.code,e?.info?.[`Numero orden`],e?.[`Numero orden`],e?.Numero,e.id];for(let n of t){let t=Number.parseInt?.(String(n||``).trim(),10);if(Number.isFinite(t)){let n={...e,code:t};return n.tasks?.data&&(n.info={...n.info||{},status:he(n.tasks.data)}),n}}return null}).filter(Boolean);t.length&&await N.orders.bulkPut(t),await Ee(`bulk upsert orders (${e.length})`);try{we(`bulk-upsert`)}catch{}return e.length}async function Pe(){return await ge(),N.orders.toArray()}async function I(e){await ge();let t=await N.orders.toArray(),n=P(e);return Number.isFinite(n)?t.filter(e=>{let t=e?.info?.Especialidad_id;return Number.isFinite(t)&&Number(t)===n}):t}async function Fe(e){await ge();let t=await N.orders.toArray(),n=P(e);return Number.isFinite(n)?t.filter(e=>{let t=e?.info?.asignado_a_code;return Number.isFinite(t)&&Number(t)===n}):[]}async function Ie(e){await ge();let t=P(e);return Number.isFinite(t)?N.orders.get(t):null}async function Le(e,t){await ge();let n=P(e),r=Number.parseInt(t,10);if(!Number.isFinite(n))throw Error(`order code must be numeric`);if(!Number.isInteger(r)||r<0)throw Error(`task index must be a non-negative integer`);let i=await N.orders.get(n);if(!i)throw Error(`order not found`);let a=Array.isArray(i?.tasks?.data)?i.tasks.data:null;if(!a||!a[r])throw Error(`task not found`);let o=a[r],s=o?.init_task||new Date().toISOString(),c={...o,init_task:s,status:typeof o?.status==`number`&&o.status>0?o.status:1},l=a.map((e,t)=>t===r?c:{...e}),u={...i,tasks:{...i.tasks||{},data:l}};u.info={...u.info||{},status:he(l)},await N.transaction(`rw`,N.orders,N.ordersMeta,async()=>{await N.orders.put(u),await Ee(`start task ${r+1} order ${n}`)});try{we(`task-started`)}catch{}return{order:u,task:c,index:r}}async function L(e,t,n={}){await ge();let r=P(e),i=Number.parseInt(t,10);if(!Number.isFinite(r))throw Error(`order code must be numeric`);if(!Number.isInteger(i)||i<0)throw Error(`task index must be a non-negative integer`);let a=await N.orders.get(r);if(!a)throw Error(`order not found`);let o=Array.isArray(a?.tasks?.data)?a.tasks.data:null;if(!o||!o[i])throw Error(`task not found`);let s=o[i],c=new Date().toISOString(),l={...s,status:2,completed_at:s?.completed_at??c,accepted_protocol:n.accepted??!0,accepted_at:s?.accepted_at??c};typeof n.obs==`string`&&(l.obs_assigned_to=n.obs),n.medicion!==void 0&&(l.medicion_result=n.medicion),n.rangoDesde!==void 0&&(l.medicion_range_from=n.rangoDesde),n.rangoHasta!==void 0&&(l.medicion_range_to=n.rangoHasta),l.init_task||=c;let u=o.map((e,t)=>t===i?l:{...e}),d={...a,tasks:{...a.tasks||{},data:u}};d.info={...d.info||{},status:he(u)},await N.transaction(`rw`,N.orders,N.ordersMeta,async()=>{await N.orders.put(d),await Ee(`complete task ${i+1} order ${r}`)});try{we(`task-completed`)}catch{}return{order:d,task:l,index:i}}async function Re(e,t){await ge();let n=P(e);if(!Number.isFinite(n))throw Error(`order code must be numeric`);let r=await N.orders.get(n);if(!r)throw Error(`order not found`);let i={...r.info||{},checkListDict:t},a={...r,info:i};await N.transaction(`rw`,N.orders,N.ordersMeta,async()=>{await N.orders.put(a),await Ee(`save checklist order ${n}`)});try{we(`order-checklist-updated`)}catch{}return a}async function ze(e,t){await ge();let n=P(e);if(!Number.isFinite(n))return null;let r=await N.users.get(n);if(!r||r.active!==!0||!t)return null;let i;return i=r.role===`admin`?Oe(``):Oe(String(t).trim()),r.passwordHash===i?r:null}async function Be(){return await ge(),N.usersMeta.orderBy(`version`).last()}async function Ve(){return await ge(),N.ordersMeta.orderBy(`version`).last()}async function He(){await ge();let e=await N.users.orderBy(`code`).toArray(),t=await Be(),n;try{n=await F(me(e)+`#v${t?.version||0}`)}catch{}return{meta:t,users:e.map(e=>({...e})),sig:n}}async function Ue({meta:e,users:t,sig:n}){await ge();let r=(await Be())?.version||0,i=e?.version||0;try{let e=await F(me(t||[])+`#v${i}`);n&&e!==n&&console.warn(`Users snapshot signature mismatch`)}catch{}if(i<=r)return{applied:!1,reason:`stale-version`};await N.transaction(`rw`,N.users,N.usersMeta,async()=>{await N.users.clear(),Array.isArray(t)&&t.length&&await N.users.bulkPut(t.map(e=>({...e,code:P(e.code)}))),await N.usersMeta.put({version:i,changeLog:e?.changeLog||[]})});try{be(`snapshot-applied`)}catch{}return{applied:!0}}async function We(e){await ge();let t=await I(e);return{meta:await Ve(),orders:t}}async function Ge(e){await ge();let t=(await N.orders.toArray()).filter(t=>t?.info?.asignado_a_code===e);return{meta:await Ve(),orders:t}}async function Ke({meta:e,orders:t}){await ge();let n=(await Ve())?.version||0,r=e?.version||0;if(r<=n)return{applied:!1,reason:`stale-version`};await N.transaction(`rw`,N.orders,N.ordersMeta,async()=>{Array.isArray(t)&&t.length&&await N.orders.bulkPut(t.map(e=>{let t=[e.code,e?.info?.[`Numero orden`],e?.[`Numero orden`],e?.Numero,e.id];for(let n of t){let t=Number.parseInt?.(String(n||``).trim(),10);if(Number.isFinite(t))return{...e,code:t}}return null}).filter(Boolean)),await N.ordersMeta.put({version:r,changeLog:e?.changeLog||[]})});try{we(`snapshot-applied`)}catch{}return{applied:!0}}var qe=`popstate`;function Je(e={}){function t(e,t){let{pathname:n,search:r,hash:i}=e.location;return Qe(``,{pathname:n,search:r,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||`default`)}function n(e,t){return typeof t==`string`?t:$e(t)}return tt(t,n,null,e)}function R(e,t){if(e===!1||e==null)throw Error(t)}function Ye(e,t){if(!e){typeof console<`u`&&console.warn(t);try{throw Error(t)}catch{}}}function Xe(){return Math.random().toString(36).substring(2,10)}function Ze(e,t){return{usr:e.state,key:e.key,idx:t}}function Qe(e,t,n=null,r){return{pathname:typeof e==`string`?e:e.pathname,search:``,hash:``,...typeof t==`string`?et(t):t,state:n,key:t&&t.key||r||Xe()}}function $e({pathname:e=`/`,search:t=``,hash:n=``}){return t&&t!==`?`&&(e+=t.charAt(0)===`?`?t:`?`+t),n&&n!==`#`&&(e+=n.charAt(0)===`#`?n:`#`+n),e}function et(e){let t={};if(e){let n=e.indexOf(`#`);n>=0&&(t.hash=e.substring(n),e=e.substring(0,n));let r=e.indexOf(`?`);r>=0&&(t.search=e.substring(r),e=e.substring(0,r)),e&&(t.pathname=e)}return t}function tt(e,t,n,r={}){let{window:i=document.defaultView,v5Compat:a=!1}=r,o=i.history,s=`POP`,c=null,l=u();l??(l=0,o.replaceState({...o.state,idx:l},``));function u(){return(o.state||{idx:null}).idx}function d(){s=`POP`;let e=u(),t=e==null?null:e-l;l=e,c&&c({action:s,location:h.location,delta:t})}function f(e,t){s=`PUSH`;let r=Qe(h.location,e,t);n&&n(r,e),l=u()+1;let d=Ze(r,l),f=h.createHref(r);try{o.pushState(d,``,f)}catch(e){if(e instanceof DOMException&&e.name===`DataCloneError`)throw e;i.location.assign(f)}a&&c&&c({action:s,location:h.location,delta:1})}function p(e,t){s=`REPLACE`;let r=Qe(h.location,e,t);n&&n(r,e),l=u();let i=Ze(r,l),d=h.createHref(r);o.replaceState(i,``,d),a&&c&&c({action:s,location:h.location,delta:0})}function m(e){return nt(e)}let h={get action(){return s},get location(){return e(i,o)},listen(e){if(c)throw Error(`A history only accepts one active listener`);return i.addEventListener(qe,d),c=e,()=>{i.removeEventListener(qe,d),c=null}},createHref(e){return t(i,e)},createURL:m,encodeLocation(e){let t=m(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:f,replace:p,go(e){return o.go(e)}};return h}function nt(e,t=!1){let n=`http://localhost`;typeof window<`u`&&(n=window.location.origin===`null`?window.location.href:window.location.origin),R(n,`No window.location.(origin|href) available to create URL`);let r=typeof e==`string`?e:$e(e);return r=r.replace(/ $/,`%20`),!t&&r.startsWith(`//`)&&(r=n+r),new URL(r,n)}function rt(e,t,n=`/`){return it(e,t,n,!1)}function it(e,t,n,r){let i=typeof t==`string`?et(t):t,a=St(i.pathname||`/`,n);if(a==null)return null;let o=ot(e);ct(o);let s=null;for(let e=0;s==null&&e<o.length;++e){let t=xt(a);s=vt(o[e],t,r)}return s}function at(e,t){let{route:n,pathname:r,params:i}=e;return{id:n.id,pathname:r,params:i,data:t[n.id],loaderData:t[n.id],handle:n.handle}}function ot(e,t=[],n=[],r=``,i=!1){let a=(e,a,o=i,s)=>{let c={relativePath:s===void 0?e.path||``:s,caseSensitive:e.caseSensitive===!0,childrenIndex:a,route:e};if(c.relativePath.startsWith(`/`)){if(!c.relativePath.startsWith(r)&&o)return;R(c.relativePath.startsWith(r),`Absolute route path "${c.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),c.relativePath=c.relativePath.slice(r.length)}let l=Ot([r,c.relativePath]),u=n.concat(c);e.children&&e.children.length>0&&(R(e.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${l}".`),ot(e.children,t,u,l,o)),!(e.path==null&&!e.index)&&t.push({path:l,score:gt(l,e.index),routesMeta:u})};return e.forEach((e,t)=>{if(e.path===``||!e.path?.includes(`?`))a(e,t);else for(let n of st(e.path))a(e,t,!0,n)}),t}function st(e){let t=e.split(`/`);if(t.length===0)return[];let[n,...r]=t,i=n.endsWith(`?`),a=n.replace(/\?$/,``);if(r.length===0)return i?[a,``]:[a];let o=st(r.join(`/`)),s=[];return s.push(...o.map(e=>e===``?a:[a,e].join(`/`))),i&&s.push(...o),s.map(t=>e.startsWith(`/`)&&t===``?`/`:t)}function ct(e){e.sort((e,t)=>e.score===t.score?_t(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)):t.score-e.score)}var lt=/^:[\w-]+$/,ut=3,dt=2,ft=1,pt=10,mt=-2,ht=e=>e===`*`;function gt(e,t){let n=e.split(`/`),r=n.length;return n.some(ht)&&(r+=mt),t&&(r+=dt),n.filter(e=>!ht(e)).reduce((e,t)=>e+(lt.test(t)?ut:t===``?ft:pt),r)}function _t(e,t){return e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n])?e[e.length-1]-t[t.length-1]:0}function vt(e,t,n=!1){let{routesMeta:r}=e,i={},a=`/`,o=[];for(let e=0;e<r.length;++e){let s=r[e],c=e===r.length-1,l=a===`/`?t:t.slice(a.length)||`/`,u=yt({path:s.relativePath,caseSensitive:s.caseSensitive,end:c},l),d=s.route;if(!u&&c&&n&&!r[r.length-1].route.index&&(u=yt({path:s.relativePath,caseSensitive:s.caseSensitive,end:!1},l)),!u)return null;Object.assign(i,u.params),o.push({params:i,pathname:Ot([a,u.pathname]),pathnameBase:kt(Ot([a,u.pathnameBase])),route:d}),u.pathnameBase!==`/`&&(a=Ot([a,u.pathnameBase]))}return o}function yt(e,t){typeof e==`string`&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=bt(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,`$1`),s=i.slice(1);return{params:r.reduce((e,{paramName:t,isOptional:n},r)=>{if(t===`*`){let e=s[r]||``;o=a.slice(0,a.length-e.length).replace(/(.)\/+$/,`$1`)}let i=s[r];return n&&!i?e[t]=void 0:e[t]=(i||``).replace(/%2F/g,`/`),e},{}),pathname:a,pathnameBase:o,pattern:e}}function bt(e,t=!1,n=!0){Ye(e===`*`||!e.endsWith(`*`)||e.endsWith(`/*`),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,`/*`)}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,`/*`)}".`);let r=[],i=`^`+e.replace(/\/*\*?$/,``).replace(/^\/*/,`/`).replace(/[\\.*+^${}|()[\]]/g,`\\$&`).replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(r.push({paramName:t,isOptional:n!=null}),n?`/?([^\\/]+)?`:`/([^\\/]+)`)).replace(/\/([\w-]+)\?(\/|$)/g,`(/$1)?$2`);return e.endsWith(`*`)?(r.push({paramName:`*`}),i+=e===`*`||e===`/*`?`(.*)$`:`(?:\\/(.+)|\\/*)$`):n?i+=`\\/*$`:e!==``&&e!==`/`&&(i+=`(?:(?=\\/|$))`),[new RegExp(i,t?void 0:`i`),r]}function xt(e){try{return e.split(`/`).map(e=>decodeURIComponent(e).replace(/\//g,`%2F`)).join(`/`)}catch(t){return Ye(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),e}}function St(e,t){if(t===`/`)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith(`/`)?t.length-1:t.length,r=e.charAt(n);return r&&r!==`/`?null:e.slice(n)||`/`}function z(e,t=`/`){let{pathname:n,search:r=``,hash:i=``}=typeof e==`string`?et(e):e;return{pathname:n?n.startsWith(`/`)?n:Ct(n,t):t,search:At(r),hash:jt(i)}}function Ct(e,t){let n=t.replace(/\/+$/,``).split(`/`);return e.split(`/`).forEach(e=>{e===`..`?n.length>1&&n.pop():e!==`.`&&n.push(e)}),n.length>1?n.join(`/`):`/`}function wt(e,t,n,r){return`Cannot include a '${e}' character in a manually specified \`to.${t}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Tt(e){return e.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Et(e){let t=Tt(e);return t.map((e,n)=>n===t.length-1?e.pathname:e.pathnameBase)}function Dt(e,t,n,r=!1){let i;typeof e==`string`?i=et(e):(i={...e},R(!i.pathname||!i.pathname.includes(`?`),wt(`?`,`pathname`,`search`,i)),R(!i.pathname||!i.pathname.includes(`#`),wt(`#`,`pathname`,`hash`,i)),R(!i.search||!i.search.includes(`#`),wt(`#`,`search`,`hash`,i)));let a=e===``||i.pathname===``,o=a?`/`:i.pathname,s;if(o==null)s=n;else{let e=t.length-1;if(!r&&o.startsWith(`..`)){let t=o.split(`/`);for(;t[0]===`..`;)t.shift(),--e;i.pathname=t.join(`/`)}s=e>=0?t[e]:`/`}let c=z(i,s),l=o&&o!==`/`&&o.endsWith(`/`),u=(a||o===`.`)&&n.endsWith(`/`);return!c.pathname.endsWith(`/`)&&(l||u)&&(c.pathname+=`/`),c}var Ot=e=>e.join(`/`).replace(/\/\/+/g,`/`),kt=e=>e.replace(/\/+$/,``).replace(/^\/*/,`/`),At=e=>!e||e===`?`?``:e.startsWith(`?`)?e:`?`+e,jt=e=>!e||e===`#`?``:e.startsWith(`#`)?e:`#`+e;function Mt(e){return e!=null&&typeof e.status==`number`&&typeof e.statusText==`string`&&typeof e.internal==`boolean`&&`data`in e}var Nt=_.createContext(null);Nt.displayName=`DataRouter`;var Pt=_.createContext(null);Pt.displayName=`DataRouterState`,_.createContext(!1);var Ft=_.createContext({isTransitioning:!1});Ft.displayName=`ViewTransition`;var It=_.createContext(new Map);It.displayName=`Fetchers`;var Lt=_.createContext(null);Lt.displayName=`Await`;var Rt=_.createContext(null);Rt.displayName=`Navigation`;var zt=_.createContext(null);zt.displayName=`Location`;var B=_.createContext({outlet:null,matches:[],isDataRoute:!1});B.displayName=`Route`;var Bt=_.createContext(null);Bt.displayName=`RouteError`;function Vt(e,{relative:t}={}){R(Ht(),`useHref() may be used only in the context of a <Router> component.`);let{basename:n,navigator:r}=_.useContext(Rt),{hash:i,pathname:a,search:o}=Yt(e,{relative:t}),s=a;return n!==`/`&&(s=a===`/`?n:Ot([n,a])),r.createHref({pathname:s,search:o,hash:i})}function Ht(){return _.useContext(zt)!=null}function Ut(){return R(Ht(),`useLocation() may be used only in the context of a <Router> component.`),_.useContext(zt).location}var Wt=`You should call navigate() in a React.useEffect(), not when your component is first rendered.`;function Gt(e){_.useContext(Rt).static||_.useLayoutEffect(e)}function Kt(){let{isDataRoute:e}=_.useContext(B);return e?pn():qt()}function qt(){R(Ht(),`useNavigate() may be used only in the context of a <Router> component.`);let e=_.useContext(Nt),{basename:t,navigator:n}=_.useContext(Rt),{matches:r}=_.useContext(B),{pathname:i}=Ut(),a=JSON.stringify(Et(r)),o=_.useRef(!1);return Gt(()=>{o.current=!0}),_.useCallback((r,s={})=>{if(Ye(o.current,Wt),!o.current)return;if(typeof r==`number`){n.go(r);return}let c=Dt(r,JSON.parse(a),i,s.relative===`path`);e==null&&t!==`/`&&(c.pathname=c.pathname===`/`?t:Ot([t,c.pathname])),(s.replace?n.replace:n.push)(c,s.state,s)},[t,n,a,i,e])}_.createContext(null);function Jt(){let{matches:e}=_.useContext(B),t=e[e.length-1];return t?t.params:{}}function Yt(e,{relative:t}={}){let{matches:n}=_.useContext(B),{pathname:r}=Ut(),i=JSON.stringify(Et(n));return _.useMemo(()=>Dt(e,JSON.parse(i),r,t===`path`),[e,i,r,t])}function Xt(e,t){return Zt(e,t)}function Zt(e,t,n,r,i){R(Ht(),`useRoutes() may be used only in the context of a <Router> component.`);let{navigator:a}=_.useContext(Rt),{matches:o}=_.useContext(B),s=o[o.length-1],c=s?s.params:{},l=s?s.pathname:`/`,u=s?s.pathnameBase:`/`,d=s&&s.route;{let e=d&&d.path||``;hn(l,!d||e.endsWith(`*`)||e.endsWith(`*?`),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${e}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${e}"> to <Route path="${e===`/`?`*`:`${e}/*`}">.`)}let f=Ut(),p;if(t){let e=typeof t==`string`?et(t):t;R(u===`/`||e.pathname?.startsWith(u),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${e.pathname}" was given in the \`location\` prop.`),p=e}else p=f;let m=p.pathname||`/`,h=m;if(u!==`/`){let e=u.replace(/^\//,``).split(`/`);h=`/`+m.replace(/^\//,``).split(`/`).slice(e.length).join(`/`)}let g=rt(e,{pathname:h});Ye(d||g!=null,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),Ye(g==null||g[g.length-1].route.element!==void 0||g[g.length-1].route.Component!==void 0||g[g.length-1].route.lazy!==void 0,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let v=nn(g&&g.map(e=>Object.assign({},e,{params:Object.assign({},c,e.params),pathname:Ot([u,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:e.pathnameBase===`/`?u:Ot([u,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),o,n,r,i);return t&&v?_.createElement(zt.Provider,{value:{location:{pathname:`/`,search:``,hash:``,state:null,key:`default`,...p},navigationType:`POP`}},v):v}function Qt(){let e=fn(),t=Mt(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r=`rgba(200,200,200, 0.5)`,i={padding:`0.5rem`,backgroundColor:r},a={padding:`2px 4px`,backgroundColor:r},o=null;return console.error(`Error handled by React Router default ErrorBoundary:`,e),o=_.createElement(_.Fragment,null,_.createElement(`p`,null,` Hey developer `),_.createElement(`p`,null,`You can provide a way better UX than this when your app throws errors by providing your own `,_.createElement(`code`,{style:a},`ErrorBoundary`),` or`,` `,_.createElement(`code`,{style:a},`errorElement`),` prop on your route.`)),_.createElement(_.Fragment,null,_.createElement(`h2`,null,`Unexpected Application Error!`),_.createElement(`h3`,{style:{fontStyle:`italic`}},t),n?_.createElement(`pre`,{style:i},n):null,o)}var $t=_.createElement(Qt,null),en=class extends _.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!==`idle`&&e.revalidation===`idle`?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error===void 0?t.error:e.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){this.props.unstable_onError?this.props.unstable_onError(e,t):console.error(`React Router caught the following error during render`,e)}render(){return this.state.error===void 0?this.props.children:_.createElement(B.Provider,{value:this.props.routeContext},_.createElement(Bt.Provider,{value:this.state.error,children:this.props.component}))}};function tn({routeContext:e,match:t,children:n}){let r=_.useContext(Nt);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),_.createElement(B.Provider,{value:e},n)}function nn(e,t=[],n=null,r=null,i=null){if(e==null){if(!n)return null;if(n.errors)e=n.matches;else if(t.length===0&&!n.initialized&&n.matches.length>0)e=n.matches;else return null}let a=e,o=n?.errors;if(o!=null){let e=a.findIndex(e=>e.route.id&&o?.[e.route.id]!==void 0);R(e>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(`,`)}`),a=a.slice(0,Math.min(a.length,e+1))}let s=!1,c=-1;if(n)for(let e=0;e<a.length;e++){let t=a[e];if((t.route.HydrateFallback||t.route.hydrateFallbackElement)&&(c=e),t.route.id){let{loaderData:e,errors:r}=n,i=t.route.loader&&!e.hasOwnProperty(t.route.id)&&(!r||r[t.route.id]===void 0);if(t.route.lazy||i){s=!0,a=c>=0?a.slice(0,c+1):[a[0]];break}}}return a.reduceRight((e,i,l)=>{let u,d=!1,f=null,p=null;n&&(u=o&&i.route.id?o[i.route.id]:void 0,f=i.route.errorElement||$t,s&&(c<0&&l===0?(hn(`route-fallback`,!1,"No `HydrateFallback` element provided to render during initial hydration"),d=!0,p=null):c===l&&(d=!0,p=i.route.hydrateFallbackElement||null)));let m=t.concat(a.slice(0,l+1)),h=()=>{let t;return t=u?f:d?p:i.route.Component?_.createElement(i.route.Component,null):i.route.element?i.route.element:e,_.createElement(tn,{match:i,routeContext:{outlet:e,matches:m,isDataRoute:n!=null},children:t})};return n&&(i.route.ErrorBoundary||i.route.errorElement||l===0)?_.createElement(en,{location:n.location,revalidation:n.revalidation,component:f,error:u,children:h(),routeContext:{outlet:null,matches:m,isDataRoute:!0},unstable_onError:r}):h()},null)}function rn(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function an(e){let t=_.useContext(Nt);return R(t,rn(e)),t}function on(e){let t=_.useContext(Pt);return R(t,rn(e)),t}function sn(e){let t=_.useContext(B);return R(t,rn(e)),t}function cn(e){let t=sn(e),n=t.matches[t.matches.length-1];return R(n.route.id,`${e} can only be used on routes that contain a unique "id"`),n.route.id}function ln(){return cn(`useRouteId`)}function un(){return on(`useNavigation`).navigation}function dn(){let{matches:e,loaderData:t}=on(`useMatches`);return _.useMemo(()=>e.map(e=>at(e,t)),[e,t])}function fn(){let e=_.useContext(Bt),t=on(`useRouteError`),n=cn(`useRouteError`);return e===void 0?t.errors?.[n]:e}function pn(){let{router:e}=an(`useNavigate`),t=cn(`useNavigate`),n=_.useRef(!1);return Gt(()=>{n.current=!0}),_.useCallback(async(r,i={})=>{Ye(n.current,Wt),n.current&&(typeof r==`number`?e.navigate(r):await e.navigate(r,{fromRouteId:t,...i}))},[e,t])}var mn={};function hn(e,t,n){!t&&!mn[e]&&(mn[e]=!0,Ye(!1,n))}_.memo(gn);function gn({routes:e,future:t,state:n,unstable_onError:r}){return Zt(e,void 0,n,r,t)}function _n({to:e,replace:t,state:n,relative:r}){R(Ht(),`<Navigate> may be used only in the context of a <Router> component.`);let{static:i}=_.useContext(Rt);Ye(!i,`<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.`);let{matches:a}=_.useContext(B),{pathname:o}=Ut(),s=Kt(),c=Dt(e,Et(a),o,r===`path`),l=JSON.stringify(c);return _.useEffect(()=>{s(JSON.parse(l),{replace:t,state:n,relative:r})},[s,l,r,t,n]),null}function vn(e){R(!1,`A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.`)}function yn({basename:e=`/`,children:t=null,location:n,navigationType:r=`POP`,navigator:i,static:a=!1}){R(!Ht(),`You cannot render a <Router> inside another <Router>. You should never have more than one in your app.`);let o=e.replace(/^\/*/,`/`),s=_.useMemo(()=>({basename:o,navigator:i,static:a,future:{}}),[o,i,a]);typeof n==`string`&&(n=et(n));let{pathname:c=`/`,search:l=``,hash:u=``,state:d=null,key:f=`default`}=n,p=_.useMemo(()=>{let e=St(c,o);return e==null?null:{location:{pathname:e,search:l,hash:u,state:d,key:f},navigationType:r}},[o,c,l,u,d,f,r]);return Ye(p!=null,`<Router basename="${o}"> is not able to match the URL "${c}${l}${u}" because it does not start with the basename, so the <Router> won't render anything.`),p==null?null:_.createElement(Rt.Provider,{value:s},_.createElement(zt.Provider,{children:t,value:p}))}function bn({children:e,location:t}){return Xt(xn(e),t)}function xn(e,t=[]){let n=[];return _.Children.forEach(e,(e,r)=>{if(!_.isValidElement(e))return;let i=[...t,r];if(e.type===_.Fragment){n.push.apply(n,xn(e.props.children,i));return}R(e.type===vn,`[${typeof e.type==`string`?e.type:e.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),R(!e.props.index||!e.props.children,`An index route cannot have child routes.`);let a={id:e.props.id||i.join(`-`),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,hydrateFallbackElement:e.props.hydrateFallbackElement,HydrateFallback:e.props.HydrateFallback,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:e.props.hasErrorBoundary===!0||e.props.ErrorBoundary!=null||e.props.errorElement!=null,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=xn(e.props.children,i)),n.push(a)}),n}var Sn=`get`,Cn=`application/x-www-form-urlencoded`;function wn(e){return e!=null&&typeof e.tagName==`string`}function Tn(e){return wn(e)&&e.tagName.toLowerCase()===`button`}function En(e){return wn(e)&&e.tagName.toLowerCase()===`form`}function Dn(e){return wn(e)&&e.tagName.toLowerCase()===`input`}function On(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function kn(e,t){return e.button===0&&(!t||t===`_self`)&&!On(e)}var An=null;function jn(){if(An===null)try{new FormData(document.createElement(`form`),0),An=!1}catch{An=!0}return An}var Mn=new Set([`application/x-www-form-urlencoded`,`multipart/form-data`,`text/plain`]);function Nn(e){return e!=null&&!Mn.has(e)?(Ye(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Cn}"`),null):e}function Pn(e,t){let n,r,i,a,o;if(En(e)){let o=e.getAttribute(`action`);r=o?St(o,t):null,n=e.getAttribute(`method`)||Sn,i=Nn(e.getAttribute(`enctype`))||Cn,a=new FormData(e)}else if(Tn(e)||Dn(e)&&(e.type===`submit`||e.type===`image`)){let o=e.form;if(o==null)throw Error(`Cannot submit a <button> or <input type="submit"> without a <form>`);let s=e.getAttribute(`formaction`)||o.getAttribute(`action`);if(r=s?St(s,t):null,n=e.getAttribute(`formmethod`)||o.getAttribute(`method`)||Sn,i=Nn(e.getAttribute(`formenctype`))||Nn(o.getAttribute(`enctype`))||Cn,a=new FormData(o,e),!jn()){let{name:t,type:n,value:r}=e;if(n===`image`){let e=t?`${t}.`:``;a.append(`${e}x`,`0`),a.append(`${e}y`,`0`)}else t&&a.append(t,r)}}else if(wn(e))throw Error(`Cannot submit element that is not <form>, <button>, or <input type="submit|image">`);else n=Sn,r=null,i=Cn,o=e;return a&&i===`text/plain`&&(o=a,a=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:a,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join(`\0`);function Fn(e,t){if(e===!1||e==null)throw Error(t)}function In(e,t,n){let r=typeof e==`string`?new URL(e,typeof window>`u`?`server://singlefetch/`:window.location.origin):e;return r.pathname===`/`?r.pathname=`_root.${n}`:t&&St(r.pathname,t)===`/`?r.pathname=`${t.replace(/\/$/,``)}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,``)}.${n}`,r}async function Ln(e,t){if(e.id in t)return t[e.id];try{let n=await x(()=>import(e.module),[]);return t[e.id]=n,n}catch(t){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Rn(e){return e!=null&&typeof e.page==`string`}function zn(e){return e==null?!1:e.href==null?e.rel===`preload`&&typeof e.imageSrcSet==`string`&&typeof e.imageSizes==`string`:typeof e.rel==`string`&&typeof e.href==`string`}async function Bn(e,t,n){let r=await Promise.all(e.map(async e=>{let r=t.routes[e.route.id];if(r){let e=await Ln(r,n);return e.links?e.links():[]}return[]}));return Gn(r.flat(1).filter(zn).filter(e=>e.rel===`stylesheet`||e.rel===`preload`).map(e=>e.rel===`stylesheet`?{...e,rel:`prefetch`,as:`style`}:{...e,rel:`prefetch`}))}function Vn(e,t,n,r,i,a){let o=(e,t)=>n[t]?e.route.id!==n[t].route.id:!0,s=(e,t)=>n[t].pathname!==e.pathname||n[t].route.path?.endsWith(`*`)&&n[t].params[`*`]!==e.params[`*`];return a===`assets`?t.filter((e,t)=>o(e,t)||s(e,t)):a===`data`?t.filter((t,a)=>{let c=r.routes[t.route.id];if(!c||!c.hasLoader)return!1;if(o(t,a)||s(t,a))return!0;if(t.route.shouldRevalidate){let r=t.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(e,window.origin),nextParams:t.params,defaultShouldRevalidate:!0});if(typeof r==`boolean`)return r}return!0}):[]}function Hn(e,t,{includeHydrateFallback:n}={}){return Un(e.map(e=>{let r=t.routes[e.route.id];if(!r)return[];let i=[r.module];return r.clientActionModule&&(i=i.concat(r.clientActionModule)),r.clientLoaderModule&&(i=i.concat(r.clientLoaderModule)),n&&r.hydrateFallbackModule&&(i=i.concat(r.hydrateFallbackModule)),r.imports&&(i=i.concat(r.imports)),i}).flat(1))}function Un(e){return[...new Set(e)]}function Wn(e){let t={},n=Object.keys(e).sort();for(let r of n)t[r]=e[r];return t}function Gn(e,t){let n=new Set,r=new Set(t);return e.reduce((e,i)=>{if(t&&!Rn(i)&&i.as===`script`&&i.href&&r.has(i.href))return e;let a=JSON.stringify(Wn(i));return n.has(a)||(n.add(a),e.push({key:a,link:i})),e},[])}function Kn(){let e=_.useContext(Nt);return Fn(e,`You must render this element inside a <DataRouterContext.Provider> element`),e}function qn(){let e=_.useContext(Pt);return Fn(e,`You must render this element inside a <DataRouterStateContext.Provider> element`),e}var Jn=_.createContext(void 0);Jn.displayName=`FrameworkContext`;function Yn(){let e=_.useContext(Jn);return Fn(e,`You must render this element inside a <HydratedRouter> element`),e}function Xn(e,t){let n=_.useContext(Jn),[r,i]=_.useState(!1),[a,o]=_.useState(!1),{onFocus:s,onBlur:c,onMouseEnter:l,onMouseLeave:u,onTouchStart:d}=t,f=_.useRef(null);_.useEffect(()=>{if(e===`render`&&o(!0),e===`viewport`){let e=new IntersectionObserver(e=>{e.forEach(e=>{o(e.isIntersecting)})},{threshold:.5});return f.current&&e.observe(f.current),()=>{e.disconnect()}}},[e]),_.useEffect(()=>{if(r){let e=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(e)}}},[r]);let p=()=>{i(!0)},m=()=>{i(!1),o(!1)};return n?e===`intent`?[a,f,{onFocus:Zn(s,p),onBlur:Zn(c,m),onMouseEnter:Zn(l,p),onMouseLeave:Zn(u,m),onTouchStart:Zn(d,p)}]:[a,f,{}]:[!1,f,{}]}function Zn(e,t){return n=>{e&&e(n),n.defaultPrevented||t(n)}}function Qn({page:e,...t}){let{router:n}=Kn(),r=_.useMemo(()=>rt(n.routes,e,n.basename),[n.routes,e,n.basename]);return r?_.createElement(er,{page:e,matches:r,...t}):null}function $n(e){let{manifest:t,routeModules:n}=Yn(),[r,i]=_.useState([]);return _.useEffect(()=>{let r=!1;return Bn(e,t,n).then(e=>{r||i(e)}),()=>{r=!0}},[e,t,n]),r}function er({page:e,matches:t,...n}){let r=Ut(),{manifest:i,routeModules:a}=Yn(),{basename:o}=Kn(),{loaderData:s,matches:c}=qn(),l=_.useMemo(()=>Vn(e,t,c,i,r,`data`),[e,t,c,i,r]),u=_.useMemo(()=>Vn(e,t,c,i,r,`assets`),[e,t,c,i,r]),d=_.useMemo(()=>{if(e===r.pathname+r.search+r.hash)return[];let n=new Set,c=!1;if(t.forEach(e=>{let t=i.routes[e.route.id];!t||!t.hasLoader||(!l.some(t=>t.route.id===e.route.id)&&e.route.id in s&&a[e.route.id]?.shouldRevalidate||t.hasClientLoader?c=!0:n.add(e.route.id))}),n.size===0)return[];let u=In(e,o,`data`);return c&&n.size>0&&u.searchParams.set(`_routes`,t.filter(e=>n.has(e.route.id)).map(e=>e.route.id).join(`,`)),[u.pathname+u.search]},[o,s,r,i,l,t,e,a]),f=_.useMemo(()=>Hn(u,i),[u,i]),p=$n(u);return _.createElement(_.Fragment,null,d.map(e=>_.createElement(`link`,{key:e,rel:`prefetch`,as:`fetch`,href:e,...n})),f.map(e=>_.createElement(`link`,{key:e,rel:`modulepreload`,href:e,...n})),p.map(({key:e,link:t})=>_.createElement(`link`,{key:e,nonce:n.nonce,...t})))}function tr(...e){return t=>{e.forEach(e=>{typeof e==`function`?e(t):e!=null&&(e.current=t)})}}var nr=typeof window<`u`&&window.document!==void 0&&window.document.createElement!==void 0;try{nr&&(window.__reactRouterVersion=`7.9.1`)}catch{}function rr({basename:e,children:t,window:n}){let r=_.useRef();r.current??=Je({window:n,v5Compat:!0});let i=r.current,[a,o]=_.useState({action:i.action,location:i.location}),s=_.useCallback(e=>{_.startTransition(()=>o(e))},[o]);return _.useLayoutEffect(()=>i.listen(s),[i,s]),_.createElement(yn,{basename:e,children:t,location:a.location,navigationType:a.action,navigator:i})}function ir({basename:e,children:t,history:n}){let[r,i]=_.useState({action:n.action,location:n.location}),a=_.useCallback(e=>{_.startTransition(()=>i(e))},[i]);return _.useLayoutEffect(()=>n.listen(a),[n,a]),_.createElement(yn,{basename:e,children:t,location:r.location,navigationType:r.action,navigator:n})}ir.displayName=`unstable_HistoryRouter`;var ar=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,or=_.forwardRef(function({onClick:e,discover:t=`render`,prefetch:n=`none`,relative:r,reloadDocument:i,replace:a,state:o,target:s,to:c,preventScrollReset:l,viewTransition:u,...d},f){let{basename:p}=_.useContext(Rt),m=typeof c==`string`&&ar.test(c),h,g=!1;if(typeof c==`string`&&m&&(h=c,nr))try{let e=new URL(window.location.href),t=c.startsWith(`//`)?new URL(e.protocol+c):new URL(c),n=St(t.pathname,p);t.origin===e.origin&&n!=null?c=n+t.search+t.hash:g=!0}catch{Ye(!1,`<Link to="${c}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let v=Vt(c,{relative:r}),[y,b,x]=Xn(n,d),S=pr(c,{replace:a,state:o,target:s,preventScrollReset:l,relative:r,viewTransition:u});function C(t){e&&e(t),t.defaultPrevented||S(t)}let w=_.createElement(`a`,{...d,...x,href:h||v,onClick:g||i?e:C,ref:tr(f,b),target:s,"data-discover":!m&&t===`render`?`true`:void 0});return y&&!m?_.createElement(_.Fragment,null,w,_.createElement(Qn,{page:v})):w});or.displayName=`Link`;var sr=_.forwardRef(function({"aria-current":e=`page`,caseSensitive:t=!1,className:n=``,end:r=!1,style:i,to:a,viewTransition:o,children:s,...c},l){let u=Yt(a,{relative:c.relative}),d=Ut(),f=_.useContext(Pt),{navigator:p,basename:m}=_.useContext(Rt),h=f!=null&&Cr(u)&&o===!0,g=p.encodeLocation?p.encodeLocation(u).pathname:u.pathname,v=d.pathname,y=f&&f.navigation&&f.navigation.location?f.navigation.location.pathname:null;t||(v=v.toLowerCase(),y=y?y.toLowerCase():null,g=g.toLowerCase()),y&&m&&(y=St(y,m)||y);let b=g!==`/`&&g.endsWith(`/`)?g.length-1:g.length,x=v===g||!r&&v.startsWith(g)&&v.charAt(b)===`/`,S=y!=null&&(y===g||!r&&y.startsWith(g)&&y.charAt(g.length)===`/`),C={isActive:x,isPending:S,isTransitioning:h},w=x?e:void 0,T;T=typeof n==`function`?n(C):[n,x?`active`:null,S?`pending`:null,h?`transitioning`:null].filter(Boolean).join(` `);let E=typeof i==`function`?i(C):i;return _.createElement(or,{...c,"aria-current":w,className:T,ref:l,style:E,to:a,viewTransition:o},typeof s==`function`?s(C):s)});sr.displayName=`NavLink`;var cr=_.forwardRef(({discover:e=`render`,fetcherKey:t,navigate:n,reloadDocument:r,replace:i,state:a,method:o=Sn,action:s,onSubmit:c,relative:l,preventScrollReset:u,viewTransition:d,...f},p)=>{let m=gr(),h=_r(s,{relative:l}),g=o.toLowerCase()===`get`?`get`:`post`,v=typeof s==`string`&&ar.test(s);return _.createElement(`form`,{ref:p,method:g,action:h,onSubmit:r?c:e=>{if(c&&c(e),e.defaultPrevented)return;e.preventDefault();let r=e.nativeEvent.submitter,s=r?.getAttribute(`formmethod`)||o;m(r||e.currentTarget,{fetcherKey:t,method:s,navigate:n,replace:i,state:a,relative:l,preventScrollReset:u,viewTransition:d})},...f,"data-discover":!v&&e===`render`?`true`:void 0})});cr.displayName=`Form`;function lr({getKey:e,storageKey:t,...n}){let r=_.useContext(Jn),{basename:i}=_.useContext(Rt),a=Ut(),o=dn();xr({getKey:e,storageKey:t});let s=_.useMemo(()=>{if(!r||!e)return null;let t=br(a,o,i,e);return t===a.key?null:t},[]);if(!r||r.isSpaMode)return null;let c=((e,t)=>{if(!window.history.state||!window.history.state.key){let e=Math.random().toString(32).slice(2);window.history.replaceState({key:e},``)}try{let n=JSON.parse(sessionStorage.getItem(e)||`{}`)[t||window.history.state.key];typeof n==`number`&&window.scrollTo(0,n)}catch(t){console.error(t),sessionStorage.removeItem(e)}}).toString();return _.createElement(`script`,{...n,suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:`(${c})(${JSON.stringify(t||vr)}, ${JSON.stringify(s)})`}})}lr.displayName=`ScrollRestoration`;function ur(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function dr(e){let t=_.useContext(Nt);return R(t,ur(e)),t}function fr(e){let t=_.useContext(Pt);return R(t,ur(e)),t}function pr(e,{target:t,replace:n,state:r,preventScrollReset:i,relative:a,viewTransition:o}={}){let s=Kt(),c=Ut(),l=Yt(e,{relative:a});return _.useCallback(u=>{if(kn(u,t)){u.preventDefault();let t=n===void 0?$e(c)===$e(l):n;s(e,{replace:t,state:r,preventScrollReset:i,relative:a,viewTransition:o})}},[c,s,l,n,r,t,e,i,a,o])}var mr=0,hr=()=>`__${String(++mr)}__`;function gr(){let{router:e}=dr(`useSubmit`),{basename:t}=_.useContext(Rt),n=ln();return _.useCallback(async(r,i={})=>{let{action:a,method:o,encType:s,formData:c,body:l}=Pn(r,t);if(i.navigate===!1){let t=i.fetcherKey||hr();await e.fetch(t,n,i.action||a,{preventScrollReset:i.preventScrollReset,formData:c,body:l,formMethod:i.method||o,formEncType:i.encType||s,flushSync:i.flushSync})}else await e.navigate(i.action||a,{preventScrollReset:i.preventScrollReset,formData:c,body:l,formMethod:i.method||o,formEncType:i.encType||s,replace:i.replace,state:i.state,fromRouteId:n,flushSync:i.flushSync,viewTransition:i.viewTransition})},[e,t,n])}function _r(e,{relative:t}={}){let{basename:n}=_.useContext(Rt),r=_.useContext(B);R(r,`useFormAction must be used inside a RouteContext`);let[i]=r.matches.slice(-1),a={...Yt(e||`.`,{relative:t})},o=Ut();if(e==null){a.search=o.search;let e=new URLSearchParams(a.search),t=e.getAll(`index`);if(t.some(e=>e===``)){e.delete(`index`),t.filter(e=>e).forEach(t=>e.append(`index`,t));let n=e.toString();a.search=n?`?${n}`:``}}return(!e||e===`.`)&&i.route.index&&(a.search=a.search?a.search.replace(/^\?/,`?index&`):`?index`),n!==`/`&&(a.pathname=a.pathname===`/`?n:Ot([n,a.pathname])),$e(a)}var vr=`react-router-scroll-positions`,yr={};function br(e,t,n,r){let i=null;return r&&(i=r(n===`/`?e:{...e,pathname:St(e.pathname,n)||e.pathname},t)),i??=e.key,i}function xr({getKey:e,storageKey:t}={}){let{router:n}=dr(`useScrollRestoration`),{restoreScrollPosition:r,preventScrollReset:i}=fr(`useScrollRestoration`),{basename:a}=_.useContext(Rt),o=Ut(),s=dn(),c=un();_.useEffect(()=>(window.history.scrollRestoration=`manual`,()=>{window.history.scrollRestoration=`auto`}),[]),Sr(_.useCallback(()=>{if(c.state===`idle`){let t=br(o,s,a,e);yr[t]=window.scrollY}try{sessionStorage.setItem(t||vr,JSON.stringify(yr))}catch(e){Ye(!1,`Failed to save scroll positions in sessionStorage, <ScrollRestoration /> will not work properly (${e}).`)}window.history.scrollRestoration=`auto`},[c.state,e,a,o,s,t])),typeof document<`u`&&(_.useLayoutEffect(()=>{try{let e=sessionStorage.getItem(t||vr);e&&(yr=JSON.parse(e))}catch{}},[t]),_.useLayoutEffect(()=>{let t=n?.enableScrollRestoration(yr,()=>window.scrollY,e?(t,n)=>br(t,n,a,e):void 0);return()=>t&&t()},[n,a,e]),_.useLayoutEffect(()=>{if(r!==!1){if(typeof r==`number`){window.scrollTo(0,r);return}try{if(o.hash){let e=document.getElementById(decodeURIComponent(o.hash.slice(1)));if(e){e.scrollIntoView();return}}}catch{Ye(!1,`"${o.hash.slice(1)}" is not a decodable element ID. The view will not scroll to it.`)}i!==!0&&window.scrollTo(0,0)}},[o,r,i]))}function Sr(e,t){let{capture:n}=t||{};_.useEffect(()=>{let t=n==null?void 0:{capture:n};return window.addEventListener(`pagehide`,e,t),()=>{window.removeEventListener(`pagehide`,e,t)}},[e,n])}function Cr(e,{relative:t}={}){let n=_.useContext(Ft);R(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=dr(`useViewTransitionState`),i=Yt(e,{relative:t});if(!n.isTransitioning)return!1;let a=St(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=St(n.nextLocation.pathname,r)||n.nextLocation.pathname;return yt(i.pathname,o)!=null||yt(i.pathname,a)!=null}var wr=()=>void 0,Tr={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},V=function(e,t){if(!e)throw Er(t)},Er=function(e){return Error(`Firebase Database (`+Tr.SDK_VERSION+`) INTERNAL ASSERT FAILED: `+e)},Dr=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=i&63|128):(i&64512)==55296&&r+1<e.length&&(e.charCodeAt(r+1)&64512)==56320?(i=65536+((i&1023)<<10)+(e.charCodeAt(++r)&1023),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=i&63|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=i&63|128)}return t},Or=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let a=e[n++];t[r++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){let a=e[n++],o=e[n++],s=e[n++],c=((i&7)<<18|(a&63)<<12|(o&63)<<6|s&63)-65536;t[r++]=String.fromCharCode(55296+(c>>10)),t[r++]=String.fromCharCode(56320+(c&1023))}else{let a=e[n++],o=e[n++];t[r++]=String.fromCharCode((i&15)<<12|(a&63)<<6|o&63)}}return t.join(``)},kr={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789`,get ENCODED_VALS(){return this.ENCODED_VALS_BASE+`+/=`},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+`-_.`},HAS_NATIVE_SUPPORT:typeof atob==`function`,encodeByteArray(e,t){if(!Array.isArray(e))throw Error(`encodeByteArray takes an array as a parameter`);this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],a=t+1<e.length,o=a?e[t+1]:0,s=t+2<e.length,c=s?e[t+2]:0,l=i>>2,u=(i&3)<<4|o>>4,d=(o&15)<<2|c>>6,f=c&63;s||(f=64,a||(d=64)),r.push(n[l],n[u],n[d],n[f])}return r.join(``)},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Dr(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):Or(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],a=t<e.length?n[e.charAt(t)]:0;++t;let o=t<e.length?n[e.charAt(t)]:64;++t;let s=t<e.length?n[e.charAt(t)]:64;if(++t,i==null||a==null||o==null||s==null)throw new Ar;let c=i<<2|a>>4;if(r.push(c),o!==64){let e=a<<4&240|o>>2;if(r.push(e),s!==64){let e=o<<6&192|s;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},Ar=class extends Error{constructor(){super(...arguments),this.name=`DecodeBase64StringError`}},jr=function(e){let t=Dr(e);return kr.encodeByteArray(t,!0)},Mr=function(e){return jr(e).replace(/\./g,``)},Nr=function(e){try{return kr.decodeString(e,!0)}catch(e){console.error(`base64Decode failed: `,e)}return null};
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
function Pr(e){return Fr(void 0,e)}function Fr(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:let n=t;return new Date(n.getTime());case Object:e===void 0&&(e={});break;case Array:e=[];break;default:return t}for(let n in t){if(!t.hasOwnProperty(n)||!Ir(n))continue;e[n]=Fr(e[n],t[n])}return e}function Ir(e){return e!==`__proto__`}
/**
* @license
* Copyright 2022 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
function Lr(){if(typeof self<`u`)return self;if(typeof window<`u`)return window;if(typeof global<`u`)return global;throw Error(`Unable to locate global object.`)}
/**
* @license
* Copyright 2022 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var Rr=()=>Lr().__FIREBASE_DEFAULTS__,zr=()=>{if(typeof process>`u`)return;let e={}.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},Br=()=>{if(typeof document>`u`)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let t=e&&Nr(e[1]);return t&&JSON.parse(t)},Vr=()=>{try{return wr()||Rr()||zr()||Br()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},Hr=e=>Vr()?.emulatorHosts?.[e],Ur=e=>{let t=Hr(e);if(!t)return;let n=t.lastIndexOf(`:`);if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return t[0]===`[`?[t.substring(1,n-1),r]:[t.substring(0,n),r]},Wr=()=>Vr()?.config,Gr=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e==`function`&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}};
/**
* @license
* Copyright 2025 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
function Kr(e){try{return(e.startsWith(`http://`)||e.startsWith(`https://`)?new URL(e).hostname:e).endsWith(`.cloudworkstations.dev`)}catch{return!1}}async function qr(e){return(await fetch(e,{credentials:`include`})).ok}
/**
* @license
* Copyright 2021 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
function Jr(e,t){if(e.uid)throw Error(`The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.`);let n={alg:`none`,type:`JWT`},r=t||`demo-project`,i=e.iat||0,a=e.sub||e.user_id;if(!a)throw Error(`mockUserToken must contain 'sub' or 'user_id' field!`);let o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:a,user_id:a,firebase:{sign_in_provider:`custom`,identities:{}},...e};return[Mr(JSON.stringify(n)),Mr(JSON.stringify(o)),``].join(`.`)}var Yr={};function Xr(){let e={prod:[],emulator:[]};for(let t of Object.keys(Yr))Yr[t]?e.emulator.push(t):e.prod.push(t);return e}function Zr(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement(`div`),t.setAttribute(`id`,e),n=!0),{created:n,element:t}}var Qr=!1;function $r(e,t){if(typeof window>`u`||typeof document>`u`||!Kr(window.location.host)||Yr[e]===t||Yr[e]||Qr)return;Yr[e]=t;function n(e){return`__firebase__banner__${e}`}let r=`__firebase__banner`,i=Xr().prod.length>0;function a(){let e=document.getElementById(r);e&&e.remove()}function o(e){e.style.display=`flex`,e.style.background=`#7faaf0`,e.style.position=`fixed`,e.style.bottom=`5px`,e.style.left=`5px`,e.style.padding=`.5em`,e.style.borderRadius=`5px`,e.style.alignItems=`center`}function s(e,t){e.setAttribute(`width`,`24`),e.setAttribute(`id`,t),e.setAttribute(`height`,`24`),e.setAttribute(`viewBox`,`0 0 24 24`),e.setAttribute(`fill`,`none`),e.style.marginLeft=`-6px`}function c(){let e=document.createElement(`span`);return e.style.cursor=`pointer`,e.style.marginLeft=`16px`,e.style.fontSize=`24px`,e.innerHTML=` &times;`,e.onclick=()=>{Qr=!0,a()},e}function l(e,t){e.setAttribute(`id`,t),e.innerText=`Learn more`,e.href=`https://firebase.google.com/docs/studio/preview-apps#preview-backend`,e.setAttribute(`target`,`__blank`),e.style.paddingLeft=`5px`,e.style.textDecoration=`underline`}function u(){let e=Zr(r),t=n(`text`),a=document.getElementById(t)||document.createElement(`span`),u=n(`learnmore`),d=document.getElementById(u)||document.createElement(`a`),f=n(`preprendIcon`),p=document.getElementById(f)||document.createElementNS(`http://www.w3.org/2000/svg`,`svg`);if(e.created){let t=e.element;o(t),l(d,u);let n=c();s(p,f),t.append(p,a,d,n),document.body.appendChild(t)}i?(a.innerText=`Preview backend disconnected.`,p.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(p.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,a.innerText=`Preview backend running in this workspace.`),a.setAttribute(`id`,t)}document.readyState===`loading`?window.addEventListener(`DOMContentLoaded`,u):u()}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
function ei(){return typeof navigator<`u`&&typeof navigator.userAgent==`string`?navigator.userAgent:``}function ti(){return typeof window<`u`&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ei())}function ni(){return typeof navigator==`object`&&navigator.product===`ReactNative`}function ri(){return Tr.NODE_CLIENT===!0||Tr.NODE_ADMIN===!0}function ii(){try{return typeof indexedDB==`object`}catch{return!1}}function ai(){return new Promise((e,t)=>{try{let n=!0,r=`validate-browser-context-for-indexeddb-analytics-module`,i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{t(i.error?.message||``)}}catch(e){t(e)}})}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var oi=`FirebaseError`,si=class e extends Error{constructor(t,n,r){super(n),this.code=t,this.customData=r,this.name=oi,Object.setPrototypeOf(this,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ci.prototype.create)}},ci=class{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){let n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],a=i?li(i,n):`Error`,o=`${this.serviceName}: ${a} (${r}).`;return new si(r,o,n)}};function li(e,t){return e.replace(ui,(e,n)=>{let r=t[n];return r==null?`<${n}?>`:String(r)})}var ui=/\{\$([^}]+)}/g;
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
function di(e){return JSON.parse(e)}function fi(e){return JSON.stringify(e)}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var pi=function(e){let t={},n={},r={},i=``;try{let a=e.split(`.`);t=di(Nr(a[0])||``),n=di(Nr(a[1])||``),i=a[2],r=n.d||{},delete n.d}catch{}return{header:t,claims:n,data:r,signature:i}},mi=function(e){let t=pi(e),n=t.claims;return!!n&&typeof n==`object`&&n.hasOwnProperty(`iat`)},hi=function(e){let t=pi(e).claims;return typeof t==`object`&&t.admin===!0};
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
function gi(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function _i(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function vi(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function yi(e,t,n){let r={};for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function bi(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],a=t[i];if(xi(n)&&xi(a)){if(!bi(n,a))return!1}else if(n!==a)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function xi(e){return typeof e==`object`&&!!e}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
function Si(e){let t=[];for(let[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+`=`+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+`=`+encodeURIComponent(r));return t.length?`&`+t.join(`&`):``}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var Ci=class{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||=0;let n=this.W_;if(typeof e==`string`)for(let r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=n[e-3]^n[e-8]^n[e-14]^n[e-16];n[e]=(t<<1|t>>>31)&4294967295}let r=this.chain_[0],i=this.chain_[1],a=this.chain_[2],o=this.chain_[3],s=this.chain_[4],c,l;for(let e=0;e<80;e++){e<40?e<20?(c=o^i&(a^o),l=1518500249):(c=i^a^o,l=1859775393):e<60?(c=i&a|o&(i|a),l=2400959708):(c=i^a^o,l=3395469782);let t=(r<<5|r>>>27)+c+s+l+n[e]&4294967295;s=o,o=a,a=(i<<30|i>>>2)&4294967295,i=r,r=t}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+i&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+o&4294967295,this.chain_[4]=this.chain_[4]+s&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);let n=t-this.blockSize,r=0,i=this.buf_,a=this.inbuf_;for(;r<t;){if(a===0)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if(typeof e==`string`){for(;r<t;)if(i[a]=e.charCodeAt(r),++a,++r,a===this.blockSize){this.compress_(i),a=0;break}}else for(;r<t;)if(i[a]=e[r],++a,++r,a===this.blockSize){this.compress_(i),a=0;break}}this.inbuf_=a,this.total_+=t}digest(){let e=[],t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=t&255,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let r=24;r>=0;r-=8)e[n]=this.chain_[t]>>r&255,++n;return e}};function wi(e,t){return`${e} failed: ${t} argument `}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var Ti=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){let t=i-55296;r++,V(r<e.length,`Surrogate pair missing trail surrogate.`);let n=e.charCodeAt(r)-56320;i=65536+(t<<10)+n}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=i&63|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=i&63|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=i&63|128)}return t},Ei=function(e){let t=0;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};
/**
* @license
* Copyright 2021 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
function Di(e){return e&&e._delegate?e._delegate:e}var Oi=class{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode=`LAZY`,this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}},ki=`[DEFAULT]`,Ai=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new Gr;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}else if(n)return null;else throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(Mi(e))try{this.getOrInitializeService({instanceIdentifier:ki})}catch{}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch{}}}}clearInstance(e=ki){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>`INTERNAL`in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>`_delete`in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ki){return this.instances.has(e)}getOptions(e=ki){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(e);n===i&&t.resolve(r)}return r}onInit(e,t){let n=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);let i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:ji(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=ki){return this.component?this.component.multipleInstances?e:ki:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!==`EXPLICIT`}};function ji(e){return e===ki?void 0:e}function Mi(e){return e.instantiationMode===`EAGER`}
/**
* @license
* Copyright 2019 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var Ni=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new Ai(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}},Pi=[],Fi;(function(e){e[e.DEBUG=0]=`DEBUG`,e[e.VERBOSE=1]=`VERBOSE`,e[e.INFO=2]=`INFO`,e[e.WARN=3]=`WARN`,e[e.ERROR=4]=`ERROR`,e[e.SILENT=5]=`SILENT`})(Fi||={});var Ii={debug:Fi.DEBUG,verbose:Fi.VERBOSE,info:Fi.INFO,warn:Fi.WARN,error:Fi.ERROR,silent:Fi.SILENT},Li=Fi.INFO,Ri={[Fi.DEBUG]:`log`,[Fi.VERBOSE]:`log`,[Fi.INFO]:`info`,[Fi.WARN]:`warn`,[Fi.ERROR]:`error`},zi=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=Ri[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)},Bi=class{constructor(e){this.name=e,this._logLevel=Li,this._logHandler=zi,this._userLogHandler=null,Pi.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Fi))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e==`string`?Ii[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!=`function`)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Fi.DEBUG,...e),this._logHandler(this,Fi.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Fi.VERBOSE,...e),this._logHandler(this,Fi.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Fi.INFO,...e),this._logHandler(this,Fi.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Fi.WARN,...e),this._logHandler(this,Fi.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Fi.ERROR,...e),this._logHandler(this,Fi.ERROR,...e)}},Vi=(e,t)=>t.some(t=>e instanceof t),Hi,Ui;function Wi(){return Hi||=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]}function Gi(){return Ui||=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]}var Ki=new WeakMap,qi=new WeakMap,Ji=new WeakMap,Yi=new WeakMap,Xi=new WeakMap;function Zi(e){let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener(`success`,i),e.removeEventListener(`error`,a)},i=()=>{t(ra(e.result)),r()},a=()=>{n(e.error),r()};e.addEventListener(`success`,i),e.addEventListener(`error`,a)});return t.then(t=>{t instanceof IDBCursor&&Ki.set(t,e)}).catch(()=>{}),Xi.set(t,e),t}function Qi(e){if(qi.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener(`complete`,i),e.removeEventListener(`error`,a),e.removeEventListener(`abort`,a)},i=()=>{t(),r()},a=()=>{n(e.error||new DOMException(`AbortError`,`AbortError`)),r()};e.addEventListener(`complete`,i),e.addEventListener(`error`,a),e.addEventListener(`abort`,a)});qi.set(e,t)}var $i={get(e,t,n){if(e instanceof IDBTransaction){if(t===`done`)return qi.get(e);if(t===`objectStoreNames`)return e.objectStoreNames||Ji.get(e);if(t===`store`)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ra(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t===`done`||t===`store`)?!0:t in e}};function ea(e){$i=e($i)}function ta(e){return e===IDBDatabase.prototype.transaction&&!(`objectStoreNames`in IDBTransaction.prototype)?function(t,...n){let r=e.call(ia(this),t,...n);return Ji.set(r,t.sort?t.sort():[t]),ra(r)}:Gi().includes(e)?function(...t){return e.apply(ia(this),t),ra(Ki.get(this))}:function(...t){return ra(e.apply(ia(this),t))}}function na(e){return typeof e==`function`?ta(e):(e instanceof IDBTransaction&&Qi(e),Vi(e,Wi())?new Proxy(e,$i):e)}function ra(e){if(e instanceof IDBRequest)return Zi(e);if(Yi.has(e))return Yi.get(e);let t=na(e);return t!==e&&(Yi.set(e,t),Xi.set(t,e)),t}var ia=e=>Xi.get(e);function aa(e,t,{blocked:n,upgrade:r,blocking:i,terminated:a}={}){let o=indexedDB.open(e,t),s=ra(o);return r&&o.addEventListener(`upgradeneeded`,e=>{r(ra(o.result),e.oldVersion,e.newVersion,ra(o.transaction),e)}),n&&o.addEventListener(`blocked`,e=>n(e.oldVersion,e.newVersion,e)),s.then(e=>{a&&e.addEventListener(`close`,()=>a()),i&&e.addEventListener(`versionchange`,e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}var oa=[`get`,`getKey`,`getAll`,`getAllKeys`,`count`],sa=[`put`,`add`,`delete`,`clear`],ca=new Map;function la(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t==`string`))return;if(ca.get(t))return ca.get(t);let n=t.replace(/FromIndex$/,``),r=t!==n,i=sa.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||oa.includes(n)))return;let a=async function(e,...t){let a=this.transaction(e,i?`readwrite`:`readonly`),o=a.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&a.done]))[0]};return ca.set(t,a),a}ea(e=>({...e,get:(t,n,r)=>la(t,n)||e.get(t,n,r),has:(t,n)=>!!la(t,n)||e.has(t,n)}));
/**
* @license
* Copyright 2019 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var ua=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(da(e)){let t=e.getImmediate();return`${t.library}/${t.version}`}else return null}).filter(e=>e).join(` `)}};function da(e){return e.getComponent()?.type===`VERSION`}var fa=`@firebase/app`,pa=`0.14.3`,ma=new Bi(`@firebase/app`),ha=`@firebase/app-compat`,ga=`@firebase/analytics-compat`,_a=`@firebase/analytics`,va=`@firebase/app-check-compat`,ya=`@firebase/app-check`,ba=`@firebase/auth`,xa=`@firebase/auth-compat`,Sa=`@firebase/database`,Ca=`@firebase/data-connect`,wa=`@firebase/database-compat`,Ta=`@firebase/functions`,Ea=`@firebase/functions-compat`,Da=`@firebase/installations`,Oa=`@firebase/installations-compat`,ka=`@firebase/messaging`,Aa=`@firebase/messaging-compat`,ja=`@firebase/performance`,Ma=`@firebase/performance-compat`,Na=`@firebase/remote-config`,Pa=`@firebase/remote-config-compat`,Fa=`@firebase/storage`,Ia=`@firebase/storage-compat`,La=`@firebase/firestore`,Ra=`@firebase/ai`,za=`@firebase/firestore-compat`,Ba=`firebase`,Va=`12.3.0`,Ha=`[DEFAULT]`,Ua={[fa]:`fire-core`,[ha]:`fire-core-compat`,[_a]:`fire-analytics`,[ga]:`fire-analytics-compat`,[ya]:`fire-app-check`,[va]:`fire-app-check-compat`,[ba]:`fire-auth`,[xa]:`fire-auth-compat`,[Sa]:`fire-rtdb`,[Ca]:`fire-data-connect`,[wa]:`fire-rtdb-compat`,[Ta]:`fire-fn`,[Ea]:`fire-fn-compat`,[Da]:`fire-iid`,[Oa]:`fire-iid-compat`,[ka]:`fire-fcm`,[Aa]:`fire-fcm-compat`,[ja]:`fire-perf`,[Ma]:`fire-perf-compat`,[Na]:`fire-rc`,[Pa]:`fire-rc-compat`,[Fa]:`fire-gcs`,[Ia]:`fire-gcs-compat`,[La]:`fire-fst`,[za]:`fire-fst-compat`,[Ra]:`fire-vertex`,"fire-js":`fire-js`,[Ba]:`fire-js-all`},Wa=new Map,Ga=new Map,Ka=new Map;function qa(e,t){try{e.container.addComponent(t)}catch(n){ma.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Ja(e){let t=e.name;if(Ka.has(t))return ma.debug(`There were multiple attempts to register component ${t}.`),!1;Ka.set(t,e);for(let t of Wa.values())qa(t,e);for(let t of Ga.values())qa(t,e);return!0}function Ya(e,t){let n=e.container.getProvider(`heartbeat`).getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function Xa(e){return e==null?!1:e.settings!==void 0}var Za=new ci(`app`,`Firebase`,{"no-app":`No Firebase App '{$appName}' has been created - call initializeApp() first`,"bad-app-name":`Illegal App name: '{$appName}'`,"duplicate-app":`Firebase App named '{$appName}' already exists with different options or config`,"app-deleted":`Firebase App named '{$appName}' already deleted`,"server-app-deleted":`Firebase Server App has been deleted`,"no-options":`Need to provide options, when not being deployed to hosting via source.`,"invalid-app-argument":`firebase.{$appName}() takes either no argument or a Firebase App instance.`,"invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":`Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.`,"idb-get":`Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.`,"idb-set":`Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.`,"idb-delete":`Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.`,"finalization-registry-not-supported":`FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.`,"invalid-server-app-environment":`FirebaseServerApp is not for use in browser environments.`}),Qa=class{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Oi(`app`,()=>this,`PUBLIC`))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Za.create(`app-deleted`,{appName:this._name})}},$a=Va;function eo(e,t={}){let n=e;typeof t!=`object`&&(t={name:t});let r={name:Ha,automaticDataCollectionEnabled:!0,...t},i=r.name;if(typeof i!=`string`||!i)throw Za.create(`bad-app-name`,{appName:String(i)});if(n||=Wr(),!n)throw Za.create(`no-options`);let a=Wa.get(i);if(a){if(bi(n,a.options)&&bi(r,a.config))return a;throw Za.create(`duplicate-app`,{appName:i})}let o=new Ni(i);for(let e of Ka.values())o.addComponent(e);let s=new Qa(n,r,o);return Wa.set(i,s),s}function to(e=Ha){let t=Wa.get(e);if(!t&&e===`[DEFAULT]`&&Wr())return eo();if(!t)throw Za.create(`no-app`,{appName:e});return t}function no(e,t,n){let r=Ua[e]??e;n&&(r+=`-${n}`);let i=r.match(/\s|\//),a=t.match(/\s|\//);if(i||a){let e=[`Unable to register library "${r}" with version "${t}":`];i&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&a&&e.push(`and`),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ma.warn(e.join(` `));return}Ja(new Oi(`${r}-version`,()=>({library:r,version:t}),`VERSION`))}
/**
* @license
* Copyright 2021 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var ro=`firebase-heartbeat-database`,io=1,ao=`firebase-heartbeat-store`,oo=null;function so(){return oo||=aa(ro,io,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(ao)}catch(e){console.warn(e)}}}}).catch(e=>{throw Za.create(`idb-open`,{originalErrorMessage:e.message})}),oo}async function co(e){try{let t=(await so()).transaction(ao),n=await t.objectStore(ao).get(uo(e));return await t.done,n}catch(e){if(e instanceof si)ma.warn(e.message);else{let t=Za.create(`idb-get`,{originalErrorMessage:e?.message});ma.warn(t.message)}}}async function lo(e,t){try{let n=(await so()).transaction(ao,`readwrite`);await n.objectStore(ao).put(t,uo(e)),await n.done}catch(e){if(e instanceof si)ma.warn(e.message);else{let t=Za.create(`idb-set`,{originalErrorMessage:e?.message});ma.warn(t.message)}}}function uo(e){return`${e.name}!${e.options.appId}`}
/**
* @license
* Copyright 2021 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var fo=1024,po=30,mo=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider(`app`).getImmediate();this._storage=new _o(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider(`platform-logger`).getImmediate().getPlatformInfoString(),t=ho();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>po){let e=yo(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ma.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return``;let e=ho(),{heartbeatsToSend:t,unsentEntries:n}=go(this._heartbeatsCache.heartbeats),r=Mr(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return ma.warn(e),``}}};function ho(){return new Date().toISOString().substring(0,10)}function go(e,t=fo){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),vo(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),vo(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}var _o=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ii()?ai().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){let e=await co(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return lo(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return lo(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}else return}};function vo(e){return Mr(JSON.stringify({version:2,heartbeats:e})).length}function yo(e){if(e.length===0)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}
/**
* @license
* Copyright 2019 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
function bo(e){Ja(new Oi(`platform-logger`,e=>new ua(e),`PRIVATE`)),Ja(new Oi(`heartbeat`,e=>new mo(e),`PRIVATE`)),no(fa,pa,e),no(fa,pa,`esm2020`),no(`fire-js`,``)}bo(``);var xo=`@firebase/database`,So=`1.1.0`,H=``;function Co(e){H=e}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var wo=class{constructor(e){this.domStorage_=e,this.prefix_=`firebase:`}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),fi(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:di(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}},To=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return gi(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}},Eo=function(e){try{if(typeof window<`u`&&window[e]!==void 0){let t=window[e];return t.setItem(`firebase:sentinel`,`cache`),t.removeItem(`firebase:sentinel`),new wo(t)}}catch{}return new To},Do=Eo(`localStorage`),Oo=Eo(`sessionStorage`),ko=new Bi(`@firebase/database`),Ao=(function(){let e=1;return function(){return e++}})(),jo=function(e){let t=Ti(e),n=new Ci;n.update(t);let r=n.digest();return kr.encodeByteArray(r)},Mo=function(...e){let t=``;for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)||r&&typeof r==`object`&&typeof r.length==`number`?t+=Mo.apply(null,r):typeof r==`object`?t+=fi(r):t+=r,t+=` `}return t},No=null,Po=!0,Fo=function(e,t){V(!t||e===!0||e===!1,`Can't turn on custom loggers persistently.`),e===!0?(ko.logLevel=Fi.VERBOSE,No=ko.log.bind(ko),t&&Oo.set(`logging_enabled`,!0)):typeof e==`function`?No=e:(No=null,Oo.remove(`logging_enabled`))},Io=function(...e){if(Po===!0&&(Po=!1,No===null&&Oo.get(`logging_enabled`)===!0&&Fo(!0)),No){let t=Mo.apply(null,e);No(t)}},Lo=function(e){return function(...t){Io(e,...t)}},Ro=function(...e){let t=`FIREBASE INTERNAL ERROR: `+Mo(...e);ko.error(t)},zo=function(...e){let t=`FIREBASE FATAL ERROR: ${Mo(...e)}`;throw ko.error(t),Error(t)},Bo=function(...e){let t=`FIREBASE WARNING: `+Mo(...e);ko.warn(t)},Vo=function(){typeof window<`u`&&window.location&&window.location.protocol&&window.location.protocol.indexOf(`https:`)!==-1&&Bo(`Insecure Firebase access from a secure page. Please use https in calls to new Firebase().`)},Ho=function(e){return typeof e==`number`&&(e!==e||e===1/0||e===-1/0)},Uo=function(e){if(ri()||document.readyState===`complete`)e();else{let t=!1,n=function(){if(!document.body){setTimeout(n,10);return}t||(t=!0,e())};document.addEventListener?(document.addEventListener(`DOMContentLoaded`,n,!1),window.addEventListener(`load`,n,!1)):document.attachEvent&&(document.attachEvent(`onreadystatechange`,()=>{document.readyState===`complete`&&n()}),window.attachEvent(`onload`,n))}},Wo=`[MIN_NAME]`,Go=`[MAX_NAME]`,Ko=function(e,t){if(e===t)return 0;if(e===Wo||t===Go)return-1;if(t===Wo||e===Go)return 1;{let n=ss(e),r=ss(t);return n===null?r===null&&e<t?-1:1:r===null?-1:n-r===0?e.length-t.length:n-r}},qo=function(e,t){return e===t?0:e<t?-1:1},Jo=function(e,t){if(t&&e in t)return t[e];throw Error(`Missing required key (`+e+`) in object: `+fi(t))},Yo=function(e){if(typeof e!=`object`||!e)return fi(e);let t=[];for(let n in e)t.push(n);t.sort();let n=`{`;for(let r=0;r<t.length;r++)r!==0&&(n+=`,`),n+=fi(t[r]),n+=`:`,n+=Yo(e[t[r]]);return n+=`}`,n},Xo=function(e,t){let n=e.length;if(n<=t)return[e];let r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function Zo(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}var Qo=function(e){V(!Ho(e),`Invalid JSON number`);let t=1023,n,r,i,a,o;e===0?(r=0,i=0,n=1/e==-1/0?1:0):(n=e<0,e=Math.abs(e),e>=2**(1-t)?(a=Math.min(Math.floor(Math.log(e)/Math.LN2),t),r=a+t,i=Math.round(e*2**(52-a)-2**52)):(r=0,i=Math.round(e/2**(1-t-52))));let s=[];for(o=52;o;--o)s.push(i%2?1:0),i=Math.floor(i/2);for(o=11;o;--o)s.push(r%2?1:0),r=Math.floor(r/2);s.push(n?1:0),s.reverse();let c=s.join(``),l=``;for(o=0;o<64;o+=8){let e=parseInt(c.substr(o,8),2).toString(16);e.length===1&&(e=`0`+e),l+=e}return l.toLowerCase()},$o=function(){return!!(typeof window==`object`&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},es=function(){return typeof Windows==`object`&&typeof Windows.UI==`object`};function ts(e,t){let n=`Unknown Error`;e===`too_big`?n=`The data requested exceeds the maximum size that can be accessed with a single request.`:e===`permission_denied`?n=`Client doesn't have permission to access the desired data.`:e===`unavailable`&&(n=`The service is unavailable`);let r=Error(e+` at `+t._path.toString()+`: `+n);return r.code=e.toUpperCase(),r}var ns=RegExp(`^-?(0*)\\d{1,10}$`),rs=-2147483648,os=2147483647,ss=function(e){if(ns.test(e)){let t=Number(e);if(t>=rs&&t<=os)return t}return null},cs=function(e){try{e()}catch(e){setTimeout(()=>{let t=e.stack||``;throw Bo(`Exception was thrown by user callback.`,t),e},0)}},ls=function(){return(typeof window==`object`&&window.navigator&&window.navigator.userAgent||``).search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},us=function(e,t){let n=setTimeout(e,t);return typeof n==`number`&&typeof Deno<`u`&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n==`object`&&n.unref&&n.unref(),n},ds=class{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Xa(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){Bo(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}},fs=class{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&e.code===`auth/token-not-initialized`?(Io(`Got auth/token-not-initialized error.  Treating as null token.`),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e=`Provided authentication credentials for the app named "`+this.appName_+`" are invalid. This usually indicates your app was not initialized correctly. `;`credential`in this.firebaseOptions_?e+=`Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.`:`serviceAccount`in this.firebaseOptions_?e+=`Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.`:e+=`Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.`,Bo(e)}},ps=class{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}};ps.OWNER=`owner`;
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var ms=`5`,hs=`v`,gs=`s`,_s=`r`,vs=`f`,ys=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,bs=`ls`,xs=`p`,Ss=`ac`,Cs=`websocket`,ws=`long_polling`,Ts=class{constructor(e,t,n,r,i=!1,a=``,o=!1,s=!1,c=null){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=a,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=s,this.emulatorOptions=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(`.`)+1),this.internalHost=Do.get(`host:`+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)===`s-`}isCustomHost(){return this._domain!==`firebaseio.com`&&this._domain!==`firebaseio-demo.com`}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Do.set(`host:`+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+=`<`+this.persistenceKey+`>`),e}toURLString(){let e=this.secure?`https://`:`http://`,t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:``;return`${e}${this.host}/${t}`}};function Es(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams}function Ds(e,t,n){V(typeof t==`string`,`typeof type must == string`),V(typeof n==`object`,`typeof params must == object`);let r;if(t===Cs)r=(e.secure?`wss://`:`ws://`)+e.internalHost+`/.ws?`;else if(t===ws)r=(e.secure?`https://`:`http://`)+e.internalHost+`/.lp?`;else throw Error(`Unknown connection type: `+t);Es(e)&&(n.ns=e.namespace);let i=[];return Zo(n,(e,t)=>{i.push(e+`=`+t)}),r+i.join(`&`)}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var Os=class{constructor(){this.counters_={}}incrementCounter(e,t=1){gi(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Pr(this.counters_)}},ks={},As={};function js(e){let t=e.toString();return ks[t]||(ks[t]=new Os),ks[t]}function Ms(e,t){let n=e.toString();return As[n]||(As[n]=t()),As[n]}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var Ns=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&cs(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&=(this.onClose(),null);break}this.currentResponseNum++}}},Ps=`start`,Fs=`close`,Is=`pLPCommand`,Ls=`pRTLPCB`,Rs=`id`,zs=`pw`,Bs=`ser`,Vs=`cb`,Hs=`dframe`,Us=1870,Ws=30,Gs=Us-Ws,Ks=25e3,qs=3e4,Js=class e{constructor(e,t,n,r,i,a,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=a,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Lo(e),this.stats_=js(t),this.urlFn=e=>(this.appCheckToken&&(e[Ss]=this.appCheckToken),Ds(t,ws,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Ns(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_(`Timed out trying to connect.`),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(qs)),Uo(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ys((...e)=>{let[t,n,r,i,a]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&=(clearTimeout(this.connectTimeoutTimer_),null),this.everConnected_=!0,t===Ps)this.id=n,this.password=r;else if(t===Fs)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error(`Unrecognized command received: `+t)},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[Ps]=`t`,e[Bs]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(e[Vs]=this.scriptTagHolder.uniqueCallbackIdentifier),e[hs]=ms,this.transportSessionId&&(e[gs]=this.transportSessionId),this.lastSessionId&&(e[bs]=this.lastSessionId),this.applicationId&&(e[xs]=this.applicationId),this.appCheckToken&&(e[Ss]=this.appCheckToken),typeof location<`u`&&location.hostname&&ys.test(location.hostname)&&(e[_s]=vs);let t=this.urlFn(e);this.log_(`Connecting via long-poll to `+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){e.forceAllow_=!0}static forceDisallow(){e.forceDisallow_=!0}static isAvailable(){return ri()?!1:e.forceAllow_?!0:!e.forceDisallow_&&typeof document<`u`&&document.createElement!=null&&!$o()&&!es()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&=(this.scriptTagHolder.close(),null),this.myDisconnFrame&&=(document.body.removeChild(this.myDisconnFrame),null),this.connectTimeoutTimer_&&=(clearTimeout(this.connectTimeoutTimer_),null)}onClosed_(){this.isClosed_||(this.log_(`Longpoll is closing itself`),this.shutdown_(),this.onDisconnect_&&=(this.onDisconnect_(this.everConnected_),null))}close(){this.isClosed_||(this.log_(`Longpoll is being closed.`),this.shutdown_())}send(e){let t=fi(e);this.bytesSent+=t.length,this.stats_.incrementCounter(`bytes_sent`,t.length);let n=jr(t),r=Xo(n,Gs);for(let e=0;e<r.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(ri())return;this.myDisconnFrame=document.createElement(`iframe`);let n={};n[Hs]=`t`,n[Rs]=e,n[zs]=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display=`none`,document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=fi(e).length;this.bytesReceived+=t,this.stats_.incrementCounter(`bytes_received`,t)}},Ys=class e{constructor(t,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,ri())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=Ao(),window[Is+this.uniqueCallbackIdentifier]=t,window[Ls+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();let r=``;this.myIFrame.src&&this.myIFrame.src.substr(0,11)===`javascript:`&&(r=`<script>document.domain="`+document.domain+`";<\/script>`);let i=`<html><body>`+r+`</body></html>`;try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){Io(`frame writing exception`),e.stack&&Io(e.stack),Io(e)}}}static createIFrame_(){let e=document.createElement(`iframe`);if(e.style.display=`none`,document.body){document.body.appendChild(e);try{e.contentWindow.document||Io(`No IE domain setting required`)}catch{e.src=`javascript:void((function(){document.open();document.domain='`+document.domain+`';document.close();})())`}}else throw`Document body has not initialized. Wait to initialize Firebase until after the document is ready.`;return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent=``,setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},0));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[Rs]=this.myID,e[zs]=this.myPW,e[Bs]=this.currentSerial;let t=this.urlFn(e),n=``,r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Ws+n.length<=Us;){let e=this.pendingSegs.shift();n=n+`&seg`+r+`=`+e.seg+`&ts`+r+`=`+e.ts+`&d`+r+`=`+e.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(Ks));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,t){ri()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement(`script`);n.type=`text/javascript`,n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;(!e||e===`loaded`||e===`complete`)&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{Io(`Long-poll script failed to load: `+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},1)}},Xs=16384,Zs=45e3,Qs=null;typeof MozWebSocket<`u`?Qs=MozWebSocket:typeof WebSocket<`u`&&(Qs=WebSocket);var $s=class e{constructor(t,n,r,i,a,o,s){this.connId=t,this.applicationId=r,this.appCheckToken=i,this.authToken=a,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Lo(this.connId),this.stats_=js(n),this.connURL=e.connectionURL_(n,o,s,i,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,t,n,r,i){let a={};return a[hs]=ms,!ri()&&typeof location<`u`&&location.hostname&&ys.test(location.hostname)&&(a[_s]=vs),t&&(a[gs]=t),n&&(a[bs]=n),r&&(a[Ss]=r),i&&(a[xs]=i),Ds(e,Cs,a)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_(`Websocket connecting to `+this.connURL),this.everConnected_=!1,Do.set(`previous_websocket_failure`,!0);try{let e;if(ri()){let t=this.nodeAdmin?`AdminNode`:`Node`;e={headers:{"User-Agent":`Firebase/${ms}/${H}/${process.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||``}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers[`X-Firebase-AppCheck`]=this.appCheckToken);let n={},r=this.connURL.indexOf(`wss://`)===0?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;r&&(e.proxy={origin:r})}this.mySock=new Qs(this.connURL,[],e)}catch(e){this.log_(`Error instantiating WebSocket.`);let t=e.message||e.data;t&&this.log_(t),this.onClosed_();return}this.mySock.onopen=()=>{this.log_(`Websocket connected.`),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_(`Websocket connection was disconnected.`),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_(`WebSocket error.  Closing connection.`);let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){e.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<`u`&&navigator.userAgent){let e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&e.length>1&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&Qs!==null&&!e.forceDisallow_}static previouslyFailed(){return Do.isInMemoryStorage||Do.get(`previous_websocket_failure`)===!0}markConnectionHealthy(){Do.remove(`previous_websocket_failure`)}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join(``);this.frames=null;let t=di(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(V(this.frames===null,`We already have a frame buffer`),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter(`bytes_received`,t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);e!==null&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=fi(e);this.bytesSent+=t.length,this.stats_.incrementCounter(`bytes_sent`,t.length);let n=Xo(t,Xs);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&=(clearInterval(this.keepaliveTimer),null),this.mySock&&=(this.mySock.close(),null)}onClosed_(){this.isClosed_||(this.log_(`WebSocket is closing itself`),this.shutdown_(),this.onDisconnect&&=(this.onDisconnect(this.everConnected_),null))}close(){this.isClosed_||(this.log_(`WebSocket is being closed`),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_(`0`),this.resetKeepAlive()},Math.floor(Zs))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_(`Exception thrown from WebSocket.send():`,e.message||e.data,`Closing connection.`),setTimeout(this.onClosed_.bind(this),0)}}};$s.responsesRequiredToBeHealthy=2,$s.healthyTimeout=3e4;
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var ec=class e{static get ALL_TRANSPORTS(){return[Js,$s]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(t){let n=$s&&$s.isAvailable(),r=n&&!$s.previouslyFailed();if(t.webSocketOnly&&(n||Bo(`wss:// URL used, but browser isn't known to support websockets.  Trying anyway.`),r=!0),r)this.transports_=[$s];else{let t=this.transports_=[];for(let n of e.ALL_TRANSPORTS)n&&n.isAvailable()&&t.push(n);e.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error(`No transports available`)}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}};ec.globalTransportInitialized_=!1;
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var tc=6e4,nc=5e3,rc=10*1024,ic=100*1024,ac=`t`,oc=`d`,sc=`s`,cc=`r`,lc=`e`,uc=`o`,dc=`a`,fc=`n`,pc=`p`,mc=`h`,hc=class{constructor(e,t,n,r,i,a,o,s,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=a,this.onReady_=o,this.onDisconnect_=s,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Lo(`c:`+this.id+`:`),this.transportManager_=new ec(t),this.log_(`Connection created`),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},0);let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=us(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>ic?(this.log_(`Connection exceeded healthy timeout but has received `+this.conn_.bytesReceived+` bytes.  Marking connection healthy.`),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>rc?this.log_(`Connection exceeded healthy timeout but has sent `+this.conn_.bytesSent+` bytes.  Leaving connection alive.`):(this.log_(`Closing unhealthy connection after timeout.`),this.close()))},Math.floor(r)))}nextTransportId_(){return`c:`+this.id+`:`+ this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_(`Secondary connection lost.`),this.onSecondaryConnectionLost_()):this.log_(`closing an old connection`)}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_(`message on old connection`))}}sendRequest(e){let t={t:`d`,d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_(`cleaning up and promoting a connection: `+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(ac in e){let t=e[ac];t===dc?this.upgradeIfSecondaryHealthy_():t===cc?(this.log_(`Got a reset on secondary, closing it`),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===uc&&(this.log_(`got pong on secondary.`),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=Jo(`t`,e),n=Jo(`d`,e);if(t===`c`)this.onSecondaryControl_(n);else if(t===`d`)this.pendingDataMessages.push(n);else throw Error(`Unknown protocol layer: `+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_(`Secondary connection is healthy.`),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_(`sending ping on secondary.`),this.secondaryConn_.send({t:`c`,d:{t:pc,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_(`sending client ack on secondary`),this.secondaryConn_.send({t:`c`,d:{t:dc,d:{}}}),this.log_(`Ending transmission on primary`),this.conn_.send({t:`c`,d:{t:fc,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=Jo(`t`,e),n=Jo(`d`,e);t===`c`?this.onControl_(n):t===`d`&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_(`Primary connection is healthy.`),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=Jo(ac,e);if(oc in e){let n=e[oc];if(t===mc){let e={...n};this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if(t===fc){this.log_(`recvd end transmission on primary`),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===sc?this.onConnectionShutdown_(n):t===cc?this.onReset_(n):t===lc?Ro(`Server Error: `+n):t===uc?(this.log_(`got pong on primary.`),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ro(`Unknown control packet command: `+t)}}onHandshake_(e){let t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),ms!==n&&Bo(`Protocol version mismatch detected`),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),us(()=>{this.secondaryConn_&&(this.log_(`Timed out trying to upgrade.`),this.secondaryConn_.close())},Math.floor(tc))}onReset_(e){this.log_(`Reset packet received.  New host: `+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_(`Realtime connection established.`),this.conn_=e,this.state_=1,this.onReady_&&=(this.onReady_(t,this.sessionId),null),this.primaryResponsesRequired_===0?(this.log_(`Primary connection is healthy.`),this.isHealthy_=!0):us(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(nc))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_(`sending ping on primary.`),this.sendData_({t:`c`,d:{t:pc,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_(`Realtime connection failed.`),this.repoInfo_.isCacheableHost()&&(Do.remove(`host:`+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_(`Realtime connection lost.`),this.close()}onConnectionShutdown_(e){this.log_(`Connection shutdown command received. Shutting down...`),this.onKill_&&=(this.onKill_(e),null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw`Connection is not connected`;this.tx_.send(e)}close(){this.state_!==2&&(this.log_(`Closing realtime connection.`),this.state_=2,this.closeConnections_(),this.onDisconnect_&&=(this.onDisconnect_(),null))}closeConnections_(){this.log_(`Shutting down all connections`),this.conn_&&=(this.conn_.close(),null),this.secondaryConn_&&=(this.secondaryConn_.close(),null),this.healthyTimeout_&&=(clearTimeout(this.healthyTimeout_),null)}},gc=class{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}},_c=class{constructor(e){this.allowedEvents_=e,this.listeners_={},V(Array.isArray(e)&&e.length>0,`Requires a non-empty array`)}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context)){r.splice(e,1);return}}validateEventType_(e){V(this.allowedEvents_.find(t=>t===e),`Unknown event: `+e)}},vc=class e extends _c{static getInstance(){return new e}constructor(){super([`online`]),this.online_=!0,typeof window<`u`&&window.addEventListener!==void 0&&!ti()&&(window.addEventListener(`online`,()=>{this.online_||(this.online_=!0,this.trigger(`online`,!0))},!1),window.addEventListener(`offline`,()=>{this.online_&&(this.online_=!1,this.trigger(`online`,!1))},!1))}getInitialEvent(e){return V(e===`online`,`Unknown event type: `+e),[this.online_]}currentlyOnline(){return this.online_}},yc=32,bc=768,xc=class{constructor(e,t){if(t===void 0){this.pieces_=e.split(`/`);let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e=``;for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==``&&(e+=`/`+this.pieces_[t]);return e||`/`}};function Sc(){return new xc(``)}function U(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Cc(e){return e.pieces_.length-e.pieceNum_}function wc(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new xc(e.pieces_,t)}function Tc(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Ec(e){let t=``;for(let n=e.pieceNum_;n<e.pieces_.length;n++)e.pieces_[n]!==``&&(t+=`/`+encodeURIComponent(String(e.pieces_[n])));return t||`/`}function Dc(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function Oc(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new xc(t,0)}function kc(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof xc)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split(`/`);for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new xc(n,0)}function W(e){return e.pieceNum_>=e.pieces_.length}function Ac(e,t){let n=U(e),r=U(t);if(n===null)return t;if(n===r)return Ac(wc(e),wc(t));throw Error(`INTERNAL ERROR: innerPath (`+t+`) is not within outerPath (`+e+`)`)}function jc(e,t){let n=Dc(e,0),r=Dc(t,0);for(let e=0;e<n.length&&e<r.length;e++){let t=Ko(n[e],r[e]);if(t!==0)return t}return n.length===r.length?0:n.length<r.length?-1:1}function Mc(e,t){if(Cc(e)!==Cc(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function Nc(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(Cc(e)>Cc(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}var Pc=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Dc(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=Ei(this.parts_[e]);Lc(this)}};function Fc(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=Ei(t),Lc(e)}function Ic(e){let t=e.parts_.pop();e.byteLength_-=Ei(t),e.parts_.length>0&&--e.byteLength_}function Lc(e){if(e.byteLength_>bc)throw Error(e.errorPrefix_+`has a key path longer than 768 bytes (`+e.byteLength_+`).`);if(e.parts_.length>yc)throw Error(e.errorPrefix_+`path specified exceeds the maximum depth that can be written (32) or object contains a cycle `+Rc(e))}function Rc(e){return e.parts_.length===0?``:`in property '`+e.parts_.join(`.`)+`'`}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var zc=class e extends _c{static getInstance(){return new e}constructor(){super([`visible`]);let e,t;typeof document<`u`&&document.addEventListener!==void 0&&(document.hidden===void 0?document.mozHidden===void 0?document.msHidden===void 0?document.webkitHidden!==void 0&&(t=`webkitvisibilitychange`,e=`webkitHidden`):(t=`msvisibilitychange`,e=`msHidden`):(t=`mozvisibilitychange`,e=`mozHidden`):(t=`visibilitychange`,e=`hidden`)),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger(`visible`,t))},!1)}getInitialEvent(e){return V(e===`visible`,`Unknown event type: `+e),[this.visible_]}},Bc=1e3,Vc=300*1e3,Hc=30*1e3,Uc=1.3,Wc=3e4,Gc=`server_kill`,Kc=3,qc=class e extends gc{constructor(t,n,r,i,a,o,s,c){if(super(),this.repoInfo_=t,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=a,this.authTokenProvider_=o,this.appCheckTokenProvider_=s,this.authOverride_=c,this.id=e.nextPersistentConnectionId_++,this.log_=Lo(`p:`+this.id+`:`),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Bc,this.maxReconnectDelay_=Vc,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!ri())throw Error(`Auth override specified in options, but not supported on non Node.js platforms`);zc.getInstance().on(`visible`,this.onVisible_,this),t.host.indexOf(`fblocal`)===-1&&vc.getInstance().on(`online`,this.onOnline_,this)}sendRequest(e,t,n){let r=++this.requestNumber_,i={r,a:e,b:t};this.log_(fi(i)),V(this.connected_,`sendRequest call when we're not connected not allowed.`),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();let t=new Gr,n={action:`g`,request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{let n=e.d;e.s===`ok`?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;let r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,r){this.initConnection_();let i=e._queryIdentifier,a=e._path.toString();this.log_(`Listen called for `+a+` `+i),this.listens.has(a)||this.listens.set(a,new Map),V(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),`listen() called for non-default but complete query`),V(!this.listens.get(a).has(i),`listen() called twice for same path/queryId.`);let o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(a).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest(`g`,t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(t){let n=t.query,r=n._path.toString(),i=n._queryIdentifier;this.log_(`Listen on `+r+` for `+i);let a={p:r};t.tag&&(a.q=n._queryObject,a.t=t.tag),a.h=t.hashFn(),this.sendRequest(`q`,a,a=>{let o=a.d,s=a.s;e.warnOnListenWarnings_(o,n),(this.listens.get(r)&&this.listens.get(r).get(i))===t&&(this.log_(`listen response`,a),s!==`ok`&&this.removeListen_(r,i),t.onComplete&&t.onComplete(s,o))})}static warnOnListenWarnings_(e,t){if(e&&typeof e==`object`&&gi(e,`w`)){let n=_i(e,`w`);if(Array.isArray(n)&&~n.indexOf(`no_index`)){let e=`".indexOn": "`+t._queryParams.getIndex().toString()+`"`,n=t._path.toString();Bo(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_(`Auth token refreshed`),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest(`unauth`,{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||hi(e))&&(this.log_(`Admin auth credential detected.  Reducing max reconnect time.`),this.maxReconnectDelay_=Hc)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_(`App check token refreshed`),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest(`unappeck`,{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=mi(e)?`auth`:`gauth`,n={cred:e};this.authOverride_===null?n.noauth=!0:typeof this.authOverride_==`object`&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,r=t.d||`error`;this.authToken_===e&&(n===`ok`?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest(`appcheck`,{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||`error`;t===`ok`?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),r=e._queryIdentifier;this.log_(`Unlisten called for `+n+` `+r),V(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),`unlisten() called for non-default but complete query`),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_(`Unlisten on `+e+` for `+t);let i={p:e};r&&(i.q=n,i.t=r),this.sendRequest(`n`,i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_(`o`,e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:`o`,data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_(`om`,e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:`om`,data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_(`oc`,e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:`oc`,data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){let i={p:t,d:n};this.log_(`onDisconnect `+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},0)})}put(e,t,n,r){this.putInternal(`p`,e,t,n,r)}merge(e,t,n,r){this.putInternal(`m`,e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();let a={p:t,d:n};i!==void 0&&(a.h=i),this.outstandingPuts_.push({action:e,request:a,onComplete:r}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_(`Buffering put: `+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+` response`,n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_(`reportStats`,t),this.sendRequest(`s`,t,e=>{if(e.s!==`ok`){let t=e.d;this.log_(`reportStats`,`Error sending stats: `+t)}})}}onDataMessage_(e){if(`r`in e){this.log_(`from server: `+fi(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if(`error`in e)throw`A server-side error has occurred: `+e.error;else `a`in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_(`handleServerMessage`,e,t),e===`d`?this.onDataUpdate_(t.p,t.d,!1,t.t):e===`m`?this.onDataUpdate_(t.p,t.d,!0,t.t):e===`c`?this.onListenRevoked_(t.p,t.q):e===`ac`?this.onAuthRevoked_(t.s,t.d):e===`apc`?this.onAppCheckRevoked_(t.s,t.d):e===`sd`?this.onSecurityDebugPacket_(t):Ro(`Unrecognized action received from server: `+fi(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_(`connection ready`),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){V(!this.realtime_,`Scheduling a connect when we're already connected/ing?`),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_(`Window became visible.  Reducing delay.`),this.reconnectDelay_=Bc,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_(`Browser went online.`),this.reconnectDelay_=Bc,this.realtime_||this.scheduleConnect_(0)):(this.log_(`Browser went offline.  Killing connection.`),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_(`data client disconnected`),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&=(new Date().getTime()-this.lastConnectionEstablishedTime_>Wc&&(this.reconnectDelay_=Bc),null):(this.log_(`Window isn't visible.  Delaying reconnect.`),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_(`Trying to reconnect in `+t+`ms`),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Uc)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_(`Making a connection attempt`),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+`:`+ e.nextConnectionId_++,a=this.lastSessionId,o=!1,s=null,c=function(){s?s.close():(o=!0,r())};this.realtime_={close:c,sendRequest:function(e){V(s,`sendRequest call when we're not connected not allowed.`),s.sendRequest(e)}};let l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[e,c]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);o?Io(`getToken() completed but was canceled`):(Io(`getToken() completed. Creating connection.`),this.authToken_=e&&e.accessToken,this.appCheckToken_=c&&c.token,s=new hc(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,n,r,e=>{Bo(e+` (`+this.repoInfo_.toString()+`)`),this.interrupt(Gc)},a))}catch(e){this.log_(`Failed to get token: `+e),o||(this.repoInfo_.nodeAdmin&&Bo(e),c())}}}interrupt(e){Io(`Interrupting connection for reason: `+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&=(clearTimeout(this.establishConnectionTimer_),null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Io(`Resuming connection for reason: `+e),delete this.interruptReasons_[e],vi(this.interruptReasons_)&&(this.reconnectDelay_=Bc,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&`h`in t.request&&t.queued&&(t.onComplete&&t.onComplete(`disconnect`),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>Yo(e)).join(`$`):`default`;let r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete(`permission_denied`)}removeListen_(e,t){let n=new xc(e).toString(),r;if(this.listens.has(n)){let e=this.listens.get(n);r=e.get(t),e.delete(t),e.size===0&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){Io(`Auth token revoked: `+e+`/`+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e===`invalid_token`||e===`permission_denied`)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Kc&&(this.reconnectDelay_=Hc,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Io(`App check token revoked: `+e+`/`+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e===`invalid_token`||e===`permission_denied`)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Kc&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):`msg`in e&&console.log(`FIREBASE: `+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let e of this.listens.values())for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t=`js`;ri()&&(t=this.repoInfo_.nodeAdmin?`admin_node`:`node`),e[`sdk.`+t+`.`+H.replace(/\./g,`-`)]=1,ti()?e[`framework.cordova`]=1:ni()&&(e[`framework.reactnative`]=1),this.reportStats(e)}shouldReconnect_(){let e=vc.getInstance().currentlyOnline();return vi(this.interruptReasons_)&&e}};qc.nextPersistentConnectionId_=0,qc.nextConnectionId_=0;
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var G=class e{constructor(e,t){this.name=e,this.node=t}static Wrap(t,n){return new e(t,n)}},Jc=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new G(Wo,e),r=new G(Wo,t);return this.compare(n,r)!==0}minPost(){return G.MIN}},Yc,Xc=class extends Jc{static get __EMPTY_NODE(){return Yc}static set __EMPTY_NODE(e){Yc=e}compare(e,t){return Ko(e.name,t.name)}isDefinedOn(e){throw Er(`KeyIndex.isDefinedOn not expected to be called.`)}indexedValueChanged(e,t){return!1}minPost(){return G.MIN}maxPost(){return new G(Go,Yc)}makePost(e,t){return V(typeof e==`string`,`KeyIndex indexValue must always be a string.`),new G(e,Yc)}toString(){return`.key`}},Zc=new Xc,Qc=class{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let a=1;for(;!e.isEmpty();)if(e=e,a=t?n(e.key,t):1,r&&(a*=-1),a<0)e=this.isReverse_?e.left:e.right;else if(a===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},$c=class e{constructor(t,n,r,i,a){this.key=t,this.value=n,this.color=r??e.RED,this.left=i??tl.EMPTY_NODE,this.right=a??tl.EMPTY_NODE}copy(t,n,r,i,a){return new e(t??this.key,n??this.value,r??this.color,i??this.left,a??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):i===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return tl.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()&&(n=n.moveRedRight_()),t(e,n.key)===0){if(n.right.isEmpty())return tl.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){let t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return 2**this.check_()<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error(`Red node has red child(`+this.key+`,`+this.value+`)`);if(this.right.isRed_())throw Error(`Right child of (`+this.key+`,`+this.value+`) is red`);let e=this.left.check_();if(e!==this.right.check_())throw Error(`Black depths differ`);return e+(this.isRed_()?0:1)}};$c.RED=!0,$c.BLACK=!1;var el=class{copy(e,t,n,r,i){return this}insert(e,t,n){return new $c(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},tl=class e{constructor(t,n=e.EMPTY_NODE){this.comparator_=t,this.root_=n}insert(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,$c.BLACK,null,null))}remove(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,$c.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),t===0)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();)if(t=this.comparator_(e,n.key),t===0){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}else t<0?n=n.left:t>0&&(r=n,n=n.right);throw Error(`Attempted to find predecessor key for a nonexistent key.  What gives?`)}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Qc(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Qc(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Qc(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Qc(this.root_,null,this.comparator_,!0,e)}};tl.EMPTY_NODE=new el;
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
function nl(e,t){return Ko(e.name,t.name)}function rl(e,t){return Ko(e,t)}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var il;function al(e){il=e}var ol=function(e){return typeof e==`number`?`number:`+Qo(e):`string:`+e},sl=function(e){if(e.isLeafNode()){let t=e.val();V(typeof t==`string`||typeof t==`number`||typeof t==`object`&&gi(t,`.sv`),`Priority must be a string or number.`)}else V(e===il||e.isEmpty(),`priority of unexpected type.`);V(e===il||e.getPriority().isEmpty(),`Priority nodes can't have a priority of their own.`)},cl,ll=class e{static set __childrenNodeConstructor(e){cl=e}static get __childrenNodeConstructor(){return cl}constructor(t,n=e.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=n,this.lazyHash_=null,V(this.value_!==void 0&&this.value_!==null,`LeafNode shouldn't be created with null/undefined value.`),sl(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new e(this.value_,t)}getImmediateChild(t){return t===`.priority`?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return W(t)?this:U(t)===`.priority`?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(t,n){return t===`.priority`?this.updatePriority(n):n.isEmpty()&&t!==`.priority`?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)}updateChild(t,n){let r=U(t);return r===null?n:n.isEmpty()&&r!==`.priority`?this:(V(r!==`.priority`||Cc(t)===1,`.priority must be the last token in a path`),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(wc(t),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e=``;this.priorityNode_.isEmpty()||(e+=`priority:`+ol(this.priorityNode_.val())+`:`);let t=typeof this.value_;e+=t+`:`,t===`number`?e+=Qo(this.value_):e+=this.value_,this.lazyHash_=jo(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(V(t.isLeafNode(),`Unknown node type`),this.compareToLeafNode_(t))}compareToLeafNode_(t){let n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),a=e.VALUE_TYPE_ORDER.indexOf(r);return V(i>=0,`Unknown leaf type: `+n),V(a>=0,`Unknown leaf type: `+r),i===a?r===`object`?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:a-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){let t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}};ll.VALUE_TYPE_ORDER=[`object`,`boolean`,`number`,`string`];
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var ul,dl;function fl(e){ul=e}function pl(e){dl=e}var ml=new class extends Jc{compare(e,t){let n=(e.node.getPriority()),r=(t.node.getPriority()),i=(n.compareTo(r));return i===0?Ko(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return G.MIN}maxPost(){return new G(Go,new ll(`[PRIORITY-POST]`,dl))}makePost(e,t){let n=(ul(e));return new G(t,new ll(`[PRIORITY-POST]`,n))}toString(){return`.priority`}},hl=Math.log(2),gl=class{constructor(e){let t=e=>parseInt(Math.log(e)/hl,10),n=e=>parseInt(Array(e+1).join(`1`),2);this.count=t(e+1),this.current_=this.count-1;let r=n(this.count);this.bits_=e+1&r}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},_l=function(e,t,n,r){e.sort(t);let i=function(t,r){let a=r-t,o,s;if(a===0)return null;if(a===1)return o=e[t],s=n?n(o):o,new $c(s,o.node,$c.BLACK,null,null);{let c=parseInt(a/2,10)+t,l=i(t,c),u=i(c+1,r);return o=e[c],s=n?n(o):o,new $c(s,o.node,$c.BLACK,l,u)}},a=function(t){let r=null,a=null,o=e.length,s=function(t,r){let a=o-t,s=o;o-=t;let l=i(a+1,s),u=e[a],d=n?n(u):u;c(new $c(d,u.node,r,null,l))},c=function(e){r?(r.left=e,r=e):(a=e,r=e)};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),r=2**(t.count-(e+1));n?s(r,$c.BLACK):(s(r,$c.BLACK),s(r,$c.RED))}return a},o=new gl(e.length),s=a(o);return new tl(r||t,s)},vl,yl={},bl=class e{static get Default(){return V(yl&&ml,`ChildrenNode.ts has not been loaded`),vl||=new e({".priority":yl},{".priority":ml}),vl}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=_i(this.indexes_,e);if(!t)throw Error(`No index defined for `+e);return t instanceof tl?t:null}hasIndex(e){return gi(this.indexSet_,e.toString())}addIndex(t,n){V(t!==Zc,`KeyIndex always exists and isn't meant to be added to the IndexMap.`);let r=[],i=!1,a=n.getIterator(G.Wrap),o=a.getNext();for(;o;)i||=t.isDefinedOn(o.node),r.push(o),o=a.getNext();let s;s=i?_l(r,t.getCompare()):yl;let c=t.toString(),l={...this.indexSet_};l[c]=t;let u={...this.indexes_};return u[c]=s,new e(u,l)}addToIndexes(t,n){let r=yi(this.indexes_,(e,r)=>{let i=_i(this.indexSet_,r);if(V(i,`Missing index implementation for `+r),e===yl)if(i.isDefinedOn(t.node)){let e=[],r=n.getIterator(G.Wrap),a=r.getNext();for(;a;)a.name!==t.name&&e.push(a),a=r.getNext();return e.push(t),_l(e,i.getCompare())}else return yl;else{let r=n.get(t.name),i=e;return r&&(i=i.remove(new G(t.name,r))),i.insert(t,t.node)}});return new e(r,this.indexSet_)}removeFromIndexes(t,n){let r=yi(this.indexes_,e=>{if(e===yl)return e;{let r=n.get(t.name);return r?e.remove(new G(t.name,r)):e}});return new e(r,this.indexSet_)}},xl,K=class e{static get EMPTY_NODE(){return xl||=new e(new tl(rl),null,bl.Default)}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&sl(this.priorityNode_),this.children_.isEmpty()&&V(!this.priorityNode_||this.priorityNode_.isEmpty(),`An empty node cannot have a priority`)}isLeafNode(){return!1}getPriority(){return this.priorityNode_||xl}updatePriority(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)}getImmediateChild(e){if(e===`.priority`)return this.getPriority();{let t=this.children_.get(e);return t===null?xl:t}}getChild(e){let t=U(e);return t===null?this:this.getImmediateChild(t).getChild(wc(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(t,n){if(V(n,`We should always be passing snapshot nodes`),t===`.priority`)return this.updatePriority(n);{let r=new G(t,n),i,a;n.isEmpty()?(i=this.children_.remove(t),a=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,n),a=this.indexMap_.addToIndexes(r,this.children_));let o=i.isEmpty()?xl:this.priorityNode_;return new e(i,o,a)}}updateChild(e,t){let n=U(e);if(n===null)return t;{V(U(e)!==`.priority`||Cc(e)===1,`.priority must be the last token in a path`);let r=this.getImmediateChild(n).updateChild(wc(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let n={},r=0,i=0,a=!0;if(this.forEachChild(ml,(o,s)=>{n[o]=s.val(t),r++,a&&e.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):a=!1}),!t&&a&&i<2*r){let e=[];for(let t in n)e[t]=n[t];return e}else return t&&!this.getPriority().isEmpty()&&(n[`.priority`]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e=``;this.getPriority().isEmpty()||(e+=`priority:`+ol(this.getPriority().val())+`:`),this.forEachChild(ml,(t,n)=>{let r=n.hash();r!==``&&(e+=`:`+t+`:`+r)}),this.lazyHash_=e===``?``:jo(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let r=this.resolveIndex_(n);if(r){let n=r.getPredecessorKey(new G(e,t));return n?n.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){let t=this.resolveIndex_(e);if(t){let e=t.minKey();return e&&e.name}else return this.children_.minKey()}getFirstChild(e){let t=this.getFirstChildName(e);return t?new G(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(t){let e=t.maxKey();return e&&e.name}else return this.children_.maxKey()}getLastChild(e){let t=this.getLastChildName(e);return t?new G(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,G.Wrap),r=n.peek();for(;r!=null&&t.compare(r,e)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,G.Wrap),r=n.peek();for(;r!=null&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Sl?-1:0}withIndex(t){if(t===Zc||this.indexMap_.hasIndex(t))return this;{let n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===Zc||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{let t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){let e=this.getIterator(ml),n=t.getIterator(ml),r=e.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=e.getNext(),i=n.getNext()}return r===null&&i===null}else return!1;else return!1}}resolveIndex_(e){return e===Zc?null:this.indexMap_.get(e.toString())}};K.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;var Sl=new class extends K{constructor(){super(new tl(rl),K.EMPTY_NODE,bl.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return K.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(G,{MIN:{value:new G(Wo,K.EMPTY_NODE)},MAX:{value:new G(Go,Sl)}}),Xc.__EMPTY_NODE=K.EMPTY_NODE,ll.__childrenNodeConstructor=K,al(Sl),pl(Sl);
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var Cl=!0;function wl(e,t=null){if(e===null)return K.EMPTY_NODE;if(typeof e==`object`&&`.priority`in e&&(t=e[`.priority`]),V(t===null||typeof t==`string`||typeof t==`number`||typeof t==`object`&&`.sv`in t,`Invalid priority type found: `+typeof t),typeof e==`object`&&`.value`in e&&e[`.value`]!==null&&(e=e[`.value`]),typeof e!=`object`||`.sv`in e)return new ll(e,wl(t));if(!(e instanceof Array)&&Cl){let n=[],r=!1;if(Zo(e,(e,t)=>{if(e.substring(0,1)!==`.`){let i=wl(t);i.isEmpty()||(r||=!i.getPriority().isEmpty(),n.push(new G(e,i)))}}),n.length===0)return K.EMPTY_NODE;let i=_l(n,nl,e=>e.name,rl);if(r){let e=_l(n,ml.getCompare());return new K(i,wl(t),new bl({".priority":e},{".priority":ml}))}else return new K(i,wl(t),bl.Default)}else{let n=K.EMPTY_NODE;return Zo(e,(t,r)=>{if(gi(e,t)&&t.substring(0,1)!==`.`){let e=wl(r);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(wl(t))}}fl(wl);
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var Tl=class extends Jc{constructor(e){super(),this.indexPath_=e,V(!W(e)&&U(e)!==`.priority`,`Can't create PathIndex with empty path or .priority key`)}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return i===0?Ko(e.name,t.name):i}makePost(e,t){let n=wl(e),r=K.EMPTY_NODE.updateChild(this.indexPath_,n);return new G(t,r)}maxPost(){let e=K.EMPTY_NODE.updateChild(this.indexPath_,Sl);return new G(Go,e)}toString(){return Dc(this.indexPath_,0).join(`/`)}},El=new class extends Jc{compare(e,t){let n=(e.node.compareTo(t.node));return n===0?Ko(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return G.MIN}maxPost(){return G.MAX}makePost(e,t){let n=(wl(e));return new G(t,n)}toString(){return`.value`}};
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
function Dl(e){return{type:`value`,snapshotNode:e}}function Ol(e,t){return{type:`child_added`,snapshotNode:t,childName:e}}function kl(e,t){return{type:`child_removed`,snapshotNode:t,childName:e}}function Al(e,t,n){return{type:`child_changed`,snapshotNode:t,childName:e,oldSnap:n}}function jl(e,t){return{type:`child_moved`,snapshotNode:t,childName:e}}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var Ml=class{constructor(e){this.index_=e}updateChild(e,t,n,r,i,a){V(e.isIndexed(this.index_),`A node must be indexed if only a child is updated`);let o=e.getImmediateChild(t);return o.getChild(r).equals(n.getChild(r))&&o.isEmpty()===n.isEmpty()||(a!=null&&(n.isEmpty()?e.hasChild(t)?a.trackChildChange(kl(t,o)):V(e.isLeafNode(),`A child remove without an old child only makes sense on a leaf node`):o.isEmpty()?a.trackChildChange(Ol(t,n)):a.trackChildChange(Al(t,n,o))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return n!=null&&(e.isLeafNode()||e.forEachChild(ml,(e,r)=>{t.hasChild(e)||n.trackChildChange(kl(e,r))}),t.isLeafNode()||t.forEachChild(ml,(t,r)=>{if(e.hasChild(t)){let i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(Al(t,r,i))}else n.trackChildChange(Ol(t,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?K.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}},Nl=class e{constructor(t){this.indexedFilter_=new Ml(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,i,a){return this.matches(new G(t,n))||(n=K.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,a)}updateFullNode(e,t,n){t.isLeafNode()&&(t=K.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(K.EMPTY_NODE);let i=this;return t.forEachChild(ml,(e,t)=>{i.matches(new G(e,t))||(r=r.updateImmediateChild(e,K.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}},Pl=class{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{let t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new Nl(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,i,a){return this.rangedFilter_.matches(new G(t,n))||(n=K.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,a):this.fullLimitUpdateChild_(e,t,n,i,a)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=K.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=K.EMPTY_NODE.withIndex(this.index_);let e;e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){let t=e.getNext();if(this.withinDirectionalStart(t))if(this.withinDirectionalEnd(t))r=r.updateImmediateChild(t.name,t.node),n++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(K.EMPTY_NODE);let e;e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let n=0;for(;e.hasNext();){let t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:r=r.updateImmediateChild(t.name,K.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let a;if(this.reverse_){let e=this.index_.getCompare();a=(t,n)=>e(n,t)}else a=this.index_.getCompare();let o=e;V(o.numChildren()===this.limit_,``);let s=new G(t,n),c=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),l=this.rangedFilter_.matches(s);if(o.hasChild(t)){let e=o.getImmediateChild(t),u=r.getChildAfterChild(this.index_,c,this.reverse_);for(;u!=null&&(u.name===t||o.hasChild(u.name));)u=r.getChildAfterChild(this.index_,u,this.reverse_);let d=u==null?1:a(u,s);if(l&&!n.isEmpty()&&d>=0)return i?.trackChildChange(Al(t,n,e)),o.updateImmediateChild(t,n);{i?.trackChildChange(kl(t,e));let n=o.updateImmediateChild(t,K.EMPTY_NODE);return u!=null&&this.rangedFilter_.matches(u)?(i?.trackChildChange(Ol(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}else if(n.isEmpty())return e;else if(l)return a(c,s)>=0?(i!=null&&(i.trackChildChange(kl(c.name,c.node)),i.trackChildChange(Ol(t,n))),o.updateImmediateChild(t,n).updateImmediateChild(c.name,K.EMPTY_NODE)):e;else return e}},Fl=class e{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_=``,this.indexStartValue_=null,this.indexStartName_=``,this.indexEndValue_=null,this.indexEndName_=``,this.index_=ml}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===``?this.startSet_:this.viewFrom_===`l`}getIndexStartValue(){return V(this.startSet_,`Only valid if start has been set`),this.indexStartValue_}getIndexStartName(){return V(this.startSet_,`Only valid if start has been set`),this.startNameSet_?this.indexStartName_:Wo}hasEnd(){return this.endSet_}getIndexEndValue(){return V(this.endSet_,`Only valid if end has been set`),this.indexEndValue_}getIndexEndName(){return V(this.endSet_,`Only valid if end has been set`),this.endNameSet_?this.indexEndName_:Go}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==``}getLimit(){return V(this.limitSet_,`Only valid if limit has been set`),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ml}copy(){let t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}};function Il(e){return e.loadsAllData()?new Ml(e.getIndex()):e.hasLimit()?new Pl(e):new Nl(e)}function Ll(e){let t={};if(e.isDefault())return t;let n;if(e.index_===ml?n=`$priority`:e.index_===El?n=`$value`:e.index_===Zc?n=`$key`:(V(e.index_ instanceof Tl,`Unrecognized index type!`),n=e.index_.toString()),t.orderBy=fi(n),e.startSet_){let n=e.startAfterSet_?`startAfter`:`startAt`;t[n]=fi(e.indexStartValue_),e.startNameSet_&&(t[n]+=`,`+fi(e.indexStartName_))}if(e.endSet_){let n=e.endBeforeSet_?`endBefore`:`endAt`;t[n]=fi(e.indexEndValue_),e.endNameSet_&&(t[n]+=`,`+fi(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function Rl(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;n===``&&(n=e.isViewFromLeft()?`l`:`r`),t.vf=n}return e.index_!==ml&&(t.i=e.index_.toString()),t}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var zl=class e extends gc{reportStats(e){throw Error(`Method not implemented.`)}static getListenId_(e,t){return t===void 0?(V(e._queryParams.isDefault(),`should have a tag if it's not a default query.`),e._path.toString()):`tag$`+t}constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=Lo(`p:rest:`),this.listens_={}}listen(t,n,r,i){let a=t._path.toString();this.log_(`Listen called for `+a+` `+t._queryIdentifier);let o=e.getListenId_(t,r),s={};this.listens_[o]=s;let c=Ll(t._queryParams);this.restRequest_(a+`.json`,c,(e,t)=>{let n=t;if(e===404&&(n=null,e=null),e===null&&this.onDataUpdate_(a,n,!1,r),_i(this.listens_,o)===s){let t;t=e?e===401?`permission_denied`:`rest_error:`+e:`ok`,i(t,null)}})}unlisten(t,n){let r=e.getListenId_(t,n);delete this.listens_[r]}get(e){let t=Ll(e._queryParams),n=e._path.toString(),r=new Gr;return this.restRequest_(n+`.json`,t,(e,t)=>{let i=t;e===404&&(i=null,e=null),e===null?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(Error(i))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format=`export`,Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);let a=(this.repoInfo_.secure?`https://`:`http://`)+this.repoInfo_.host+e+`?ns=`+this.repoInfo_.namespace+Si(t);this.log_(`Sending REST request for `+a);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&o.readyState===4){this.log_(`REST Response for `+a+` received. status:`,o.status,`response:`,o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=di(o.responseText)}catch{Bo(`Failed to parse JSON response for `+a+`: `+o.responseText)}n(null,e)}else o.status!==401&&o.status!==404&&Bo(`Got unsuccessful REST response for `+a+` Status: `+o.status),n(o.status);n=null}},o.open(`GET`,a,!0),o.send()})}},Bl=class{constructor(){this.rootNode_=K.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
function Vl(){return{value:null,children:new Map}}function Hl(e,t,n){if(W(t))e.value=n,e.children.clear();else if(e.value!==null)e.value=e.value.updateChild(t,n);else{let r=U(t);e.children.has(r)||e.children.set(r,Vl());let i=e.children.get(r);t=wc(t),Hl(i,t,n)}}function Ul(e,t){if(W(t))return e.value=null,e.children.clear(),!0;if(e.value!==null){if(e.value.isLeafNode())return!1;{let n=e.value;return e.value=null,n.forEachChild(ml,(t,n)=>{Hl(e,new xc(t),n)}),Ul(e,t)}}else if(e.children.size>0){let n=U(t);return t=wc(t),e.children.has(n)&&Ul(e.children.get(n),t)&&e.children.delete(n),e.children.size===0}else return!0}function Wl(e,t,n){e.value===null?Gl(e,(e,r)=>{let i=new xc(t.toString()+`/`+e);Wl(r,i,n)}):n(t,e.value)}function Gl(e,t){e.children.forEach((e,n)=>{t(n,e)})}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var Kl=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t={...e};return this.last_&&Zo(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}},ql=10*1e3,Jl=30*1e3,Yl=300*1e3,Xl=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Kl(e);let n=ql+(Jl-ql)*Math.random();us(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;Zo(e,(e,r)=>{r>0&&gi(this.statsToReport_,e)&&(t[e]=r,n=!0)}),n&&this.server_.reportStats(t),us(this.reportStats_.bind(this),Math.floor(Math.random()*2*Yl))}},q;(function(e){e[e.OVERWRITE=0]=`OVERWRITE`,e[e.MERGE=1]=`MERGE`,e[e.ACK_USER_WRITE=2]=`ACK_USER_WRITE`,e[e.LISTEN_COMPLETE=3]=`LISTEN_COMPLETE`})(q||={});function Zl(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Ql(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function $l(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var eu=class e{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=q.ACK_USER_WRITE,this.source=Zl()}operationForChild(t){if(W(this.path)){if(this.affectedTree.value!=null)return V(this.affectedTree.children.isEmpty(),`affectedTree should not have overlapping affected paths.`),this;{let n=this.affectedTree.subtree(new xc(t));return new e(Sc(),n,this.revert)}}else return V(U(this.path)===t,`operationForChild called for unrelated child.`),new e(wc(this.path),this.affectedTree,this.revert)}},tu=class e{constructor(e,t){this.source=e,this.path=t,this.type=q.LISTEN_COMPLETE}operationForChild(t){return W(this.path)?new e(this.source,Sc()):new e(this.source,wc(this.path))}},nu=class e{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=q.OVERWRITE}operationForChild(t){return W(this.path)?new e(this.source,Sc(),this.snap.getImmediateChild(t)):new e(this.source,wc(this.path),this.snap)}},ru=class e{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=q.MERGE}operationForChild(t){if(W(this.path)){let n=this.children.subtree(new xc(t));return n.isEmpty()?null:n.value?new nu(this.source,Sc(),n.value):new e(this.source,Sc(),n)}else return V(U(this.path)===t,`Can't get a merge for a child not on the path of the operation`),new e(this.source,wc(this.path),this.children)}toString(){return`Operation(`+this.path+`: `+this.source.toString()+` merge: `+this.children.toString()+`)`}},iu=class{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(W(e))return this.isFullyInitialized()&&!this.filtered_;let t=U(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}},au=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function ou(e,t,n,r){let i=[],a=[];return t.forEach(t=>{t.type===`child_changed`&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&a.push(jl(t.childName,t.snapshotNode))}),su(e,i,`child_removed`,t,r,n),su(e,i,`child_added`,t,r,n),su(e,i,`child_moved`,a,r,n),su(e,i,`child_changed`,t,r,n),su(e,i,`value`,t,r,n),i}function su(e,t,n,r,i,a){let o=r.filter(e=>e.type===n);o.sort((t,n)=>lu(e,t,n)),o.forEach(n=>{let r=cu(e,n,a);i.forEach(i=>{i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))})})}function cu(e,t,n){return t.type===`value`||t.type===`child_removed`||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}function lu(e,t,n){if(t.childName==null||n.childName==null)throw Er(`Should only compare child_ events.`);let r=new G(t.childName,t.snapshotNode),i=new G(n.childName,n.snapshotNode);return e.index_.compare(r,i)}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
function uu(e,t){return{eventCache:e,serverCache:t}}function du(e,t,n,r){return uu(new iu(t,n,r),e.serverCache)}function fu(e,t,n,r){return uu(e.eventCache,new iu(t,n,r))}function pu(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function mu(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var hu,gu=()=>(hu||=new tl(qo),hu),_u=class e{static fromObject(t){let n=new e(null);return Zo(t,(e,t)=>{n=n.set(new xc(e),t)}),n}constructor(e,t=gu()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:Sc(),value:this.value};if(W(e))return null;{let n=U(e),r=this.children.get(n);if(r!==null){let i=r.findRootMostMatchingPathAndValue(wc(e),t);return i==null?null:{path:kc(new xc(n),i.path),value:i.value}}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(t){if(W(t))return this;{let n=U(t),r=this.children.get(n);return r===null?new e(null):r.subtree(wc(t))}}set(t,n){if(W(t))return new e(n,this.children);{let r=U(t),i=(this.children.get(r)||new e(null)).set(wc(t),n),a=this.children.insert(r,i);return new e(this.value,a)}}remove(t){if(W(t))return this.children.isEmpty()?new e(null):new e(null,this.children);{let n=U(t),r=this.children.get(n);if(r){let i=r.remove(wc(t)),a;return a=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),this.value===null&&a.isEmpty()?new e(null):new e(this.value,a)}else return this}}get(e){if(W(e))return this.value;{let t=U(e),n=this.children.get(t);return n?n.get(wc(e)):null}}setTree(t,n){if(W(t))return n;{let r=U(t),i=(this.children.get(r)||new e(null)).setTree(wc(t),n),a;return a=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new e(this.value,a)}}fold(e){return this.fold_(Sc(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((r,i)=>{n[r]=i.fold_(kc(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,Sc(),t)}findOnPath_(e,t,n){let r=this.value?n(t,this.value):!1;if(r)return r;if(W(e))return null;{let r=U(e),i=this.children.get(r);return i?i.findOnPath_(wc(e),kc(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Sc(),t)}foreachOnPath_(t,n,r){if(W(t))return this;{this.value&&r(n,this.value);let i=U(t),a=this.children.get(i);return a?a.foreachOnPath_(wc(t),kc(n,i),r):new e(null)}}foreach(e){this.foreach_(Sc(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(kc(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}},vu=class e{constructor(e){this.writeTree_=e}static empty(){return new e(new _u(null))}};function yu(e,t,n){if(W(t))return new vu(new _u(n));{let r=e.writeTree_.findRootMostValueAndPath(t);if(r!=null){let i=r.path,a=r.value,o=Ac(i,t);return a=a.updateChild(o,n),new vu(e.writeTree_.set(i,a))}else{let r=new _u(n),i=e.writeTree_.setTree(t,r);return new vu(i)}}}function bu(e,t,n){let r=e;return Zo(n,(e,n)=>{r=yu(r,kc(t,e),n)}),r}function xu(e,t){if(W(t))return vu.empty();{let n=e.writeTree_.setTree(t,new _u(null));return new vu(n)}}function Su(e,t){return Cu(e,t)!=null}function Cu(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return n==null?null:e.writeTree_.get(n.path).getChild(Ac(n.path,t))}function wu(e){let t=[],n=e.writeTree_.value;return n==null?e.writeTree_.children.inorderTraversal((e,n)=>{n.value!=null&&t.push(new G(e,n.value))}):n.isLeafNode()||n.forEachChild(ml,(e,n)=>{t.push(new G(e,n))}),t}function Tu(e,t){if(W(t))return e;{let n=Cu(e,t);return n==null?new vu(e.writeTree_.subtree(t)):new vu(new _u(n))}}function Eu(e){return e.writeTree_.isEmpty()}function Du(e,t){return Ou(Sc(),e.writeTree_,t)}function Ou(e,t,n){if(t.value!=null)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal((t,i)=>{t===`.priority`?(V(i.value!==null,`Priority writes must always be leaf nodes`),r=i.value):n=Ou(kc(e,t),i,n)}),!n.getChild(e).isEmpty()&&r!==null&&(n=n.updateChild(kc(e,`.priority`),r)),n}}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
function ku(e,t){return Qu(t,e)}function Au(e,t,n,r,i){V(r>e.lastWriteId,`Stacking an older write on top of newer ones`),i===void 0&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=yu(e.visibleWrites,t,n)),e.lastWriteId=r}function ju(e,t,n,r){V(r>e.lastWriteId,`Stacking an older merge on top of newer ones`),e.allWrites.push({path:t,children:n,writeId:r,visible:!0}),e.visibleWrites=bu(e.visibleWrites,t,n),e.lastWriteId=r}function Mu(e,t){for(let n=0;n<e.allWrites.length;n++){let r=e.allWrites[n];if(r.writeId===t)return r}return null}function Nu(e,t){let n=e.allWrites.findIndex(e=>e.writeId===t);V(n>=0,`removeWrite called with nonexistent writeId.`);let r=e.allWrites[n];e.allWrites.splice(n,1);let i=r.visible,a=!1,o=e.allWrites.length-1;for(;i&&o>=0;){let t=e.allWrites[o];t.visible&&(o>=n&&Pu(t,r.path)?i=!1:Nc(r.path,t.path)&&(a=!0)),o--}if(i){if(a)return Fu(e),!0;if(r.snap)e.visibleWrites=xu(e.visibleWrites,r.path);else{let t=r.children;Zo(t,t=>{e.visibleWrites=xu(e.visibleWrites,kc(r.path,t))})}return!0}else return!1}function Pu(e,t){if(e.snap)return Nc(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&Nc(kc(e.path,n),t))return!0;return!1}function Fu(e){e.visibleWrites=Lu(e.allWrites,Iu,Sc()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}function Iu(e){return e.visible}function Lu(e,t,n){let r=vu.empty();for(let i=0;i<e.length;++i){let a=e[i];if(t(a)){let e=a.path,t;if(a.snap)Nc(n,e)?(t=Ac(n,e),r=yu(r,t,a.snap)):Nc(e,n)&&(t=Ac(e,n),r=yu(r,Sc(),a.snap.getChild(t)));else if(a.children){if(Nc(n,e))t=Ac(n,e),r=bu(r,t,a.children);else if(Nc(e,n))if(t=Ac(e,n),W(t))r=bu(r,Sc(),a.children);else{let e=_i(a.children,U(t));if(e){let n=e.getChild(wc(t));r=yu(r,Sc(),n)}}}else throw Er(`WriteRecord should have .snap or .children`)}}return r}function Ru(e,t,n,r,i){if(!r&&!i){let r=Cu(e.visibleWrites,t);if(r!=null)return r;{let r=Tu(e.visibleWrites,t);if(Eu(r))return n;if(n==null&&!Su(r,Sc()))return null;{let e=n||K.EMPTY_NODE;return Du(r,e)}}}else{let a=Tu(e.visibleWrites,t);if(!i&&Eu(a))return n;if(!i&&n==null&&!Su(a,Sc()))return null;{let a=Lu(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(Nc(e.path,t)||Nc(t,e.path))},t),o=n||K.EMPTY_NODE;return Du(a,o)}}}function zu(e,t,n){let r=K.EMPTY_NODE,i=Cu(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(ml,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){let i=Tu(e.visibleWrites,t);return n.forEachChild(ml,(e,t)=>{let n=Du(Tu(i,new xc(e)),t);r=r.updateImmediateChild(e,n)}),wu(i).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}else{let n=Tu(e.visibleWrites,t);return wu(n).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}}function Bu(e,t,n,r,i){V(r||i,`Either existingEventSnap or existingServerSnap must exist`);let a=kc(t,n);if(Su(e.visibleWrites,a))return null;{let t=Tu(e.visibleWrites,a);return Eu(t)?i.getChild(n):Du(t,i.getChild(n))}}function Vu(e,t,n,r){let i=kc(t,n),a=Cu(e.visibleWrites,i);if(a!=null)return a;if(r.isCompleteForChild(n)){let t=Tu(e.visibleWrites,i);return Du(t,r.getNode().getImmediateChild(n))}else return null}function Hu(e,t){return Cu(e.visibleWrites,t)}function Uu(e,t,n,r,i,a,o){let s,c=Tu(e.visibleWrites,t),l=Cu(c,Sc());if(l!=null)s=l;else if(n!=null)s=Du(c,n);else return[];if(s=s.withIndex(o),!s.isEmpty()&&!s.isLeafNode()){let e=[],t=o.getCompare(),n=a?s.getReverseIteratorFrom(r,o):s.getIteratorFrom(r,o),c=n.getNext();for(;c&&e.length<i;)t(c,r)!==0&&e.push(c),c=n.getNext();return e}else return[]}function Wu(){return{visibleWrites:vu.empty(),allWrites:[],lastWriteId:-1}}function Gu(e,t,n,r){return Ru(e.writeTree,e.treePath,t,n,r)}function Ku(e,t){return zu(e.writeTree,e.treePath,t)}function qu(e,t,n,r){return Bu(e.writeTree,e.treePath,t,n,r)}function Ju(e,t){return Hu(e.writeTree,kc(e.treePath,t))}function Yu(e,t,n,r,i,a){return Uu(e.writeTree,e.treePath,t,n,r,i,a)}function Xu(e,t,n){return Vu(e.writeTree,e.treePath,t,n)}function Zu(e,t){return Qu(kc(e.treePath,t),e.writeTree)}function Qu(e,t){return{treePath:e,writeTree:t}}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var $u=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;V(t===`child_added`||t===`child_changed`||t===`child_removed`,`Only child changes supported for tracking`),V(n!==`.priority`,`Only non-priority child changes can be tracked.`);let r=this.changeMap.get(n);if(r){let i=r.type;if(t===`child_added`&&i===`child_removed`)this.changeMap.set(n,Al(n,e.snapshotNode,r.snapshotNode));else if(t===`child_removed`&&i===`child_added`)this.changeMap.delete(n);else if(t===`child_removed`&&i===`child_changed`)this.changeMap.set(n,kl(n,r.oldSnap));else if(t===`child_changed`&&i===`child_added`)this.changeMap.set(n,Ol(n,e.snapshotNode));else if(t===`child_changed`&&i===`child_changed`)this.changeMap.set(n,Al(n,e.snapshotNode,r.oldSnap));else throw Er(`Illegal combination of changes: `+e+` occurred after `+r)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}},ed=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}},td=class{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=this.optCompleteServerCache_==null?this.viewCache_.serverCache:new iu(this.optCompleteServerCache_,!0,!1);return Xu(this.writes_,e,t)}}getChildAfterChild(e,t,n){let r=this.optCompleteServerCache_==null?mu(this.viewCache_):this.optCompleteServerCache_,i=Yu(this.writes_,r,t,1,n,e);return i.length===0?null:i[0]}};
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
function nd(e){return{filter:e}}function rd(e,t){V(t.eventCache.getNode().isIndexed(e.filter.getIndex()),`Event snap not indexed`),V(t.serverCache.getNode().isIndexed(e.filter.getIndex()),`Server snap not indexed`)}function id(e,t,n,r,i){let a=new $u,o,s;if(n.type===q.OVERWRITE){let c=n;c.source.fromUser?o=cd(e,t,c.path,c.snap,r,i,a):(V(c.source.fromServer,`Unknown source.`),s=c.source.tagged||t.serverCache.isFiltered()&&!W(c.path),o=sd(e,t,c.path,c.snap,r,i,s,a))}else if(n.type===q.MERGE){let c=n;c.source.fromUser?o=ud(e,t,c.path,c.children,r,i,a):(V(c.source.fromServer,`Unknown source.`),s=c.source.tagged||t.serverCache.isFiltered(),o=fd(e,t,c.path,c.children,r,i,s,a))}else if(n.type===q.ACK_USER_WRITE){let s=n;o=s.revert?hd(e,t,s.path,r,i,a):pd(e,t,s.path,s.affectedTree,r,i,a)}else if(n.type===q.LISTEN_COMPLETE)o=md(e,t,n.path,r,a);else throw Er(`Unknown operation type: `+n.type);let c=a.getChanges();return ad(t,o,c),{viewCache:o,changes:c}}function ad(e,t,n){let r=t.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),a=pu(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(a)||!r.getNode().getPriority().equals(a.getPriority()))&&n.push(Dl(pu(t)))}}function od(e,t,n,r,i,a){let o=t.eventCache;if(Ju(r,n)!=null)return t;{let s,c;if(W(n))if(V(t.serverCache.isFullyInitialized(),`If change path is empty, we must have complete server data`),t.serverCache.isFiltered()){let n=mu(t),i=n instanceof K?n:K.EMPTY_NODE,o=Ku(r,i);s=e.filter.updateFullNode(t.eventCache.getNode(),o,a)}else{let n=Gu(r,mu(t));s=e.filter.updateFullNode(t.eventCache.getNode(),n,a)}else{let l=U(n);if(l===`.priority`){V(Cc(n)===1,`Can't have a priority with additional path components`);let i=o.getNode();c=t.serverCache.getNode();let a=qu(r,n,i,c);s=a==null?o.getNode():e.filter.updatePriority(i,a)}else{let u=wc(n),d;if(o.isCompleteForChild(l)){c=t.serverCache.getNode();let e=qu(r,n,o.getNode(),c);d=e==null?o.getNode().getImmediateChild(l):o.getNode().getImmediateChild(l).updateChild(u,e)}else d=Xu(r,l,t.serverCache);s=d==null?o.getNode():e.filter.updateChild(o.getNode(),l,d,u,i,a)}}return du(t,s,o.isFullyInitialized()||W(n),e.filter.filtersNodes())}}function sd(e,t,n,r,i,a,o,s){let c=t.serverCache,l,u=o?e.filter:e.filter.getIndexedFilter();if(W(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){let e=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),e,null)}else{let e=U(n);if(!c.isCompleteForPath(n)&&Cc(n)>1)return t;let i=wc(n),a=c.getNode().getImmediateChild(e).updateChild(i,r);l=e===`.priority`?u.updatePriority(c.getNode(),a):u.updateChild(c.getNode(),e,a,i,ed,null)}let d=fu(t,l,c.isFullyInitialized()||W(n),u.filtersNodes()),f=new td(i,d,a);return od(e,d,n,i,f,s)}function cd(e,t,n,r,i,a,o){let s=t.eventCache,c,l,u=new td(i,t,a);if(W(n))l=e.filter.updateFullNode(t.eventCache.getNode(),r,o),c=du(t,l,!0,e.filter.filtersNodes());else{let i=U(n);if(i===`.priority`)l=e.filter.updatePriority(t.eventCache.getNode(),r),c=du(t,l,s.isFullyInitialized(),s.isFiltered());else{let a=wc(n),l=s.getNode().getImmediateChild(i),d;if(W(a))d=r;else{let e=u.getCompleteChild(i);d=e==null?K.EMPTY_NODE:Tc(a)===`.priority`&&e.getChild(Oc(a)).isEmpty()?e:e.updateChild(a,r)}if(l.equals(d))c=t;else{let n=e.filter.updateChild(s.getNode(),i,d,a,u,o);c=du(t,n,s.isFullyInitialized(),e.filter.filtersNodes())}}}return c}function ld(e,t){return e.eventCache.isCompleteForChild(t)}function ud(e,t,n,r,i,a,o){let s=t;return r.foreach((r,c)=>{let l=kc(n,r);ld(t,U(l))&&(s=cd(e,s,l,c,i,a,o))}),r.foreach((r,c)=>{let l=kc(n,r);ld(t,U(l))||(s=cd(e,s,l,c,i,a,o))}),s}function dd(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function fd(e,t,n,r,i,a,o,s){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c=t,l;l=W(n)?r:new _u(null).setTree(n,r);let u=t.serverCache.getNode();return l.children.inorderTraversal((n,r)=>{if(u.hasChild(n)){let l=t.serverCache.getNode().getImmediateChild(n),u=dd(e,l,r);c=sd(e,c,new xc(n),u,i,a,o,s)}}),l.children.inorderTraversal((n,r)=>{let l=!t.serverCache.isCompleteForChild(n)&&r.value===null;if(!u.hasChild(n)&&!l){let l=t.serverCache.getNode().getImmediateChild(n),u=dd(e,l,r);c=sd(e,c,new xc(n),u,i,a,o,s)}}),c}function pd(e,t,n,r,i,a,o){if(Ju(i,n)!=null)return t;let s=t.serverCache.isFiltered(),c=t.serverCache;if(r.value!=null){if(W(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return sd(e,t,n,c.getNode().getChild(n),i,a,s,o);if(W(n)){let r=new _u(null);return c.getNode().forEachChild(Zc,(e,t)=>{r=r.set(new xc(e),t)}),fd(e,t,n,r,i,a,s,o)}else return t}else{let l=new _u(null);return r.foreach((e,t)=>{let r=kc(n,e);c.isCompleteForPath(r)&&(l=l.set(e,c.getNode().getChild(r)))}),fd(e,t,n,l,i,a,s,o)}}function md(e,t,n,r,i){let a=t.serverCache,o=fu(t,a.getNode(),a.isFullyInitialized()||W(n),a.isFiltered());return od(e,o,n,r,ed,i)}function hd(e,t,n,r,i,a){let o;if(Ju(r,n)!=null)return t;{let s=new td(r,t,i),c=t.eventCache.getNode(),l;if(W(n)||U(n)===`.priority`){let n;if(t.serverCache.isFullyInitialized())n=Gu(r,mu(t));else{let e=t.serverCache.getNode();V(e instanceof K,`serverChildren would be complete if leaf node`),n=Ku(r,e)}n=n,l=e.filter.updateFullNode(c,n,a)}else{let i=U(n),u=Xu(r,i,t.serverCache);u==null&&t.serverCache.isCompleteForChild(i)&&(u=c.getImmediateChild(i)),l=u==null?t.eventCache.getNode().hasChild(i)?e.filter.updateChild(c,i,K.EMPTY_NODE,wc(n),s,a):c:e.filter.updateChild(c,i,u,wc(n),s,a),l.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=Gu(r,mu(t)),o.isLeafNode()&&(l=e.filter.updateFullNode(l,o,a)))}return o=t.serverCache.isFullyInitialized()||Ju(r,Sc())!=null,du(t,l,o,e.filter.filtersNodes())}}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var gd=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let n=this.query_._queryParams,r=new Ml(n.getIndex()),i=Il(n);this.processor_=nd(i);let a=t.serverCache,o=t.eventCache,s=r.updateFullNode(K.EMPTY_NODE,a.getNode(),null),c=i.updateFullNode(K.EMPTY_NODE,o.getNode(),null),l=new iu(s,a.isFullyInitialized(),r.filtersNodes()),u=new iu(c,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=uu(u,l),this.eventGenerator_=new au(this.query_)}get query(){return this.query_}};function _d(e){return e.viewCache_.serverCache.getNode()}function vd(e,t){let n=mu(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!W(t)&&!n.getImmediateChild(U(t)).isEmpty())?n.getChild(t):null}function yd(e){return e.eventRegistrations_.length===0}function bd(e,t){e.eventRegistrations_.push(t)}function xd(e,t,n){let r=[];if(n){V(t==null,`A cancel should cancel all event registrations.`);let i=e.query._path;e.eventRegistrations_.forEach(e=>{let t=e.createCancelEvent(n,i);t&&r.push(t)})}if(t){let n=[];for(let r=0;r<e.eventRegistrations_.length;++r){let i=e.eventRegistrations_[r];if(!i.matches(t))n.push(i);else if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(r+1));break}}e.eventRegistrations_=n}else e.eventRegistrations_=[];return r}function Sd(e,t,n,r){t.type===q.MERGE&&t.source.queryId!==null&&(V(mu(e.viewCache_),`We should always have a full cache before handling merges`),V(pu(e.viewCache_),`Missing event cache, even though we have a server cache`));let i=e.viewCache_,a=id(e.processor_,i,t,n,r);return rd(e.processor_,a.viewCache),V(a.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),`Once a server snap is complete, it should never go back`),e.viewCache_=a.viewCache,wd(e,a.changes,a.viewCache.eventCache.getNode(),null)}function Cd(e,t){let n=e.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(ml,(e,t)=>{r.push(Ol(e,t))}),n.isFullyInitialized()&&r.push(Dl(n.getNode())),wd(e,r,n.getNode(),t)}function wd(e,t,n,r){let i=r?[r]:e.eventRegistrations_;return ou(e.eventGenerator_,t,n,i)}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var Td,Ed=class{constructor(){this.views=new Map}};function Dd(e){V(!Td,`__referenceConstructor has already been defined`),Td=e}function Od(){return V(Td,`Reference.ts has not been loaded`),Td}function kd(e){return e.views.size===0}function Ad(e,t,n,r){let i=t.source.queryId;if(i!==null){let a=e.views.get(i);return V(a!=null,`SyncTree gave us an op for an invalid query.`),Sd(a,t,n,r)}else{let i=[];for(let a of e.views.values())i=i.concat(Sd(a,t,n,r));return i}}function jd(e,t,n,r,i){let a=t._queryIdentifier,o=e.views.get(a);if(!o){let e=Gu(n,i?r:null),a=!1;e?a=!0:r instanceof K?(e=Ku(n,r),a=!1):(e=K.EMPTY_NODE,a=!1);let o=uu(new iu(e,a,!1),new iu(r,i,!1));return new gd(t,o)}return o}function Md(e,t,n,r,i,a){let o=jd(e,t,r,i,a);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),bd(o,n),Cd(o,n)}function Nd(e,t,n,r){let i=t._queryIdentifier,a=[],o=[],s=Rd(e);if(i===`default`)for(let[t,i]of e.views.entries())o=o.concat(xd(i,n,r)),yd(i)&&(e.views.delete(t),i.query._queryParams.loadsAllData()||a.push(i.query));else{let t=e.views.get(i);t&&(o=o.concat(xd(t,n,r)),yd(t)&&(e.views.delete(i),t.query._queryParams.loadsAllData()||a.push(t.query)))}return s&&!Rd(e)&&a.push(new(Od())(t._repo,t._path)),{removed:a,events:o}}function Pd(e){let t=[];for(let n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function Fd(e,t){let n=null;for(let r of e.views.values())n||=vd(r,t);return n}function Id(e,t){if(t._queryParams.loadsAllData())return J(e);{let n=t._queryIdentifier;return e.views.get(n)}}function Ld(e,t){return Id(e,t)!=null}function Rd(e){return J(e)!=null}function J(e){for(let t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var zd;function Bd(e){V(!zd,`__referenceConstructor has already been defined`),zd=e}function Vd(){return V(zd,`Reference.ts has not been loaded`),zd}var Hd=1,Ud=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new _u(null),this.pendingWriteTree_=Wu(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function Wd(e,t,n,r,i){return Au(e.pendingWriteTree_,t,n,r,i),i?nf(e,new nu(Zl(),t,n)):[]}function Gd(e,t,n,r){ju(e.pendingWriteTree_,t,n,r);let i=_u.fromObject(n);return nf(e,new ru(Zl(),t,i))}function Kd(e,t,n=!1){let r=Mu(e.pendingWriteTree_,t);if(Nu(e.pendingWriteTree_,t)){let t=new _u(null);return r.snap==null?Zo(r.children,e=>{t=t.set(new xc(e),!0)}):t=t.set(Sc(),!0),nf(e,new eu(r.path,t,n))}else return[]}function qd(e,t,n){return nf(e,new nu(Ql(),t,n))}function Jd(e,t,n){let r=_u.fromObject(n);return nf(e,new ru(Ql(),t,r))}function Yd(e,t){return nf(e,new tu(Ql(),t))}function Xd(e,t,n){let r=uf(e,n);if(r){let n=df(r),i=n.path,a=n.queryId,o=Ac(i,t),s=new tu($l(a),o);return ff(e,i,s)}else return[]}function Zd(e,t,n,r,i=!1){let a=t._path,o=e.syncPointTree_.get(a),s=[];if(o&&(t._queryIdentifier===`default`||Ld(o,t))){let c=Nd(o,t,n,r);kd(o)&&(e.syncPointTree_=e.syncPointTree_.remove(a));let l=c.removed;if(s=c.events,!i){let n=l.findIndex(e=>e._queryParams.loadsAllData())!==-1,i=e.syncPointTree_.findOnPath(a,(e,t)=>Rd(t));if(n&&!i){let t=e.syncPointTree_.subtree(a);if(!t.isEmpty()){let n=pf(t);for(let t=0;t<n.length;++t){let r=n[t],i=r.query,a=sf(e,r);e.listenProvider_.startListening(mf(i),cf(e,i),a.hashFn,a.onComplete)}}}!i&&l.length>0&&!r&&(n?e.listenProvider_.stopListening(mf(t),null):l.forEach(t=>{let n=e.queryToTagMap.get(lf(t));e.listenProvider_.stopListening(mf(t),n)}))}hf(e,l)}return s}function Qd(e,t,n,r){let i=uf(e,r);if(i!=null){let r=df(i),a=r.path,o=r.queryId,s=Ac(a,t),c=new nu($l(o),s,n);return ff(e,a,c)}else return[]}function $d(e,t,n,r){let i=uf(e,r);if(i){let r=df(i),a=r.path,o=r.queryId,s=Ac(a,t),c=_u.fromObject(n),l=new ru($l(o),s,c);return ff(e,a,l)}else return[]}function ef(e,t,n,r=!1){let i=t._path,a=null,o=!1;e.syncPointTree_.foreachOnPath(i,(e,t)=>{let n=Ac(e,i);a||=Fd(t,n),o||=Rd(t)});let s=e.syncPointTree_.get(i);s?(o||=Rd(s),a||=Fd(s,Sc())):(s=new Ed,e.syncPointTree_=e.syncPointTree_.set(i,s));let c;a==null?(c=!1,a=K.EMPTY_NODE,e.syncPointTree_.subtree(i).foreachChild((e,t)=>{let n=Fd(t,Sc());n&&(a=a.updateImmediateChild(e,n))})):c=!0;let l=Ld(s,t);if(!l&&!t._queryParams.loadsAllData()){let n=lf(t);V(!e.queryToTagMap.has(n),`View does not exist, but we have a tag`);let r=gf();e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}let u=ku(e.pendingWriteTree_,i),d=Md(s,t,n,u,a,c);if(!l&&!o&&!r){let n=Id(s,t);d=d.concat(_f(e,t,n))}return d}function tf(e,t,n){let r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,n)=>{let r=Ac(e,t),i=Fd(n,r);if(i)return i});return Ru(r,t,i,n,!0)}function nf(e,t){return rf(t,e.syncPointTree_,null,ku(e.pendingWriteTree_,Sc()))}function rf(e,t,n,r){if(W(e.path))return af(e,t,n,r);{let i=t.get(Sc());n==null&&i!=null&&(n=Fd(i,Sc()));let a=[],o=U(e.path),s=e.operationForChild(o),c=t.children.get(o);if(c&&s){let e=n?n.getImmediateChild(o):null,t=Zu(r,o);a=a.concat(rf(s,c,e,t))}return i&&(a=a.concat(Ad(i,e,r,n))),a}}function af(e,t,n,r){let i=t.get(Sc());n==null&&i!=null&&(n=Fd(i,Sc()));let a=[];return t.children.inorderTraversal((t,i)=>{let o=n?n.getImmediateChild(t):null,s=Zu(r,t),c=e.operationForChild(t);c&&(a=a.concat(af(c,i,o,s)))}),i&&(a=a.concat(Ad(i,e,r,n))),a}function sf(e,t){let n=t.query,r=cf(e,n);return{hashFn:()=>(_d(t)||K.EMPTY_NODE).hash(),onComplete:t=>{if(t===`ok`)return r?Xd(e,n._path,r):Yd(e,n._path);{let r=ts(t,n);return Zd(e,n,null,r)}}}}function cf(e,t){let n=lf(t);return e.queryToTagMap.get(n)}function lf(e){return e._path.toString()+`$`+e._queryIdentifier}function uf(e,t){return e.tagToQueryMap.get(t)}function df(e){let t=e.indexOf(`$`);return V(t!==-1&&t<e.length-1,`Bad queryKey.`),{queryId:e.substr(t+1),path:new xc(e.substr(0,t))}}function ff(e,t,n){let r=e.syncPointTree_.get(t);V(r,`Missing sync point for query tag that we're tracking`);let i=ku(e.pendingWriteTree_,t);return Ad(r,n,i,null)}function pf(e){return e.fold((e,t,n)=>{if(t&&Rd(t))return[J(t)];{let e=[];return t&&(e=Pd(t)),Zo(n,(t,n)=>{e=e.concat(n)}),e}})}function mf(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(Vd())(e._repo,e._path):e}function hf(e,t){for(let n=0;n<t.length;++n){let r=t[n];if(!r._queryParams.loadsAllData()){let t=lf(r),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}function gf(){return Hd++}function _f(e,t,n){let r=t._path,i=cf(e,t),a=sf(e,n),o=e.listenProvider_.startListening(mf(t),i,a.hashFn,a.onComplete),s=e.syncPointTree_.subtree(r);if(i)V(!Rd(s.value),`If we're adding a query, it shouldn't be shadowed`);else{let t=s.fold((e,t,n)=>{if(!W(e)&&t&&Rd(t))return[J(t).query];{let e=[];return t&&(e=e.concat(Pd(t).map(e=>e.query))),Zo(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){let r=t[n];e.listenProvider_.stopListening(mf(r),cf(e,r))}}return o}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var vf=class e{constructor(e){this.node_=e}getImmediateChild(t){let n=this.node_.getImmediateChild(t);return new e(n)}node(){return this.node_}},yf=class e{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(t){let n=kc(this.path_,t);return new e(this.syncTree_,n)}node(){return tf(this.syncTree_,this.path_)}},bf=function(e){return e||={},e.timestamp=e.timestamp||new Date().getTime(),e},xf=function(e,t,n){if(!e||typeof e!=`object`)return e;if(V(`.sv`in e,`Unexpected leaf node or priority contents`),typeof e[`.sv`]==`string`)return Sf(e[`.sv`],t,n);if(typeof e[`.sv`]==`object`)return Cf(e[`.sv`],t);V(!1,`Unexpected server value: `+JSON.stringify(e,null,2))},Sf=function(e,t,n){switch(e){case`timestamp`:return n.timestamp;default:V(!1,`Unexpected server value: `+e)}},Cf=function(e,t,n){e.hasOwnProperty(`increment`)||V(!1,`Unexpected server value: `+JSON.stringify(e,null,2));let r=e.increment;typeof r!=`number`&&V(!1,`Unexpected increment value: `+r);let i=t.node();if(V(i!=null,`Expected ChildrenNode.EMPTY_NODE for nulls`),!i.isLeafNode())return r;let a=i.getValue();return typeof a==`number`?a+r:r},wf=function(e,t,n,r){return Ef(t,new yf(n,e),r)},Tf=function(e,t,n){return Ef(e,new vf(t),n)};function Ef(e,t,n){let r=e.getPriority().val(),i=xf(r,t.getImmediateChild(`.priority`),n),a;if(e.isLeafNode()){let r=e,a=xf(r.getValue(),t,n);return a!==r.getValue()||i!==r.getPriority().val()?new ll(a,wl(i)):e}else{let r=e;return a=r,i!==r.getPriority().val()&&(a=a.updatePriority(new ll(i))),r.forEachChild(ml,(e,r)=>{let i=Ef(r,t.getImmediateChild(e),n);i!==r&&(a=a.updateImmediateChild(e,i))}),a}}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var Df=class{constructor(e=``,t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}};function Of(e,t){let n=t instanceof xc?t:new xc(t),r=e,i=U(n);for(;i!==null;){let e=_i(r.node.children,i)||{children:{},childCount:0};r=new Df(i,r,e),n=wc(n),i=U(n)}return r}function kf(e){return e.node.value}function Af(e,t){e.node.value=t,Lf(e)}function jf(e){return e.node.childCount>0}function Mf(e){return kf(e)===void 0&&!jf(e)}function Nf(e,t){Zo(e.node.children,(n,r)=>{t(new Df(n,e,r))})}function Pf(e,t,n,r){n&&!r&&t(e),Nf(e,e=>{Pf(e,t,!0,r)}),n&&r&&t(e)}function Ff(e,t,n){let r=n?e:e.parent;for(;r!==null;){if(t(r))return!0;r=r.parent}return!1}function If(e){return new xc(e.parent===null?e.name:If(e.parent)+`/`+e.name)}function Lf(e){e.parent!==null&&Rf(e.parent,e.name,e)}function Rf(e,t,n){let r=Mf(n),i=gi(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,Lf(e)):!r&&!i&&(e.node.children[t]=n.node,e.node.childCount++,Lf(e))}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var zf=/[\[\].#$\/\u0000-\u001F\u007F]/,Bf=/[\[\].#$\u0000-\u001F\u007F]/,Vf=10*1024*1024,Hf=function(e){return typeof e==`string`&&e.length!==0&&!zf.test(e)},Uf=function(e){return typeof e==`string`&&e.length!==0&&!Bf.test(e)},Wf=function(e){return e&&=e.replace(/^\/*\.info(\/|$)/,`/`),Uf(e)},Gf=function(e){return e===null||typeof e==`string`||typeof e==`number`&&!Ho(e)||e&&typeof e==`object`&&gi(e,`.sv`)},Kf=function(e,t,n,r){r&&t===void 0||qf(wi(e,`value`),t,n)},qf=function(e,t,n){let r=n instanceof xc?new Pc(n,e):n;if(t===void 0)throw Error(e+`contains undefined `+Rc(r));if(typeof t==`function`)throw Error(e+`contains a function `+Rc(r)+` with contents = `+t.toString());if(Ho(t))throw Error(e+`contains `+t.toString()+` `+Rc(r));if(typeof t==`string`&&t.length>Vf/3&&Ei(t)>Vf)throw Error(e+`contains a string greater than 10485760 utf8 bytes `+Rc(r)+` ('`+t.substring(0,50)+`...')`);if(t&&typeof t==`object`){let n=!1,i=!1;if(Zo(t,(t,a)=>{if(t===`.value`)n=!0;else if(t!==`.priority`&&t!==`.sv`&&(i=!0,!Hf(t)))throw Error(e+` contains an invalid key (`+t+`) `+Rc(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Fc(r,t),qf(e,a,r),Ic(r)}),n&&i)throw Error(e+` contains ".value" child `+Rc(r)+` in addition to actual children.`)}},Jf=function(e,t){let n,r;for(n=0;n<t.length;n++){r=t[n];let i=Dc(r);for(let t=0;t<i.length;t++)if(!(i[t]===`.priority`&&t===i.length-1)&&!Hf(i[t]))throw Error(e+`contains an invalid key (`+i[t]+`) in path `+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}t.sort(jc);let i=null;for(n=0;n<t.length;n++){if(r=t[n],i!==null&&Nc(i,r))throw Error(e+`contains a path `+i.toString()+` that is ancestor of another path `+r.toString());i=r}},Yf=function(e,t,n,r){if(r&&t===void 0)return;let i=wi(e,`values`);if(!(t&&typeof t==`object`)||Array.isArray(t))throw Error(i+` must be an object containing the children to replace.`);let a=[];Zo(t,(e,t)=>{let r=new xc(e);if(qf(i,t,kc(n,r)),Tc(r)===`.priority`&&!Gf(t))throw Error(i+`contains an invalid value for '`+r.toString()+`', which must be a valid Firebase priority (a string, finite number, server value, or null).`);a.push(r)}),Jf(i,a)},Xf=function(e,t,n){if(!(n&&t===void 0)){if(Ho(t))throw Error(wi(e,`priority`)+`is `+t.toString()+`, but must be a valid Firebase priority (a string, finite number, server value, or null).`);if(!Gf(t))throw Error(wi(e,`priority`)+`must be a valid Firebase priority (a string, finite number, server value, or null).`)}},Zf=function(e,t,n,r){if(!(r&&n===void 0)&&!Uf(n))throw Error(wi(e,t)+`was an invalid path = "`+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Qf=function(e,t,n,r){n&&=n.replace(/^\/*\.info(\/|$)/,`/`),Zf(e,t,n,r)},$f=function(e,t){if(U(t)===`.info`)throw Error(e+` failed = Can't modify data under /.info/`)},ep=function(e,t){let n=t.path.toString();if(typeof t.repoInfo.host!=`string`||t.repoInfo.host.length===0||!Hf(t.repoInfo.namespace)&&t.repoInfo.host.split(`:`)[0]!==`localhost`||n.length!==0&&!Wf(n))throw Error(wi(e,`url`)+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)},tp=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function np(e,t){let n=null;for(let r=0;r<t.length;r++){let i=t[r],a=i.getPath();n!==null&&!Mc(a,n.path)&&(e.eventLists_.push(n),n=null),n===null&&(n={events:[],path:a}),n.events.push(i)}n&&e.eventLists_.push(n)}function rp(e,t,n){np(e,n),ap(e,e=>Mc(e,t))}function ip(e,t,n){np(e,n),ap(e,e=>Nc(e,t)||Nc(t,e))}function ap(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){let i=e.eventLists_[r];if(i){let a=i.path;t(a)?(op(e.eventLists_[r]),e.eventLists_[r]=null):n=!1}}n&&(e.eventLists_=[]),e.recursionDepth_--}function op(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(n!==null){e.events[t]=null;let r=n.getEventRunner();No&&Io(`event: `+n.toString()),cs(r)}}}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var sp=`repo_interrupt`,cp=25,lp=class{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new tp,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Vl(),this.transactionQueueTree_=new Df,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?`https://`:`http://`)+this.repoInfo_.host}};function up(e,t,n){if(e.stats_=js(e.repoInfo_),e.forceRestClient_||ls())e.server_=new zl(e.repoInfo_,(t,n,r,i)=>{pp(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>mp(e,!0),0);else{if(n!=null){if(typeof n!=`object`)throw Error(`Only objects are supported for option databaseAuthVariableOverride`);try{fi(n)}catch(e){throw Error(`Invalid authOverride provided: `+e)}}e.persistentConnection_=new qc(e.repoInfo_,t,(t,n,r,i)=>{pp(e,t,n,r,i)},t=>{mp(e,t)},t=>{hp(e,t)},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=Ms(e.repoInfo_,()=>new Xl(e.stats_,e.server_)),e.infoData_=new Bl,e.infoSyncTree_=new Ud({startListening:(t,n,r,i)=>{let a=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(a=qd(e.infoSyncTree_,t._path,o),setTimeout(()=>{i(`ok`)},0)),a},stopListening:()=>{}}),gp(e,`connected`,!1),e.serverSyncTree_=new Ud({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,(n,r)=>{let a=i(n,r);ip(e.eventQueue_,t._path,a)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function dp(e){let t=e.infoData_.getNode(new xc(`.info/serverTimeOffset`)).val()||0;return new Date().getTime()+t}function fp(e){return bf({timestamp:dp(e)})}function pp(e,t,n,r,i){e.dataUpdateCount++;let a=new xc(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i)if(r){let t=yi(n,e=>wl(e));o=$d(e.serverSyncTree_,a,t,i)}else{let t=wl(n);o=Qd(e.serverSyncTree_,a,t,i)}else if(r){let t=yi(n,e=>wl(e));o=Jd(e.serverSyncTree_,a,t)}else{let t=wl(n);o=qd(e.serverSyncTree_,a,t)}let s=a;o.length>0&&(s=Np(e,a)),ip(e.eventQueue_,s,o)}function mp(e,t){gp(e,`connected`,t),t===!1&&bp(e)}function hp(e,t){Zo(t,(t,n)=>{gp(e,t,n)})}function gp(e,t,n){let r=new xc(`/.info/`+t),i=wl(n);e.infoData_.updateSnapshot(r,i);let a=qd(e.infoSyncTree_,r,i);ip(e.eventQueue_,r,a)}function _p(e){return e.nextWriteId_++}function vp(e,t,n,r,i){Op(e,`set`,{path:t.toString(),value:n,priority:r});let a=fp(e),o=wl(n,r),s=tf(e.serverSyncTree_,t),c=Tf(o,s,a),l=_p(e),u=Wd(e.serverSyncTree_,t,c,l,!0);np(e.eventQueue_,u),e.server_.put(t.toString(),o.val(!0),(n,r)=>{let a=n===`ok`;a||Bo(`set at `+t+` failed: `+n);let o=Kd(e.serverSyncTree_,l,!a);ip(e.eventQueue_,t,o),kp(e,i,n,r)});let d=zp(e,t);Np(e,d),ip(e.eventQueue_,d,[])}function yp(e,t,n,r){Op(e,`update`,{path:t.toString(),value:n});let i=!0,a=fp(e),o={};if(Zo(n,(n,r)=>{i=!1,o[n]=wf(kc(t,n),wl(r),e.serverSyncTree_,a)}),i)Io(`update() called with empty data.  Don't do anything.`),kp(e,r,`ok`,void 0);else{let i=_p(e),a=Gd(e.serverSyncTree_,t,o,i);np(e.eventQueue_,a),e.server_.merge(t.toString(),n,(n,a)=>{let o=n===`ok`;o||Bo(`update at `+t+` failed: `+n);let s=Kd(e.serverSyncTree_,i,!o),c=s.length>0?Np(e,t):t;ip(e.eventQueue_,c,s),kp(e,r,n,a)}),Zo(n,n=>{let r=zp(e,kc(t,n));Np(e,r)}),ip(e.eventQueue_,t,[])}}function bp(e){Op(e,`onDisconnectEvents`);let t=fp(e),n=Vl();Wl(e.onDisconnect_,Sc(),(r,i)=>{let a=wf(r,i,e.serverSyncTree_,t);Hl(n,r,a)});let r=[];Wl(n,Sc(),(t,n)=>{r=r.concat(qd(e.serverSyncTree_,t,n));let i=zp(e,t);Np(e,i)}),e.onDisconnect_=Vl(),ip(e.eventQueue_,Sc(),r)}function xp(e,t,n){e.server_.onDisconnectCancel(t.toString(),(r,i)=>{r===`ok`&&Ul(e.onDisconnect_,t),kp(e,n,r,i)})}function Sp(e,t,n,r){let i=wl(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),(n,a)=>{n===`ok`&&Hl(e.onDisconnect_,t,i),kp(e,r,n,a)})}function Cp(e,t,n,r,i){let a=wl(n,r);e.server_.onDisconnectPut(t.toString(),a.val(!0),(n,r)=>{n===`ok`&&Hl(e.onDisconnect_,t,a),kp(e,i,n,r)})}function wp(e,t,n,r){if(vi(n)){Io(`onDisconnect().update() called with empty data.  Don't do anything.`),kp(e,r,`ok`,void 0);return}e.server_.onDisconnectMerge(t.toString(),n,(i,a)=>{i===`ok`&&Zo(n,(n,r)=>{let i=wl(r);Hl(e.onDisconnect_,kc(t,n),i)}),kp(e,r,i,a)})}function Tp(e,t,n){let r;r=U(t._path)===`.info`?ef(e.infoSyncTree_,t,n):ef(e.serverSyncTree_,t,n),rp(e.eventQueue_,t._path,r)}function Ep(e,t,n){let r;r=U(t._path)===`.info`?Zd(e.infoSyncTree_,t,n):Zd(e.serverSyncTree_,t,n),rp(e.eventQueue_,t._path,r)}function Dp(e){e.persistentConnection_&&e.persistentConnection_.interrupt(sp)}function Op(e,...t){let n=``;e.persistentConnection_&&(n=e.persistentConnection_.id+`:`),Io(n,...t)}function kp(e,t,n,r){t&&cs(()=>{if(n===`ok`)t(null);else{let e=(n||`error`).toUpperCase(),i=e;r&&(i+=`: `+r);let a=Error(i);a.code=e,t(a)}})}function Ap(e,t,n){return tf(e.serverSyncTree_,t,n)||K.EMPTY_NODE}function jp(e,t=e.transactionQueueTree_){if(t||Rp(e,t),kf(t)){let n=Ip(e,t);V(n.length>0,`Sending zero length transaction queue`),n.every(e=>e.status===0)&&Mp(e,If(t),n)}else jf(t)&&Nf(t,t=>{jp(e,t)})}function Mp(e,t,n){let r=n.map(e=>e.currentWriteId),i=Ap(e,t,r),a=i,o=i.hash();for(let e=0;e<n.length;e++){let r=n[e];V(r.status===0,`tryToSendTransactionQueue_: items in queue should all be run.`),r.status=1,r.retryCount++;let i=Ac(t,r.path);a=a.updateChild(i,r.currentOutputSnapshotRaw)}let s=a.val(!0),c=t;e.server_.put(c.toString(),s,r=>{Op(e,`transaction put response`,{path:c.toString(),status:r});let i=[];if(r===`ok`){let r=[];for(let t=0;t<n.length;t++)n[t].status=2,i=i.concat(Kd(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&r.push(()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)),n[t].unwatcher();Rp(e,Of(e.transactionQueueTree_,t)),jp(e,e.transactionQueueTree_),ip(e.eventQueue_,t,i);for(let e=0;e<r.length;e++)cs(r[e])}else{if(r===`datastale`)for(let e=0;e<n.length;e++)n[e].status===3?n[e].status=4:n[e].status=0;else{Bo(`transaction at `+c.toString()+` failed: `+r);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=r}Np(e,t)}},o)}function Np(e,t){let n=Fp(e,t),r=If(n),i=Ip(e,n);return Pp(e,i,r),r}function Pp(e,t,n){if(t.length===0)return;let r=[],i=[],a=t.filter(e=>e.status===0).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let s=t[o],c=Ac(n,s.path),l=!1,u;if(V(c!==null,`rerunTransactionsUnderNode_: relativePath should not be null.`),s.status===4)l=!0,u=s.abortReason,i=i.concat(Kd(e.serverSyncTree_,s.currentWriteId,!0));else if(s.status===0)if(s.retryCount>=cp)l=!0,u=`maxretry`,i=i.concat(Kd(e.serverSyncTree_,s.currentWriteId,!0));else{let n=Ap(e,s.path,a);s.currentInputSnapshot=n;let r=t[o].update(n.val());if(r!==void 0){qf(`transaction failed: Data returned `,r,s.path);let t=wl(r);typeof r==`object`&&r&&gi(r,`.priority`)||(t=t.updatePriority(n.getPriority()));let o=s.currentWriteId,c=fp(e),l=Tf(t,n,c);s.currentOutputSnapshotRaw=t,s.currentOutputSnapshotResolved=l,s.currentWriteId=_p(e),a.splice(a.indexOf(o),1),i=i.concat(Wd(e.serverSyncTree_,s.path,l,s.currentWriteId,s.applyLocally)),i=i.concat(Kd(e.serverSyncTree_,o,!0))}else l=!0,u=`nodata`,i=i.concat(Kd(e.serverSyncTree_,s.currentWriteId,!0))}ip(e.eventQueue_,n,i),i=[],l&&(t[o].status=2,(function(e){setTimeout(e,0)})(t[o].unwatcher),t[o].onComplete&&(u===`nodata`?r.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):r.push(()=>t[o].onComplete(Error(u),!1,null))))}Rp(e,e.transactionQueueTree_);for(let e=0;e<r.length;e++)cs(r[e]);jp(e,e.transactionQueueTree_)}function Fp(e,t){let n,r=e.transactionQueueTree_;for(n=U(t);n!==null&&kf(r)===void 0;)r=Of(r,n),t=wc(t),n=U(t);return r}function Ip(e,t){let n=[];return Lp(e,t,n),n.sort((e,t)=>e.order-t.order),n}function Lp(e,t,n){let r=kf(t);if(r)for(let e=0;e<r.length;e++)n.push(r[e]);Nf(t,t=>{Lp(e,t,n)})}function Rp(e,t){let n=kf(t);if(n){let e=0;for(let t=0;t<n.length;t++)n[t].status!==2&&(n[e]=n[t],e++);n.length=e,Af(t,n.length>0?n:void 0)}Nf(t,t=>{Rp(e,t)})}function zp(e,t){let n=If(Fp(e,t)),r=Of(e.transactionQueueTree_,t);return Ff(r,t=>{Bp(e,t)}),Bp(e,r),Pf(r,t=>{Bp(e,t)}),n}function Bp(e,t){let n=kf(t);if(n){let r=[],i=[],a=-1;for(let t=0;t<n.length;t++)n[t].status===3||(n[t].status===1?(V(a===t-1,`All SENT items should be at beginning of queue.`),a=t,n[t].status=3,n[t].abortReason=`set`):(V(n[t].status===0,`Unexpected transaction status in abort`),n[t].unwatcher(),i=i.concat(Kd(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,Error(`set`),!1,null))));a===-1?Af(t,void 0):n.length=a+1,ip(e.eventQueue_,If(t),i);for(let e=0;e<r.length;e++)cs(r[e])}}
/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
function Vp(e){let t=``,n=e.split(`/`);for(let e=0;e<n.length;e++)if(n[e].length>0){let r=n[e];try{r=decodeURIComponent(r.replace(/\+/g,` `))}catch{}t+=`/`+r}return t}function Hp(e){let t={};e.charAt(0)===`?`&&(e=e.substring(1));for(let n of e.split(`&`)){if(n.length===0)continue;let r=n.split(`=`);r.length===2?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Bo(`Invalid query segment '${n}' in query '${e}'`)}return t}var Up=function(e,t){let n=Wp(e),r=n.namespace;n.domain===`firebase.com`&&zo(n.host+` is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead`),(!r||r===`undefined`)&&n.domain!==`localhost`&&zo(`Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com`),n.secure||Vo();let i=n.scheme===`ws`||n.scheme===`wss`;return{repoInfo:new Ts(n.host,n.secure,r,i,t,``,r!==n.subdomain),path:new xc(n.pathString)}},Wp=function(e){let t=``,n=``,r=``,i=``,a=``,o=!0,s=`https`,c=443;if(typeof e==`string`){let l=e.indexOf(`//`);l>=0&&(s=e.substring(0,l-1),e=e.substring(l+2));let u=e.indexOf(`/`);u===-1&&(u=e.length);let d=e.indexOf(`?`);d===-1&&(d=e.length),t=e.substring(0,Math.min(u,d)),u<d&&(i=Vp(e.substring(u,d)));let f=Hp(e.substring(Math.min(e.length,d)));l=t.indexOf(`:`),l>=0?(o=s===`https`||s===`wss`,c=parseInt(t.substring(l+1),10)):l=t.length;let p=t.slice(0,l);if(p.toLowerCase()===`localhost`)n=`localhost`;else if(p.split(`.`).length<=2)n=p;else{let e=t.indexOf(`.`);r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),a=r}`ns`in f&&(a=f.ns)}return{host:t,port:c,domain:n,subdomain:r,secure:o,scheme:s,pathString:i,namespace:a}},Gp=`-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz`,Kp=(function(){let e=0,t=[];return function(n){let r=n===e;e=n;let i,a=Array(8);for(i=7;i>=0;i--)a[i]=Gp.charAt(n%64),n=Math.floor(n/64);V(n===0,`Cannot push at time == 0`);let o=a.join(``);if(r){for(i=11;i>=0&&t[i]===63;i--)t[i]=0;t[i]++}else for(i=0;i<12;i++)t[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=Gp.charAt(t[i]);return V(o.length===20,`nextPushId: Length should be 20.`),o}})(),qp=class{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){let e=this.snapshot.ref;return this.eventType===`value`?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+`:`+this.eventType+`:`+fi(this.snapshot.exportVal())}},Jp=class{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return`cancel`}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+`:cancel`}},Yp=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return V(this.hasCancelCallback,`Raising a cancel event on a listener with no cancel callback`),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}},Xp=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new Gr;return xp(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){$f(`OnDisconnect.remove`,this._path);let e=new Gr;return Sp(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){$f(`OnDisconnect.set`,this._path),Kf(`OnDisconnect.set`,e,this._path,!1);let t=new Gr;return Sp(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){$f(`OnDisconnect.setWithPriority`,this._path),Kf(`OnDisconnect.setWithPriority`,e,this._path,!1),Xf(`OnDisconnect.setWithPriority`,t,!1);let n=new Gr;return Cp(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){$f(`OnDisconnect.update`,this._path),Yf(`OnDisconnect.update`,e,this._path,!1);let t=new Gr;return wp(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}},Zp=class e{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return W(this._path)?null:Tc(this._path)}get ref(){return new Qp(this._repo,this._path)}get _queryIdentifier(){let e=Rl(this._queryParams),t=Yo(e);return t===`{}`?`default`:t}get _queryObject(){return Rl(this._queryParams)}isEqual(t){if(t=Di(t),!(t instanceof e))return!1;let n=this._repo===t._repo,r=Mc(this._path,t._path),i=this._queryIdentifier===t._queryIdentifier;return n&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+Ec(this._path)}},Qp=class e extends Zp{constructor(e,t){super(e,t,new Fl,!1)}get parent(){let t=Oc(this._path);return t===null?null:new e(this._repo,t)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},$p=class e{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){let n=new xc(t),r=tm(this.ref,t);return new e(this._node.getChild(n),r,ml)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(n,r)=>t(new e(r,tm(this.ref,n),ml)))}hasChild(e){let t=new xc(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function em(e,t){return e=Di(e),e._checkNotDeleted(`ref`),t===void 0?e._root:tm(e._root,t)}function tm(e,t){return e=Di(e),U(e._path)===null?Qf(`child`,`path`,t,!1):Zf(`child`,`path`,t,!1),new Qp(e._repo,kc(e._path,t))}function nm(e){return e=Di(e),new Xp(e._repo,e._path)}function rm(e,t){e=Di(e),$f(`push`,e._path),Kf(`push`,t,e._path,!0);let n=dp(e._repo),r=Kp(n),i=tm(e,r),a=tm(e,r),o;return o=t==null?Promise.resolve(a):am(a,t).then(()=>a),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function im(e){return $f(`remove`,e._path),am(e,null)}function am(e,t){e=Di(e),$f(`set`,e._path),Kf(`set`,t,e._path,!1);let n=new Gr;return vp(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function om(e,t){Yf(`update`,t,e._path,!1);let n=new Gr;return yp(e._repo,e._path,t,n.wrapCallback(()=>{})),n.promise}var sm=class e{constructor(e){this.callbackContext=e}respondsTo(e){return e===`value`}createEvent(e,t){let n=t._queryParams.getIndex();return new qp(`value`,this,new $p(e.snapshotNode,new Qp(t._repo,t._path),n))}getEventRunner(e){return e.getEventType()===`cancel`?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Jp(this,e,t):null}matches(t){return t instanceof e?!t.callbackContext||!this.callbackContext?!0:t.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},cm=class e{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e===`children_added`?`child_added`:e;return t=t===`children_removed`?`child_removed`:t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Jp(this,e,t):null}createEvent(e,t){V(e.childName!=null,`Child events should have a childName.`);let n=tm(new Qp(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new qp(e.type,this,new $p(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return e.getEventType()===`cancel`?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(t){return t instanceof e?this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function lm(e,t,n,r,i){let a;if(typeof r==`object`&&(a=void 0,i=r),typeof r==`function`&&(a=r),i&&i.onlyOnce){let t=n,r=(n,r)=>{Ep(e._repo,e,s),t(n,r)};r.userCallback=n.userCallback,r.context=n.context,n=r}let o=new Yp(n,a||void 0),s=t===`value`?new sm(o):new cm(t,o);return Tp(e._repo,e,s),()=>Ep(e._repo,e,s)}function um(e,t,n,r){return lm(e,`value`,t,n,r)}function dm(e,t,n,r){return lm(e,`child_added`,t,n,r)}function fm(e,t,n){let r=null,i=n?new Yp(n):null;t===`value`?r=new sm(i):t&&(r=new cm(t,i)),Ep(e._repo,e,r)}Dd(Qp),Bd(Qp);
/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var pm=`FIREBASE_DATABASE_EMULATOR_HOST`,mm={},hm=!1;function gm(e,t,n,r){let i=t.lastIndexOf(`:`),a=t.substring(0,i),o=Kr(a);e.repoInfo_=new Ts(t,o,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(e.authTokenProvider_=r)}function _m(e,t,n,r,i){let a=r||e.options.databaseURL;a===void 0&&(e.options.projectId||zo(`Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp().`),Io(`Using default host for project `,e.options.projectId),a=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o=Up(a,i),s=o.repoInfo,c,l;typeof process<`u`&&(l={}[pm]),l?(c=!0,a=`http://${l}?ns=${s.namespace}`,o=Up(a,i),s=o.repoInfo):c=!o.repoInfo.secure;let u=i&&c?new ps(ps.OWNER):new fs(e.name,e.options,t);ep(`Invalid Firebase Database URL`,o),W(o.path)||zo(`Database URL must point to the root of a Firebase Database (not including a child path).`);let d=ym(s,e,u,new ds(e,n));return new bm(d,e)}function vm(e,t){let n=mm[t];(!n||n[e.key]!==e)&&zo(`Database ${t}(${e.repoInfo_}) has already been deleted.`),Dp(e),delete n[e.key]}function ym(e,t,n,r){let i=mm[t.name];i||(i={},mm[t.name]=i);let a=i[e.toURLString()];return a&&zo(`Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.`),a=new lp(e,hm,n,r),i[e.toURLString()]=a,a}var bm=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type=`database`,this._instanceStarted=!1}get _repo(){return this._instanceStarted||=(up(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),!0),this._repoInternal}get _root(){return this._rootInternal||=new Qp(this._repo,Sc()),this._rootInternal}_delete(){return this._rootInternal!==null&&(vm(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&zo(`Cannot call `+e+` on a deleted database.`)}};function xm(e=to(),t){let n=Ya(e,`database`).getImmediate({identifier:t});if(!n._instanceStarted){let e=Ur(`database`);e&&Sm(n,...e)}return n}function Sm(e,t,n,r={}){e=Di(e),e._checkNotDeleted(`useEmulator`);let i=`${t}:${n}`,a=e._repoInternal;if(e._instanceStarted){if(i===e._repoInternal.repoInfo_.host&&bi(r,a.repoInfo_.emulatorOptions))return;zo(`connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.`)}let o;if(a.repoInfo_.nodeAdmin)r.mockUserToken&&zo(`mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".`),o=new ps(ps.OWNER);else if(r.mockUserToken){let t=typeof r.mockUserToken==`string`?r.mockUserToken:Jr(r.mockUserToken,e.app.options.projectId);o=new ps(t)}Kr(t)&&(qr(t),$r(`Database`,!0)),gm(a,i,r,o)}
/**
* @license
* Copyright 2021 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
function Cm(e){Co($a),Ja(new Oi(`database`,(e,{instanceIdentifier:t})=>{let n=e.getProvider(`app`).getImmediate(),r=e.getProvider(`auth-internal`),i=e.getProvider(`app-check-internal`);return _m(n,r,i,t)},`PUBLIC`).setMultipleInstances(!0)),no(xo,So,e),no(xo,So,`esm2020`)}
/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
qc.prototype.simpleListen=function(e,t){this.sendRequest(`q`,{p:e},t)},qc.prototype.echo=function(e,t){this.sendRequest(`echo`,{d:e},t)},Cm(),no(`firebase`,`12.3.0`,`app`);const wm=eo({apiKey:void 0,authDomain:void 0,projectId:void 0,storageBucket:void 0,messagingSenderId:void 0,appId:void 0,databaseURL:void 0}),Tm=xm(wm);
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */
var Em=4,Dm=0,Om=1,km=2;function Am(e){let t=e.length;for(;--t>=0;)e[t]=0}var jm=0,Mm=1,Nm=2,Pm=3,Fm=258,Im=29,Lm=256,Rm=Lm+1+Im,zm=30,Bm=19,Vm=2*Rm+1,Hm=15,Um=16,Wm=7,Gm=256,Km=16,qm=17,Jm=18,Ym=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Xm=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Zm=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Qm=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$m=512,eh=Array((Rm+2)*2);Am(eh);var th=Array(zm*2);Am(th);var nh=Array($m);Am(nh);var rh=Array(Fm-Pm+1);Am(rh);var ih=Array(Im);Am(ih);var ah=Array(zm);Am(ah);function oh(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}var sh,ch,lh;function uh(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}var dh=e=>e<256?nh[e]:nh[256+(e>>>7)],fh=(e,t)=>{e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255},ph=(e,t,n)=>{e.bi_valid>Um-n?(e.bi_buf|=t<<e.bi_valid&65535,fh(e,e.bi_buf),e.bi_buf=t>>Um-e.bi_valid,e.bi_valid+=n-Um):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},mh=(e,t,n)=>{ph(e,n[t*2],n[t*2+1])},hh=(e,t)=>{let n=0;do n|=e&1,e>>>=1,n<<=1;while(--t>0);return n>>>1},gh=e=>{e.bi_valid===16?(fh(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},_h=(e,t)=>{let n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,a=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,s=t.stat_desc.extra_base,c=t.stat_desc.max_length,l,u,d,f,p,m,h=0;for(f=0;f<=Hm;f++)e.bl_count[f]=0;for(n[e.heap[e.heap_max]*2+1]=0,l=e.heap_max+1;l<Vm;l++)u=e.heap[l],f=n[n[u*2+1]*2+1]+1,f>c&&(f=c,h++),n[u*2+1]=f,!(u>r)&&(e.bl_count[f]++,p=0,u>=s&&(p=o[u-s]),m=n[u*2],e.opt_len+=m*(f+p),a&&(e.static_len+=m*(i[u*2+1]+p)));if(h!==0){do{for(f=c-1;e.bl_count[f]===0;)f--;e.bl_count[f]--,e.bl_count[f+1]+=2,e.bl_count[c]--,h-=2}while(h>0);for(f=c;f!==0;f--)for(u=e.bl_count[f];u!==0;)d=e.heap[--l],!(d>r)&&(n[d*2+1]!==f&&(e.opt_len+=(f-n[d*2+1])*n[d*2],n[d*2+1]=f),u--)}},vh=(e,t,n)=>{let r=Array(Hm+1),i=0,a,o;for(a=1;a<=Hm;a++)i=i+n[a-1]<<1,r[a]=i;for(o=0;o<=t;o++){let t=e[o*2+1];t!==0&&(e[o*2]=hh(r[t]++,t))}},yh=()=>{let e,t,n,r,i,a=Array(Hm+1);for(n=0,r=0;r<Im-1;r++)for(ih[r]=n,e=0;e<1<<Ym[r];e++)rh[n++]=r;for(rh[n-1]=r,i=0,r=0;r<16;r++)for(ah[r]=i,e=0;e<1<<Xm[r];e++)nh[i++]=r;for(i>>=7;r<zm;r++)for(ah[r]=i<<7,e=0;e<1<<Xm[r]-7;e++)nh[256+ i++]=r;for(t=0;t<=Hm;t++)a[t]=0;for(e=0;e<=143;)eh[e*2+1]=8,e++,a[8]++;for(;e<=255;)eh[e*2+1]=9,e++,a[9]++;for(;e<=279;)eh[e*2+1]=7,e++,a[7]++;for(;e<=287;)eh[e*2+1]=8,e++,a[8]++;for(vh(eh,Rm+1,a),e=0;e<zm;e++)th[e*2+1]=5,th[e*2]=hh(e,5);sh=new oh(eh,Ym,Lm+1,Rm,Hm),ch=new oh(th,Xm,0,zm,Hm),lh=new oh([],Zm,0,Bm,Wm)},bh=e=>{let t;for(t=0;t<Rm;t++)e.dyn_ltree[t*2]=0;for(t=0;t<zm;t++)e.dyn_dtree[t*2]=0;for(t=0;t<Bm;t++)e.bl_tree[t*2]=0;e.dyn_ltree[Gm*2]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},xh=e=>{e.bi_valid>8?fh(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Sh=(e,t,n,r)=>{let i=t*2,a=n*2;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]},Ch=(e,t,n)=>{let r=e.heap[n],i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&Sh(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!Sh(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},wh=(e,t,n)=>{let r,i,a=0,o,s;if(e.sym_next!==0)do r=e.pending_buf[e.sym_buf+ a++]&255,r+=(e.pending_buf[e.sym_buf+ a++]&255)<<8,i=e.pending_buf[e.sym_buf+ a++],r===0?mh(e,i,t):(o=rh[i],mh(e,o+Lm+1,t),s=Ym[o],s!==0&&(i-=ih[o],ph(e,i,s)),r--,o=dh(r),mh(e,o,n),s=Xm[o],s!==0&&(r-=ah[o],ph(e,r,s)));while(a<e.sym_next);mh(e,Gm,t)},Th=(e,t)=>{let n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,a=t.stat_desc.elems,o,s,c=-1,l;for(e.heap_len=0,e.heap_max=Vm,o=0;o<a;o++)n[o*2]===0?n[o*2+1]=0:(e.heap[++e.heap_len]=c=o,e.depth[o]=0);for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,n[l*2]=1,e.depth[l]=0,e.opt_len--,i&&(e.static_len-=r[l*2+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)Ch(e,n,o);l=a;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Ch(e,n,1),s=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=s,n[l*2]=n[o*2]+n[s*2],e.depth[l]=(e.depth[o]>=e.depth[s]?e.depth[o]:e.depth[s])+1,n[o*2+1]=n[s*2+1]=l,e.heap[1]=l++,Ch(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],_h(e,t),vh(n,c,e.bl_count)},Eh=(e,t,n)=>{let r,i=-1,a,o=t[1],s=0,c=7,l=4;for(o===0&&(c=138,l=3),t[(n+1)*2+1]=65535,r=0;r<=n;r++)a=o,o=t[(r+1)*2+1],!(++s<c&&a===o)&&(s<l?e.bl_tree[a*2]+=s:a===0?s<=10?e.bl_tree[qm*2]++:e.bl_tree[Jm*2]++:(a!==i&&e.bl_tree[a*2]++,e.bl_tree[Km*2]++),s=0,i=a,o===0?(c=138,l=3):a===o?(c=6,l=3):(c=7,l=4))},Dh=(e,t,n)=>{let r,i=-1,a,o=t[1],s=0,c=7,l=4;for(o===0&&(c=138,l=3),r=0;r<=n;r++)if(a=o,o=t[(r+1)*2+1],!(++s<c&&a===o)){if(s<l)do mh(e,a,e.bl_tree);while(--s!==0);else a===0?s<=10?(mh(e,qm,e.bl_tree),ph(e,s-3,3)):(mh(e,Jm,e.bl_tree),ph(e,s-11,7)):(a!==i&&(mh(e,a,e.bl_tree),s--),mh(e,Km,e.bl_tree),ph(e,s-3,2));s=0,i=a,o===0?(c=138,l=3):a===o?(c=6,l=3):(c=7,l=4)}},Oh=e=>{let t;for(Eh(e,e.dyn_ltree,e.l_desc.max_code),Eh(e,e.dyn_dtree,e.d_desc.max_code),Th(e,e.bl_desc),t=Bm-1;t>=3&&e.bl_tree[Qm[t]*2+1]===0;t--);return e.opt_len+=3*(t+1)+5+5+4,t},kh=(e,t,n,r)=>{let i;for(ph(e,t-257,5),ph(e,n-1,5),ph(e,r-4,4),i=0;i<r;i++)ph(e,e.bl_tree[Qm[i]*2+1],3);Dh(e,e.dyn_ltree,t-1),Dh(e,e.dyn_dtree,n-1)},Ah=e=>{let t=4093624447,n;for(n=0;n<=31;n++,t>>>=1)if(t&1&&e.dyn_ltree[n*2]!==0)return Dm;if(e.dyn_ltree[18]!==0||e.dyn_ltree[20]!==0||e.dyn_ltree[26]!==0)return Om;for(n=32;n<Lm;n++)if(e.dyn_ltree[n*2]!==0)return Om;return Dm},jh=!1,Mh=e=>{jh||=(yh(),!0),e.l_desc=new uh(e.dyn_ltree,sh),e.d_desc=new uh(e.dyn_dtree,ch),e.bl_desc=new uh(e.bl_tree,lh),e.bi_buf=0,e.bi_valid=0,bh(e)},Nh=(e,t,n,r)=>{ph(e,(jm<<1)+(r?1:0),3),xh(e),fh(e,n),fh(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n},Ph={_tr_init:Mh,_tr_stored_block:Nh,_tr_flush_block:(e,t,n,r)=>{let i,a,o=0;e.level>0?(e.strm.data_type===km&&(e.strm.data_type=Ah(e)),Th(e,e.l_desc),Th(e,e.d_desc),o=Oh(e),i=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=i&&(i=a)):i=a=n+5,n+4<=i&&t!==-1?Nh(e,t,n,r):e.strategy===Em||a===i?(ph(e,(Mm<<1)+(r?1:0),3),wh(e,eh,th)):(ph(e,(Nm<<1)+(r?1:0),3),kh(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),wh(e,e.dyn_ltree,e.dyn_dtree)),bh(e),r&&xh(e)},_tr_tally:(e,t,n)=>(e.pending_buf[e.sym_buf+ e.sym_next++]=t,e.pending_buf[e.sym_buf+ e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+ e.sym_next++]=n,t===0?e.dyn_ltree[n*2]++:(e.matches++,t--,e.dyn_ltree[(rh[n]+Lm+1)*2]++,e.dyn_dtree[dh(t)*2]++),e.sym_next===e.sym_end),_tr_align:e=>{ph(e,Mm<<1,3),mh(e,Gm,eh),gh(e)}},Fh=(e,t,n,r)=>{let i=e&65535|0,a=e>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+t[r++]|0,a=a+i|0;while(--o);i%=65521,a%=65521}return i|a<<16|0},Ih=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=e&1?3988292384^e>>>1:e>>>1;t[n]=e}return t})()),Lh=(e,t,n,r)=>{let i=Ih,a=r+n;e^=-1;for(let n=r;n<a;n++)e=e>>>8^i[(e^t[n])&255];return e^-1},Rh={2:`need dictionary`,1:`stream end`,0:``,"-1":`file error`,"-2":`stream error`,"-3":`data error`,"-4":`insufficient memory`,"-5":`buffer error`,"-6":`incompatible version`},zh={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:Bh,_tr_stored_block:Vh,_tr_flush_block:Hh,_tr_tally:Uh,_tr_align:Wh}=Ph,{Z_NO_FLUSH:Gh,Z_PARTIAL_FLUSH:Kh,Z_FULL_FLUSH:qh,Z_FINISH:Jh,Z_BLOCK:Yh,Z_OK:Xh,Z_STREAM_END:Zh,Z_STREAM_ERROR:Qh,Z_DATA_ERROR:$h,Z_BUF_ERROR:eg,Z_DEFAULT_COMPRESSION:tg,Z_FILTERED:ng,Z_HUFFMAN_ONLY:rg,Z_RLE:ig,Z_FIXED:ag,Z_DEFAULT_STRATEGY:og,Z_UNKNOWN:sg,Z_DEFLATED:cg}=zh,lg=9,ug=15,dg=8,fg=286,pg=30,mg=19,hg=2*fg+1,gg=15,_g=3,vg=258,yg=vg+_g+1,bg=32,xg=42,Sg=57,Cg=69,wg=73,Tg=91,Eg=103,Dg=113,Og=666,kg=1,Ag=2,jg=3,Mg=4,Ng=3,Pg=(e,t)=>(e.msg=Rh[t],t),Fg=e=>e*2-(e>4?9:0),Ig=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Lg=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do n=e.head[--r],e.head[r]=n>=i?n-i:0;while(--t);t=i,r=t;do n=e.prev[--r],e.prev[r]=n>=i?n-i:0;while(--t)},Rg=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask,zg=e=>{let t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},Bg=(e,t)=>{Hh(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,zg(e.strm)},Vg=(e,t)=>{e.pending_buf[e.pending++]=t},Hg=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255},Ug=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),i===0?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),e.state.wrap===1?e.adler=Fh(e.adler,t,i,n):e.state.wrap===2&&(e.adler=Lh(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},Wg=(e,t)=>{let n=e.max_chain_length,r=e.strstart,i,a,o=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-yg?e.strstart-(e.w_size-yg):0,l=e.window,u=e.w_mask,d=e.prev,f=e.strstart+vg,p=l[r+o-1],m=l[r+o];e.prev_length>=e.good_match&&(n>>=2),s>e.lookahead&&(s=e.lookahead);do{if(i=t,l[i+o]!==m||l[i+o-1]!==p||l[i]!==l[r]||l[++i]!==l[r+1])continue;r+=2,i++;do;while(l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&r<f);if(a=vg-(f-r),r=f-vg,a>o){if(e.match_start=t,o=a,a>=s)break;p=l[r+o-1],m=l[r+o]}}while((t=d[t&u])>c&&--n!==0);return o<=e.lookahead?o:e.lookahead},Gg=e=>{let t=e.w_size,n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-yg)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Lg(e),r+=t),e.strm.avail_in===0)break;if(n=Ug(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=_g)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=Rg(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=Rg(e,e.ins_h,e.window[i+_g-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<_g)););}while(e.lookahead<yg&&e.strm.avail_in!==0)},Kg=(e,t)=>{let n=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,r,i,a,o=0,s=e.strm.avail_in;do{if(r=65535,a=e.bi_valid+42>>3,e.strm.avail_out<a||(a=e.strm.avail_out-a,i=e.strstart-e.block_start,r>i+e.strm.avail_in&&(r=i+e.strm.avail_in),r>a&&(r=a),r<n&&(r===0&&t!==Jh||t===Gh||r!==i+e.strm.avail_in)))break;o=t===Jh&&r===i+e.strm.avail_in?1:0,Vh(e,0,0,o),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,zg(e.strm),i&&(i>r&&(i=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,r-=i),r&&(Ug(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(o===0);return s-=e.strm.avail_in,s&&(s>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=s&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-s,e.strm.next_in),e.strstart),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?Mg:t!==Gh&&t!==Jh&&e.strm.avail_in===0&&e.strstart===e.block_start?Ag:(a=e.window_size-e.strstart,e.strm.avail_in>a&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,a+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),a>e.strm.avail_in&&(a=e.strm.avail_in),a&&(Ug(e.strm,e.window,e.strstart,a),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.high_water<e.strstart&&(e.high_water=e.strstart),a=e.bi_valid+42>>3,a=e.pending_buf_size-a>65535?65535:e.pending_buf_size-a,n=a>e.w_size?e.w_size:a,i=e.strstart-e.block_start,(i>=n||(i||t===Jh)&&t!==Gh&&e.strm.avail_in===0&&i<=a)&&(r=i>a?a:i,o=t===Jh&&e.strm.avail_in===0&&r===i?1:0,Vh(e,e.block_start,r,o),e.block_start+=r,zg(e.strm)),o?jg:kg)},qg=(e,t)=>{let n,r;for(;;){if(e.lookahead<yg){if(Gg(e),e.lookahead<yg&&t===Gh)return kg;if(e.lookahead===0)break}if(n=0,e.lookahead>=_g&&(e.ins_h=Rg(e,e.ins_h,e.window[e.strstart+_g-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-yg&&(e.match_length=Wg(e,n)),e.match_length>=_g)if(r=Uh(e,e.strstart-e.match_start,e.match_length-_g),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=_g){e.match_length--;do e.strstart++,e.ins_h=Rg(e,e.ins_h,e.window[e.strstart+_g-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Rg(e,e.ins_h,e.window[e.strstart+1]);else r=Uh(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(Bg(e,!1),e.strm.avail_out===0))return kg}return e.insert=e.strstart<_g-1?e.strstart:_g-1,t===Jh?(Bg(e,!0),e.strm.avail_out===0?jg:Mg):e.sym_next&&(Bg(e,!1),e.strm.avail_out===0)?kg:Ag},Jg=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<yg){if(Gg(e),e.lookahead<yg&&t===Gh)return kg;if(e.lookahead===0)break}if(n=0,e.lookahead>=_g&&(e.ins_h=Rg(e,e.ins_h,e.window[e.strstart+_g-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=_g-1,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-yg&&(e.match_length=Wg(e,n),e.match_length<=5&&(e.strategy===ng||e.match_length===_g&&e.strstart-e.match_start>4096)&&(e.match_length=_g-1)),e.prev_length>=_g&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-_g,r=Uh(e,e.strstart-1-e.prev_match,e.prev_length-_g),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=Rg(e,e.ins_h,e.window[e.strstart+_g-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=_g-1,e.strstart++,r&&(Bg(e,!1),e.strm.avail_out===0))return kg}else if(e.match_available){if(r=Uh(e,0,e.window[e.strstart-1]),r&&Bg(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return kg}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&=(r=Uh(e,0,e.window[e.strstart-1]),0),e.insert=e.strstart<_g-1?e.strstart:_g-1,t===Jh?(Bg(e,!0),e.strm.avail_out===0?jg:Mg):e.sym_next&&(Bg(e,!1),e.strm.avail_out===0)?kg:Ag},Yg=(e,t)=>{let n,r,i,a,o=e.window;for(;;){if(e.lookahead<=vg){if(Gg(e),e.lookahead<=vg&&t===Gh)return kg;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=_g&&e.strstart>0&&(i=e.strstart-1,r=o[i],r===o[++i]&&r===o[++i]&&r===o[++i])){a=e.strstart+vg;do;while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<a);e.match_length=vg-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=_g?(n=Uh(e,1,e.match_length-_g),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=Uh(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Bg(e,!1),e.strm.avail_out===0))return kg}return e.insert=0,t===Jh?(Bg(e,!0),e.strm.avail_out===0?jg:Mg):e.sym_next&&(Bg(e,!1),e.strm.avail_out===0)?kg:Ag},Xg=(e,t)=>{let n;for(;;){if(e.lookahead===0&&(Gg(e),e.lookahead===0)){if(t===Gh)return kg;break}if(e.match_length=0,n=Uh(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Bg(e,!1),e.strm.avail_out===0))return kg}return e.insert=0,t===Jh?(Bg(e,!0),e.strm.avail_out===0?jg:Mg):e.sym_next&&(Bg(e,!1),e.strm.avail_out===0)?kg:Ag};function Zg(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}var Qg=[new Zg(0,0,0,0,Kg),new Zg(4,4,8,4,qg),new Zg(4,5,16,8,qg),new Zg(4,6,32,32,qg),new Zg(4,4,16,16,Jg),new Zg(8,16,32,32,Jg),new Zg(8,16,128,128,Jg),new Zg(8,32,128,256,Jg),new Zg(32,128,258,1024,Jg),new Zg(32,258,258,4096,Jg)],$g=e=>{e.window_size=2*e.w_size,Ig(e.head),e.max_lazy_match=Qg[e.level].max_lazy,e.good_match=Qg[e.level].good_length,e.nice_match=Qg[e.level].nice_length,e.max_chain_length=Qg[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=_g-1,e.match_available=0,e.ins_h=0};function e_(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=cg,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(hg*2),this.dyn_dtree=new Uint16Array((2*pg+1)*2),this.bl_tree=new Uint16Array((2*mg+1)*2),Ig(this.dyn_ltree),Ig(this.dyn_dtree),Ig(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(gg+1),this.heap=new Uint16Array(2*fg+1),Ig(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*fg+1),Ig(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var t_=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==xg&&t.status!==Sg&&t.status!==Cg&&t.status!==wg&&t.status!==Tg&&t.status!==Eg&&t.status!==Dg&&t.status!==Og?1:0},n_=e=>{if(t_(e))return Pg(e,Qh);e.total_in=e.total_out=0,e.data_type=sg;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?Sg:t.wrap?xg:Dg,e.adler=t.wrap===2?0:1,t.last_flush=-2,Bh(t),Xh},r_=e=>{let t=n_(e);return t===Xh&&$g(e.state),t},i_=(e,t)=>t_(e)||e.state.wrap!==2?Qh:(e.state.gzhead=t,Xh),a_=(e,t,n,r,i,a)=>{if(!e)return Qh;let o=1;if(t===tg&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>lg||n!==cg||r<8||r>15||t<0||t>9||a<0||a>ag||r===8&&o!==1)return Pg(e,Qh);r===8&&(r=9);let s=new e_;return e.state=s,s.strm=e,s.status=xg,s.wrap=o,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+_g-1)/_g),s.window=new Uint8Array(s.w_size*2),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=s.lit_bufsize*4,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=(s.lit_bufsize-1)*3,s.level=t,s.strategy=a,s.method=n,r_(e)},o_={deflateInit:(e,t)=>a_(e,t,cg,ug,dg,og),deflateInit2:a_,deflateReset:r_,deflateResetKeep:n_,deflateSetHeader:i_,deflate:(e,t)=>{if(t_(e)||t>Yh||t<0)return e?Pg(e,Qh):Qh;let n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===Og&&t!==Jh)return Pg(e,e.avail_out===0?eg:Qh);let r=n.last_flush;if(n.last_flush=t,n.pending!==0){if(zg(e),e.avail_out===0)return n.last_flush=-1,Xh}else if(e.avail_in===0&&Fg(t)<=Fg(r)&&t!==Jh)return Pg(e,eg);if(n.status===Og&&e.avail_in!==0)return Pg(e,eg);if(n.status===xg&&n.wrap===0&&(n.status=Dg),n.status===xg){let t=cg+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=rg||n.level<2?0:n.level<6?1:n.level===6?2:3,t|=r<<6,n.strstart!==0&&(t|=bg),t+=31-t%31,Hg(n,t),n.strstart!==0&&(Hg(n,e.adler>>>16),Hg(n,e.adler&65535)),e.adler=1,n.status=Dg,zg(e),n.pending!==0)return n.last_flush=-1,Xh}if(n.status===Sg){if(e.adler=0,Vg(n,31),Vg(n,139),Vg(n,8),n.gzhead)Vg(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Vg(n,n.gzhead.time&255),Vg(n,n.gzhead.time>>8&255),Vg(n,n.gzhead.time>>16&255),Vg(n,n.gzhead.time>>24&255),Vg(n,n.level===9?2:n.strategy>=rg||n.level<2?4:0),Vg(n,n.gzhead.os&255),n.gzhead.extra&&n.gzhead.extra.length&&(Vg(n,n.gzhead.extra.length&255),Vg(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Lh(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=Cg;else if(Vg(n,0),Vg(n,0),Vg(n,0),Vg(n,0),Vg(n,0),Vg(n,n.level===9?2:n.strategy>=rg||n.level<2?4:0),Vg(n,Ng),n.status=Dg,zg(e),n.pending!==0)return n.last_flush=-1,Xh}if(n.status===Cg){if(n.gzhead.extra){let t=n.pending,r=(n.gzhead.extra.length&65535)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=Lh(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=i,zg(e),n.pending!==0)return n.last_flush=-1,Xh;t=0,r-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=Lh(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=wg}if(n.status===wg){if(n.gzhead.name){let t=n.pending,r;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>t&&(e.adler=Lh(e.adler,n.pending_buf,n.pending-t,t)),zg(e),n.pending!==0)return n.last_flush=-1,Xh;t=0}r=n.gzindex<n.gzhead.name.length?n.gzhead.name.charCodeAt(n.gzindex++)&255:0,Vg(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>t&&(e.adler=Lh(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=Tg}if(n.status===Tg){if(n.gzhead.comment){let t=n.pending,r;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>t&&(e.adler=Lh(e.adler,n.pending_buf,n.pending-t,t)),zg(e),n.pending!==0)return n.last_flush=-1,Xh;t=0}r=n.gzindex<n.gzhead.comment.length?n.gzhead.comment.charCodeAt(n.gzindex++)&255:0,Vg(n,r)}while(r!==0);n.gzhead.hcrc&&n.pending>t&&(e.adler=Lh(e.adler,n.pending_buf,n.pending-t,t))}n.status=Eg}if(n.status===Eg){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(zg(e),n.pending!==0))return n.last_flush=-1,Xh;Vg(n,e.adler&255),Vg(n,e.adler>>8&255),e.adler=0}if(n.status=Dg,zg(e),n.pending!==0)return n.last_flush=-1,Xh}if(e.avail_in!==0||n.lookahead!==0||t!==Gh&&n.status!==Og){let r=n.level===0?Kg(n,t):n.strategy===rg?Xg(n,t):n.strategy===ig?Yg(n,t):Qg[n.level].func(n,t);if((r===jg||r===Mg)&&(n.status=Og),r===kg||r===jg)return e.avail_out===0&&(n.last_flush=-1),Xh;if(r===Ag&&(t===Kh?Wh(n):t!==Yh&&(Vh(n,0,0,!1),t===qh&&(Ig(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),zg(e),e.avail_out===0))return n.last_flush=-1,Xh}return t===Jh?n.wrap<=0?Zh:(n.wrap===2?(Vg(n,e.adler&255),Vg(n,e.adler>>8&255),Vg(n,e.adler>>16&255),Vg(n,e.adler>>24&255),Vg(n,e.total_in&255),Vg(n,e.total_in>>8&255),Vg(n,e.total_in>>16&255),Vg(n,e.total_in>>24&255)):(Hg(n,e.adler>>>16),Hg(n,e.adler&65535)),zg(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending===0?Zh:Xh):Xh},deflateEnd:e=>{if(t_(e))return Qh;let t=e.state.status;return e.state=null,t===Dg?Pg(e,$h):Xh},deflateSetDictionary:(e,t)=>{let n=t.length;if(t_(e))return Qh;let r=e.state,i=r.wrap;if(i===2||i===1&&r.status!==xg||r.lookahead)return Qh;if(i===1&&(e.adler=Fh(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){i===0&&(Ig(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}let a=e.avail_in,o=e.next_in,s=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Gg(r);r.lookahead>=_g;){let e=r.strstart,t=r.lookahead-(_g-1);do r.ins_h=Rg(r,r.ins_h,r.window[e+_g-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++;while(--t);r.strstart=e,r.lookahead=_g-1,Gg(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=_g-1,r.match_available=0,e.next_in=o,e.input=s,e.avail_in=a,r.wrap=i,Xh},deflateInfo:`pako deflate (from Nodeca project)`},s_=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c_={assign:function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let n=t.shift();if(n){if(typeof n!=`object`)throw TypeError(n+`must be non-object`);for(let t in n)s_(n,t)&&(e[t]=n[t])}}return e},flattenChunks:e=>{let t=0;for(let n=0,r=e.length;n<r;n++)t+=e[n].length;let n=new Uint8Array(t);for(let t=0,r=0,i=e.length;t<i;t++){let i=e[t];n.set(i,r),r+=i.length}return n}},l_=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{l_=!1}var u_=new Uint8Array(256);for(let e=0;e<256;e++)u_[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;u_[254]=u_[254]=1;var d_=e=>{if(typeof TextEncoder==`function`&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,r,i,a,o=e.length,s=0;for(i=0;i<o;i++)n=e.charCodeAt(i),(n&64512)==55296&&i+1<o&&(r=e.charCodeAt(i+1),(r&64512)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),a=0,i=0;a<s;i++)n=e.charCodeAt(i),(n&64512)==55296&&i+1<o&&(r=e.charCodeAt(i+1),(r&64512)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|n&63):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|n&63):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|n&63);return t},f_=(e,t)=>{if(t<65534&&e.subarray&&l_)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n=``;for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n},p_={string2buf:d_,buf2string:(e,t)=>{let n=t||e.length;if(typeof TextDecoder==`function`&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,i,a=Array(n*2);for(i=0,r=0;r<n;){let t=e[r++];if(t<128){a[i++]=t;continue}let o=u_[t];if(o>4){a[i++]=65533,r+=o-1;continue}for(t&=o===2?31:o===3?15:7;o>1&&r<n;)t=t<<6|e[r++]&63,o--;if(o>1){a[i++]=65533;continue}t<65536?a[i++]=t:(t-=65536,a[i++]=55296|t>>10&1023,a[i++]=56320|t&1023)}return f_(a,i)},utf8border:(e,t)=>{t||=e.length,t>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(e[n]&192)==128;)n--;return n<0||n===0?t:n+u_[e[n]]>t?n:t}};function m_(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg=``,this.state=null,this.data_type=2,this.adler=0}var h_=m_,g_=Object.prototype.toString,{Z_NO_FLUSH:__,Z_SYNC_FLUSH:v_,Z_FULL_FLUSH:y_,Z_FINISH:b_,Z_OK:x_,Z_STREAM_END:S_,Z_DEFAULT_COMPRESSION:C_,Z_DEFAULT_STRATEGY:w_,Z_DEFLATED:T_}=zh;function E_(e){this.options=c_.assign({level:C_,method:T_,chunkSize:16384,windowBits:15,memLevel:8,strategy:w_},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg=``,this.ended=!1,this.chunks=[],this.strm=new h_,this.strm.avail_out=0;let n=o_.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==x_)throw Error(Rh[n]);if(t.header&&o_.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e=typeof t.dictionary==`string`?p_.string2buf(t.dictionary):g_.call(t.dictionary)===`[object ArrayBuffer]`?new Uint8Array(t.dictionary):t.dictionary,n=o_.deflateSetDictionary(this.strm,e),n!==x_)throw Error(Rh[n]);this._dict_set=!0}}E_.prototype.push=function(e,t){let n=this.strm,r=this.options.chunkSize,i,a;if(this.ended)return!1;for(a=t===~~t?t:t===!0?b_:__,typeof e==`string`?n.input=p_.string2buf(e):g_.call(e)===`[object ArrayBuffer]`?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(a===v_||a===y_)&&n.avail_out<=6){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(i=o_.deflate(n,a),i===S_)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=o_.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===x_;if(n.avail_out===0){this.onData(n.output);continue}if(a>0&&n.next_out>0){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(n.avail_in===0)break}return!0},E_.prototype.onData=function(e){this.chunks.push(e)},E_.prototype.onEnd=function(e){e===x_&&(this.result=c_.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function D_(e,t){let n=new E_(t);if(n.push(e,!0),n.err)throw n.msg||Rh[n.err];return n.result}function O_(e,t){return t||={},t.raw=!0,D_(e,t)}function k_(e,t){return t||={},t.gzip=!0,D_(e,t)}var A_={Deflate:E_,deflate:D_,deflateRaw:O_,gzip:k_,constants:zh},j_=16209,M_=16191,N_=function(e,t){let n,r,i,a,o,s,c,l,u,d,f,p,m,h,g,_,v,y,b,x,S,C,w,T,E=e.state;n=e.next_in,w=e.input,r=n+(e.avail_in-5),i=e.next_out,T=e.output,a=i-(t-e.avail_out),o=i+(e.avail_out-257),s=E.dmax,c=E.wsize,l=E.whave,u=E.wnext,d=E.window,f=E.hold,p=E.bits,m=E.lencode,h=E.distcode,g=(1<<E.lenbits)-1,_=(1<<E.distbits)-1;top:do{p<15&&(f+=w[n++]<<p,p+=8,f+=w[n++]<<p,p+=8),v=m[f&g];dolen:for(;;){if(y=v>>>24,f>>>=y,p-=y,y=v>>>16&255,y===0)T[i++]=v&65535;else if(y&16){b=v&65535,y&=15,y&&(p<y&&(f+=w[n++]<<p,p+=8),b+=f&(1<<y)-1,f>>>=y,p-=y),p<15&&(f+=w[n++]<<p,p+=8,f+=w[n++]<<p,p+=8),v=h[f&_];dodist:for(;;){if(y=v>>>24,f>>>=y,p-=y,y=v>>>16&255,y&16){if(x=v&65535,y&=15,p<y&&(f+=w[n++]<<p,p+=8,p<y&&(f+=w[n++]<<p,p+=8)),x+=f&(1<<y)-1,x>s){e.msg=`invalid distance too far back`,E.mode=j_;break top}if(f>>>=y,p-=y,y=i-a,x>y){if(y=x-y,y>l&&E.sane){e.msg=`invalid distance too far back`,E.mode=j_;break top}if(S=0,C=d,u===0){if(S+=c-y,y<b){b-=y;do T[i++]=d[S++];while(--y);S=i-x,C=T}}else if(u<y){if(S+=c+u-y,y-=u,y<b){b-=y;do T[i++]=d[S++];while(--y);if(S=0,u<b){y=u,b-=y;do T[i++]=d[S++];while(--y);S=i-x,C=T}}}else if(S+=u-y,y<b){b-=y;do T[i++]=d[S++];while(--y);S=i-x,C=T}for(;b>2;)T[i++]=C[S++],T[i++]=C[S++],T[i++]=C[S++],b-=3;b&&(T[i++]=C[S++],b>1&&(T[i++]=C[S++]))}else{S=i-x;do T[i++]=T[S++],T[i++]=T[S++],T[i++]=T[S++],b-=3;while(b>2);b&&(T[i++]=T[S++],b>1&&(T[i++]=T[S++]))}}else if(y&64){e.msg=`invalid distance code`,E.mode=j_;break top}else{v=h[(v&65535)+(f&(1<<y)-1)];continue dodist}break}}else if(y&64)if(y&32){E.mode=M_;break top}else{e.msg=`invalid literal/length code`,E.mode=j_;break top}else{v=m[(v&65535)+(f&(1<<y)-1)];continue dolen}break}}while(n<r&&i<o);b=p>>3,n-=b,p-=b<<3,f&=(1<<p)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?5+(r-n):5-(n-r),e.avail_out=i<o?257+(o-i):257-(i-o),E.hold=f,E.bits=p},P_=15,F_=852,I_=592,L_=0,R_=1,z_=2,B_=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),V_=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),H_=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),U_=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),W_=(e,t,n,r,i,a,o,s)=>{let c=s.bits,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y,b,x,S,C,w=null,T,E=new Uint16Array(P_+1),D=new Uint16Array(P_+1),O=null,ee,k,te;for(l=0;l<=P_;l++)E[l]=0;for(u=0;u<r;u++)E[t[n+u]]++;for(p=c,f=P_;f>=1&&E[f]===0;f--);if(p>f&&(p=f),f===0)return i[a++]=20971520,i[a++]=20971520,s.bits=1,0;for(d=1;d<f&&E[d]===0;d++);for(p<d&&(p=d),g=1,l=1;l<=P_;l++)if(g<<=1,g-=E[l],g<0)return-1;if(g>0&&(e===L_||f!==1))return-1;for(D[1]=0,l=1;l<P_;l++)D[l+1]=D[l]+E[l];for(u=0;u<r;u++)t[n+u]!==0&&(o[D[t[n+u]]++]=u);if(e===L_?(w=O=o,T=20):e===R_?(w=B_,O=V_,T=257):(w=H_,O=U_,T=0),v=0,u=0,l=d,C=a,m=p,h=0,x=-1,_=1<<p,S=_-1,e===R_&&_>F_||e===z_&&_>I_)return 1;for(;;){ee=l-h,o[u]+1<T?(k=0,te=o[u]):o[u]>=T?(k=O[o[u]-T],te=w[o[u]-T]):(k=96,te=0),y=1<<l-h,b=1<<m,d=b;do b-=y,i[C+(v>>h)+b]=ee<<24|k<<16|te|0;while(b!==0);for(y=1<<l-1;v&y;)y>>=1;if(y===0?v=0:(v&=y-1,v+=y),u++,--E[l]===0){if(l===f)break;l=t[n+o[u]]}if(l>p&&(v&S)!==x){for(h===0&&(h=p),C+=d,m=l-h,g=1<<m;m+h<f&&(g-=E[m+h],!(g<=0));)m++,g<<=1;if(_+=1<<m,e===R_&&_>F_||e===z_&&_>I_)return 1;x=v&S,i[x]=p<<24|m<<16|C-a|0}}return v!==0&&(i[C+v]=l-h<<24|4194304),s.bits=p,0},G_=0,K_=1,q_=2,{Z_FINISH:J_,Z_BLOCK:Y_,Z_TREES:X_,Z_OK:Z_,Z_STREAM_END:Q_,Z_NEED_DICT:$_,Z_STREAM_ERROR:ev,Z_DATA_ERROR:tv,Z_MEM_ERROR:nv,Z_BUF_ERROR:rv,Z_DEFLATED:iv}=zh,av=16180,ov=16181,sv=16182,cv=16183,lv=16184,uv=16185,dv=16186,fv=16187,pv=16188,mv=16189,hv=16190,gv=16191,_v=16192,vv=16193,yv=16194,bv=16195,xv=16196,Sv=16197,Cv=16198,wv=16199,Tv=16200,Ev=16201,Dv=16202,Ov=16203,kv=16204,Av=16205,jv=16206,Mv=16207,Nv=16208,Pv=16209,Fv=16210,Iv=16211,Lv=852,Rv=592,zv=15,Bv=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);function Vv(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Hv=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<av||t.mode>Iv?1:0},Uv=e=>{if(Hv(e))return ev;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg=``,t.wrap&&(e.adler=t.wrap&1),t.mode=av,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(Lv),t.distcode=t.distdyn=new Int32Array(Rv),t.sane=1,t.back=-1,Z_},Wv=e=>{if(Hv(e))return ev;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Uv(e)},Gv=(e,t)=>{let n;if(Hv(e))return ev;let r=e.state;return t<0?(n=0,t=-t):(n=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?ev:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,Wv(e))},Kv=(e,t)=>{if(!e)return ev;let n=new Vv;e.state=n,n.strm=e,n.window=null,n.mode=av;let r=Gv(e,t);return r!==Z_&&(e.state=null),r},qv=e=>Kv(e,zv),Jv=!0,Yv,Xv,Zv=e=>{if(Jv){Yv=new Int32Array(512),Xv=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(W_(K_,e.lens,0,288,Yv,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;W_(q_,e.lens,0,32,Xv,0,e.work,{bits:5}),Jv=!1}e.lencode=Yv,e.lenbits=9,e.distcode=Xv,e.distbits=5},Qv=(e,t,n,r)=>{let i,a=e.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>r&&(i=r),a.window.set(t.subarray(n-r,n-r+i),a.wnext),r-=i,r?(a.window.set(t.subarray(n-r,n),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0},$v={inflateReset:Wv,inflateReset2:Gv,inflateResetKeep:Uv,inflateInit:qv,inflateInit2:Kv,inflate:(e,t)=>{let n,r,i,a,o,s,c,l,u,d,f,p,m,h,g=0,_,v,y,b,x,S,C,w,T=new Uint8Array(4),E,D,O=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Hv(e)||!e.output||!e.input&&e.avail_in!==0)return ev;n=e.state,n.mode===gv&&(n.mode=_v),o=e.next_out,i=e.output,c=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,l=n.hold,u=n.bits,d=s,f=c,w=Z_;inf_leave:for(;;)switch(n.mode){case av:if(n.wrap===0){n.mode=_v;break}for(;u<16;){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}if(n.wrap&2&&l===35615){n.wbits===0&&(n.wbits=15),n.check=0,T[0]=l&255,T[1]=l>>>8&255,n.check=Lh(n.check,T,2,0),l=0,u=0,n.mode=ov;break}if(n.head&&(n.head.done=!1),!(n.wrap&1)||(((l&255)<<8)+(l>>8))%31){e.msg=`incorrect header check`,n.mode=Pv;break}if((l&15)!==iv){e.msg=`unknown compression method`,n.mode=Pv;break}if(l>>>=4,u-=4,C=(l&15)+8,n.wbits===0&&(n.wbits=C),C>15||C>n.wbits){e.msg=`invalid window size`,n.mode=Pv;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=l&512?mv:gv,l=0,u=0;break;case ov:for(;u<16;){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}if(n.flags=l,(n.flags&255)!==iv){e.msg=`unknown compression method`,n.mode=Pv;break}if(n.flags&57344){e.msg=`unknown header flags set`,n.mode=Pv;break}n.head&&(n.head.text=l>>8&1),n.flags&512&&n.wrap&4&&(T[0]=l&255,T[1]=l>>>8&255,n.check=Lh(n.check,T,2,0)),l=0,u=0,n.mode=sv;case sv:for(;u<32;){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}n.head&&(n.head.time=l),n.flags&512&&n.wrap&4&&(T[0]=l&255,T[1]=l>>>8&255,T[2]=l>>>16&255,T[3]=l>>>24&255,n.check=Lh(n.check,T,4,0)),l=0,u=0,n.mode=cv;case cv:for(;u<16;){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}n.head&&(n.head.xflags=l&255,n.head.os=l>>8),n.flags&512&&n.wrap&4&&(T[0]=l&255,T[1]=l>>>8&255,n.check=Lh(n.check,T,2,0)),l=0,u=0,n.mode=lv;case lv:if(n.flags&1024){for(;u<16;){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}n.length=l,n.head&&(n.head.extra_len=l),n.flags&512&&n.wrap&4&&(T[0]=l&255,T[1]=l>>>8&255,n.check=Lh(n.check,T,2,0)),l=0,u=0}else n.head&&(n.head.extra=null);n.mode=uv;case uv:if(n.flags&1024&&(p=n.length,p>s&&(p=s),p&&(n.head&&(C=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(a,a+p),C)),n.flags&512&&n.wrap&4&&(n.check=Lh(n.check,r,p,a)),s-=p,a+=p,n.length-=p),n.length))break inf_leave;n.length=0,n.mode=dv;case dv:if(n.flags&2048){if(s===0)break inf_leave;p=0;do C=r[a+ p++],n.head&&C&&n.length<65536&&(n.head.name+=String.fromCharCode(C));while(C&&p<s);if(n.flags&512&&n.wrap&4&&(n.check=Lh(n.check,r,p,a)),s-=p,a+=p,C)break inf_leave}else n.head&&(n.head.name=null);n.length=0,n.mode=fv;case fv:if(n.flags&4096){if(s===0)break inf_leave;p=0;do C=r[a+ p++],n.head&&C&&n.length<65536&&(n.head.comment+=String.fromCharCode(C));while(C&&p<s);if(n.flags&512&&n.wrap&4&&(n.check=Lh(n.check,r,p,a)),s-=p,a+=p,C)break inf_leave}else n.head&&(n.head.comment=null);n.mode=pv;case pv:if(n.flags&512){for(;u<16;){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}if(n.wrap&4&&l!==(n.check&65535)){e.msg=`header crc mismatch`,n.mode=Pv;break}l=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=gv;break;case mv:for(;u<32;){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}e.adler=n.check=Bv(l),l=0,u=0,n.mode=hv;case hv:if(n.havedict===0)return e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,n.hold=l,n.bits=u,$_;e.adler=n.check=1,n.mode=gv;case gv:if(t===Y_||t===X_)break inf_leave;case _v:if(n.last){l>>>=u&7,u-=u&7,n.mode=jv;break}for(;u<3;){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}switch(n.last=l&1,l>>>=1,--u,l&3){case 0:n.mode=vv;break;case 1:if(Zv(n),n.mode=wv,t===X_){l>>>=2,u-=2;break inf_leave}break;case 2:n.mode=xv;break;case 3:e.msg=`invalid block type`,n.mode=Pv}l>>>=2,u-=2;break;case vv:for(l>>>=u&7,u-=u&7;u<32;){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}if((l&65535)!=(l>>>16^65535)){e.msg=`invalid stored block lengths`,n.mode=Pv;break}if(n.length=l&65535,l=0,u=0,n.mode=yv,t===X_)break inf_leave;case yv:n.mode=bv;case bv:if(p=n.length,p){if(p>s&&(p=s),p>c&&(p=c),p===0)break inf_leave;i.set(r.subarray(a,a+p),o),s-=p,a+=p,c-=p,o+=p,n.length-=p;break}n.mode=gv;break;case xv:for(;u<14;){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}if(n.nlen=(l&31)+257,l>>>=5,u-=5,n.ndist=(l&31)+1,l>>>=5,u-=5,n.ncode=(l&15)+4,l>>>=4,u-=4,n.nlen>286||n.ndist>30){e.msg=`too many length or distance symbols`,n.mode=Pv;break}n.have=0,n.mode=Sv;case Sv:for(;n.have<n.ncode;){for(;u<3;){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}n.lens[O[n.have++]]=l&7,l>>>=3,u-=3}for(;n.have<19;)n.lens[O[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,E={bits:n.lenbits},w=W_(G_,n.lens,0,19,n.lencode,0,n.work,E),n.lenbits=E.bits,w){e.msg=`invalid code lengths set`,n.mode=Pv;break}n.have=0,n.mode=Cv;case Cv:for(;n.have<n.nlen+n.ndist;){for(;g=n.lencode[l&(1<<n.lenbits)-1],_=g>>>24,v=g>>>16&255,y=g&65535,!(_<=u);){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}if(y<16)l>>>=_,u-=_,n.lens[n.have++]=y;else{if(y===16){for(D=_+2;u<D;){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}if(l>>>=_,u-=_,n.have===0){e.msg=`invalid bit length repeat`,n.mode=Pv;break}C=n.lens[n.have-1],p=3+(l&3),l>>>=2,u-=2}else if(y===17){for(D=_+3;u<D;){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}l>>>=_,u-=_,C=0,p=3+(l&7),l>>>=3,u-=3}else{for(D=_+7;u<D;){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}l>>>=_,u-=_,C=0,p=11+(l&127),l>>>=7,u-=7}if(n.have+p>n.nlen+n.ndist){e.msg=`invalid bit length repeat`,n.mode=Pv;break}for(;p--;)n.lens[n.have++]=C}}if(n.mode===Pv)break;if(n.lens[256]===0){e.msg=`invalid code -- missing end-of-block`,n.mode=Pv;break}if(n.lenbits=9,E={bits:n.lenbits},w=W_(K_,n.lens,0,n.nlen,n.lencode,0,n.work,E),n.lenbits=E.bits,w){e.msg=`invalid literal/lengths set`,n.mode=Pv;break}if(n.distbits=6,n.distcode=n.distdyn,E={bits:n.distbits},w=W_(q_,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,E),n.distbits=E.bits,w){e.msg=`invalid distances set`,n.mode=Pv;break}if(n.mode=wv,t===X_)break inf_leave;case wv:n.mode=Tv;case Tv:if(s>=6&&c>=258){e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,n.hold=l,n.bits=u,N_(e,f),o=e.next_out,i=e.output,c=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,l=n.hold,u=n.bits,n.mode===gv&&(n.back=-1);break}for(n.back=0;g=n.lencode[l&(1<<n.lenbits)-1],_=g>>>24,v=g>>>16&255,y=g&65535,!(_<=u);){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}if(v&&!(v&240)){for(b=_,x=v,S=y;g=n.lencode[S+((l&(1<<b+x)-1)>>b)],_=g>>>24,v=g>>>16&255,y=g&65535,!(b+_<=u);){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}l>>>=b,u-=b,n.back+=b}if(l>>>=_,u-=_,n.back+=_,n.length=y,v===0){n.mode=Av;break}if(v&32){n.back=-1,n.mode=gv;break}if(v&64){e.msg=`invalid literal/length code`,n.mode=Pv;break}n.extra=v&15,n.mode=Ev;case Ev:if(n.extra){for(D=n.extra;u<D;){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=Dv;case Dv:for(;g=n.distcode[l&(1<<n.distbits)-1],_=g>>>24,v=g>>>16&255,y=g&65535,!(_<=u);){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}if(!(v&240)){for(b=_,x=v,S=y;g=n.distcode[S+((l&(1<<b+x)-1)>>b)],_=g>>>24,v=g>>>16&255,y=g&65535,!(b+_<=u);){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}l>>>=b,u-=b,n.back+=b}if(l>>>=_,u-=_,n.back+=_,v&64){e.msg=`invalid distance code`,n.mode=Pv;break}n.offset=y,n.extra=v&15,n.mode=Ov;case Ov:if(n.extra){for(D=n.extra;u<D;){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg=`invalid distance too far back`,n.mode=Pv;break}n.mode=kv;case kv:if(c===0)break inf_leave;if(p=f-c,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){e.msg=`invalid distance too far back`,n.mode=Pv;break}p>n.wnext?(p-=n.wnext,m=n.wsize-p):m=n.wnext-p,p>n.length&&(p=n.length),h=n.window}else h=i,m=o-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do i[o++]=h[m++];while(--p);n.length===0&&(n.mode=Tv);break;case Av:if(c===0)break inf_leave;i[o++]=n.length,c--,n.mode=Tv;break;case jv:if(n.wrap){for(;u<32;){if(s===0)break inf_leave;s--,l|=r[a++]<<u,u+=8}if(f-=c,e.total_out+=f,n.total+=f,n.wrap&4&&f&&(e.adler=n.check=n.flags?Lh(n.check,i,f,o-f):Fh(n.check,i,f,o-f)),f=c,n.wrap&4&&(n.flags?l:Bv(l))!==n.check){e.msg=`incorrect data check`,n.mode=Pv;break}l=0,u=0}n.mode=Mv;case Mv:if(n.wrap&&n.flags){for(;u<32;){if(s===0)break inf_leave;s--,l+=r[a++]<<u,u+=8}if(n.wrap&4&&l!==(n.total&4294967295)){e.msg=`incorrect length check`,n.mode=Pv;break}l=0,u=0}n.mode=Nv;case Nv:w=Q_;break inf_leave;case Pv:w=tv;break inf_leave;case Fv:return nv;case Iv:default:return ev}return e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,n.hold=l,n.bits=u,(n.wsize||f!==e.avail_out&&n.mode<Pv&&(n.mode<jv||t!==J_))&&Qv(e,e.output,e.next_out,f-e.avail_out),d-=e.avail_in,f-=e.avail_out,e.total_in+=d,e.total_out+=f,n.total+=f,n.wrap&4&&f&&(e.adler=n.check=n.flags?Lh(n.check,i,f,e.next_out-f):Fh(n.check,i,f,e.next_out-f)),e.data_type=n.bits+(n.last?64:0)+(n.mode===gv?128:0)+(n.mode===wv||n.mode===yv?256:0),(d===0&&f===0||t===J_)&&w===Z_&&(w=rv),w},inflateEnd:e=>{if(Hv(e))return ev;let t=e.state;return t.window&&=null,e.state=null,Z_},inflateGetHeader:(e,t)=>{if(Hv(e))return ev;let n=e.state;return n.wrap&2?(n.head=t,t.done=!1,Z_):ev},inflateSetDictionary:(e,t)=>{let n=t.length,r,i,a;return Hv(e)||(r=e.state,r.wrap!==0&&r.mode!==hv)?ev:r.mode===hv&&(i=1,i=Fh(i,t,n,0),i!==r.check)?tv:(a=Qv(e,t,n,n),a?(r.mode=Fv,nv):(r.havedict=1,Z_))},inflateInfo:`pako inflate (from Nodeca project)`};function ey(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name=``,this.comment=``,this.hcrc=0,this.done=!1}var ty=ey,ny=Object.prototype.toString,{Z_NO_FLUSH:ry,Z_FINISH:iy,Z_OK:ay,Z_STREAM_END:oy,Z_NEED_DICT:sy,Z_STREAM_ERROR:cy,Z_DATA_ERROR:ly,Z_MEM_ERROR:uy}=zh;function dy(e){this.options=c_.assign({chunkSize:1024*64,windowBits:15,to:``},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(e&&e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15||(t.windowBits|=15)),this.err=0,this.msg=``,this.ended=!1,this.chunks=[],this.strm=new h_,this.strm.avail_out=0;let n=$v.inflateInit2(this.strm,t.windowBits);if(n!==ay||(this.header=new ty,$v.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary==`string`?t.dictionary=p_.string2buf(t.dictionary):ny.call(t.dictionary)===`[object ArrayBuffer]`&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=$v.inflateSetDictionary(this.strm,t.dictionary),n!==ay))))throw Error(Rh[n])}dy.prototype.push=function(e,t){let n=this.strm,r=this.options.chunkSize,i=this.options.dictionary,a,o,s;if(this.ended)return!1;for(o=t===~~t?t:t===!0?iy:ry,ny.call(e)===`[object ArrayBuffer]`?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),a=$v.inflate(n,o),a===sy&&i&&(a=$v.inflateSetDictionary(n,i),a===ay?a=$v.inflate(n,o):a===ly&&(a=sy));n.avail_in>0&&a===oy&&n.state.wrap>0&&e[n.next_in]!==0;)$v.inflateReset(n),a=$v.inflate(n,o);switch(a){case cy:case ly:case sy:case uy:return this.onEnd(a),this.ended=!0,!1}if(s=n.avail_out,n.next_out&&(n.avail_out===0||a===oy))if(this.options.to===`string`){let e=p_.utf8border(n.output,n.next_out),t=n.next_out-e,i=p_.buf2string(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(!(a===ay&&s===0)){if(a===oy)return a=$v.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},dy.prototype.onData=function(e){this.chunks.push(e)},dy.prototype.onEnd=function(e){e===ay&&(this.options.to===`string`?this.result=this.chunks.join(``):this.result=c_.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};function fy(e,t){let n=new dy(t);if(n.push(e),n.err)throw n.msg||Rh[n.err];return n.result}function py(e,t){return t||={},t.raw=!0,fy(e,t)}var my={Inflate:dy,inflate:fy,inflateRaw:py,ungzip:fy,constants:zh},{Deflate:hy,deflate:gy,deflateRaw:_y,gzip:vy}=A_,{Inflate:yy,inflate:by,inflateRaw:xy,ungzip:Sy}=my,Cy={Deflate:hy,deflate:gy,deflateRaw:_y,gzip:vy,Inflate:yy,inflate:by,inflateRaw:xy,ungzip:Sy,constants:zh},wy=o((exports=>{var t=Symbol.for(`react.transitional.element`),n=Symbol.for(`react.fragment`);function r(e,n,r){var i=null;if(r!==void 0&&(i=``+r),n.key!==void 0&&(i=``+n.key),`key`in n)for(var a in r={},n)a!==`key`&&(r[a]=n[a]);else r=n;return n=r.ref,{$$typeof:t,type:e,key:i,ref:n===void 0?null:n,props:r}}exports.Fragment=n,exports.jsx=r,exports.jsxs=r})),Y=c(o(((exports,t)=>{t.exports=wy()}))()),Ty=(0,_.createContext)(null),Ey=1024,Dy=64*1024,Oy=6,ky=e=>{try{let t=JSON.stringify(e);return t.length<Ey?{data:t,compressed:!1}:{data:Cy.gzip(t,{level:Oy}),compressed:!0}}catch{return{data:JSON.stringify(e),compressed:!1}}},Ay=(e,t)=>{try{if(!t)return JSON.parse(e);let n=Cy.ungzip(e,{to:`string`});return JSON.parse(n)}catch{throw Error(`Failed to decompress data`)}},jy=(e,t)=>{let n=[],r=e.length||e.byteLength,i=Math.ceil(r/Dy);for(let a=0;a<i;a++){let o=a*Dy,s=Math.min(o+Dy,r),c=e.slice?e.slice(o,s):e.subarray(o,s);n.push({data:c,index:a,total:i,size:c.length||c.byteLength,compressed:t})}return n};function My({children:e}){let t=Number.parseInt(void 0,10)||15e3,n=Number.parseInt(void 0,10)||5e3,r=Number.parseInt(void 0,10)||5,i=Number.parseInt(void 0,10)||50,a=Number.parseInt(void 0,10)||128*1024,o=Number.parseInt(void 0,10)||Math.floor(a/2),s=[`stun:stun.l.google.com:19302`,`stun:stun1.l.google.com:19302`,`stun:stun2.l.google.com:19302`,`stun:stun3.l.google.com:19302`,`stun:stun4.l.google.com:19302`].join(`,`).split(`,`).map(e=>e.trim()).filter(Boolean).map(e=>({urls:e})),[c,l]=(0,_.useState)(null),[u,d]=(0,_.useState)(navigator.onLine),[f,p]=(0,_.useState)([]),[m,h]=(0,_.useState)([]),[g,v]=(0,_.useState)({}),[y,b]=(0,_.useState)([]),[x,S]=(0,_.useState)(!1),[C,w]=(0,_.useState)(()=>de()),T=(0,_.useRef)({}),E=(0,_.useRef)(u),D=(0,_.useRef)({}),O=(0,_.useRef)(new Set),ee=(0,_.useRef)(new Set),k=(0,_.useRef)(new Set),te=(0,_.useRef)(null),ne=(0,_.useRef)({}),re=(0,_.useRef)({}),ie=(0,_.useRef)({}),ae=(0,_.useRef)(null),A=(0,_.useRef)(new Set),j=(0,_.useRef)(null),oe=(0,_.useRef)(new Set),se=(0,_.useRef)({}),ce=(0,_.useRef)({}),le=(0,_.useRef)({}),ue=(0,_.useRef)(typeof TextEncoder<`u`?new TextEncoder:null),M=(0,_.useRef)(!0),N=(0,_.useRef)([]),P=(0,_.useCallback)((...e)=>{let t=`[${new Date().toLocaleTimeString()}] ${e.map(e=>typeof e==`string`?e:JSON.stringify(e,null,2)).join(` `)}`;N.current=[...N.current.slice(-500),t],b(N.current),console.log(`[PeerDebug]`,...e)},[]),pe=(0,_.useCallback)(e=>{let t=T.current?.[e];if(!t)return;let{dc:n}=t;if(!n||n.readyState!==`open`){t.flushScheduled&&=(clearTimeout(t.flushScheduled),null);return}if(!Array.isArray(t.queue)||t.queue.length===0){t.flushScheduled&&=(clearTimeout(t.flushScheduled),null);return}for(;t.queue.length;){let r=t.queue[0];if(!r){t.queue.shift();continue}if(!(r.size>a)&&n.bufferedAmount+r.size>a)break;try{n.send(r.data)}catch(t){P(`sendJSON flush error`,e,String(t));break}t.queue.shift()}if(t.queue.length===0){t.flushScheduled&&=(clearTimeout(t.flushScheduled),null);return}t.flushScheduled||=setTimeout(()=>{t.flushScheduled=null,pe(e)},120)},[a,P]),F=(0,_.useCallback)((e,t)=>{try{let n=T.current?.[e];n||(n={pc:null,dc:null,pingTimer:null,pendingCandidates:[],queue:[],bufferedLowHandler:null,flushScheduled:null},T.current[e]=n),Array.isArray(n.queue)||(n.queue=[]);let r=JSON.stringify(t),i=ue.current?.encode(r).length??r.length;n.queue.push({data:r,size:i});let{dc:s}=n;if(!s||s.readyState!==`open`)return P(`sendJSON: canal pendiente`,e,`state`,s?.readyState??`sin canal`,`pendientes`,n.queue.length),n.flushScheduled||=setTimeout(()=>{n.flushScheduled=null,pe(e)},150),!0;if(!n.bufferedLowHandler){let t=()=>pe(e);n.bufferedLowHandler=t,typeof s.addEventListener==`function`?s.addEventListener(`bufferedamountlow`,t):s.onbufferedamountlow=t}return typeof s.bufferedAmountLowThreshold==`number`&&(s.bufferedAmountLowThreshold=o),s.bufferedAmount+i>a&&P(`sendJSON: encolado por buffer`,e,`buffered`,s.bufferedAmount,`pendientes`,n.queue.length),pe(e),!0}catch(t){return P(`sendJSON fallo`,e,String(t)),!1}},[o,a,P,pe]),me=(0,_.useCallback)((e,t,n,r={})=>{try{let{data:i,compressed:a}=ky(t),o=jy(i,a);if(o.length===1){let o={type:n,payload:a?{data:btoa(String.fromCharCode(...new Uint8Array(i))),compressed:!0}:t,...r};return F(e,o)}else{let t=0,i=()=>{if(t>=o.length)return;let s=o[t],c=s.data,l={type:`dataChunk`,payload:{data:a?btoa(String.fromCharCode(...new Uint8Array(c))):c,index:s.index,total:s.total,compressed:a,originalType:n,metadata:r}};F(e,l)?(t++,t<o.length&&setTimeout(i,0)):P(`Failed to send chunk`,e,s.index)};return i(),!0}}catch(t){return P(`sendEfficientData error`,e,String(t)),!1}},[F,P]),he=(0,_.useCallback)((e,t)=>{if(!e||!t)return!0;let n=[e.role,t.role].sort().join(`-`);return n===`admin-supervisor`||n===`mantenedor-supervisor`},[]),ge=(0,_.useCallback)(e=>{let t=j.current;return!t||!e?.auth?!1:he(t,e.user)},[he]),_e=(0,_.useCallback)(async e=>{if(!c)return!1;let t=j.current?{code:j.current.code,role:j.current.role,speciality:j.current.speciality??null,name:j.current.name}:null,n=await Be(),r=await Ve();return F(e,{type:`hello`,from:c,auth:!!j.current,user:t,ts:Date.now(),version:n?.version||0,ordersVersion:r?.version||0})},[c,F]),ve=(0,_.useCallback)(async e=>{if(!j.current)return P(`omit usersSnapshot`,e,`sin auth local`),!1;try{let t=await He();return me(e,t,`usersSnapshot`,{fromAuth:!0})}catch(e){return P(`usersSnapshot error`,String(e)),!1}},[P,me]),ye=(0,_.useCallback)(async(e,t)=>{if(!j.current)return!1;try{let n=await We(t);return me(e,n,`ordersSnapshot`,{fromAuth:!0,speciality:t})}catch(e){return P(`ordersSnapshot error`,String(e)),!1}},[P,me]),be=(0,_.useCallback)(async()=>{try{let e=j.current;if(!e)return;let t=Object.keys(T.current||{});if(!t.length)return;let[n,r]=await Promise.all([He(),Ve()]),i=n.meta?.version||0,a=r?.version||0;t.forEach(t=>{let r=se.current?.[t]||{},o=r.version||0,s=r.ordersVersion||0;i>o&&me(t,n,`usersSnapshot`,{fromAuth:!0});let c=r.hello||null;if(c?.auth&&he(e,c.user)&&a>s)if(c.user?.role===`mantenedor`)Ge(c.user.code).then(e=>{(e.orders||[]).length&&me(t,e,`ordersSnapshot`,{fromAuth:!0,userCode:c.user.code})}).catch(e=>P(`broadcastSync orders error`,String(e)));else{let n=c.user?.speciality??e.speciality??null;We(n).then(e=>{(e.orders||[]).length&&me(t,e,`ordersSnapshot`,{fromAuth:!0,speciality:n})}).catch(e=>P(`broadcastSync orders error`,String(e)))}})}catch(e){P(`broadcastSync error`,String(e))}},[]),xe=(0,_.useCallback)(()=>{Object.keys(T.current||{}).forEach(e=>{F(e,{type:`requestUsersSnapshot`})||P(`request users snapshot fallo`,e)})},[P,F]),Se=(0,_.useCallback)(e=>{let t=T.current[e];if(t){try{t.dc?.close?.()}catch{}try{t.pc?.close?.()}catch{}if(t.pingTimer&&clearInterval(t.pingTimer),t.flushScheduled&&=(clearTimeout(t.flushScheduled),null),t.dc&&t.bufferedLowHandler)try{typeof t.dc.removeEventListener==`function`?t.dc.removeEventListener(`bufferedamountlow`,t.bufferedLowHandler):t.dc.onbufferedamountlow===t.bufferedLowHandler&&(t.dc.onbufferedamountlow=null)}catch{}delete T.current[e],h(t=>t.filter(t=>t!==e)),v(t=>{let{[e]:n,...r}=t;return r}),delete se.current[e],delete ce.current[`${e}-1`],delete ce.current[`${e}-2`],Object.keys(le.current).forEach(t=>{t.startsWith(`${e}-`)&&delete le.current[t]})}},[]),Ce=(0,_.useCallback)((e,t)=>{let r=T.current[e];if(r?.dc&&r.bufferedLowHandler)try{typeof r.dc.removeEventListener==`function`?r.dc.removeEventListener(`bufferedamountlow`,r.bufferedLowHandler):r.dc.onbufferedamountlow===r.bufferedLowHandler&&(r.dc.onbufferedamountlow=null)}catch{}let i={...r||{pc:null,dc:null,pingTimer:null,pendingCandidates:[],queue:[],bufferedLowHandler:null,flushScheduled:null},dc:t};Array.isArray(i.queue)||(i.queue=[]),T.current[e]=i;let a=i.bufferedLowHandler||(()=>pe(e));i.bufferedLowHandler=a,typeof t.addEventListener==`function`?t.addEventListener(`bufferedamountlow`,a):t.onbufferedamountlow=a,typeof t.bufferedAmountLowThreshold==`number`&&(t.bufferedAmountLowThreshold=o),t.onopen=()=>{h(t=>t.includes(e)?t:[...t,e]),ie.current[e]=0,_e(e).catch(()=>{}),T.current[e]&&(T.current[e].pingTimer&&clearInterval(T.current[e].pingTimer),T.current[e].pingTimer=setInterval(()=>{t.readyState===`open`&&t.send(JSON.stringify({type:`ping`,ts:performance.now()}))},n)),pe(e),j.current?ve(e).catch(()=>{}):F(e,{type:`requestUsersSnapshot`})},t.onclose=()=>{Se(e),O.current.has(e)&&ee.current.add(e)},t.onmessage=n=>{try{let r=JSON.parse(n.data);if(r.type===`ping`){t.send(JSON.stringify({type:`pong`,ts:r.ts}));return}if(r.type===`pong`){let t=Math.max(0,performance.now()-(r.ts||0));v(n=>({...n,[e]:Math.round(t)}));return}if(r.type===`hello`){if(se.current={...se.current,[e]:{hello:r,version:r.version||0,ordersVersion:r.ordersVersion||0}},j.current&&r?.auth&&!he(j.current,r.user)){P(`hierarchy bloqueada`,e,`roles:`,j.current.role,`->`,r.user?.role),A.current.add(e),Se(e);return}j.current&&r?.auth&&he(j.current,r.user)&&Ve().then(t=>{let n=t?.version||0,i=r.ordersVersion||0;if(P(`Versiones rdenes`,e,`local:`,n,`remota:`,i),i>n){P(`Solicitando rdenes ms recientes de`,e);let t=r.user?.speciality??j.current.speciality??null;t!=null&&F(e,{type:`requestOrders`,speciality:t})}else if(n>i){P(`Enviando rdenes ms recientes a`,e);let t=r.user?.speciality??j.current.speciality??null;t!=null&&ye(e,t).catch(t=>P(`Error enviando rdenes en sync`,e,String(t)))}else P(`Versiones de rdenes sincronizadas con`,e)}).catch(e=>P(`Error obteniendo meta rdenes local`,String(e)));return}if(r.type===`dataChunk`){let t=r.payload||{},n=`${e}-${t.originalType}-${t.metadata?.speciality||`all`}`;if(!((se.current?.[e]?.hello||null)?.auth||t.metadata?.fromAuth)){P(`dataChunk rechazado`,e);return}le.current[n]||(le.current[n]={chunks:[],total:t.total,compressed:t.compressed,originalType:t.originalType,metadata:t.metadata});let i=le.current[n];if(i.chunks[t.index]=t.compressed?Uint8Array.from(atob(t.data),e=>e.charCodeAt(0)):t.data,i.chunks.filter(e=>e!==void 0).length===i.total)try{let t=i.chunks.reduce((e,t)=>e+t.length,0),r=new Uint8Array(t),a=0;for(let e of i.chunks)r.set(e,a),a+=e.length;let o=Ay(r,i.compressed);i.originalType===`usersSnapshot`?Ue(o).then(t=>{P(`applyUsersSnapshot efficient`,e,t?.applied?`applied`:t?.reason)}).catch(e=>P(`applyUsersSnapshot efficient error`,String(e))):i.originalType===`ordersSnapshot`&&Ke(o).then(t=>{P(`applyOrdersSnapshot efficient`,e,t?.applied?`applied`:t?.reason),t?.applied&&(se.current[e]={...se.current[e]||{},ordersVersion:o.meta?.version||0})}).catch(e=>P(`applyOrdersSnapshot efficient error`,String(e))),delete le.current[n]}catch(t){P(`chunk assembly error`,e,String(t)),delete le.current[n]}return}if(r.type===`usersSnapshot`){if(!((se.current?.[e]?.hello||null)?.auth||r?.fromAuth)){P(`usersSnapshot rechazado`,e);return}let t=r.payload;if(t?.compressed)try{t=Ay(Uint8Array.from(atob(t.data),e=>e.charCodeAt(0)),!0)}catch(e){P(`decompress usersSnapshot error`,String(e));return}Ue(t||{}).then(t=>{P(`applyUsersSnapshot`,e,t?.applied?`applied`:t?.reason)}).catch(e=>P(`applyUsersSnapshot error`,String(e)));return}if(r.type===`ordersChunk`){if(!((se.current?.[e]?.hello||null)?.auth||r?.fromAuth))return;let t=`${e}-${r.speciality}`,n=r.payload||{};ce.current[t]||(ce.current[t]={meta:n.meta,orders:[],total:n.total??0});let i=ce.current[t],a=n.orders||[];i.orders.push(...a);let o=Number.isFinite(n.total)&&n.total>0?n.total:i.total||i.orders.length;if(i.total=o,i.orders.length>=o){let n={meta:i.meta,orders:i.orders};Ke(n).then(t=>{P(`applyOrdersSnapshot chunks`,e,t?.applied?`applied`:t?.reason),t?.applied&&(se.current[e]={...se.current[e]||{},ordersVersion:n.meta?.version||0})}).catch(e=>P(`applyOrdersSnapshot chunk error`,String(e))),delete ce.current[t]}return}if(r.type===`ordersSnapshot`){if(!((se.current?.[e]?.hello||null)?.auth||r?.fromAuth))return;let t=r.payload;if(t?.compressed)try{t=Ay(Uint8Array.from(atob(t.data),e=>e.charCodeAt(0)),!0)}catch(e){P(`decompress ordersSnapshot error`,String(e));return}Ke(t||{}).then(n=>{P(`applyOrdersSnapshot direct`,e,n?.applied?`applied`:n?.reason),n?.applied&&(se.current[e]={...se.current[e]||{},ordersVersion:t?.meta?.version||0})}).catch(e=>P(`applyOrdersSnapshot direct error`,String(e)));return}if(r.type===`requestUsersSnapshot`){j.current?ve(e).catch(()=>{}):oe.current.add(e);return}if(r.type===`requestOrders`){let t=se.current?.[e]?.hello||null;r.speciality!=null&&ge(t)&&ye(e,r.speciality).catch(()=>{});return}}catch(t){P(`Mensaje no procesado`,e,String(t))}}},[ge,Se,P,o,n,he,pe,_e,F,ye,ve]),we=(0,_.useCallback)(e=>{let t=T.current[e];if(t?.pc)return t;let n=new RTCPeerConnection({iceServers:s}),r={pc:n,dc:t?.dc??null,pingTimer:t?.pingTimer??null,pendingCandidates:[],queue:Array.isArray(t?.queue)?t.queue:[],bufferedLowHandler:t?.bufferedLowHandler??null,flushScheduled:t?.flushScheduled??null};T.current[e]=r,n.onicecandidate=t=>{if(!t.candidate)return;let n=rm(em(Tm,`signals/${e}`));am(n,{from:c,candidate:t.candidate.toJSON?.()}).then(()=>P(`ICE local`,e)).catch(e=>P(`ICE local error`,String(e)))},n.onconnectionstatechange=()=>{P(`pc state`,e,n.connectionState),(n.connectionState===`failed`||n.connectionState===`closed`)&&(Se(e),O.current.has(e)&&ee.current.add(e))},n.oniceconnectionstatechange=()=>{n.iceConnectionState===`disconnected`&&setTimeout(()=>{n.iceConnectionState===`disconnected`&&(Se(e),O.current.has(e)&&ee.current.add(e))},3e3)},n.ondatachannel=t=>{t.channel?.label===`dataChannel`&&Ce(e,t.channel)};let i=n.createDataChannel(`dataChannel`);return Ce(e,i),r},[s,Se,P,c,Ce]),Te=(0,_.useCallback)(async e=>{if(!c)return;if(!E.current){ee.current.add(e);return}if(T.current[e]?.pc)return;if(A.current.has(e)){P(`Conexin bloqueada por jerarqua`,e);return}ie.current[e]=(ie.current[e]||0)+1;let{pc:t}=we(e);try{ne.current[e]=!0;let n=await t.createOffer();await t.setLocalDescription(n);let r=rm(em(Tm,`signals/${e}`));await am(r,{from:c,sdp:n}),P(`offer enviada`,e)}finally{ne.current[e]=!1}},[P,we,c]),Ee=(0,_.useRef)();Ee.current=Te;let De=(0,_.useCallback)(e=>{if(!E.current){ee.current.add(e);return}if(D.current[e]||T.current[e]||A.current.has(e))return;let n=Math.floor(Math.random()*(t+1));D.current[e]=setTimeout(()=>{Ee.current(e),delete D.current[e]},n)},[t]),Oe=(0,_.useCallback)(e=>{let t=j.current,n=!!t==!!e&&(!e||t&&t.code===e.code&&t.role===e.role&&t.speciality===e.speciality&&t.name===e.name);if(!n&&(!n&&t?.role!==e?.role&&(P(`Usuario cambi de rol, limpiando peers bloqueados`,t?.role,`->`,e?.role),A.current.clear()),j.current=e||null,ae.current&&om(ae.current,{role:e?.role??null,code:e?.code??null,speciality:e?.speciality??null,updatedAt:Date.now()}).catch(()=>{}),Object.keys(T.current||{}).forEach(e=>{_e(e).catch(()=>{})}),e)){let e=Array.from(oe.current);oe.current.clear(),e.forEach(e=>{ve(e).catch(()=>{})})}},[_e,ve,P]);(0,_.useEffect)(()=>{let e=localStorage.getItem(`peerBaseId`);e||(e=`guest-${Date.now()}-${Math.floor(Math.random()*1e3)}`,localStorage.setItem(`peerBaseId`,e));let t=sessionStorage.getItem(`peerSessionId`);t||(t=`${Math.floor(Math.random()*1e5)}`,sessionStorage.setItem(`peerSessionId`,t));let n=`${e}-${t}`;l(n);let r=em(Tm,`peers/${n}`);ae.current=r,am(r,{peerId:n,baseId:e,status:`online`,role:null,code:null,speciality:null,updatedAt:Date.now()}).catch(()=>{});try{nm(r).remove()}catch{}let i=()=>{im(r).catch(()=>{})};window.addEventListener(`beforeunload`,i);let a=em(Tm,`peers`),o=um(a,e=>{let t=e.val()||{},r=Object.keys(t).filter(e=>e!==n);p(r),O.current=new Set(r),r.forEach(e=>k.current.add(e))});return()=>{window.removeEventListener(`beforeunload`,i);try{o()}catch{}im(r).catch(()=>{})}},[]),(0,_.useEffect)(()=>{E.current=u},[u]),(0,_.useEffect)(()=>{let e=()=>{d(!0),Array.from(ee.current).forEach(e=>{De(e)}),ee.current.clear()},t=()=>{d(!1),Object.values(D.current).forEach(e=>{clearTimeout(e)}),D.current={}};return window.addEventListener(`online`,e),window.addEventListener(`offline`,t),()=>{window.removeEventListener(`online`,e),window.removeEventListener(`offline`,t)}},[De]),(0,_.useEffect)(()=>{if(!c)return;let e=em(Tm,`signals/${c}`),t=dm(e,async e=>{let t=e.val(),n=t?.from;if(!n||n===c){await im(e.ref);return}if(A.current.has(n)){await im(e.ref);return}let r=we(n),i=r.pc;try{if(t.sdp){let{sdp:a}=t;if(a.type===`offer`){re.current[n]??(re.current[n]=c>n);let t=re.current[n],o=!!ne.current[n],s=i.signalingState===`stable`;if(!t&&(o||!s)){await im(e.ref);return}if(!s)try{await i.setLocalDescription({type:`rollback`})}catch{}let l=!0;try{await i.setRemoteDescription(a)}catch(e){l=!1,P(`remote offer error`,n,String(e))}if(!l)return;if(r.pendingCandidates?.length){let e=[...r.pendingCandidates];r.pendingCandidates=[];for(let t of e)try{await i.addIceCandidate(new RTCIceCandidate(t))}catch(e){P(`ICE diferido error`,String(e))}}let u=i.signalingState;if(u!==`have-remote-offer`){P(`omitir answer`,n,`estado`,u);return}let d;try{d=await i.createAnswer()}catch(e){P(`createAnswer error`,n,String(e));return}try{await i.setLocalDescription(d)}catch(e){P(`setLocalDescription answer error`,n,String(e));return}let f=rm(em(Tm,`signals/${n}`));await am(f,{from:c,sdp:d})}else if(a.type===`answer`){let t=i.signalingState;if(t!==`have-local-offer`){P(`ignorar answer`,n,`estado`,t),await im(e.ref);return}try{await i.setRemoteDescription(a)}catch(e){P(`remote answer error`,n,String(e));return}if(r.pendingCandidates?.length){let e=[...r.pendingCandidates];r.pendingCandidates=[];for(let t of e)try{await i.addIceCandidate(new RTCIceCandidate(t))}catch(e){P(`ICE diferido error`,String(e))}}}}else if(t.candidate)if(i.remoteDescription)try{await i.addIceCandidate(new RTCIceCandidate(t.candidate))}catch(e){P(`ICE candidate error`,n,String(e))}else r.pendingCandidates.push(t.candidate)}finally{await im(e.ref)}});return te.current={ref:e,callback:t},()=>{if(te.current){let{ref:e,callback:t}=te.current;fm(e,`child_added`,t)}}},[c]),(0,_.useEffect)(()=>{let e=e=>{let t=e?.detail||null;Oe(t)};return window.addEventListener(`auth:user-changed`,e),()=>{window.removeEventListener(`auth:user-changed`,e)}},[Oe]),(0,_.useEffect)(()=>{let e=e=>{let t=e?.detail?.reason;!j.current||t===`snapshot-applied`||be().catch(()=>{})};window.addEventListener(`users:changed`,e);let t;try{`BroadcastChannel`in self&&(t=new BroadcastChannel(`wt-users-changes`),t.onmessage=t=>{t?.data?.type===`users:changed`&&e({detail:{reason:t.data.reason}})})}catch{}return()=>{window.removeEventListener(`users:changed`,e),t&&(t.onmessage=null,t.close())}},[be]),(0,_.useEffect)(()=>{let e=e=>{let t=e?.detail?.reason;!j.current||t===`snapshot-applied`||be().catch(e=>P(`broadcastSync on orders changed error`,String(e)))};window.addEventListener(`orders:changed`,e);let t;try{`BroadcastChannel`in self&&(t=new BroadcastChannel(`wt-orders-changes`),t.onmessage=t=>{t?.data?.type===`orders:changed`&&e({detail:{reason:t.data.reason}})})}catch{}return()=>{window.removeEventListener(`orders:changed`,e),t&&(t.onmessage=null,t.close())}},[be,P]),(0,_.useEffect)(()=>{f.filter(e=>!k.current.has(e)).forEach(e=>{A.current.has(e)||De(e)}),k.current=new Set(f)},[f,De]);let ke=(0,_.useCallback)(async e=>{if(!j.current)return!1;let t=Object.keys(se.current||{});for(let n of t)if((se.current[n]?.hello)?.user?.code===e)try{let t=await Ge(e);return me(n,t,`ordersSnapshot`,{fromAuth:!0,userCode:e})}catch(e){return P(`sendOrdersToUser error`,String(e)),!1}return P(`No se encontr peer para usuario`,e),!1},[P,me]),Ae=(0,_.useCallback)(e=>A.current.has(e)?(P(`Desbloqueando peer`,e),A.current.delete(e),!0):!1,[P]),je=(0,_.useCallback)(()=>{let e=A.current.size;return P(`Limpiando todos los peers bloqueados`,e),A.current.clear(),e},[P]),Me=(0,_.useCallback)(async({force:e=!0}={})=>{try{let t=await fe({force:e});return M.current&&w({...t}),t}catch(e){let t={supported:!1,persisted:!1,reason:`error`,error:e};return M.current&&w(t),t}},[]);(0,_.useEffect)(()=>(M.current=!0,Me({force:!1}).catch(()=>{}),()=>{M.current=!1}),[Me]);let Ne=(0,_.useMemo)(()=>({ICE_SERVERS:s,BACKOFF_MAX:t,PING_INTERVAL_MS:n,CHUNK_SIZE:r,CHUNK_DELAY_MS:i,peerId:c,isOnline:u,peers:f,connectedPeerIds:m,peerRTT:g,debugLog:y,debugOpen:x,connectToPeer:Te,scheduleConnect:De,cleanupConnection:Se,setDebugLog:b,openDebug:()=>S(!0),closeDebug:()=>S(!1),toggleDebug:()=>S(e=>!e),setAuthUser:Oe,broadcastSync:be,requestUsersSnapshot:xe,sendOrdersToUser:ke,unblockPeer:Ae,clearBlockedPeers:je,storagePersistence:C,refreshStoragePersistence:Me,dlog:P}),[s,t,n,r,i,c,u,f,m,g,y,x,Te,De,Se,Oe,be,xe,ke,Ae,je,C,Me,P]);return(0,Y.jsx)(Ty.Provider,{value:Ne,children:e})}function Ny(){let e=(0,_.useContext)(Ty);if(!e)throw Error(`usePeer must be used within <PeerProvider>`);return e}var Py=(0,_.createContext)(null);function Fy({children:e}){let[t,n]=(0,_.useState)(null),[r,i]=(0,_.useState)(!0),{setAuthUser:a}=Ny(),o=(0,_.useCallback)(e=>{try{window.dispatchEvent(new CustomEvent(`auth:user-changed`,{detail:e||null}))}catch{}},[]);(0,_.useEffect)(()=>{(async()=>{await ge(),await De();let e=localStorage.getItem(`auth.user`);if(e)try{let t=JSON.parse(e);n(t),a(t),o(t)}catch{}i(!1)})()},[a,o]);let s=(0,_.useCallback)(async({code:e,password:t})=>{let r=await ze(e,t);if(r){let e={code:r.code,name:r.name,role:r.role,speciality:r.speciality};return n(e),localStorage.setItem(`auth.user`,JSON.stringify(e)),a(e),o(e),{ok:!0,user:e}}return{ok:!1,error:`Credenciales invlidas`}},[a,o]),c=(0,_.useCallback)(()=>{n(null),localStorage.removeItem(`auth.user`),a(null),o(null)},[a,o]),l=(0,_.useMemo)(()=>({user:t,loading:r,login:s,logout:c}),[t,r,s,c]);return(0,Y.jsx)(Py.Provider,{value:l,children:e})}function Iy(){let e=(0,_.useContext)(Py);if(!e)throw Error(`useAuth must be used inside <AuthProvider>`);return e}function Ly(){let e=Kt(),{toggleDebug:t}=Ny(),{user:n,logout:r}=Iy();return(0,Y.jsx)(`header`,{className:`fixed top-0 left-0 w-full bg-white shadow-md z-30`,children:(0,Y.jsxs)(`div`,{className:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-12 flex items-center justify-between`,children:[(0,Y.jsx)(`h1`,{className:`text-lg font-semibold text-gray-900`,children:(0,Y.jsx)(`button`,{type:`button`,onClick:()=>{if(!n){e(`/login`);return}let t={admin:`/admin`,supervisor:`/supervisor`,mantenedor:`/mantenedor`}[n.role]??`/login`;e(t)},className:`rounded-md text-left text-lg font-semibold text-gray-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 cursor-pointer`,children:`WatchTask`})}),(0,Y.jsxs)(`div`,{className:`flex items-center gap-2`,children:[n?(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsxs)(`span`,{className:`text-sm text-gray-700`,children:[n.name,`  `,n.role]}),(0,Y.jsx)(`button`,{className:`btn btn-outline btn-sm`,onClick:r,children:`Salir`})]}):null,(0,Y.jsx)(`button`,{className:`btn btn-outline`,onClick:t,children:`Debug`})]})]})})}function Ry(){return(0,Y.jsx)(`footer`,{className:`bg-white shadow-inner mt-auto`,children:(0,Y.jsxs)(`div`,{className:`max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 text-center text-sm text-gray-500`,children:[` `,new Date().getFullYear(),` WatchTask. v0.0.1.7 Debug State`]})})}function zy(){let{BACKOFF_MAX:e,PING_INTERVAL_MS:t,peerId:n,isOnline:r,peers:i,connectedPeerIds:a,peerRTT:o,debugLog:s,debugOpen:c,connectToPeer:l,scheduleConnect:u,setDebugLog:d,requestUsersSnapshot:f,clearBlockedPeers:p,storagePersistence:m,refreshStoragePersistence:h}=Ny();if(!c)return null;let g=m??{supported:!1,persisted:!1,reason:`unknown`},_=g.persisted?`Persistente`:g.supported?`No persistente`:`Sin soporte`,v=g.persisted?`bg-green-100 text-green-700`:g.supported?`bg-yellow-100 text-yellow-700`:`bg-gray-200 text-gray-700`,y=g.persisted?`IndexedDB est protegido contra purgas automticas.`:g.supported?`El navegador podra liberar datos offline si necesita espacio.`:`El navegador usa almacenamiento 'best-effort'; no admite persistencia forzada.`;return(0,Y.jsxs)(`aside`,{className:`fixed top-12 bottom-0 right-0 w-full md:w-[520px] overflow-auto z-20 bg-white border-l border-gray-200 shadow-lg text-xs`,children:[(0,Y.jsxs)(`div`,{className:`px-3 py-2 border-b flex items-center gap-2 justify-between`,children:[(0,Y.jsxs)(`div`,{className:`flex items-center gap-2 min-w-0`,children:[(0,Y.jsx)(`span`,{className:`font-semibold`,children:`P2P Debug`}),(0,Y.jsx)(`span`,{className:`inline-flex items-center rounded px-1.5 py-0.5 text-[10px] font-medium ${r?`bg-green-100 text-green-700`:`bg-red-100 text-red-700`}`,children:r?`Online`:`Offline`})]}),(0,Y.jsx)(`div`,{className:`flex items-center gap-2 min-w-0`,children:(0,Y.jsx)(`span`,{className:`font-mono text-[11px] text-gray-600 truncate max-w-[200px]`,title:n||`-`,children:n||`-`})})]}),(0,Y.jsxs)(`div`,{className:`p-3 space-y-3`,children:[(0,Y.jsxs)(`section`,{className:`card p-2`,children:[(0,Y.jsxs)(`div`,{className:`flex items-center justify-between mb-1`,children:[(0,Y.jsx)(`div`,{className:`heading mb-0 text-sm`,children:`Almacenamiento local`}),(0,Y.jsx)(`span`,{className:`inline-flex items-center rounded px-2 py-0.5 text-[10px] font-medium ${v}`,children:_})]}),(0,Y.jsxs)(`div`,{className:`text-[11px] text-gray-700`,children:[y,g.reason&&(0,Y.jsxs)(`span`,{className:`block text-[10px] text-gray-500 mt-1`,children:[`Motivo: `,g.reason]}),g.error&&(0,Y.jsxs)(`span`,{className:`block text-[10px] text-red-600 mt-1`,children:[`Error: `,String(g.error)]})]}),(0,Y.jsx)(`div`,{className:`mt-2 flex gap-2`,children:(0,Y.jsx)(`button`,{className:`btn btn-outline px-2 py-1 text-[11px]`,onClick:()=>h({force:!0}),children:`Reintentar persistencia`})})]}),(0,Y.jsxs)(`section`,{children:[(0,Y.jsx)(`div`,{className:`mb-1 text-[12px] font-medium`,children:`Conectados`}),a.length===0?(0,Y.jsx)(`p`,{className:`muted`,children:`Sin conexiones activas`}):(0,Y.jsx)(`ul`,{className:`flex flex-wrap gap-1`,children:a.map(e=>(0,Y.jsxs)(`li`,{className:`px-2 py-0.5 rounded border bg-green-50 text-green-800 flex items-center gap-1`,children:[(0,Y.jsx)(`span`,{className:`font-mono text-[11px] break-all max-w-[200px] truncate`,title:e,children:e}),typeof o[e]==`number`&&(0,Y.jsxs)(`span`,{className:`text-[10px] text-gray-600`,children:[o[e],` ms`]})]},e))})]}),(0,Y.jsxs)(`section`,{className:`card p-2`,children:[(0,Y.jsx)(`div`,{className:`flex items-center justify-between`,children:(0,Y.jsx)(`div`,{className:`heading mb-0 text-sm`,children:`Peers`})}),i.length===0?(0,Y.jsx)(`p`,{className:`muted mt-1`,children:`No hay peers disponibles.`}):(0,Y.jsx)(`ul`,{className:`divide-y h-38 overflow-auto`,children:i.map(e=>(0,Y.jsx)(`li`,{className:`py-1.5`,children:(0,Y.jsxs)(`div`,{className:`flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2`,children:[(0,Y.jsx)(`div`,{className:`min-w-0`,children:(0,Y.jsx)(`div`,{className:`font-mono text-[11px] break-all truncate`,title:e,children:e})}),(0,Y.jsxs)(`div`,{className:`flex flex-wrap gap-2 w-full sm:w-auto`,children:[(0,Y.jsx)(`button`,{className:`btn btn-outline px-2 py-1 text-[11px]`,onClick:()=>u(e),children:`Programar`}),(0,Y.jsx)(`button`,{className:`btn btn-primary px-2 py-1 text-[11px]`,onClick:()=>l(e),children:`Conectar`})]})]})},e))})]}),(0,Y.jsxs)(`section`,{className:`card p-2`,children:[(0,Y.jsxs)(`div`,{className:`flex items-center justify-between mb-2`,children:[(0,Y.jsx)(`div`,{className:`heading mb-0 text-sm`,children:`Jerarqua P2P`}),(0,Y.jsx)(`button`,{className:`btn btn-outline px-2 py-1 text-[11px]`,onClick:()=>{let e=p();alert(`${e} peers desbloqueados`)},children:`Desbloquear todos`})]}),(0,Y.jsx)(`div`,{className:`text-[10px] text-gray-600 mb-2`,children:`Reglas: adminsupervisor, mantenedorsupervisor`})]}),(0,Y.jsxs)(`section`,{className:`card p-2`,children:[(0,Y.jsxs)(`div`,{className:`flex items-center justify-between mb-2`,children:[(0,Y.jsx)(`div`,{className:`heading mb-0 text-sm`,children:`Log`}),(0,Y.jsxs)(`div`,{className:`flex gap-2`,children:[(0,Y.jsx)(`button`,{className:`btn btn-outline px-2 py-1 text-[11px]`,onClick:async()=>{if(n)try{let{ref:e,remove:t}=await x(async()=>{let{ref:e,remove:t}=await import(`./index.esm-BpZ6PBG0.js`);return{ref:e,remove:t}},[]),{db:r}=await x(async()=>{let{db:e}=await import(`./firebaseConfig-DNMcDm3U.js`);return{db:e}},[]);await t(e(r,`signals/${n}`))}catch{}},children:`Limpiar seales`}),(0,Y.jsx)(`button`,{className:`btn btn-outline px-2 py-1 text-[11px]`,onClick:()=>d([]),children:`Limpiar log`}),(0,Y.jsx)(`button`,{className:`btn btn-primary px-2 py-1 text-[11px]`,onClick:()=>f(),children:`Pedir usuarios`})]})]}),(0,Y.jsx)(`div`,{className:`border rounded p-2 bg-white`,children:(0,Y.jsx)(`ul`,{className:`messages h-50 overflow-auto`,children:s.slice(-100).map((e,t)=>(0,Y.jsx)(`li`,{className:`font-mono text-[11px]`,children:e},t))})}),(0,Y.jsxs)(`div`,{className:`mt-2 text-[10px] text-gray-500`,children:[`BACKOFF: `,e,` ms  PING: `,t,` ms`]})]})]})]})}function By(){let[e,t]=(0,_.useState)(``),[n,r]=(0,_.useState)(``),[i,a]=(0,_.useState)(``),{login:o}=Iy(),s=Kt();return(0,Y.jsxs)(`div`,{className:`max-w-md mx-auto mt-16 p-6 bg-white shadow card`,children:[(0,Y.jsx)(`h2`,{className:`text-xl font-semibold mb-4`,children:`Iniciar sesin`}),(0,Y.jsxs)(`form`,{onSubmit:async t=>{t.preventDefault(),a(``);let r=await o({code:e,password:n});r.ok?r.user.role===`admin`?s(`/admin`):r.user.role===`supervisor`?s(`/supervisor`):r.user.role===`mantenedor`?s(`/mantenedor`):s(`/login`):a(r.error||`Error de autenticacin`)},className:`space-y-4`,children:[(0,Y.jsxs)(`div`,{children:[(0,Y.jsx)(`label`,{className:`block text-sm font-medium mb-1`,children:`Cdigo`}),(0,Y.jsx)(`input`,{type:`number`,className:`input w-full`,value:e,onChange:e=>t(e.target.value),required:!0})]}),(0,Y.jsxs)(`div`,{children:[(0,Y.jsx)(`label`,{className:`block text-sm font-medium mb-1`,children:`Password`}),(0,Y.jsx)(`input`,{type:`password`,className:`input w-full`,value:n,onChange:e=>r(e.target.value),required:!0})]}),i?(0,Y.jsx)(`p`,{className:`text-red-600 text-sm`,children:i}):null,(0,Y.jsx)(`button`,{type:`submit`,className:`btn btn-primary w-full`,children:`Entrar`})]}),(0,Y.jsx)(`p`,{className:`text-xs text-gray-500 mt-3`,children:`Usa las credenciales de .env`})]})}var Vy={};Vy.d=(e,t)=>{for(var n in t)Vy.o(t,n)&&!Vy.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},Vy.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Hy=typeof process==`object`&&process+``==`[object process]`&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!==`browser`),Uy=[.001,0,0,.001,0,0],Wy=1.35;.35/Wy;var Gy={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Ky={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},qy=`pdfjs_internal_editor_`,X={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},Jy={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},Yy={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Xy={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Zy={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Qy={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},$y={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},eb={ERRORS:0,WARNINGS:1,INFOS:5},tb={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},nb={moveTo:0,lineTo:1,curveTo:2,closePath:3},rb={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},ib=eb.WARNINGS;function ab(e){Number.isInteger(e)&&(ib=e)}function ob(){return ib}function sb(e){ib>=eb.INFOS&&console.log(`Info: ${e}`)}function Z(e){ib>=eb.WARNINGS&&console.log(`Warning: ${e}`)}function cb(e){throw Error(e)}function lb(e,t){e||cb(t)}function ub(e){switch(e?.protocol){case`http:`:case`https:`:case`ftp:`:case`mailto:`:case`tel:`:return!0;default:return!1}}function db(e,t=null,n=null){if(!e)return null;if(n&&typeof e==`string`&&(n.addDefaultProtocol&&e.startsWith(`www.`)&&e.match(/\./g)?.length>=2&&(e=`http://${e}`),n.tryConvertEncoding))try{e=Ob(e)}catch{}let r=t?URL.parse(e,t):URL.parse(e);return ub(r)?r:null}function fb(e,t,n=!1){let r=URL.parse(e);return r?(r.hash=t,r.href):n&&db(e,`http://example.com`)?e.split(`#`,1)[0]+`${t?`#${t}`:``}`:``}function pb(e,t,n,r=!1){return Object.defineProperty(e,t,{value:n,enumerable:!r,configurable:!0,writable:!1}),n}var mb=function(){function e(e,t){this.message=e,this.name=t}return e.prototype=Error(),e.constructor=e,e}(),hb=class extends mb{constructor(e,t){super(e,`PasswordException`),this.code=t}},gb=class extends mb{constructor(e,t){super(e,`UnknownErrorException`),this.details=t}},_b=class extends mb{constructor(e){super(e,`InvalidPDFException`)}},vb=class extends mb{constructor(e,t,n){super(e,`ResponseException`),this.status=t,this.missing=n}},yb=class extends mb{constructor(e){super(e,`FormatError`)}},bb=class extends mb{constructor(e){super(e,`AbortException`)}};function xb(e){(typeof e!=`object`||e?.length===void 0)&&cb(`Invalid argument for bytesToString`);let t=e.length,n=8192;if(t<n)return String.fromCharCode.apply(null,e);let r=[];for(let i=0;i<t;i+=n){let a=Math.min(i+n,t),o=e.subarray(i,a);r.push(String.fromCharCode.apply(null,o))}return r.join(``)}function Sb(e){typeof e!=`string`&&cb(`Invalid argument for stringToBytes`);let t=e.length,n=new Uint8Array(t);for(let r=0;r<t;++r)n[r]=e.charCodeAt(r)&255;return n}function Cb(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,e&255)}function wb(){let e=new Uint8Array(4);return e[0]=1,new Uint32Array(e.buffer,0,1)[0]===1}function Tb(){try{return Function(``),!0}catch{return!1}}var Eb=class{static get isLittleEndian(){return pb(this,`isLittleEndian`,wb())}static get isEvalSupported(){return pb(this,`isEvalSupported`,Tb())}static get isOffscreenCanvasSupported(){return pb(this,`isOffscreenCanvasSupported`,typeof OffscreenCanvas<`u`)}static get isImageDecoderSupported(){return pb(this,`isImageDecoderSupported`,typeof ImageDecoder<`u`)}static get platform(){let{platform:e,userAgent:t}=navigator;return pb(this,`platform`,{isAndroid:t.includes(`Android`),isLinux:e.includes(`Linux`),isMac:e.includes(`Mac`),isWindows:e.includes(`Win`),isFirefox:t.includes(`Firefox`)})}static get isCSSRoundSupported(){return pb(this,`isCSSRoundSupported`,globalThis.CSS?.supports?.(`width: round(1.5px, 1px)`))}},Db=Array.from(Array(256).keys(),e=>e.toString(16).padStart(2,`0`)),Q=class{static makeHexColor(e,t,n){return`#${Db[e]}${Db[t]}${Db[n]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,n=0){let r=e[n],i=e[n+1];e[n]=r*t[0]+i*t[2]+t[4],e[n+1]=r*t[1]+i*t[3]+t[5]}static applyTransformToBezier(e,t,n=0){let r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5];for(let t=0;t<6;t+=2){let l=e[n+t],u=e[n+t+1];e[n+t]=l*r+u*a+s,e[n+t+1]=l*i+u*o+c}}static applyInverseTransform(e,t){let n=e[0],r=e[1],i=t[0]*t[3]-t[1]*t[2];e[0]=(n*t[3]-r*t[2]+t[2]*t[5]-t[4]*t[3])/i,e[1]=(-n*t[1]+r*t[0]+t[4]*t[1]-t[5]*t[0])/i}static axialAlignedBoundingBox(e,t,n){let r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=e[0],u=e[1],d=e[2],f=e[3],p=r*l+s,m=p,h=r*d+s,g=h,_=o*u+c,v=_,y=o*f+c,b=y;if(i!==0||a!==0){let e=i*l,t=i*d,n=a*u,r=a*f;p+=n,g+=n,h+=r,m+=r,_+=e,b+=e,y+=t,v+=t}n[0]=Math.min(n[0],p,h,m,g),n[1]=Math.min(n[1],_,y,v,b),n[2]=Math.max(n[2],p,h,m,g),n[3]=Math.max(n[3],_,y,v,b)}static inverseTransform(e){let t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){let n=e[0],r=e[1],i=e[2],a=e[3],o=n**2+r**2,s=n*i+r*a,c=i**2+a**2,l=(o+c)/2,u=Math.sqrt(l**2-(o*c-s**2));t[0]=Math.sqrt(l+u||1),t[1]=Math.sqrt(l-u||1)}static normalizeRect(e){let t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){let n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),r=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>r)return null;let i=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return i>a?null:[n,i,r,a]}static pointBoundingBox(e,t,n){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}static rectBoundingBox(e,t,n,r,i){i[0]=Math.min(i[0],e,n),i[1]=Math.min(i[1],t,r),i[2]=Math.max(i[2],e,n),i[3]=Math.max(i[3],t,r)}static#getExtremumOnCurve(e,t,n,r,i,a,o,s,c,l){if(c<=0||c>=1)return;let u=1-c,d=c*c,f=d*c,p=u*(u*(u*e+3*c*t)+3*d*n)+f*r,m=u*(u*(u*i+3*c*a)+3*d*o)+f*s;l[0]=Math.min(l[0],p),l[1]=Math.min(l[1],m),l[2]=Math.max(l[2],p),l[3]=Math.max(l[3],m)}static#getExtremum(e,t,n,r,i,a,o,s,c,l,u,d){if(Math.abs(c)<1e-12){Math.abs(l)>=1e-12&&this.#getExtremumOnCurve(e,t,n,r,i,a,o,s,-u/l,d);return}let f=l**2-4*u*c;if(f<0)return;let p=Math.sqrt(f),m=2*c;this.#getExtremumOnCurve(e,t,n,r,i,a,o,s,(-l+p)/m,d),this.#getExtremumOnCurve(e,t,n,r,i,a,o,s,(-l-p)/m,d)}static bezierBoundingBox(e,t,n,r,i,a,o,s,c){c[0]=Math.min(c[0],e,o),c[1]=Math.min(c[1],t,s),c[2]=Math.max(c[2],e,o),c[3]=Math.max(c[3],t,s),this.#getExtremum(e,n,i,o,t,r,a,s,3*(-e+3*(n-i)+o),6*(e-2*n+i),3*(n-e),c),this.#getExtremum(e,n,i,o,t,r,a,s,3*(-t+3*(r-a)+s),6*(t-2*r+a),3*(r-t),c)}};function Ob(e){return decodeURIComponent(escape(e))}var kb=null,Ab=null;function jb(e){return kb||(kb=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Ab=new Map([[``,`t`]])),e.replaceAll(kb,(e,t,n)=>t?t.normalize(`NFKC`):Ab.get(n))}function Mb(){if(typeof crypto.randomUUID==`function`)return crypto.randomUUID();let e=new Uint8Array(32);return crypto.getRandomValues(e),xb(e)}var Nb=`pdfjs_internal_id_`;function Pb(e,t,n){if(!Array.isArray(n)||n.length<2)return!1;let[r,i,...a]=n;if(!e(r)&&!Number.isInteger(r)||!t(i))return!1;let o=a.length,s=!0;switch(i.name){case`XYZ`:if(o<2||o>3)return!1;break;case`Fit`:case`FitB`:return o===0;case`FitH`:case`FitBH`:case`FitV`:case`FitBV`:if(o>1)return!1;break;case`FitR`:if(o!==4)return!1;s=!1;break;default:return!1}for(let e of a){if(typeof e==`number`||s&&e===null)continue;return!1}return!0}function Fb(e,t,n){return Math.min(Math.max(e,t),n)}function Ib(e){return Uint8Array.prototype.toBase64?e.toBase64():btoa(xb(e))}function Lb(e){return Uint8Array.fromBase64?Uint8Array.fromBase64(e):Sb(atob(e))}typeof Promise.try!=`function`&&(Promise.try=function(e,...t){return new Promise(n=>{n(e(...t))})}),typeof Math.sumPrecise!=`function`&&(Math.sumPrecise=function(e){return e.reduce((e,t)=>e+t,0)});var Rb=`http://www.w3.org/2000/svg`,zb=class{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF};async function Bb(e,t=`text`){if(Jb(e,document.baseURI)){let n=await fetch(e);if(!n.ok)throw Error(n.statusText);switch(t){case`arraybuffer`:return n.arrayBuffer();case`blob`:return n.blob();case`json`:return n.json()}return n.text()}return new Promise((n,r)=>{let i=new XMLHttpRequest;i.open(`GET`,e,!0),i.responseType=t,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(t){case`arraybuffer`:case`blob`:case`json`:n(i.response);return}n(i.responseText);return}r(Error(i.statusText))}},i.send(null)})}var Vb=class e{constructor({viewBox:e,userUnit:t,scale:n,rotation:r,offsetX:i=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=e,this.userUnit=t,this.scale=n,this.rotation=r,this.offsetX=i,this.offsetY=a,n*=t;let s=(e[2]+e[0])/2,c=(e[3]+e[1])/2,l,u,d,f;switch(r%=360,r<0&&(r+=360),r){case 180:l=-1,u=0,d=0,f=1;break;case 90:l=0,u=1,d=1,f=0;break;case 270:l=0,u=-1,d=-1,f=0;break;case 0:l=1,u=0,d=0,f=-1;break;default:throw Error(`PageViewport: Invalid rotation, must be a multiple of 90 degrees.`)}o&&(d=-d,f=-f);let p,m,h,g;l===0?(p=Math.abs(c-e[1])*n+i,m=Math.abs(s-e[0])*n+a,h=(e[3]-e[1])*n,g=(e[2]-e[0])*n):(p=Math.abs(s-e[0])*n+i,m=Math.abs(c-e[1])*n+a,h=(e[2]-e[0])*n,g=(e[3]-e[1])*n),this.transform=[l*n,u*n,d*n,f*n,p-l*n*s-d*n*c,m-u*n*s-f*n*c],this.width=h,this.height=g}get rawDims(){let e=this.viewBox;return pb(this,`rawDims`,{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:t=this.scale,rotation:n=this.rotation,offsetX:r=this.offsetX,offsetY:i=this.offsetY,dontFlip:a=!1}={}){return new e({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:n,offsetX:r,offsetY:i,dontFlip:a})}convertToViewportPoint(e,t){let n=[e,t];return Q.applyTransform(n,this.transform),n}convertToViewportRectangle(e){let t=[e[0],e[1]];Q.applyTransform(t,this.transform);let n=[e[2],e[3]];return Q.applyTransform(n,this.transform),[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){let n=[e,t];return Q.applyInverseTransform(n,this.transform),n}},Hb=class extends mb{constructor(e,t=0){super(e,`RenderingCancelledException`),this.extraDelay=t}};function Ub(e){let t=e.length,n=0;for(;n<t&&e[n].trim()===``;)n++;return e.substring(n,n+5).toLowerCase()===`data:`}function Wb(e){return typeof e==`string`&&/\.pdf$/i.test(e)}function Gb(e){return[e]=e.split(/[#?]/,1),e.substring(e.lastIndexOf(`/`)+1)}function Kb(e,t=`document.pdf`){if(typeof e!=`string`)return t;if(Ub(e))return Z(`getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.`),t;let n=(e=>{try{return new URL(e)}catch{try{return new URL(decodeURIComponent(e))}catch{try{return new URL(e,`https://foo.bar`)}catch{try{return new URL(decodeURIComponent(e),`https://foo.bar`)}catch{return null}}}}})(e);if(!n)return t;let r=e=>{try{let t=decodeURIComponent(e);return t.includes(`/`)?(t=t.split(`/`).at(-1),t.test(/^\.pdf$/i)?t:e):t}catch{return e}},i=/\.pdf$/i,a=n.pathname.split(`/`).at(-1);if(i.test(a))return r(a);if(n.searchParams.size>0){let e=Array.from(n.searchParams.values()).reverse();for(let t of e)if(i.test(t))return r(t);let t=Array.from(n.searchParams.keys()).reverse();for(let e of t)if(i.test(e))return r(e)}if(n.hash){let e=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(e)return r(e[0])}return t}var qb=class{started=Object.create(null);times=[];time(e){e in this.started&&Z(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Z(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){let e=[],t=0;for(let{name:e}of this.times)t=Math.max(e.length,t);for(let{name:n,start:r,end:i}of this.times)e.push(`${n.padEnd(t)} ${i-r}ms\n`);return e.join(``)}};function Jb(e,t){let n=t?URL.parse(e,t):URL.parse(e);return n?.protocol===`http:`||n?.protocol===`https:`}function Yb(e){e.preventDefault()}function Xb(e){e.preventDefault(),e.stopPropagation()}function Zb(e){console.log(`Deprecated API usage: `+e)}var Qb=class{static#regex;static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!=`string`)return null;this.#regex||=RegExp(`^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?`);let t=this.#regex.exec(e);if(!t)return null;let n=parseInt(t[1],10),r=parseInt(t[2],10);r=r>=1&&r<=12?r-1:0;let i=parseInt(t[3],10);i=i>=1&&i<=31?i:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let s=parseInt(t[6],10);s=s>=0&&s<=59?s:0;let c=t[7]||`Z`,l=parseInt(t[8],10);l=l>=0&&l<=23?l:0;let u=parseInt(t[9],10)||0;return u=u>=0&&u<=59?u:0,c===`-`?(a+=l,o+=u):c===`+`&&(a-=l,o-=u),new Date(Date.UTC(n,r,i,a,o,s))}};function $b(e,{scale:t=1,rotation:n=0}){let{width:r,height:i}=e.attributes.style;return new Vb({viewBox:[0,0,parseInt(r),parseInt(i)],userUnit:1,scale:t,rotation:n})}function ex(e){if(e.startsWith(`#`)){let t=parseInt(e.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return e.startsWith(`rgb(`)?e.slice(4,-1).split(`,`).map(e=>parseInt(e)):e.startsWith(`rgba(`)?e.slice(5,-1).split(`,`).map(e=>parseInt(e)).slice(0,3):(Z(`Not a valid color format: "${e}"`),[0,0,0])}function tx(e){let t=document.createElement(`span`);t.style.visibility=`hidden`,t.style.colorScheme=`only light`,document.body.append(t);for(let n of e.keys()){t.style.color=n;let r=window.getComputedStyle(t).color;e.set(n,ex(r))}t.remove()}function nx(e){let{a:t,b:n,c:r,d:i,e:a,f:o}=e.getTransform();return[t,n,r,i,a,o]}function rx(e){let{a:t,b:n,c:r,d:i,e:a,f:o}=e.getTransform().invertSelf();return[t,n,r,i,a,o]}function ix(e,t,n=!1,r=!0){if(t instanceof Vb){let{pageWidth:r,pageHeight:i}=t.rawDims,{style:a}=e,o=Eb.isCSSRoundSupported,s=`var(--total-scale-factor) * ${r}px`,c=`var(--total-scale-factor) * ${i}px`,l=o?`round(down, ${s}, var(--scale-round-x))`:`calc(${s})`,u=o?`round(down, ${c}, var(--scale-round-y))`:`calc(${c})`;!n||t.rotation%180==0?(a.width=l,a.height=u):(a.width=u,a.height=l)}r&&e.setAttribute(`data-main-rotation`,t.rotation)}var ax=class e{constructor(){let{pixelRatio:t}=e;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,n,r,i,a=-1){let o=1/0,s=1/0,c=1/0;r=e.capPixels(r,a),r>0&&(o=Math.sqrt(r/(t*n))),i!==-1&&(s=i/t,c=i/n);let l=Math.min(o,s,c);return this.sx>l||this.sy>l?(this.sx=l,this.sy=l,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){let n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,n):n}return e}},ox=[`image/apng`,`image/avif`,`image/bmp`,`image/gif`,`image/jpeg`,`image/png`,`image/svg+xml`,`image/webp`,`image/x-icon`],sx=class e{#toolbar=null;#colorPicker=null;#editor;#buttons=null;#altText=null;#comment=null;#signatureDescriptionButton=null;static#l10nRemove=null;constructor(t){this.#editor=t,e.#l10nRemove||=Object.freeze({freetext:`pdfjs-editor-remove-freetext-button`,highlight:`pdfjs-editor-remove-highlight-button`,ink:`pdfjs-editor-remove-ink-button`,stamp:`pdfjs-editor-remove-stamp-button`,signature:`pdfjs-editor-remove-signature-button`})}render(){let t=this.#toolbar=document.createElement(`div`);t.classList.add(`editToolbar`,`hidden`),t.setAttribute(`role`,`toolbar`);let n=this.#editor._uiManager._signal;n instanceof AbortSignal&&!n.aborted&&(t.addEventListener(`contextmenu`,Yb,{signal:n}),t.addEventListener(`pointerdown`,e.#pointerDown,{signal:n}));let r=this.#buttons=document.createElement(`div`);r.className=`buttons`,t.append(r);let i=this.#editor.toolbarPosition;if(i){let{style:e}=t;e.insetInlineEnd=`${100*(this.#editor._uiManager.direction===`ltr`?1-i[0]:i[0])}%`,e.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#toolbar}static#pointerDown(e){e.stopPropagation()}#focusIn(e){this.#editor._focusEventsAllowed=!1,Xb(e)}#focusOut(e){this.#editor._focusEventsAllowed=!0,Xb(e)}#addListenersToElement(e){let t=this.#editor._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener(`focusin`,this.#focusIn.bind(this),{capture:!0,signal:t}),e.addEventListener(`focusout`,this.#focusOut.bind(this),{capture:!0,signal:t}),e.addEventListener(`contextmenu`,Yb,{signal:t}),!0)}hide(){this.#toolbar.classList.add(`hidden`),this.#colorPicker?.hideDropdown()}show(){this.#toolbar.classList.remove(`hidden`),this.#altText?.shown(),this.#comment?.shown()}addDeleteButton(){let{editorType:t,_uiManager:n}=this.#editor,r=document.createElement(`button`);r.classList.add(`basic`,`deleteButton`),r.tabIndex=0,r.setAttribute(`data-l10n-id`,e.#l10nRemove[t]),this.#addListenersToElement(r)&&r.addEventListener(`click`,e=>{n.delete()},{signal:n._signal}),this.#buttons.append(r)}get#divider(){let e=document.createElement(`div`);return e.className=`divider`,e}async addAltText(e){let t=await e.render();this.#addListenersToElement(t),this.#buttons.append(t,this.#divider),this.#altText=e}addComment(e){if(this.#comment)return;let t=e.render();t&&(this.#addListenersToElement(t),this.#buttons.append(t,this.#divider),this.#comment=e,e.toolbar=this)}addColorPicker(e){if(this.#colorPicker)return;this.#colorPicker=e;let t=e.renderButton();this.#addListenersToElement(t),this.#buttons.append(t,this.#divider)}async addEditSignatureButton(e){let t=this.#signatureDescriptionButton=await e.renderEditButton(this.#editor);this.#addListenersToElement(t),this.#buttons.append(t,this.#divider)}async addButton(e,t){switch(e){case`colorPicker`:this.addColorPicker(t);break;case`altText`:await this.addAltText(t);break;case`editSignature`:await this.addEditSignatureButton(t);break;case`delete`:this.addDeleteButton();break;case`comment`:this.addComment(t);break}}updateEditSignatureButton(e){this.#signatureDescriptionButton&&(this.#signatureDescriptionButton.title=e)}remove(){this.#toolbar.remove(),this.#colorPicker?.destroy(),this.#colorPicker=null}},cx=class{#buttons=null;#toolbar=null;#uiManager;constructor(e){this.#uiManager=e}#render(){let e=this.#toolbar=document.createElement(`div`);e.className=`editToolbar`,e.setAttribute(`role`,`toolbar`);let t=this.#uiManager._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener(`contextmenu`,Yb,{signal:t});let n=this.#buttons=document.createElement(`div`);return n.className=`buttons`,e.append(n),this.#uiManager.hasCommentManager()&&this.#makeButton(`commentButton`,`pdfjs-comment-floating-button`,`pdfjs-comment-floating-button-label`,()=>{this.#uiManager.commentSelection(`floating_button`)}),this.#makeButton(`highlightButton`,`pdfjs-highlight-floating-button1`,`pdfjs-highlight-floating-button-label`,()=>{this.#uiManager.highlightSelection(`floating_button`)}),e}#getLastPoint(e,t){let n=0,r=0;for(let i of e){let e=i.y+i.height;if(e<n)continue;let a=i.x+(t?i.width:0);if(e>n){r=a,n=e;continue}t?a>r&&(r=a):a<r&&(r=a)}return[t?1-r:r,n]}show(e,t,n){let[r,i]=this.#getLastPoint(t,n),{style:a}=this.#toolbar||=this.#render();e.append(this.#toolbar),a.insetInlineEnd=`${100*r}%`,a.top=`calc(${100*i}% + var(--editor-toolbar-vert-offset))`}hide(){this.#toolbar.remove()}#makeButton(e,t,n,r){let i=document.createElement(`button`);i.classList.add(`basic`,e),i.tabIndex=0,i.setAttribute(`data-l10n-id`,t);let a=document.createElement(`span`);i.append(a),a.className=`visuallyHidden`,a.setAttribute(`data-l10n-id`,n);let o=this.#uiManager._signal;o instanceof AbortSignal&&!o.aborted&&(i.addEventListener(`contextmenu`,Yb,{signal:o}),i.addEventListener(`click`,r,{signal:o})),this.#buttons.append(i)}};function lx(e,t,n){for(let r of n)t.addEventListener(r,e[r].bind(e))}var ux=class{#id=0;get id(){return`${qy}${this.#id++}`}},dx=class e{#baseId=Mb();#id=0;#cache=null;static get _isSVGFittingCanvas(){let e=new OffscreenCanvas(1,3).getContext(`2d`,{willReadFrequently:!0}),t=new Image;t.src=`data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>`;let n=t.decode().then(()=>(e.drawImage(t,0,0,1,1,0,0,1,3),new Uint32Array(e.getImageData(0,0,1,1).data.buffer)[0]===0));return pb(this,`_isSVGFittingCanvas`,n)}async#get(t,n){this.#cache||=new Map;let r=this.#cache.get(t);if(r===null)return null;if(r?.bitmap)return r.refCounter+=1,r;try{r||={bitmap:null,id:`image_${this.#baseId}_${this.#id++}`,refCounter:0,isSvg:!1};let t;if(typeof n==`string`?(r.url=n,t=await Bb(n,`blob`)):n instanceof File?t=r.file=n:n instanceof Blob&&(t=n),t.type===`image/svg+xml`){let n=e._isSVGFittingCanvas,i=new FileReader,a=new Image,o=new Promise((e,t)=>{a.onload=()=>{r.bitmap=a,r.isSvg=!0,e()},i.onload=async()=>{let e=r.svgUrl=i.result;a.src=await n?`${e}#svgView(preserveAspectRatio(none))`:e},a.onerror=i.onerror=t});i.readAsDataURL(t),await o}else r.bitmap=await createImageBitmap(t);r.refCounter=1}catch(e){Z(e),r=null}return this.#cache.set(t,r),r&&this.#cache.set(r.id,r),r}async getFromFile(e){let{lastModified:t,name:n,size:r,type:i}=e;return this.#get(`${t}_${n}_${r}_${i}`,e)}async getFromUrl(e){return this.#get(e,e)}async getFromBlob(e,t){let n=await t;return this.#get(e,n)}async getFromId(e){this.#cache||=new Map;let t=this.#cache.get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){let{blobPromise:e}=t;return delete t.blobPromise,this.getFromBlob(t.id,e)}return this.getFromUrl(t.url)}getFromCanvas(e,t){this.#cache||=new Map;let n=this.#cache.get(e);if(n?.bitmap)return n.refCounter+=1,n;let r=new OffscreenCanvas(t.width,t.height);return r.getContext(`2d`).drawImage(t,0,0),n={bitmap:r.transferToImageBitmap(),id:`image_${this.#baseId}_${this.#id++}`,refCounter:1,isSvg:!1},this.#cache.set(e,n),this.#cache.set(n.id,n),n}getSvgUrl(e){let t=this.#cache.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#cache||=new Map;let t=this.#cache.get(e);if(!t||(--t.refCounter,t.refCounter!==0))return;let{bitmap:n}=t;if(!t.url&&!t.file){let e=new OffscreenCanvas(n.width,n.height);e.getContext(`bitmaprenderer`).transferFromImageBitmap(n),t.blobPromise=e.convertToBlob()}n.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#baseId}_`)}},fx=class{#commands=[];#locked=!1;#maxSize;#position=-1;constructor(e=128){this.#maxSize=e}add({cmd:e,undo:t,post:n,mustExec:r,type:i=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(r&&e(),this.#locked)return;let s={cmd:e,undo:t,post:n,type:i};if(this.#position===-1){this.#commands.length>0&&(this.#commands.length=0),this.#position=0,this.#commands.push(s);return}if(a&&this.#commands[this.#position].type===i){o&&(s.undo=this.#commands[this.#position].undo),this.#commands[this.#position]=s;return}let c=this.#position+1;c===this.#maxSize?this.#commands.splice(0,1):(this.#position=c,c<this.#commands.length&&this.#commands.splice(c)),this.#commands.push(s)}undo(){if(this.#position===-1)return;this.#locked=!0;let{undo:e,post:t}=this.#commands[this.#position];e(),t?.(),this.#locked=!1,--this.#position}redo(){if(this.#position<this.#commands.length-1){this.#position+=1,this.#locked=!0;let{cmd:e,post:t}=this.#commands[this.#position];e(),t?.(),this.#locked=!1}}hasSomethingToUndo(){return this.#position!==-1}hasSomethingToRedo(){return this.#position<this.#commands.length-1}cleanType(e){if(this.#position!==-1){for(let t=this.#position;t>=0;t--)if(this.#commands[t].type!==e){this.#commands.splice(t+1,this.#position-t),this.#position=t;return}this.#commands.length=0,this.#position=-1}}destroy(){this.#commands=null}},px=class{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let{isMac:t}=Eb.platform;for(let[n,r,i={}]of e)for(let e of n){let n=e.startsWith(`mac+`);t&&n?(this.callbacks.set(e.slice(4),{callback:r,options:i}),this.allKeys.add(e.split(`+`).at(-1))):!t&&!n&&(this.callbacks.set(e,{callback:r,options:i}),this.allKeys.add(e.split(`+`).at(-1)))}}#serialize(e){e.altKey&&this.buffer.push(`alt`),e.ctrlKey&&this.buffer.push(`ctrl`),e.metaKey&&this.buffer.push(`meta`),e.shiftKey&&this.buffer.push(`shift`),this.buffer.push(e.key);let t=this.buffer.join(`+`);return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;let n=this.callbacks.get(this.#serialize(t));if(!n)return;let{callback:r,options:{bubbles:i=!1,args:a=[],checker:o=null}}=n;o&&!o(e,t)||(r.bind(e,...a,t)(),i||Xb(t))}},mx=class e{static _colorsMapping=new Map([[`CanvasText`,[0,0,0]],[`Canvas`,[255,255,255]]]);get _colors(){let e=new Map([[`CanvasText`,null],[`Canvas`,null]]);return tx(e),pb(this,`_colors`,e)}convert(t){let n=ex(t);if(!window.matchMedia(`(forced-colors: active)`).matches)return n;for(let[t,r]of this._colors)if(r.every((e,t)=>e===n[t]))return e._colorsMapping.get(t);return n}getHexCode(e){let t=this._colors.get(e);return t?Q.makeHexColor(...t):e}},hx=class e{#abortController=new AbortController;#activeEditor=null;#allEditableAnnotations=null;#allEditors=new Map;#allLayers=new Map;#altTextManager=null;#annotationStorage=null;#changedExistingAnnotations=null;#commandManager=new fx;#commentManager=null;#copyPasteAC=null;#currentDrawingSession=null;#currentPageIndex=0;#deletedAnnotationsElementIds=new Set;#draggingEditors=null;#editorTypes=null;#editorsToRescale=new Set;_editorUndoBar=null;#enableHighlightFloatingButton=!1;#enableUpdatedAddImage=!1;#enableNewAltTextWhenAddingImage=!1;#filterFactory=null;#focusMainContainerTimeoutId=null;#focusManagerAC=null;#highlightColors=null;#highlightWhenShiftUp=!1;#floatingToolbar=null;#idManager=new ux;#isEnabled=!1;#isPointerDown=!1;#isWaiting=!1;#keyboardManagerAC=null;#lastActiveElement=null;#mainHighlightColorPicker=null;#missingCanvases=null;#mlManager=null;#mode=X.NONE;#selectedEditors=new Set;#selectedTextNode=null;#signatureManager=null;#pageColors=null;#showAllStates=null;#pdfDocument=null;#previousStates={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#translation=[0,0];#translationTimeoutId=null;#container=null;#viewer=null;#viewerAlert=null;#updateModeCapability=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){let t=e.prototype,n=e=>e.#container.contains(document.activeElement)&&document.activeElement.tagName!==`BUTTON`&&e.hasSomethingToControl(),r=(e,{target:t})=>{if(t instanceof HTMLInputElement){let{type:e}=t;return e!==`text`&&e!==`number`}return!0},i=this.TRANSLATE_SMALL,a=this.TRANSLATE_BIG;return pb(this,`_keyboardManager`,new px([[[`ctrl+a`,`mac+meta+a`],t.selectAll,{checker:r}],[[`ctrl+z`,`mac+meta+z`],t.undo,{checker:r}],[[`ctrl+y`,`ctrl+shift+z`,`mac+meta+shift+z`,`ctrl+shift+Z`,`mac+meta+shift+Z`],t.redo,{checker:r}],[[`Backspace`,`alt+Backspace`,`ctrl+Backspace`,`shift+Backspace`,`mac+Backspace`,`mac+alt+Backspace`,`mac+ctrl+Backspace`,`Delete`,`ctrl+Delete`,`shift+Delete`,`mac+Delete`],t.delete,{checker:r}],[[`Enter`,`mac+Enter`],t.addNewEditorFromKeyboard,{checker:(e,{target:t})=>!(t instanceof HTMLButtonElement)&&e.#container.contains(t)&&!e.isEnterHandled}],[[` `,`mac+ `],t.addNewEditorFromKeyboard,{checker:(e,{target:t})=>!(t instanceof HTMLButtonElement)&&e.#container.contains(document.activeElement)}],[[`Escape`,`mac+Escape`],t.unselectAll],[[`ArrowLeft`,`mac+ArrowLeft`],t.translateSelectedEditors,{args:[-i,0],checker:n}],[[`ctrl+ArrowLeft`,`mac+shift+ArrowLeft`],t.translateSelectedEditors,{args:[-a,0],checker:n}],[[`ArrowRight`,`mac+ArrowRight`],t.translateSelectedEditors,{args:[i,0],checker:n}],[[`ctrl+ArrowRight`,`mac+shift+ArrowRight`],t.translateSelectedEditors,{args:[a,0],checker:n}],[[`ArrowUp`,`mac+ArrowUp`],t.translateSelectedEditors,{args:[0,-i],checker:n}],[[`ctrl+ArrowUp`,`mac+shift+ArrowUp`],t.translateSelectedEditors,{args:[0,-a],checker:n}],[[`ArrowDown`,`mac+ArrowDown`],t.translateSelectedEditors,{args:[0,i],checker:n}],[[`ctrl+ArrowDown`,`mac+shift+ArrowDown`],t.translateSelectedEditors,{args:[0,a],checker:n}]]))}constructor(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h){let g=this._signal=this.#abortController.signal;this.#container=e,this.#viewer=t,this.#viewerAlert=n,this.#altTextManager=r,this.#commentManager=i,this.#signatureManager=a,this.#pdfDocument=s,this._eventBus=o,o._on(`editingaction`,this.onEditingAction.bind(this),{signal:g}),o._on(`pagechanging`,this.onPageChanging.bind(this),{signal:g}),o._on(`scalechanging`,this.onScaleChanging.bind(this),{signal:g}),o._on(`rotationchanging`,this.onRotationChanging.bind(this),{signal:g}),o._on(`setpreference`,this.onSetPreference.bind(this),{signal:g}),o._on(`switchannotationeditorparams`,e=>this.updateParams(e.type,e.value),{signal:g}),window.addEventListener(`pointerdown`,()=>{this.#isPointerDown=!0},{capture:!0,signal:g}),window.addEventListener(`pointerup`,()=>{this.#isPointerDown=!1},{capture:!0,signal:g}),this.#addSelectionListener(),this.#addDragAndDropListeners(),this.#addKeyboardManager(),this.#annotationStorage=s.annotationStorage,this.#filterFactory=s.filterFactory,this.#pageColors=c,this.#highlightColors=l||null,this.#enableHighlightFloatingButton=u,this.#enableUpdatedAddImage=d,this.#enableNewAltTextWhenAddingImage=f,this.#mlManager=p||null,this.viewParameters={realScale:zb.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=m||null,this._supportsPinchToZoom=h!==!1}destroy(){this.#updateModeCapability?.resolve(),this.#updateModeCapability=null,this.#abortController?.abort(),this.#abortController=null,this._signal=null;for(let e of this.#allLayers.values())e.destroy();this.#allLayers.clear(),this.#allEditors.clear(),this.#editorsToRescale.clear(),this.#missingCanvases?.clear(),this.#activeEditor=null,this.#selectedEditors.clear(),this.#commandManager.destroy(),this.#altTextManager?.destroy(),this.#commentManager?.destroy(),this.#signatureManager?.destroy(),this.#floatingToolbar?.hide(),this.#floatingToolbar=null,this.#mainHighlightColorPicker?.destroy(),this.#mainHighlightColorPicker=null,this.#allEditableAnnotations=null,this.#focusMainContainerTimeoutId&&=(clearTimeout(this.#focusMainContainerTimeoutId),null),this.#translationTimeoutId&&=(clearTimeout(this.#translationTimeoutId),null),this._editorUndoBar?.destroy(),this.#pdfDocument=null}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return this.#mlManager}get useNewAltTextFlow(){return this.#enableUpdatedAddImage}get useNewAltTextWhenAddingImage(){return this.#enableNewAltTextWhenAddingImage}get hcmFilter(){return pb(this,`hcmFilter`,this.#pageColors?this.#filterFactory.addHCMFilter(this.#pageColors.foreground,this.#pageColors.background):`none`)}get direction(){return pb(this,`direction`,getComputedStyle(this.#container).direction)}get _highlightColors(){return pb(this,`_highlightColors`,this.#highlightColors?new Map(this.#highlightColors.split(`,`).map(e=>(e=e.split(`=`).map(e=>e.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){let{_highlightColors:e}=this;if(!e)return pb(this,`highlightColors`,null);let t=new Map,n=!!this.#pageColors;for(let[r,i]of e){let e=r.endsWith(`_HCM`);if(n&&e){t.set(r.replace(`_HCM`,``),i);continue}!n&&!e&&t.set(r,i)}return pb(this,`highlightColors`,t)}get highlightColorNames(){return pb(this,`highlightColorNames`,this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;let t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#currentDrawingSession=e}setMainHighlightColorPicker(e){this.#mainHighlightColorPicker=e}editAltText(e,t=!1){this.#altTextManager?.editAltText(this,e,t)}hasCommentManager(){return!!this.#commentManager}editComment(e,t){this.#commentManager?.open(this,e,t)}getSignature(e){this.#signatureManager?.getSignature({uiManager:this,editor:e})}get signatureManager(){return this.#signatureManager}switchToMode(e,t){this._eventBus.on(`annotationeditormodechanged`,t,{once:!0,signal:this._signal}),this._eventBus.dispatch(`showannotationeditorui`,{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch(`setpreference`,{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case`enableNewAltTextWhenAddingImage`:this.#enableNewAltTextWhenAddingImage=t;break}}onPageChanging({pageNumber:e}){this.#currentPageIndex=e-1}focusMainContainer(){this.#container.focus()}findParent(e,t){for(let n of this.#allLayers.values()){let{x:r,y:i,width:a,height:o}=n.div.getBoundingClientRect();if(e>=r&&e<=r+a&&t>=i&&t<=i+o)return n}return null}disableUserSelect(e=!1){this.#viewer.classList.toggle(`noUserSelect`,e)}addShouldRescale(e){this.#editorsToRescale.add(e)}removeShouldRescale(e){this.#editorsToRescale.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*zb.PDF_TO_CSS_UNITS;for(let e of this.#editorsToRescale)e.onScaleChanging();this.#currentDrawingSession?.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}#getAnchorElementForSelection({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e}#getLayerForTextLayer(e){let{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(let t of this.#allLayers.values())if(t.hasTextLayer(e))return t;return null}highlightSelection(e=``,t=!1){let n=document.getSelection();if(!n||n.isCollapsed)return;let{anchorNode:r,anchorOffset:i,focusNode:a,focusOffset:o}=n,s=n.toString(),c=this.#getAnchorElementForSelection(n).closest(`.textLayer`),l=this.getSelectionBoxes(c);if(!l)return;n.empty();let u=this.#getLayerForTextLayer(c),d=this.#mode===X.NONE,f=()=>{let n=u?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:l,anchorNode:r,anchorOffset:i,focusNode:a,focusOffset:o,text:s});d&&this.showAllEditors(`highlight`,!0,!0),t&&n?.editComment()};if(d){this.switchToMode(X.HIGHLIGHT,f);return}f()}commentSelection(e=``){this.highlightSelection(e,!0)}#displayFloatingToolbar(){let e=document.getSelection();if(!e||e.isCollapsed)return;let t=this.#getAnchorElementForSelection(e).closest(`.textLayer`),n=this.getSelectionBoxes(t);n&&(this.#floatingToolbar||=new cx(this),this.#floatingToolbar.show(t,n,this.direction===`ltr`))}addToAnnotationStorage(e){!e.isEmpty()&&this.#annotationStorage&&!this.#annotationStorage.has(e.id)&&this.#annotationStorage.setValue(e.id,e)}a11yAlert(e,t=null){let n=this.#viewerAlert;n&&(n.setAttribute(`data-l10n-id`,e),t?n.setAttribute(`data-l10n-args`,JSON.stringify(t)):n.removeAttribute(`data-l10n-args`))}#selectionChange(){let e=document.getSelection();if(!e||e.isCollapsed){this.#selectedTextNode&&(this.#floatingToolbar?.hide(),this.#selectedTextNode=null,this.#dispatchUpdateStates({hasSelectedText:!1}));return}let{anchorNode:t}=e;if(t===this.#selectedTextNode)return;let n=this.#getAnchorElementForSelection(e).closest(`.textLayer`);if(!n){this.#selectedTextNode&&(this.#floatingToolbar?.hide(),this.#selectedTextNode=null,this.#dispatchUpdateStates({hasSelectedText:!1}));return}if(this.#floatingToolbar?.hide(),this.#selectedTextNode=t,this.#dispatchUpdateStates({hasSelectedText:!0}),!(this.#mode!==X.HIGHLIGHT&&this.#mode!==X.NONE)&&(this.#mode===X.HIGHLIGHT&&this.showAllEditors(`highlight`,!0,!0),this.#highlightWhenShiftUp=this.isShiftKeyDown,!this.isShiftKeyDown)){let e=this.#mode===X.HIGHLIGHT?this.#getLayerForTextLayer(n):null;if(e?.toggleDrawing(),this.#isPointerDown){let t=new AbortController,n=this.combinedSignal(t),r=n=>{n.type===`pointerup`&&n.button!==0||(t.abort(),e?.toggleDrawing(!0),n.type===`pointerup`&&this.#onSelectEnd(`main_toolbar`))};window.addEventListener(`pointerup`,r,{signal:n}),window.addEventListener(`blur`,r,{signal:n})}else e?.toggleDrawing(!0),this.#onSelectEnd(`main_toolbar`)}}#onSelectEnd(e=``){this.#mode===X.HIGHLIGHT?this.highlightSelection(e):this.#enableHighlightFloatingButton&&this.#displayFloatingToolbar()}#addSelectionListener(){document.addEventListener(`selectionchange`,this.#selectionChange.bind(this),{signal:this._signal})}#addFocusManager(){if(this.#focusManagerAC)return;this.#focusManagerAC=new AbortController;let e=this.combinedSignal(this.#focusManagerAC);window.addEventListener(`focus`,this.focus.bind(this),{signal:e}),window.addEventListener(`blur`,this.blur.bind(this),{signal:e})}#removeFocusManager(){this.#focusManagerAC?.abort(),this.#focusManagerAC=null}blur(){if(this.isShiftKeyDown=!1,this.#highlightWhenShiftUp&&(this.#highlightWhenShiftUp=!1,this.#onSelectEnd(`main_toolbar`)),!this.hasSelection)return;let{activeElement:e}=document;for(let t of this.#selectedEditors)if(t.div.contains(e)){this.#lastActiveElement=[t,e],t._focusEventsAllowed=!1;break}}focus(){if(!this.#lastActiveElement)return;let[e,t]=this.#lastActiveElement;this.#lastActiveElement=null,t.addEventListener(`focusin`,()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}#addKeyboardManager(){if(this.#keyboardManagerAC)return;this.#keyboardManagerAC=new AbortController;let e=this.combinedSignal(this.#keyboardManagerAC);window.addEventListener(`keydown`,this.keydown.bind(this),{signal:e}),window.addEventListener(`keyup`,this.keyup.bind(this),{signal:e})}#removeKeyboardManager(){this.#keyboardManagerAC?.abort(),this.#keyboardManagerAC=null}#addCopyPasteListeners(){if(this.#copyPasteAC)return;this.#copyPasteAC=new AbortController;let e=this.combinedSignal(this.#copyPasteAC);document.addEventListener(`copy`,this.copy.bind(this),{signal:e}),document.addEventListener(`cut`,this.cut.bind(this),{signal:e}),document.addEventListener(`paste`,this.paste.bind(this),{signal:e})}#removeCopyPasteListeners(){this.#copyPasteAC?.abort(),this.#copyPasteAC=null}#addDragAndDropListeners(){let e=this._signal;document.addEventListener(`dragover`,this.dragOver.bind(this),{signal:e}),document.addEventListener(`drop`,this.drop.bind(this),{signal:e})}addEditListeners(){this.#addKeyboardManager(),this.#addCopyPasteListeners()}removeEditListeners(){this.#removeKeyboardManager(),this.#removeCopyPasteListeners()}dragOver(e){for(let{type:t}of e.dataTransfer.items)for(let n of this.#editorTypes)if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect=`copy`,e.preventDefault();return}}drop(e){for(let t of e.dataTransfer.items)for(let n of this.#editorTypes)if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){if(e.preventDefault(),this.#activeEditor?.commitOrRemove(),!this.hasSelection)return;let t=[];for(let e of this.#selectedEditors){let n=e.serialize(!0);n&&t.push(n)}t.length!==0&&e.clipboardData.setData(`application/pdfjs`,JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();let{clipboardData:t}=e;for(let e of t.items)for(let t of this.#editorTypes)if(t.isHandlingMimeForPasting(e.type)){t.paste(e,this.currentLayer);return}let n=t.getData(`application/pdfjs`);if(!n)return;try{n=JSON.parse(n)}catch(e){Z(`paste: "${e.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();let r=this.currentLayer;try{let e=[];for(let t of n){let n=await r.deserialize(t);if(!n)return;e.push(n)}this.addCommands({cmd:()=>{for(let t of e)this.#addEditorToLayer(t);this.#selectEditors(e)},undo:()=>{for(let t of e)t.remove()},mustExec:!0})}catch(e){Z(`paste: "${e.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key===`Shift`&&(this.isShiftKeyDown=!0),this.#mode!==X.NONE&&!this.isEditorHandlingKeyboard&&e._keyboardManager.exec(this,t)}keyup(e){this.isShiftKeyDown&&e.key===`Shift`&&(this.isShiftKeyDown=!1,this.#highlightWhenShiftUp&&(this.#highlightWhenShiftUp=!1,this.#onSelectEnd(`main_toolbar`)))}onEditingAction({name:e}){switch(e){case`undo`:case`redo`:case`delete`:case`selectAll`:this[e]();break;case`highlightSelection`:this.highlightSelection(`context_menu`);break;case`commentSelection`:this.commentSelection(`context_menu`);break}}#dispatchUpdateStates(e){Object.entries(e).some(([e,t])=>this.#previousStates[e]!==t)&&(this._eventBus.dispatch(`annotationeditorstateschanged`,{source:this,details:Object.assign(this.#previousStates,e)}),this.#mode===X.HIGHLIGHT&&e.hasSelectedEditor===!1&&this.#dispatchUpdateUI([[Jy.HIGHLIGHT_FREE,!0]]))}#dispatchUpdateUI(e){this._eventBus.dispatch(`annotationeditorparamschanged`,{source:this,details:e})}setEditingState(e){e?(this.#addFocusManager(),this.#addCopyPasteListeners(),this.#dispatchUpdateStates({isEditing:this.#mode!==X.NONE,isEmpty:this.#isEmpty(),hasSomethingToUndo:this.#commandManager.hasSomethingToUndo(),hasSomethingToRedo:this.#commandManager.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#removeFocusManager(),this.#removeCopyPasteListeners(),this.#dispatchUpdateStates({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#editorTypes){this.#editorTypes=e;for(let e of this.#editorTypes)this.#dispatchUpdateUI(e.defaultPropertiesToUpdate)}}getId(){return this.#idManager.id}get currentLayer(){return this.#allLayers.get(this.#currentPageIndex)}getLayer(e){return this.#allLayers.get(e)}get currentPageIndex(){return this.#currentPageIndex}addLayer(e){this.#allLayers.set(e.pageIndex,e),this.#isEnabled?e.enable():e.disable()}removeLayer(e){this.#allLayers.delete(e.pageIndex)}async updateMode(e,t=null,n=!1,r=!1,i=!1){if(this.#mode!==e&&!(this.#updateModeCapability&&(await this.#updateModeCapability.promise,!this.#updateModeCapability))){if(this.#updateModeCapability=Promise.withResolvers(),this.#currentDrawingSession?.commitOrRemove(),this.#mode===X.POPUP&&this.#commentManager?.hideSidebar(),this.#mode=e,e===X.NONE){this.setEditingState(!1),this.#disableAll(),this._editorUndoBar?.hide(),this.#updateModeCapability.resolve();return}e===X.SIGNATURE&&await this.#signatureManager?.loadSignatures(),e===X.POPUP&&(this.#allEditableAnnotations||=await this.#pdfDocument.getAnnotationsByType(new Set(this.#editorTypes.map(e=>e._editorType))),this.#commentManager?.showSidebar(this.#allEditableAnnotations)),this.setEditingState(!0),await this.#enableAll(),this.unselectAll();for(let t of this.#allLayers.values())t.updateMode(e);if(!t){n&&this.addNewEditorFromKeyboard(),this.#updateModeCapability.resolve();return}for(let e of this.#allEditors.values())e.annotationElementId===t||e.id===t?(this.setSelected(e),i?e.editComment():r&&e.enterInEditMode()):e.unselect();this.#updateModeCapability.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==this.#mode&&this._eventBus.dispatch(`switchannotationeditormode`,{source:this,...e})}updateParams(e,t){if(this.#editorTypes){switch(e){case Jy.CREATE:this.currentLayer.addNewEditor(t);return;case Jy.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch(`reporttelemetry`,{source:this,details:{type:`editing`,data:{type:`highlight`,action:`toggle_visibility`}}}),(this.#showAllStates||=new Map).set(e,t),this.showAllEditors(`highlight`,t);break}if(this.hasSelection)for(let n of this.#selectedEditors)n.updateParams(e,t);else for(let n of this.#editorTypes)n.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){for(let n of this.#allEditors.values())n.editorType===e&&n.show(t);(this.#showAllStates?.get(Jy.HIGHLIGHT_SHOW_ALL)??!0)!==t&&this.#dispatchUpdateUI([[Jy.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(this.#isWaiting!==e){this.#isWaiting=e;for(let t of this.#allLayers.values())e?t.disableClick():t.enableClick(),t.div.classList.toggle(`waiting`,e)}}async#enableAll(){if(!this.#isEnabled){this.#isEnabled=!0;let e=[];for(let t of this.#allLayers.values())e.push(t.enable());await Promise.all(e);for(let e of this.#allEditors.values())e.enable()}}#disableAll(){if(this.unselectAll(),this.#isEnabled){this.#isEnabled=!1;for(let e of this.#allLayers.values())e.disable();for(let e of this.#allEditors.values())e.disable()}}getEditors(e){let t=[];for(let n of this.#allEditors.values())n.pageIndex===e&&t.push(n);return t}getEditor(e){return this.#allEditors.get(e)}addEditor(e){this.#allEditors.set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(this.#focusMainContainerTimeoutId&&clearTimeout(this.#focusMainContainerTimeoutId),this.#focusMainContainerTimeoutId=setTimeout(()=>{this.focusMainContainer(),this.#focusMainContainerTimeoutId=null},0)),this.#allEditors.delete(e.id),e.annotationElementId&&this.#missingCanvases?.delete(e.annotationElementId),this.unselect(e),(!e.annotationElementId||!this.#deletedAnnotationsElementIds.has(e.annotationElementId))&&this.#annotationStorage?.remove(e.id)}addDeletedAnnotationElement(e){this.#deletedAnnotationsElementIds.add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return this.#deletedAnnotationsElementIds.has(e)}removeDeletedAnnotationElement(e){this.#deletedAnnotationsElementIds.delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}#addEditorToLayer(e){let t=this.#allLayers.get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}setActiveEditor(e){this.#activeEditor!==e&&(this.#activeEditor=e,e&&this.#dispatchUpdateUI(e.propertiesToUpdate))}get#lastSelectedEditor(){let e=null;for(e of this.#selectedEditors);return e}updateUI(e){this.#lastSelectedEditor===e&&this.#dispatchUpdateUI(e.propertiesToUpdate)}updateUIForDefaultProperties(e){this.#dispatchUpdateUI(e.defaultPropertiesToUpdate)}toggleSelected(e){if(this.#selectedEditors.has(e)){this.#selectedEditors.delete(e),e.unselect(),this.#dispatchUpdateStates({hasSelectedEditor:this.hasSelection});return}this.#selectedEditors.add(e),e.select(),this.#dispatchUpdateUI(e.propertiesToUpdate),this.#dispatchUpdateStates({hasSelectedEditor:!0})}setSelected(e){this.updateToolbar({mode:e.mode,editId:e.id}),this.#currentDrawingSession?.commitOrRemove();for(let t of this.#selectedEditors)t!==e&&t.unselect();this.#selectedEditors.clear(),this.#selectedEditors.add(e),e.select(),this.#dispatchUpdateUI(e.propertiesToUpdate),this.#dispatchUpdateStates({hasSelectedEditor:!0})}isSelected(e){return this.#selectedEditors.has(e)}get firstSelectedEditor(){return this.#selectedEditors.values().next().value}unselect(e){e.unselect(),this.#selectedEditors.delete(e),this.#dispatchUpdateStates({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#selectedEditors.size!==0}get isEnterHandled(){return this.#selectedEditors.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#commandManager.undo(),this.#dispatchUpdateStates({hasSomethingToUndo:this.#commandManager.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#isEmpty()}),this._editorUndoBar?.hide()}redo(){this.#commandManager.redo(),this.#dispatchUpdateStates({hasSomethingToUndo:!0,hasSomethingToRedo:this.#commandManager.hasSomethingToRedo(),isEmpty:this.#isEmpty()})}addCommands(e){this.#commandManager.add(e),this.#dispatchUpdateStates({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#isEmpty()})}cleanUndoStack(e){this.#commandManager.cleanType(e)}#isEmpty(){if(this.#allEditors.size===0)return!0;if(this.#allEditors.size===1)for(let e of this.#allEditors.values())return e.isEmpty();return!1}delete(){this.commitOrRemove();let e=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!e)return;let t=e?[e]:[...this.#selectedEditors],n=()=>{this._editorUndoBar?.show(r,t.length===1?t[0].editorType:t.length);for(let e of t)e.remove()},r=()=>{for(let e of t)this.#addEditorToLayer(e)};this.addCommands({cmd:n,undo:r,mustExec:!0})}commitOrRemove(){this.#activeEditor?.commitOrRemove()}hasSomethingToControl(){return this.#activeEditor||this.hasSelection}#selectEditors(e){for(let e of this.#selectedEditors)e.unselect();this.#selectedEditors.clear();for(let t of e){if(t.isEmpty())continue;this.#selectedEditors.add(t),t.select()}this.#dispatchUpdateStates({hasSelectedEditor:this.hasSelection})}selectAll(){for(let e of this.#selectedEditors)e.commit();this.#selectEditors(this.#allEditors.values())}unselectAll(){if(!(this.#activeEditor&&(this.#activeEditor.commitOrRemove(),this.#mode!==X.NONE))&&!this.#currentDrawingSession?.commitOrRemove()&&this.hasSelection){for(let e of this.#selectedEditors)e.unselect();this.#selectedEditors.clear(),this.#dispatchUpdateStates({hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;this.#translation[0]+=e,this.#translation[1]+=t;let[r,i]=this.#translation,a=[...this.#selectedEditors];this.#translationTimeoutId&&clearTimeout(this.#translationTimeoutId),this.#translationTimeoutId=setTimeout(()=>{this.#translationTimeoutId=null,this.#translation[0]=this.#translation[1]=0,this.addCommands({cmd:()=>{for(let e of a)this.#allEditors.has(e.id)&&(e.translateInPage(r,i),e.translationDone())},undo:()=>{for(let e of a)this.#allEditors.has(e.id)&&(e.translateInPage(-r,-i),e.translationDone())},mustExec:!1})},1e3);for(let n of a)n.translateInPage(e,t),n.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#draggingEditors=new Map;for(let e of this.#selectedEditors)this.#draggingEditors.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#draggingEditors)return!1;this.disableUserSelect(!1);let e=this.#draggingEditors;this.#draggingEditors=null;let t=!1;for(let[{x:n,y:r,pageIndex:i},a]of e)a.newX=n,a.newY=r,a.newPageIndex=i,t||=n!==a.savedX||r!==a.savedY||i!==a.savedPageIndex;if(!t)return!1;let n=(e,t,n,r)=>{if(this.#allEditors.has(e.id)){let i=this.#allLayers.get(r);i?e._setParentAndPosition(i,t,n):(e.pageIndex=r,e.x=t,e.y=n)}};return this.addCommands({cmd:()=>{for(let[t,{newX:r,newY:i,newPageIndex:a}]of e)n(t,r,i,a)},undo:()=>{for(let[t,{savedX:r,savedY:i,savedPageIndex:a}]of e)n(t,r,i,a)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(this.#draggingEditors)for(let n of this.#draggingEditors.keys())n.drag(e,t)}rebuild(e){if(e.parent===null){let t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#selectedEditors.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return this.#activeEditor===e}getActive(){return this.#activeEditor}getMode(){return this.#mode}get imageManager(){return pb(this,`imageManager`,new dx)}getSelectionBoxes(e){if(!e)return null;let t=document.getSelection();for(let n=0,r=t.rangeCount;n<r;n++)if(!e.contains(t.getRangeAt(n).commonAncestorContainer))return null;let{x:n,y:r,width:i,height:a}=e.getBoundingClientRect(),o;switch(e.getAttribute(`data-main-rotation`)){case`90`:o=(e,t,o,s)=>({x:(t-r)/a,y:1-(e+o-n)/i,width:s/a,height:o/i});break;case`180`:o=(e,t,o,s)=>({x:1-(e+o-n)/i,y:1-(t+s-r)/a,width:o/i,height:s/a});break;case`270`:o=(e,t,o,s)=>({x:1-(t+s-r)/a,y:(e-n)/i,width:s/a,height:o/i});break;default:o=(e,t,o,s)=>({x:(e-n)/i,y:(t-r)/a,width:o/i,height:s/a});break}let s=[];for(let e=0,n=t.rangeCount;e<n;e++){let n=t.getRangeAt(e);if(!n.collapsed)for(let{x:e,y:t,width:r,height:i}of n.getClientRects()){if(r===0||i===0)continue;s.push(o(e,t,r,i))}}return s.length===0?null:s}addChangedExistingAnnotation({annotationElementId:e,id:t}){(this.#changedExistingAnnotations||=new Map).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){this.#changedExistingAnnotations?.delete(e)}renderAnnotationElement(e){let t=this.#changedExistingAnnotations?.get(e.data.id);if(!t)return;let n=this.#annotationStorage.getRawValue(t);n&&(this.#mode===X.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}setMissingCanvas(e,t,n){let r=this.#missingCanvases?.get(e);r&&(r.setCanvas(t,n),this.#missingCanvases.delete(e))}addMissingCanvas(e,t){(this.#missingCanvases||=new Map).set(e,t)}},gx=class e{#altText=null;#altTextDecorative=!1;#altTextButton=null;#altTextButtonLabel=null;#altTextTooltip=null;#altTextTooltipTimeout=null;#altTextWasFromKeyBoard=!1;#badge=null;#editor=null;#guessedText=null;#textWithDisclaimer=null;#useNewAltTextFlow=!1;static#l10nNewButton=null;static _l10n=null;constructor(t){this.#editor=t,this.#useNewAltTextFlow=t._uiManager.useNewAltTextFlow,e.#l10nNewButton||=Object.freeze({added:`pdfjs-editor-new-alt-text-added-button`,"added-label":`pdfjs-editor-new-alt-text-added-button-label`,missing:`pdfjs-editor-new-alt-text-missing-button`,"missing-label":`pdfjs-editor-new-alt-text-missing-button-label`,review:`pdfjs-editor-new-alt-text-to-review-button`,"review-label":`pdfjs-editor-new-alt-text-to-review-button-label`})}static initialize(t){e._l10n??=t}async render(){let t=this.#altTextButton=document.createElement(`button`);t.className=`altText`,t.tabIndex=`0`;let n=this.#altTextButtonLabel=document.createElement(`span`);t.append(n),this.#useNewAltTextFlow?(t.classList.add(`new`),t.setAttribute(`data-l10n-id`,e.#l10nNewButton.missing),n.setAttribute(`data-l10n-id`,e.#l10nNewButton[`missing-label`])):(t.setAttribute(`data-l10n-id`,`pdfjs-editor-alt-text-button`),n.setAttribute(`data-l10n-id`,`pdfjs-editor-alt-text-button-label`));let r=this.#editor._uiManager._signal;t.addEventListener(`contextmenu`,Yb,{signal:r}),t.addEventListener(`pointerdown`,e=>e.stopPropagation(),{signal:r});let i=e=>{e.preventDefault(),this.#editor._uiManager.editAltText(this.#editor),this.#useNewAltTextFlow&&this.#editor._reportTelemetry({action:`pdfjs.image.alt_text.image_status_label_clicked`,data:{label:this.#label}})};return t.addEventListener(`click`,i,{capture:!0,signal:r}),t.addEventListener(`keydown`,e=>{e.target===t&&e.key===`Enter`&&(this.#altTextWasFromKeyBoard=!0,i(e))},{signal:r}),await this.#setState(),t}get#label(){return this.#altText&&`added`||this.#altText===null&&this.guessedText&&`review`||`missing`}finish(){this.#altTextButton&&(this.#altTextButton.focus({focusVisible:this.#altTextWasFromKeyBoard}),this.#altTextWasFromKeyBoard=!1)}isEmpty(){return this.#useNewAltTextFlow?this.#altText===null:!this.#altText&&!this.#altTextDecorative}hasData(){return this.#useNewAltTextFlow?this.#altText!==null||!!this.#guessedText:this.isEmpty()}get guessedText(){return this.#guessedText}async setGuessedText(t){this.#altText===null&&(this.#guessedText=t,this.#textWithDisclaimer=await e._l10n.get(`pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer`,{generatedAltText:t}),this.#setState())}toggleAltTextBadge(e=!1){if(!this.#useNewAltTextFlow||this.#altText){this.#badge?.remove(),this.#badge=null;return}if(!this.#badge){let e=this.#badge=document.createElement(`div`);e.className=`noAltTextBadge`,this.#editor.div.append(e)}this.#badge.classList.toggle(`hidden`,!e)}serialize(e){let t=this.#altText;return!e&&this.#guessedText===t&&(t=this.#textWithDisclaimer),{altText:t,decorative:this.#altTextDecorative,guessedText:this.#guessedText,textWithDisclaimer:this.#textWithDisclaimer}}get data(){return{altText:this.#altText,decorative:this.#altTextDecorative}}set data({altText:e,decorative:t,guessedText:n,textWithDisclaimer:r,cancel:i=!1}){n&&(this.#guessedText=n,this.#textWithDisclaimer=r),!(this.#altText===e&&this.#altTextDecorative===t)&&(i||(this.#altText=e,this.#altTextDecorative=t),this.#setState())}toggle(e=!1){this.#altTextButton&&(!e&&this.#altTextTooltipTimeout&&(clearTimeout(this.#altTextTooltipTimeout),this.#altTextTooltipTimeout=null),this.#altTextButton.disabled=!e)}shown(){this.#editor._reportTelemetry({action:`pdfjs.image.alt_text.image_status_label_displayed`,data:{label:this.#label}})}destroy(){this.#altTextButton?.remove(),this.#altTextButton=null,this.#altTextButtonLabel=null,this.#altTextTooltip=null,this.#badge?.remove(),this.#badge=null}async#setState(){let t=this.#altTextButton;if(!t)return;if(this.#useNewAltTextFlow){if(t.classList.toggle(`done`,!!this.#altText),t.setAttribute(`data-l10n-id`,e.#l10nNewButton[this.#label]),this.#altTextButtonLabel?.setAttribute(`data-l10n-id`,e.#l10nNewButton[`${this.#label}-label`]),!this.#altText){this.#altTextTooltip?.remove();return}}else{if(!this.#altText&&!this.#altTextDecorative){t.classList.remove(`done`),this.#altTextTooltip?.remove();return}t.classList.add(`done`),t.setAttribute(`data-l10n-id`,`pdfjs-editor-alt-text-edit-button`)}let n=this.#altTextTooltip;if(!n){this.#altTextTooltip=n=document.createElement(`span`),n.className=`tooltip`,n.setAttribute(`role`,`tooltip`),n.id=`alt-text-tooltip-${this.#editor.id}`;let e=this.#editor._uiManager._signal;e.addEventListener(`abort`,()=>{clearTimeout(this.#altTextTooltipTimeout),this.#altTextTooltipTimeout=null},{once:!0}),t.addEventListener(`mouseenter`,()=>{this.#altTextTooltipTimeout=setTimeout(()=>{this.#altTextTooltipTimeout=null,this.#altTextTooltip.classList.add(`show`),this.#editor._reportTelemetry({action:`alt_text_tooltip`})},100)},{signal:e}),t.addEventListener(`mouseleave`,()=>{this.#altTextTooltipTimeout&&=(clearTimeout(this.#altTextTooltipTimeout),null),this.#altTextTooltip?.classList.remove(`show`)},{signal:e})}this.#altTextDecorative?n.setAttribute(`data-l10n-id`,`pdfjs-editor-alt-text-decorative-tooltip`):(n.removeAttribute(`data-l10n-id`),n.textContent=this.#altText),n.parentNode||t.append(n),this.#editor.getElementForAltText()?.setAttribute(`aria-describedby`,n.id)}},_x=class{#commentButton=null;#commentWasFromKeyBoard=!1;#editor=null;#initialText=null;#text=null;#date=null;#deleted=!1;constructor(e){this.#editor=e,this.toolbar=null}render(){if(!this.#editor._uiManager.hasCommentManager())return null;let e=this.#commentButton=document.createElement(`button`);e.className=`comment`,e.tabIndex=`0`,e.setAttribute(`data-l10n-id`,`pdfjs-editor-edit-comment-button`);let t=this.#editor._uiManager._signal;if(!(t instanceof AbortSignal)||t.aborted)return e;e.addEventListener(`contextmenu`,Yb,{signal:t}),e.addEventListener(`pointerdown`,e=>e.stopPropagation(),{signal:t});let n=e=>{e.preventDefault(),this.edit()};return e.addEventListener(`click`,n,{capture:!0,signal:t}),e.addEventListener(`keydown`,t=>{t.target===e&&t.key===`Enter`&&(this.#commentWasFromKeyBoard=!0,n(t))},{signal:t}),e}edit(){let{bottom:e,left:t,right:n}=this.#editor.getClientDimensions(),r={top:e};this.#editor._uiManager.direction===`ltr`?r.right=n:r.left=t,this.#editor._uiManager.editComment(this.#editor,r)}finish(){this.#commentButton&&(this.#commentButton.focus({focusVisible:this.#commentWasFromKeyBoard}),this.#commentWasFromKeyBoard=!1)}isDeleted(){return this.#deleted||this.#text===``}hasBeenEdited(){return this.isDeleted()||this.#text!==this.#initialText}serialize(){return this.data}get data(){return{text:this.#text,date:this.#date,deleted:this.#deleted}}set data(e){if(e===null){this.#text=``,this.#deleted=!0;return}this.#text=e,this.#date=new Date,this.#deleted=!1}setInitialText(e){this.#initialText=e,this.data=e}toggle(e=!1){this.#commentButton&&(this.#commentButton.disabled=!e)}shown(){}destroy(){this.#commentButton?.remove(),this.#commentButton=null,this.#text=``,this.#date=null,this.#editor=null,this.#commentWasFromKeyBoard=!1,this.#deleted=!1}},vx=class e{#container;#isPinching=!1;#isPinchingStopped=null;#isPinchingDisabled;#onPinchStart;#onPinching;#onPinchEnd;#pointerDownAC=null;#signal;#touchInfo=null;#touchManagerAC;#touchMoveAC=null;constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:n=null,onPinchStart:r=null,onPinching:i=null,onPinchEnd:a=null,signal:o}){this.#container=e,this.#isPinchingStopped=n,this.#isPinchingDisabled=t,this.#onPinchStart=r,this.#onPinching=i,this.#onPinchEnd=a,this.#touchManagerAC=new AbortController,this.#signal=AbortSignal.any([o,this.#touchManagerAC.signal]),e.addEventListener(`touchstart`,this.#onTouchStart.bind(this),{passive:!1,signal:this.#signal})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/ax.pixelRatio}#onTouchStart(e){if(this.#isPinchingDisabled?.())return;if(e.touches.length===1){if(this.#pointerDownAC)return;let e=this.#pointerDownAC=new AbortController,t=AbortSignal.any([this.#signal,e.signal]),n=this.#container,r={capture:!0,signal:t,passive:!1},i=e=>{e.pointerType===`touch`&&(this.#pointerDownAC?.abort(),this.#pointerDownAC=null)};n.addEventListener(`pointerdown`,e=>{e.pointerType===`touch`&&(Xb(e),i(e))},r),n.addEventListener(`pointerup`,i,r),n.addEventListener(`pointercancel`,i,r);return}if(!this.#touchMoveAC){this.#touchMoveAC=new AbortController;let e=AbortSignal.any([this.#signal,this.#touchMoveAC.signal]),t=this.#container,n={signal:e,capture:!1,passive:!1};t.addEventListener(`touchmove`,this.#onTouchMove.bind(this),n);let r=this.#onTouchEnd.bind(this);t.addEventListener(`touchend`,r,n),t.addEventListener(`touchcancel`,r,n),n.capture=!0,t.addEventListener(`pointerdown`,Xb,n),t.addEventListener(`pointermove`,Xb,n),t.addEventListener(`pointercancel`,Xb,n),t.addEventListener(`pointerup`,Xb,n),this.#onPinchStart?.()}if(Xb(e),e.touches.length!==2||this.#isPinchingStopped?.()){this.#touchInfo=null;return}let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),this.#touchInfo={touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY}}#onTouchMove(t){if(!this.#touchInfo||t.touches.length!==2)return;Xb(t);let[n,r]=t.touches;n.identifier>r.identifier&&([n,r]=[r,n]);let{screenX:i,screenY:a}=n,{screenX:o,screenY:s}=r,c=this.#touchInfo,{touch0X:l,touch0Y:u,touch1X:d,touch1Y:f}=c,p=d-l,m=f-u,h=o-i,g=s-a,_=Math.hypot(h,g)||1,v=Math.hypot(p,m)||1;if(!this.#isPinching&&Math.abs(v-_)<=e.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(c.touch0X=i,c.touch0Y=a,c.touch1X=o,c.touch1Y=s,!this.#isPinching){this.#isPinching=!0;return}let y=[(i+o)/2,(a+s)/2];this.#onPinching?.(y,v,_)}#onTouchEnd(e){e.touches.length>=2||(this.#touchMoveAC&&(this.#touchMoveAC.abort(),this.#touchMoveAC=null,this.#onPinchEnd?.()),this.#touchInfo&&(Xb(e),this.#touchInfo=null,this.#isPinching=!1))}destroy(){this.#touchManagerAC?.abort(),this.#touchManagerAC=null,this.#pointerDownAC?.abort(),this.#pointerDownAC=null}},yx=class e{#accessibilityData=null;#allResizerDivs=null;#altText=null;#comment=null;#disabled=!1;#dragPointerId=null;#dragPointerType=``;#keepAspectRatio=!1;#resizersDiv=null;#lastPointerCoords=null;#savedDimensions=null;#focusAC=null;#focusedResizerName=``;#hasBeenClicked=!1;#initialRect=null;#isEditing=!1;#isInEditMode=!1;#isResizerEnabledForKeyboard=!1;#moveInDOMTimeout=null;#prevDragX=0;#prevDragY=0;#telemetryTimeouts=null;#touchManager=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#isDraggable=!1;#zIndex=e._zIndex++;static _borderLineWidth=-1;static _colorManager=new mx;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){let t=e.prototype._resizeWithKeyboard,n=hx.TRANSLATE_SMALL,r=hx.TRANSLATE_BIG;return pb(this,`_resizerKeyboardManager`,new px([[[`ArrowLeft`,`mac+ArrowLeft`],t,{args:[-n,0]}],[[`ctrl+ArrowLeft`,`mac+shift+ArrowLeft`],t,{args:[-r,0]}],[[`ArrowRight`,`mac+ArrowRight`],t,{args:[n,0]}],[[`ctrl+ArrowRight`,`mac+shift+ArrowRight`],t,{args:[r,0]}],[[`ArrowUp`,`mac+ArrowUp`],t,{args:[0,-n]}],[[`ctrl+ArrowUp`,`mac+shift+ArrowUp`],t,{args:[0,-r]}],[[`ArrowDown`,`mac+ArrowDown`],t,{args:[0,n]}],[[`ctrl+ArrowDown`,`mac+shift+ArrowDown`],t,{args:[0,r]}],[[`Escape`,`mac+Escape`],e.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null;let{rotation:t,rawDims:{pageWidth:n,pageHeight:r,pageX:i,pageY:a}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,r],this.pageTranslation=[i,a];let[o,s]=this.parentDimensions;this.x=e.x/o,this.y=e.y/s,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return pb(this,`_defaultLineColor`,this._colorManager.getHexCode(`CanvasText`))}static deleteAnnotationElement(e){let t=new bx({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(t,n){if(e._l10n??=t,e._l10nResizer||=Object.freeze({topLeft:`pdfjs-editor-resizer-top-left`,topMiddle:`pdfjs-editor-resizer-top-middle`,topRight:`pdfjs-editor-resizer-top-right`,middleRight:`pdfjs-editor-resizer-middle-right`,bottomRight:`pdfjs-editor-resizer-bottom-right`,bottomMiddle:`pdfjs-editor-resizer-bottom-middle`,bottomLeft:`pdfjs-editor-resizer-bottom-left`,middleLeft:`pdfjs-editor-resizer-middle-left`}),e._borderLineWidth!==-1)return;let r=getComputedStyle(document.documentElement);e._borderLineWidth=parseFloat(r.getPropertyValue(`--outline-width`))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){cb(`Not implemented`)}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#isDraggable}set _isDraggable(e){this.#isDraggable=e,this.div?.classList.toggle(`draggable`,e)}get isEnterHandled(){return!0}center(){let[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#zIndex}setParent(e){e===null?this.#stopResizing():(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#hasBeenClicked?this.#hasBeenClicked=!1:this.parent.setSelected(this))}focusout(e){this._focusEventsAllowed&&this.isAttachedToDOM&&(e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove()))}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,r){let[i,a]=this.parentDimensions;[n,r]=this.screenToPageTranslation(n,r),this.x=(e+n)/i,this.y=(t+r)/a,this.fixAndSetPosition()}_moveAfterPaste(e,t){let[n,r]=this.parentDimensions;this.setAt(e*n,t*r,this.width*n,this.height*r),this._onTranslated()}#translate([e,t],n,r){[n,r]=this.screenToPageTranslation(n,r),this.x+=n/e,this.y+=r/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,t){this.#translate(this.parentDimensions,e,t)}translateInPage(e,t){this.#initialRect||=[this.x,this.y,this.width,this.height],this.#translate(this.pageDimensions,e,t),this.div.scrollIntoView({block:`nearest`})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){this.#initialRect||=[this.x,this.y,this.width,this.height];let{div:n,parentDimensions:[r,i]}=this;if(this.x+=e/r,this.y+=t/i,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:e,y:t}=this.div.getBoundingClientRect();this.parent.findNewParent(this,e,t)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this,[s,c]=this.getBaseTranslation();a+=s,o+=c;let{style:l}=n;l.left=`${(100*a).toFixed(2)}%`,l.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),n.scrollIntoView({block:`nearest`})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!this.#initialRect&&(this.#initialRect[0]!==this.x||this.#initialRect[1]!==this.y)}get _hasBeenResized(){return!!this.#initialRect&&(this.#initialRect[2]!==this.width||this.#initialRect[3]!==this.height)}getBaseTranslation(){let[t,n]=this.parentDimensions,{_borderLineWidth:r}=e,i=r/t,a=r/n;switch(this.rotation){case 90:return[-i,a];case 180:return[i,a];case 270:return[i,-a];default:return[-i,-a]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){let{div:{style:t},pageDimensions:[n,r]}=this,{x:i,y:a,width:o,height:s}=this;if(o*=n,s*=r,i*=n,a*=r,this._mustFixPosition)switch(e){case 0:i=Fb(i,0,n-o),a=Fb(a,0,r-s);break;case 90:i=Fb(i,0,n-s),a=Fb(a,o,r);break;case 180:i=Fb(i,o,n),a=Fb(a,s,r);break;case 270:i=Fb(i,s,n),a=Fb(a,0,r-o);break}this.x=i/=n,this.y=a/=r;let[c,l]=this.getBaseTranslation();i+=c,a+=l,t.left=`${(100*i).toFixed(2)}%`,t.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}static#rotatePoint(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(t,n){return e.#rotatePoint(t,n,this.parentRotation)}pageTranslationToScreen(t,n){return e.#rotatePoint(t,n,360-this.parentRotation)}#getRotationMatrix(e){switch(e){case 90:{let[e,t]=this.pageDimensions;return[0,-e/t,t/e,0]}case 180:return[-1,0,0,-1];case 270:{let[e,t]=this.pageDimensions;return[0,e/t,-t/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(e,t){let[n,r]=this.parentDimensions,{style:i}=this.div;i.width=`${(100*e/n).toFixed(2)}%`,this.#keepAspectRatio||(i.height=`${(100*t/r).toFixed(2)}%`)}fixDims(){let{style:e}=this.div,{height:t,width:n}=e,r=n.endsWith(`%`),i=!this.#keepAspectRatio&&t.endsWith(`%`);if(r&&i)return;let[a,o]=this.parentDimensions;r||(e.width=`${(100*parseFloat(n)/a).toFixed(2)}%`),!this.#keepAspectRatio&&!i&&(e.height=`${(100*parseFloat(t)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#createResizers(){if(this.#resizersDiv)return;this.#resizersDiv=document.createElement(`div`),this.#resizersDiv.classList.add(`resizers`);let e=this._willKeepAspectRatio?[`topLeft`,`topRight`,`bottomRight`,`bottomLeft`]:[`topLeft`,`topMiddle`,`topRight`,`middleRight`,`bottomRight`,`bottomMiddle`,`bottomLeft`,`middleLeft`],t=this._uiManager._signal;for(let n of e){let e=document.createElement(`div`);this.#resizersDiv.append(e),e.classList.add(`resizer`,n),e.setAttribute(`data-resizer-name`,n),e.addEventListener(`pointerdown`,this.#resizerPointerdown.bind(this,n),{signal:t}),e.addEventListener(`contextmenu`,Yb,{signal:t}),e.tabIndex=-1}this.div.prepend(this.#resizersDiv)}#resizerPointerdown(e,t){t.preventDefault();let{isMac:n}=Eb.platform;if(t.button!==0||t.ctrlKey&&n)return;this.#altText?.toggle(!1);let r=this._isDraggable;this._isDraggable=!1,this.#lastPointerCoords=[t.screenX,t.screenY];let i=new AbortController,a=this._uiManager.combinedSignal(i);this.parent.togglePointerEvents(!1),window.addEventListener(`pointermove`,this.#resizerPointermove.bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener(`touchmove`,Xb,{passive:!1,signal:a}),window.addEventListener(`contextmenu`,Yb,{signal:a}),this.#savedDimensions={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let o=this.parent.div.style.cursor,s=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;let c=()=>{i.abort(),this.parent.togglePointerEvents(!0),this.#altText?.toggle(!0),this._isDraggable=r,this.parent.div.style.cursor=o,this.div.style.cursor=s,this.#addResizeToUndoStack()};window.addEventListener(`pointerup`,c,{signal:a}),window.addEventListener(`blur`,c,{signal:a})}#resize(e,t,n,r){this.width=n,this.height=r,this.x=e,this.y=t;let[i,a]=this.parentDimensions;this.setDims(i*n,a*r),this.fixAndSetPosition(),this._onResized()}_onResized(){}#addResizeToUndoStack(){if(!this.#savedDimensions)return;let{savedX:e,savedY:t,savedWidth:n,savedHeight:r}=this.#savedDimensions;this.#savedDimensions=null;let i=this.x,a=this.y,o=this.width,s=this.height;i===e&&a===t&&o===n&&s===r||this.addCommands({cmd:this.#resize.bind(this,i,a,o,s),undo:this.#resize.bind(this,e,t,n,r),mustExec:!0})}static _round(e){return Math.round(e*1e4)/1e4}#resizerPointermove(t,n){let[r,i]=this.parentDimensions,a=this.x,o=this.y,s=this.width,c=this.height,l=e.MIN_SIZE/r,u=e.MIN_SIZE/i,d=this.#getRotationMatrix(this.rotation),f=(e,t)=>[d[0]*e+d[2]*t,d[1]*e+d[3]*t],p=this.#getRotationMatrix(360-this.rotation),m=(e,t)=>[p[0]*e+p[2]*t,p[1]*e+p[3]*t],h,g,_=!1,v=!1;switch(t){case`topLeft`:_=!0,h=(e,t)=>[0,0],g=(e,t)=>[e,t];break;case`topMiddle`:h=(e,t)=>[e/2,0],g=(e,t)=>[e/2,t];break;case`topRight`:_=!0,h=(e,t)=>[e,0],g=(e,t)=>[0,t];break;case`middleRight`:v=!0,h=(e,t)=>[e,t/2],g=(e,t)=>[0,t/2];break;case`bottomRight`:_=!0,h=(e,t)=>[e,t],g=(e,t)=>[0,0];break;case`bottomMiddle`:h=(e,t)=>[e/2,t],g=(e,t)=>[e/2,0];break;case`bottomLeft`:_=!0,h=(e,t)=>[0,t],g=(e,t)=>[e,0];break;case`middleLeft`:v=!0,h=(e,t)=>[0,t/2],g=(e,t)=>[e,t/2];break}let y=h(s,c),b=g(s,c),x=f(...b),S=e._round(a+x[0]),C=e._round(o+x[1]),w=1,T=1,E,D;if(n.fromKeyboard)({deltaX:E,deltaY:D}=n);else{let{screenX:e,screenY:t}=n,[r,i]=this.#lastPointerCoords;[E,D]=this.screenToPageTranslation(e-r,t-i),this.#lastPointerCoords[0]=e,this.#lastPointerCoords[1]=t}if([E,D]=m(E/r,D/i),_){let e=Math.hypot(s,c);w=T=Math.max(Math.min(Math.hypot(b[0]-y[0]-E,b[1]-y[1]-D)/e,1/s,1/c),l/s,u/c)}else v?w=Fb(Math.abs(b[0]-y[0]-E),l,1)/s:T=Fb(Math.abs(b[1]-y[1]-D),u,1)/c;let O=e._round(s*w),ee=e._round(c*T);x=f(...g(O,ee));let k=S-x[0],te=C-x[1];this.#initialRect||=[this.x,this.y,this.width,this.height],this.width=O,this.height=ee,this.x=k,this.y=te,this.setDims(r*O,i*ee),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#altText?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#isInEditMode)return this._editToolbar;this._editToolbar=new sx(this),this.div.append(this._editToolbar.render());let{toolbarButtons:e}=this;if(e)for(let[t,n]of e)await this._editToolbar.addButton(t,n);return this._editToolbar.addButton(`comment`,this.addCommentButton()),this._editToolbar.addButton(`delete`),this._editToolbar}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#altText?.destroy())}addContainer(e){let t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#altText||(gx.initialize(e._l10n),this.#altText=new gx(this),this.#accessibilityData&&=(this.#altText.data=this.#accessibilityData,null)),this.#altText}get altTextData(){return this.#altText?.data}set altTextData(e){this.#altText&&(this.#altText.data=e)}get guessedAltText(){return this.#altText?.guessedText}async setGuessedAltText(e){await this.#altText?.setGuessedText(e)}serializeAltText(e){return this.#altText?.serialize(e)}hasAltText(){return!!this.#altText&&!this.#altText.isEmpty()}hasAltTextData(){return this.#altText?.hasData()??!1}addCommentButton(){return this.#comment?this.#comment:this.#comment=new _x(this)}get commentColor(){return null}get comment(){let e=this.#comment;return{text:e.data.text,date:e.data.date,deleted:e.isDeleted(),color:this.commentColor}}set comment(e){this.#comment||=new _x(this),this.#comment.data=e}setCommentData(e){this.#comment||=new _x(this),this.#comment.setInitialText(e)}get hasEditedComment(){return this.#comment?.hasBeenEdited()}async editComment(){this.#comment||=new _x(this),this.#comment.edit()}addComment(e){if(this.hasEditedComment){let[,,,t]=e.rect,[n]=this.pageDimensions,[r]=this.pageTranslation,i=r+n+1,a=t-100,o=i+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[i,a,o,t]}}}render(){let e=this.div=document.createElement(`div`);e.setAttribute(`data-editor-rotation`,(360-this.rotation)%360),e.className=this.name,e.setAttribute(`id`,this.id),e.tabIndex=this.#disabled?-1:0,e.setAttribute(`role`,`application`),this.defaultL10nId&&e.setAttribute(`data-l10n-id`,this.defaultL10nId),this._isVisible||e.classList.add(`hidden`),this.setInForeground(),this.#addFocusListeners();let[t,n]=this.parentDimensions;this.parentRotation%180!=0&&(e.style.maxWidth=`${(100*n/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/n).toFixed(2)}%`);let[r,i]=this.getInitialTranslation();return this.translate(r,i),lx(this,e,[`keydown`,`pointerdown`,`dblclick`]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#touchManager||=new vx({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#touchPinchStartCallback.bind(this),onPinching:this.#touchPinchCallback.bind(this),onPinchEnd:this.#touchPinchEndCallback.bind(this),signal:this._uiManager._signal})),this._uiManager._editorUndoBar?.hide(),e}#touchPinchStartCallback(){this.#savedDimensions={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#altText?.toggle(!1),this.parent.togglePointerEvents(!1)}#touchPinchCallback(t,n,r){let i=.7,a=i*(r/n)+1-i;if(a===1)return;let o=this.#getRotationMatrix(this.rotation),s=(e,t)=>[o[0]*e+o[2]*t,o[1]*e+o[3]*t],[c,l]=this.parentDimensions,u=this.x,d=this.y,f=this.width,p=this.height,m=e.MIN_SIZE/c,h=e.MIN_SIZE/l;a=Math.max(Math.min(a,1/f,1/p),m/f,h/p);let g=e._round(f*a),_=e._round(p*a);if(g===f&&_===p)return;this.#initialRect||=[u,d,f,p];let v=s(f/2,p/2),y=e._round(u+v[0]),b=e._round(d+v[1]),x=s(g/2,_/2);this.x=y-x[0],this.y=b-x[1],this.width=g,this.height=_,this.setDims(c*g,l*_),this.fixAndSetPosition(),this._onResizing()}#touchPinchEndCallback(){this.#altText?.toggle(!0),this.parent.togglePointerEvents(!0),this.#addResizeToUndoStack()}pointerdown(e){let{isMac:t}=Eb.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(this.#hasBeenClicked=!0,this._isDraggable){this.#setUpDragSession(e);return}this.#selectOnPointerEvent(e)}#selectOnPointerEvent(e){let{isMac:t}=Eb.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#setUpDragSession(e){let{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1,r=new AbortController,i=this._uiManager.combinedSignal(r),a={capture:!0,passive:!1,signal:i},o=e=>{r.abort(),this.#dragPointerId=null,this.#hasBeenClicked=!1,this._uiManager.endDragSession()||this.#selectOnPointerEvent(e),n&&this._onStopDragging()};t&&(this.#prevDragX=e.clientX,this.#prevDragY=e.clientY,this.#dragPointerId=e.pointerId,this.#dragPointerType=e.pointerType,window.addEventListener(`pointermove`,e=>{n||(n=!0,this._onStartDragging());let{clientX:t,clientY:r,pointerId:i}=e;if(i!==this.#dragPointerId){Xb(e);return}let[a,o]=this.screenToPageTranslation(t-this.#prevDragX,r-this.#prevDragY);this.#prevDragX=t,this.#prevDragY=r,this._uiManager.dragSelectedEditors(a,o)},a),window.addEventListener(`touchmove`,Xb,a),window.addEventListener(`pointerdown`,e=>{e.pointerType===this.#dragPointerType&&(this.#touchManager||e.isPrimary)&&o(e),Xb(e)},a));let s=e=>{if(!this.#dragPointerId||this.#dragPointerId===e.pointerId){o(e);return}Xb(e)};window.addEventListener(`pointerup`,s,{signal:i}),window.addEventListener(`blur`,s,{signal:i})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#moveInDOMTimeout&&clearTimeout(this.#moveInDOMTimeout),this.#moveInDOMTimeout=setTimeout(()=>{this.#moveInDOMTimeout=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,n=this.rotation){let r=this.parentScale,[i,a]=this.pageDimensions,[o,s]=this.pageTranslation,c=e/r,l=t/r,u=this.x*i,d=this.y*a,f=this.width*i,p=this.height*a;switch(n){case 0:return[u+c+o,a-d-l-p+s,u+c+f+o,a-d-l+s];case 90:return[u+l+o,a-d+c+s,u+l+p+o,a-d+c+f+s];case 180:return[u-c-f+o,a-d+l+s,u-c+o,a-d+l+p+s];case 270:return[u-l-p+o,a-d-c-f+s,u-l+o,a-d-c+s];default:throw Error(`Invalid rotation`)}}getRectInCurrentCoords(e,t){let[n,r,i,a]=e,o=i-n,s=a-r;switch(this.rotation){case 0:return[n,t-a,o,s];case 90:return[n,t-r,s,o];case 180:return[i,t-r,o,s];case 270:return[i,t-a,s,o];default:throw Error(`Invalid rotation`)}}getPDFRect(){return this.getRect(0,0)}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#isInEditMode=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#isInEditMode=!1,!0):!1}isInEditMode(){return this.#isInEditMode}shouldGetKeyboardEvents(){return this.#isResizerEnabledForKeyboard}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){let{top:e,left:t,bottom:n,right:r}=this.getClientDimensions(),{innerHeight:i,innerWidth:a}=window;return t<a&&r>0&&e<i&&n>0}#addFocusListeners(){if(this.#focusAC||!this.div)return;this.#focusAC=new AbortController;let e=this._uiManager.combinedSignal(this.#focusAC);this.div.addEventListener(`focusin`,this.focusin.bind(this),{signal:e}),this.div.addEventListener(`focusout`,this.focusout.bind(this),{signal:e})}rebuild(){this.#addFocusListeners()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||``}}serialize(e=!1,t=null){cb(`An editor must be serializable`)}static async deserialize(e,t,n){let r=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n,annotationElementId:e.annotationElementId});r.rotation=e.rotation,r.#accessibilityData=e.accessibilityData,r._isCopy=e.isCopy||!1;let[i,a]=r.pageDimensions,[o,s,c,l]=r.getRectInCurrentCoords(e.rect,a);return r.x=o/i,r.y=s/a,r.width=c/i,r.height=l/a,r}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#focusAC?.abort(),this.#focusAC=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#moveInDOMTimeout&&=(clearTimeout(this.#moveInDOMTimeout),null),this.#stopResizing(),this.removeEditToolbar(),this.#telemetryTimeouts){for(let e of this.#telemetryTimeouts.values())clearTimeout(e);this.#telemetryTimeouts=null}this.parent=null,this.#touchManager?.destroy(),this.#touchManager=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#createResizers(),this.#resizersDiv.classList.remove(`hidden`))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!==`Enter`)return;this._uiManager.setSelected(this),this.#savedDimensions={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let n=this.#resizersDiv.children;if(!this.#allResizerDivs){this.#allResizerDivs=Array.from(n);let t=this.#resizerKeydown.bind(this),r=this.#resizerBlur.bind(this),i=this._uiManager._signal;for(let n of this.#allResizerDivs){let a=n.getAttribute(`data-resizer-name`);n.setAttribute(`role`,`spinbutton`),n.addEventListener(`keydown`,t,{signal:i}),n.addEventListener(`blur`,r,{signal:i}),n.addEventListener(`focus`,this.#resizerFocus.bind(this,a),{signal:i}),n.setAttribute(`data-l10n-id`,e._l10nResizer[a])}}let r=this.#allResizerDivs[0],i=0;for(let e of n){if(e===r)break;i++}let a=(360-this.rotation+this.parentRotation)%360/90*(this.#allResizerDivs.length/4);if(a!==i){if(a<i)for(let e=0;e<i-a;e++)this.#resizersDiv.append(this.#resizersDiv.firstChild);else if(a>i)for(let e=0;e<a-i;e++)this.#resizersDiv.firstChild.before(this.#resizersDiv.lastChild);let t=0;for(let r of n){let n=this.#allResizerDivs[t++].getAttribute(`data-resizer-name`);r.setAttribute(`data-l10n-id`,e._l10nResizer[n])}}this.#setResizerTabIndex(0),this.#isResizerEnabledForKeyboard=!0,this.#resizersDiv.firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#resizerKeydown(t){e._resizerKeyboardManager.exec(this,t)}#resizerBlur(e){this.#isResizerEnabledForKeyboard&&e.relatedTarget?.parentNode!==this.#resizersDiv&&this.#stopResizing()}#resizerFocus(e){this.#focusedResizerName=this.#isResizerEnabledForKeyboard?e:``}#setResizerTabIndex(e){if(this.#allResizerDivs)for(let t of this.#allResizerDivs)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#isResizerEnabledForKeyboard&&this.#resizerPointermove(this.#focusedResizerName,{deltaX:e,deltaY:t,fromKeyboard:!0})}#stopResizing(){this.#isResizerEnabledForKeyboard=!1,this.#setResizerTabIndex(-1),this.#addResizeToUndoStack()}_stopResizingWithKeyboard(){this.#stopResizing(),this.div.focus()}select(){if(!(this.isSelected&&this._editToolbar)){if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add(`selectedEditor`),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains(`selectedEditor`)&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#altText?.toggleAltTextBadge(!1)}}unselect(){this.isSelected&&(this.isSelected=!1,this.#resizersDiv?.classList.add(`hidden`),this.div?.classList.remove(`selectedEditor`),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#altText?.toggleAltTextBadge(!0))}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#isEditing}set isEditing(e){this.#isEditing=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){this.#keepAspectRatio=!0;let n=e/t,{style:r}=this.div;r.aspectRatio=n,r.height=`auto`}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:`added`}}get telemetryFinalData(){return null}_reportTelemetry(t,n=!1){if(n){this.#telemetryTimeouts||=new Map;let{action:n}=t,r=this.#telemetryTimeouts.get(n);r&&clearTimeout(r),r=setTimeout(()=>{this._reportTelemetry(t),this.#telemetryTimeouts.delete(n),this.#telemetryTimeouts.size===0&&(this.#telemetryTimeouts=null)},e._telemetryTimeout),this.#telemetryTimeouts.set(n,r);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch(`reporttelemetry`,{source:this,details:{type:`editing`,data:t}})}show(e=this._isVisible){this.div.classList.toggle(`hidden`,!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#disabled=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#disabled=!0}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(`.annotationContent`);if(!t)t=document.createElement(`div`),t.classList.add(`annotationContent`,this.editorType),e.container.prepend(t);else if(t.nodeName===`CANVAS`){let e=t;t=document.createElement(`div`),t.classList.add(`annotationContent`,this.editorType),e.before(t)}return t}resetAnnotationElement(e){let{firstChild:t}=e.container;t?.nodeName===`DIV`&&t.classList.contains(`annotationContent`)&&t.remove()}},bx=class extends yx{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}},xx=3285377520,Sx=4294901760,Cx=65535,wx=class{constructor(e){this.h1=e?e&4294967295:xx,this.h2=e?e&4294967295:xx}update(e){let t,n;if(typeof e==`string`){t=new Uint8Array(e.length*2),n=0;for(let r=0,i=e.length;r<i;r++){let i=e.charCodeAt(r);i<=255?t[n++]=i:(t[n++]=i>>>8,t[n++]=i&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw Error(`Invalid data format, must be a string or TypedArray.`);let r=n>>2,i=n-r*4,a=new Uint32Array(t.buffer,0,r),o=0,s=0,c=this.h1,l=this.h2,u=3432918353,d=461845907,f=u&Cx,p=d&Cx;for(let e=0;e<r;e++)e&1?(o=a[e],o=o*u&Sx|o*f&Cx,o=o<<15|o>>>17,o=o*d&Sx|o*p&Cx,c^=o,c=c<<13|c>>>19,c=c*5+3864292196):(s=a[e],s=s*u&Sx|s*f&Cx,s=s<<15|s>>>17,s=s*d&Sx|s*p&Cx,l^=s,l=l<<13|l>>>19,l=l*5+3864292196);switch(o=0,i){case 3:o^=t[r*4+2]<<16;case 2:o^=t[r*4+1]<<8;case 1:o^=t[r*4],o=o*u&Sx|o*f&Cx,o=o<<15|o>>>17,o=o*d&Sx|o*p&Cx,r&1?c^=o:l^=o}this.h1=c,this.h2=l}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Sx|e*36045&Cx,t=t*4283543511&Sx|((t<<16|e>>>16)*2950163797&Sx)>>>16,e^=t>>>1,e=e*444984403&Sx|e*60499&Cx,t=t*3301882366&Sx|((t<<16|e>>>16)*3120437893&Sx)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,`0`)+(t>>>0).toString(16).padStart(8,`0`)}},Tx=Object.freeze({map:null,hash:``,transfer:void 0}),Ex=class{#modified=!1;#modifiedIds=null;#storage=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){let n=this.#storage.get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return this.#storage.get(e)}remove(e){if(this.#storage.delete(e),this.#storage.size===0&&this.resetModified(),typeof this.onAnnotationEditor==`function`){for(let e of this.#storage.values())if(e instanceof yx)return;this.onAnnotationEditor(null)}}setValue(e,t){let n=this.#storage.get(e),r=!1;if(n!==void 0)for(let[e,i]of Object.entries(t))n[e]!==i&&(r=!0,n[e]=i);else r=!0,this.#storage.set(e,t);r&&this.#setModified(),t instanceof yx&&typeof this.onAnnotationEditor==`function`&&this.onAnnotationEditor(t.constructor._type)}has(e){return this.#storage.has(e)}get size(){return this.#storage.size}#setModified(){this.#modified||(this.#modified=!0,typeof this.onSetModified==`function`&&this.onSetModified())}resetModified(){this.#modified&&(this.#modified=!1,typeof this.onResetModified==`function`&&this.onResetModified())}get print(){return new Dx(this)}get serializable(){if(this.#storage.size===0)return Tx;let e=new Map,t=new wx,n=[],r=Object.create(null),i=!1;for(let[n,a]of this.#storage){let o=a instanceof yx?a.serialize(!1,r):a;o&&(e.set(n,o),t.update(`${n}:${JSON.stringify(o)}`),i||=!!o.bitmap)}if(i)for(let t of e.values())t.bitmap&&n.push(t.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:Tx}get editorStats(){let e=null,t=new Map;for(let n of this.#storage.values()){if(!(n instanceof yx))continue;let r=n.telemetryFinalData;if(!r)continue;let{type:i}=r;t.has(i)||t.set(i,Object.getPrototypeOf(n).constructor),e||=Object.create(null);let a=e[i]||=new Map;for(let[e,t]of Object.entries(r)){if(e===`type`)continue;let n=a.get(e);n||(n=new Map,a.set(e,n));let r=n.get(t)??0;n.set(t,r+1)}}for(let[n,r]of t)e[n]=r.computeTelemetryFinalData(e[n]);return e}resetModifiedIds(){this.#modifiedIds=null}get modifiedIds(){if(this.#modifiedIds)return this.#modifiedIds;let e=[];for(let t of this.#storage.values()){if(!(t instanceof yx)||!t.annotationElementId||!t.serialize())continue;e.push(t.annotationElementId)}return this.#modifiedIds={ids:new Set(e),hash:e.join(`,`)}}[Symbol.iterator](){return this.#storage.entries()}},Dx=class extends Ex{#serializable;constructor(e){super();let{map:t,hash:n,transfer:r}=e.serializable;this.#serializable={map:structuredClone(t,r?{transfer:r}:null),hash:n,transfer:r}}get print(){cb(`Should not call PrintAnnotationStorage.print`)}get serializable(){return this.#serializable}get modifiedIds(){return pb(this,`modifiedIds`,{ids:new Set,hash:``})}},Ox=class{#systemFonts=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement(`style`),this._document.documentElement.getElementsByTagName(`head`)[0].append(this.styleElement));let t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(let e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#systemFonts.clear(),this.styleElement&&=(this.styleElement.remove(),null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:n}){if(!(!e||this.#systemFonts.has(e.loadedName))){if(lb(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:t,src:r,style:i}=e,a=new FontFace(t,r,i);this.addNativeFontFace(a);try{await a.load(),this.#systemFonts.add(t),n?.(e)}catch{Z(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}cb(`Not implemented: loadSystemFont without the Font Loading API.`)}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){let t=e.createNativeFontFace();if(t){this.addNativeFontFace(t);try{await t.loaded}catch(n){throw Z(`Failed to load font '${t.family}': '${n}'.`),e.disableFontFace=!0,n}}return}let t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(t=>{let n=this._queueLoadingCallback(t);this._prepareFontLoadEvent(e,n)})}}get isFontLoadingAPISupported(){let e=!!this._document?.fonts;return pb(this,`isFontLoadingAPISupported`,e)}get isSyncFontLoadingSupported(){return pb(this,`isSyncFontLoadingSupported`,Hy||Eb.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(lb(!r.done,`completeRequest() cannot be called twice.`),r.done=!0;n.length>0&&n[0].done;){let e=n.shift();setTimeout(e.callback,0)}}let{loadingRequests:n}=this,r={done:!1,complete:t,callback:e};return n.push(r),r}get _loadTestFont(){let e=atob(`T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==`);return pb(this,`_loadTestFont`,e)}_prepareFontLoadEvent(e,t){function n(e,t){return e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3)&255}function r(e,t,n,r){let i=e.substring(0,t),a=e.substring(t+n);return i+r+a}let i,a,o=this._document.createElement(`canvas`);o.width=1,o.height=1;let s=o.getContext(`2d`),c=0;function l(e,t){if(++c>30){Z(`Load test font never loaded.`),t();return}if(s.font=`30px `+e,s.fillText(`.`,0,20),s.getImageData(0,0,1,1).data[3]>0){t();return}setTimeout(l.bind(null,e,t))}let u=`lt${Date.now()}${this.loadTestFontId++}`,d=this._loadTestFont;d=r(d,976,u.length,u);let f=1482184792,p=n(d,16);for(i=0,a=u.length-3;i<a;i+=4)p=p-f+n(u,i)|0;i<u.length&&(p=p-f+n(u+`XXX`,i)|0),d=r(d,16,4,Cb(p));let m=`url(data:font/opentype;base64,${btoa(d)});`,h=`@font-face {font-family:"${u}";src:${m}}`;this.insertRule(h);let g=this._document.createElement(`div`);g.style.visibility=`hidden`,g.style.width=g.style.height=`10px`,g.style.position=`absolute`,g.style.top=g.style.left=`0px`;for(let t of[e.loadedName,u]){let e=this._document.createElement(`span`);e.textContent=`Hi`,e.style.fontFamily=t,g.append(e)}this._document.body.append(g),l(u,()=>{g.remove(),t.complete()})}},kx=class{constructor(e,t=null){for(let t in this.compiledGlyphs=Object.create(null),e)this[t]=e[t];this._inspectFont=t}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{let t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;let e=`url(data:${this.mimetype};base64,${Ib(this.data)});`,t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let n=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(n+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${n}src:${e}}`}return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];let n=this.loadedName+`_path_`+t,r;try{r=e.get(n)}catch(e){Z(`getPathGenerator - ignoring character: "${e}".`)}let i=new Path2D(r||``);return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=i}};function Ax(e){if(e instanceof URL)return e.href;if(typeof e==`string`){if(Hy)return e;let t=URL.parse(e,window.location);if(t)return t.href}throw Error(`Invalid PDF url data: either string or URL-object is expected in the url property.`)}function jx(e){if(Hy&&typeof Buffer<`u`&&e instanceof Buffer)throw Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength)return e;if(typeof e==`string`)return Sb(e);if(e instanceof ArrayBuffer||ArrayBuffer.isView(e)||typeof e==`object`&&!isNaN(e?.length))return new Uint8Array(e);throw Error(`Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.`)}function Mx(e){if(typeof e!=`string`)return null;if(e.endsWith(`/`))return e;throw Error(`Invalid factory url: "${e}" must include trailing slash.`)}var Nx=e=>typeof e==`object`&&Number.isInteger(e?.num)&&e.num>=0&&Number.isInteger(e?.gen)&&e.gen>=0,Px=Pb.bind(null,Nx,e=>typeof e==`object`&&typeof e?.name==`string`),Fx=class{#listeners=new Map;#deferred=Promise.resolve();postMessage(e,t){let n={data:structuredClone(e,t?{transfer:t}:null)};this.#deferred.then(()=>{for(let[e]of this.#listeners)e.call(this,n)})}addEventListener(e,t,n=null){let r=null;if(n?.signal instanceof AbortSignal){let{signal:i}=n;if(i.aborted){Z("LoopbackPort - cannot use an `aborted` signal.");return}let a=()=>this.removeEventListener(e,t);r=()=>i.removeEventListener(`abort`,a),i.addEventListener(`abort`,a)}this.#listeners.set(t,r)}removeEventListener(e,t){this.#listeners.get(t)?.(),this.#listeners.delete(t)}terminate(){for(let[,e]of this.#listeners)e?.();this.#listeners.clear()}},Ix={DATA:1,ERROR:2},Lx={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Rx(){}function zx(e){if(e instanceof bb||e instanceof _b||e instanceof hb||e instanceof vb||e instanceof gb)return e;switch(e instanceof Error||typeof e==`object`&&e||cb(`wrapReason: Expected "reason" to be a (possibly cloned) Error.`),e.name){case`AbortException`:return new bb(e.message);case`InvalidPDFException`:return new _b(e.message);case`PasswordException`:return new hb(e.message,e.code);case`ResponseException`:return new vb(e.message,e.status,e.missing);case`UnknownErrorException`:return new gb(e.message,e.details)}return new gb(e.message,e.toString())}var Bx=class{#messageAC=new AbortController;constructor(e,t,n){this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener(`message`,this.#onMessage.bind(this),{signal:this.#messageAC.signal})}#onMessage({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){this.#processStreamMessage(e);return}if(e.callback){let t=e.callbackId,n=this.callbackCapabilities[t];if(!n)throw Error(`Cannot resolve callback ${t}`);if(delete this.callbackCapabilities[t],e.callback===Ix.DATA)n.resolve(e.data);else if(e.callback===Ix.ERROR)n.reject(zx(e.reason));else throw Error(`Unexpected callback case`);return}let t=this.actionHandler[e.action];if(!t)throw Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){let n=this.sourceName,r=e.sourceName,i=this.comObj;Promise.try(t,e.data).then(function(t){i.postMessage({sourceName:n,targetName:r,callback:Ix.DATA,callbackId:e.callbackId,data:t})},function(t){i.postMessage({sourceName:n,targetName:r,callback:Ix.ERROR,callbackId:e.callbackId,reason:zx(t)})});return}if(e.streamId){this.#createStreamSink(e);return}t(e.data)}on(e,t){let n=this.actionHandler;if(n[e])throw Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){let r=this.callbackId++,i=Promise.withResolvers();this.callbackCapabilities[r]=i;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:r,data:t},n)}catch(e){i.reject(e)}return i.promise}sendWithStream(e,t,n,r){let i=this.streamId++,a=this.sourceName,o=this.targetName,s=this.comObj;return new ReadableStream({start:n=>{let c=Promise.withResolvers();return this.streamControllers[i]={controller:n,startCall:c,pullCall:null,cancelCall:null,isClosed:!1},s.postMessage({sourceName:a,targetName:o,action:e,streamId:i,data:t,desiredSize:n.desiredSize},r),c.promise},pull:e=>{let t=Promise.withResolvers();return this.streamControllers[i].pullCall=t,s.postMessage({sourceName:a,targetName:o,stream:Lx.PULL,streamId:i,desiredSize:e.desiredSize}),t.promise},cancel:e=>{lb(e instanceof Error,`cancel must have a valid reason`);let t=Promise.withResolvers();return this.streamControllers[i].cancelCall=t,this.streamControllers[i].isClosed=!0,s.postMessage({sourceName:a,targetName:o,stream:Lx.CANCEL,streamId:i,reason:zx(e)}),t.promise}},n)}#createStreamSink(e){let t=e.streamId,n=this.sourceName,r=e.sourceName,i=this.comObj,a=this,o=this.actionHandler[e.action],s={enqueue(e,a=1,o){if(this.isCancelled)return;let s=this.desiredSize;this.desiredSize-=a,s>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),i.postMessage({sourceName:n,targetName:r,stream:Lx.ENQUEUE,streamId:t,chunk:e},o)},close(){this.isCancelled||(this.isCancelled=!0,i.postMessage({sourceName:n,targetName:r,stream:Lx.CLOSE,streamId:t}),delete a.streamSinks[t])},error(e){lb(e instanceof Error,`error must have a valid reason`),!this.isCancelled&&(this.isCancelled=!0,i.postMessage({sourceName:n,targetName:r,stream:Lx.ERROR,streamId:t,reason:zx(e)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};s.sinkCapability.resolve(),s.ready=s.sinkCapability.promise,this.streamSinks[t]=s,Promise.try(o,e.data,s).then(function(){i.postMessage({sourceName:n,targetName:r,stream:Lx.START_COMPLETE,streamId:t,success:!0})},function(e){i.postMessage({sourceName:n,targetName:r,stream:Lx.START_COMPLETE,streamId:t,reason:zx(e)})})}#processStreamMessage(e){let t=e.streamId,n=this.sourceName,r=e.sourceName,i=this.comObj,a=this.streamControllers[t],o=this.streamSinks[t];switch(e.stream){case Lx.START_COMPLETE:e.success?a.startCall.resolve():a.startCall.reject(zx(e.reason));break;case Lx.PULL_COMPLETE:e.success?a.pullCall.resolve():a.pullCall.reject(zx(e.reason));break;case Lx.PULL:if(!o){i.postMessage({sourceName:n,targetName:r,stream:Lx.PULL_COMPLETE,streamId:t,success:!0});break}o.desiredSize<=0&&e.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=e.desiredSize,Promise.try(o.onPull||Rx).then(function(){i.postMessage({sourceName:n,targetName:r,stream:Lx.PULL_COMPLETE,streamId:t,success:!0})},function(e){i.postMessage({sourceName:n,targetName:r,stream:Lx.PULL_COMPLETE,streamId:t,reason:zx(e)})});break;case Lx.ENQUEUE:if(lb(a,`enqueue should have stream controller`),a.isClosed)break;a.controller.enqueue(e.chunk);break;case Lx.CLOSE:if(lb(a,`close should have stream controller`),a.isClosed)break;a.isClosed=!0,a.controller.close(),this.#deleteStreamController(a,t);break;case Lx.ERROR:lb(a,`error should have stream controller`),a.controller.error(zx(e.reason)),this.#deleteStreamController(a,t);break;case Lx.CANCEL_COMPLETE:e.success?a.cancelCall.resolve():a.cancelCall.reject(zx(e.reason)),this.#deleteStreamController(a,t);break;case Lx.CANCEL:if(!o)break;let s=zx(e.reason);Promise.try(o.onCancel||Rx,s).then(function(){i.postMessage({sourceName:n,targetName:r,stream:Lx.CANCEL_COMPLETE,streamId:t,success:!0})},function(e){i.postMessage({sourceName:n,targetName:r,stream:Lx.CANCEL_COMPLETE,streamId:t,reason:zx(e)})}),o.sinkCapability.reject(s),o.isCancelled=!0,delete this.streamSinks[t];break;default:throw Error(`Unexpected stream case`)}}async#deleteStreamController(e,t){await Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.#messageAC?.abort(),this.#messageAC=null}},Vx=class{#enableHWA=!1;constructor({enableHWA:e=!1}){this.#enableHWA=e}create(e,t){if(e<=0||t<=0)throw Error(`Invalid canvas size`);let n=this._createCanvas(e,t);return{canvas:n,context:n.getContext(`2d`,{willReadFrequently:!this.#enableHWA})}}reset(e,t,n){if(!e.canvas)throw Error(`Canvas is not specified`);if(t<=0||n<=0)throw Error(`Invalid canvas size`);e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw Error(`Canvas is not specified`);e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){cb("Abstract method `_createCanvas` called.")}},Hx=class extends Vx{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){let n=this._document.createElement(`canvas`);return n.width=e,n.height=t,n}},Ux=class{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw Error(`CMap name must be specified.`);let t=this.baseUrl+e+(this.isCompressed?`.bcmap`:``);return this._fetch(t).then(e=>({cMapData:e,isCompressed:this.isCompressed})).catch(e=>{throw Error(`Unable to load ${this.isCompressed?`binary `:``}CMap at: ${t}`)})}async _fetch(e){cb("Abstract method `_fetch` called.")}},Wx=class extends Ux{async _fetch(e){let t=await Bb(e,this.isCompressed?`arraybuffer`:`text`);return t instanceof ArrayBuffer?new Uint8Array(t):Sb(t)}},Gx=class{addFilter(e){return`none`}addHCMFilter(e,t){return`none`}addAlphaFilter(e){return`none`}addLuminosityFilter(e){return`none`}addHighlightHCMFilter(e,t,n,r,i){return`none`}destroy(e=!1){}},Kx=class extends Gx{#baseUrl;#_cache;#_defs;#docId;#document;#_hcmCache;#id=0;constructor({docId:e,ownerDocument:t=globalThis.document}){super(),this.#docId=e,this.#document=t}get#cache(){return this.#_cache||=new Map}get#hcmCache(){return this.#_hcmCache||=new Map}get#defs(){if(!this.#_defs){let e=this.#document.createElement(`div`),{style:t}=e;t.visibility=`hidden`,t.contain=`strict`,t.width=t.height=0,t.position=`absolute`,t.top=t.left=0,t.zIndex=-1;let n=this.#document.createElementNS(Rb,`svg`);n.setAttribute(`width`,0),n.setAttribute(`height`,0),this.#_defs=this.#document.createElementNS(Rb,`defs`),e.append(n),n.append(this.#_defs),this.#document.body.append(e)}return this.#_defs}#createTables(e){if(e.length===1){let t=e[0],n=Array(256);for(let e=0;e<256;e++)n[e]=t[e]/255;let r=n.join(`,`);return[r,r,r]}let[t,n,r]=e,i=Array(256),a=Array(256),o=Array(256);for(let e=0;e<256;e++)i[e]=t[e]/255,a[e]=n[e]/255,o[e]=r[e]/255;return[i.join(`,`),a.join(`,`),o.join(`,`)]}#createUrl(e){if(this.#baseUrl===void 0){this.#baseUrl=``;let e=this.#document.URL;e!==this.#document.baseURI&&(Ub(e)?Z(`#createUrl: ignore "data:"-URL for performance reasons.`):this.#baseUrl=fb(e,``))}return`url(${this.#baseUrl}#${e})`}addFilter(e){if(!e)return`none`;let t=this.#cache.get(e);if(t)return t;let[n,r,i]=this.#createTables(e),a=e.length===1?n:`${n}${r}${i}`;if(t=this.#cache.get(a),t)return this.#cache.set(e,t),t;let o=`g_${this.#docId}_transfer_map_${this.#id++}`,s=this.#createUrl(o);this.#cache.set(e,s),this.#cache.set(a,s);let c=this.#createFilter(o);return this.#addTransferMapConversion(n,r,i,c),s}addHCMFilter(e,t){let n=`${e}-${t}`,r=`base`,i=this.#hcmCache.get(r);if(i?.key===n||(i?(i.filter?.remove(),i.key=n,i.url=`none`,i.filter=null):(i={key:n,url:`none`,filter:null},this.#hcmCache.set(r,i)),!e||!t))return i.url;let a=this.#getRGB(e);e=Q.makeHexColor(...a);let o=this.#getRGB(t);if(t=Q.makeHexColor(...o),this.#defs.style.color=``,e===`#000000`&&t===`#ffffff`||e===t)return i.url;let s=Array(256);for(let e=0;e<=255;e++){let t=e/255;s[e]=t<=.03928?t/12.92:((t+.055)/1.055)**2.4}let c=s.join(`,`),l=`g_${this.#docId}_hcm_filter`,u=i.filter=this.#createFilter(l);this.#addTransferMapConversion(c,c,c,u),this.#addGrayConversion(u);let d=(e,t)=>{let n=a[e]/255,r=o[e]/255,i=Array(t+1);for(let e=0;e<=t;e++)i[e]=n+e/t*(r-n);return i.join(`,`)};return this.#addTransferMapConversion(d(0,5),d(1,5),d(2,5),u),i.url=this.#createUrl(l),i.url}addAlphaFilter(e){let t=this.#cache.get(e);if(t)return t;let[n]=this.#createTables([e]),r=`alpha_${n}`;if(t=this.#cache.get(r),t)return this.#cache.set(e,t),t;let i=`g_${this.#docId}_alpha_map_${this.#id++}`,a=this.#createUrl(i);this.#cache.set(e,a),this.#cache.set(r,a);let o=this.#createFilter(i);return this.#addTransferMapAlphaConversion(n,o),a}addLuminosityFilter(e){let t=this.#cache.get(e||`luminosity`);if(t)return t;let n,r;if(e?([n]=this.#createTables([e]),r=`luminosity_${n}`):r=`luminosity`,t=this.#cache.get(r),t)return this.#cache.set(e,t),t;let i=`g_${this.#docId}_luminosity_map_${this.#id++}`,a=this.#createUrl(i);this.#cache.set(e,a),this.#cache.set(r,a);let o=this.#createFilter(i);return this.#addLuminosityConversion(o),e&&this.#addTransferMapAlphaConversion(n,o),a}addHighlightHCMFilter(e,t,n,r,i){let a=`${t}-${n}-${r}-${i}`,o=this.#hcmCache.get(e);if(o?.key===a||(o?(o.filter?.remove(),o.key=a,o.url=`none`,o.filter=null):(o={key:a,url:`none`,filter:null},this.#hcmCache.set(e,o)),!t||!n))return o.url;let[s,c]=[t,n].map(this.#getRGB.bind(this)),l=Math.round(.2126*s[0]+.7152*s[1]+.0722*s[2]),u=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[d,f]=[r,i].map(this.#getRGB.bind(this));u<l&&([l,u,d,f]=[u,l,f,d]),this.#defs.style.color=``;let p=(e,t,n)=>{let r=Array(256),i=(u-l)/n,a=e/255,o=(t-e)/(255*n),s=0;for(let e=0;e<=n;e++){let t=Math.round(l+e*i),n=a+e*o;for(let e=s;e<=t;e++)r[e]=n;s=t+1}for(let e=s;e<256;e++)r[e]=r[s-1];return r.join(`,`)},m=`g_${this.#docId}_hcm_${e}_filter`,h=o.filter=this.#createFilter(m);return this.#addGrayConversion(h),this.#addTransferMapConversion(p(d[0],f[0],5),p(d[1],f[1],5),p(d[2],f[2],5),h),o.url=this.#createUrl(m),o.url}destroy(e=!1){e&&this.#_hcmCache?.size||(this.#_defs?.parentNode.parentNode.remove(),this.#_defs=null,this.#_cache?.clear(),this.#_cache=null,this.#_hcmCache?.clear(),this.#_hcmCache=null,this.#id=0)}#addLuminosityConversion(e){let t=this.#document.createElementNS(Rb,`feColorMatrix`);t.setAttribute(`type`,`matrix`),t.setAttribute(`values`,`0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0`),e.append(t)}#addGrayConversion(e){let t=this.#document.createElementNS(Rb,`feColorMatrix`);t.setAttribute(`type`,`matrix`),t.setAttribute(`values`,`0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0`),e.append(t)}#createFilter(e){let t=this.#document.createElementNS(Rb,`filter`);return t.setAttribute(`color-interpolation-filters`,`sRGB`),t.setAttribute(`id`,e),this.#defs.append(t),t}#appendFeFunc(e,t,n){let r=this.#document.createElementNS(Rb,t);r.setAttribute(`type`,`discrete`),r.setAttribute(`tableValues`,n),e.append(r)}#addTransferMapConversion(e,t,n,r){let i=this.#document.createElementNS(Rb,`feComponentTransfer`);r.append(i),this.#appendFeFunc(i,`feFuncR`,e),this.#appendFeFunc(i,`feFuncG`,t),this.#appendFeFunc(i,`feFuncB`,n)}#addTransferMapAlphaConversion(e,t){let n=this.#document.createElementNS(Rb,`feComponentTransfer`);t.append(n),this.#appendFeFunc(n,`feFuncA`,e)}#getRGB(e){return this.#defs.style.color=e,ex(getComputedStyle(this.#defs).getPropertyValue(`color`))}},qx=class{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw Error(`Font filename must be specified.`);let t=`${this.baseUrl}${e}`;return this._fetch(t).catch(e=>{throw Error(`Unable to load font data at: ${t}`)})}async _fetch(e){cb("Abstract method `_fetch` called.")}},Jx=class extends qx{async _fetch(e){let t=await Bb(e,`arraybuffer`);return new Uint8Array(t)}},Yx=class{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw Error(`Wasm filename must be specified.`);let t=`${this.baseUrl}${e}`;return this._fetch(t).catch(e=>{throw Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){cb("Abstract method `_fetch` called.")}},Xx=class extends Yx{async _fetch(e){let t=await Bb(e,`arraybuffer`);return new Uint8Array(t)}};Hy&&Z("Please use the `legacy` build in Node.js environments.");async function Zx(e){let t=await process.getBuiltinModule(`fs`).promises.readFile(e);return new Uint8Array(t)}var Qx=class extends Gx{},$x=class extends Vx{_createCanvas(e,t){return process.getBuiltinModule(`module`).createRequire(import.meta.url)(`@napi-rs/canvas`).createCanvas(e,t)}},eS=class extends Ux{async _fetch(e){return Zx(e)}},tS=class extends qx{async _fetch(e){return Zx(e)}},nS=class extends Yx{async _fetch(e){return Zx(e)}},rS=`__forcedDependency`,iS=class{#simple={__proto__:null};#incremental={__proto__:null,transform:[],moveText:[],sameLineText:[],[rS]:[]};#namedDependencies=new Map;#savesStack=[];#markedContentStack=[];#baseTransformStack=[[1,0,0,1,0,0]];#clipBox=[-1/0,-1/0,1/0,1/0];#pendingBBox=new Float64Array([1/0,1/0,-1/0,-1/0]);#pendingBBoxIdx=-1;#pendingDependencies=new Set;#operations=new Map;#fontBBoxTrustworthy=new Map;#canvasWidth;#canvasHeight;constructor(e){this.#canvasWidth=e.width,this.#canvasHeight=e.height}save(e){return this.#simple={__proto__:this.#simple},this.#incremental={__proto__:this.#incremental,transform:{__proto__:this.#incremental.transform},moveText:{__proto__:this.#incremental.moveText},sameLineText:{__proto__:this.#incremental.sameLineText},[rS]:{__proto__:this.#incremental[rS]}},this.#clipBox={__proto__:this.#clipBox},this.#savesStack.push([e,null]),this}restore(e){let t=Object.getPrototypeOf(this.#simple);if(t===null)return this;this.#simple=t,this.#incremental=Object.getPrototypeOf(this.#incremental),this.#clipBox=Object.getPrototypeOf(this.#clipBox);let n=this.#savesStack.pop();return n!==void 0&&(n[1]=e),this}recordOpenMarker(e){return this.#savesStack.push([e,null]),this}getOpenMarker(){return this.#savesStack.length===0?null:this.#savesStack.at(-1)[0]}recordCloseMarker(e){let t=this.#savesStack.pop();return t!==void 0&&(t[1]=e),this}beginMarkedContent(e){return this.#markedContentStack.push([e,null]),this}endMarkedContent(e){let t=this.#markedContentStack.pop();return t!==void 0&&(t[1]=e),this}pushBaseTransform(e){return this.#baseTransformStack.push(Q.multiplyByDOMMatrix(this.#baseTransformStack.at(-1),e.getTransform())),this}popBaseTransform(){return this.#baseTransformStack.length>1&&this.#baseTransformStack.pop(),this}recordSimpleData(e,t){return this.#simple[e]=t,this}recordIncrementalData(e,t){return this.#incremental[e].push(t),this}resetIncrementalData(e,t){return this.#incremental[e].length=0,this}recordNamedData(e,t){return this.#namedDependencies.set(e,t),this}recordFutureForcedDependency(e,t){return this.recordIncrementalData(rS,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(let t of e)t in this.#simple&&this.recordFutureForcedDependency(t,this.#simple[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(let e of this.#pendingDependencies)this.recordFutureForcedDependency(rS,e);return this}resetBBox(e){return this.#pendingBBoxIdx=e,this.#pendingBBox[0]=1/0,this.#pendingBBox[1]=1/0,this.#pendingBBox[2]=-1/0,this.#pendingBBox[3]=-1/0,this}get hasPendingBBox(){return this.#pendingBBoxIdx!==-1}recordClipBox(e,t,n,r,i,a){let o=Q.multiplyByDOMMatrix(this.#baseTransformStack.at(-1),t.getTransform()),s=[1/0,1/0,-1/0,-1/0];Q.axialAlignedBoundingBox([n,i,r,a],o,s);let c=Q.intersect(this.#clipBox,s);return c?(this.#clipBox[0]=c[0],this.#clipBox[1]=c[1],this.#clipBox[2]=c[2],this.#clipBox[3]=c[3]):(this.#clipBox[0]=this.#clipBox[1]=1/0,this.#clipBox[2]=this.#clipBox[3]=-1/0),this}recordBBox(e,t,n,r,i,a){let o=this.#clipBox;if(o[0]===1/0)return this;let s=Q.multiplyByDOMMatrix(this.#baseTransformStack.at(-1),t.getTransform());if(o[0]===-1/0)return Q.axialAlignedBoundingBox([n,i,r,a],s,this.#pendingBBox),this;let c=[1/0,1/0,-1/0,-1/0];return Q.axialAlignedBoundingBox([n,i,r,a],s,c),this.#pendingBBox[0]=Math.min(this.#pendingBBox[0],Math.max(c[0],o[0])),this.#pendingBBox[1]=Math.min(this.#pendingBBox[1],Math.max(c[1],o[1])),this.#pendingBBox[2]=Math.max(this.#pendingBBox[2],Math.min(c[2],o[2])),this.#pendingBBox[3]=Math.max(this.#pendingBBox[3],Math.min(c[3],o[3])),this}recordCharacterBBox(e,t,n,r=1,i=0,a=0,o){let s=n.bbox,c,l;if(s&&(c=s[2]!==s[0]&&s[3]!==s[1]&&this.#fontBBoxTrustworthy.get(n),c!==!1&&(l=[0,0,0,0],Q.axialAlignedBoundingBox(s,n.fontMatrix,l),(r!==1||i!==0||a!==0)&&Q.scaleMinMax([r,0,0,-r,i,a],l),c)))return this.recordBBox(e,t,l[0],l[2],l[1],l[3]);if(!o)return this.recordFullPageBBox(e);let u=o();return s&&l&&c===void 0&&(c=l[0]<=i-u.actualBoundingBoxLeft&&l[2]>=i+u.actualBoundingBoxRight&&l[1]<=a-u.actualBoundingBoxAscent&&l[3]>=a+u.actualBoundingBoxDescent,this.#fontBBoxTrustworthy.set(n,c),c)?this.recordBBox(e,t,l[0],l[2],l[1],l[3]):this.recordBBox(e,t,i-u.actualBoundingBoxLeft,i+u.actualBoundingBoxRight,a-u.actualBoundingBoxAscent,a+u.actualBoundingBoxDescent)}recordFullPageBBox(e){return this.#pendingBBox[0]=Math.max(0,this.#clipBox[0]),this.#pendingBBox[1]=Math.max(0,this.#clipBox[1]),this.#pendingBBox[2]=Math.min(this.#canvasWidth,this.#clipBox[2]),this.#pendingBBox[3]=Math.min(this.#canvasHeight,this.#clipBox[3]),this}getSimpleIndex(e){return this.#simple[e]}recordDependencies(e,t){let n=this.#pendingDependencies,r=this.#simple,i=this.#incremental;for(let e of t)e in this.#simple?n.add(r[e]):e in i&&i[e].forEach(n.add,n);return this}copyDependenciesFromIncrementalOperation(e,t){let n=this.#operations,r=this.#pendingDependencies;for(let e of this.#incremental[t])n.get(e).dependencies.forEach(r.add,r.add(e));return this}recordNamedDependency(e,t){return this.#namedDependencies.has(t)&&this.#pendingDependencies.add(this.#namedDependencies.get(t)),this}recordOperation(e,t=!1){this.recordDependencies(e,[rS]);let n=new Set(this.#pendingDependencies),r=this.#savesStack.concat(this.#markedContentStack),i=this.#pendingBBoxIdx===e?{minX:this.#pendingBBox[0],minY:this.#pendingBBox[1],maxX:this.#pendingBBox[2],maxY:this.#pendingBBox[3]}:null;return this.#operations.set(e,{bbox:i,pairs:r,dependencies:n}),t||(this.#pendingBBoxIdx=-1),this.#pendingDependencies.clear(),this}bboxToClipBoxDropOperation(e){return this.#pendingBBoxIdx!==-1&&(this.#pendingBBoxIdx=-1,this.#clipBox[0]=Math.max(this.#clipBox[0],this.#pendingBBox[0]),this.#clipBox[1]=Math.max(this.#clipBox[1],this.#pendingBBox[1]),this.#clipBox[2]=Math.min(this.#clipBox[2],this.#pendingBBox[2]),this.#clipBox[3]=Math.min(this.#clipBox[3],this.#pendingBBox[3])),this.#pendingDependencies.clear(),this}_takePendingDependencies(){let e=this.#pendingDependencies;return this.#pendingDependencies=new Set,e}_extractOperation(e){let t=this.#operations.get(e);return this.#operations.delete(e),t}_pushPendingDependencies(e){for(let t of e)this.#pendingDependencies.add(t)}take(){return this.#fontBBoxTrustworthy.clear(),Array.from(this.#operations,([e,{bbox:t,pairs:n,dependencies:r}])=>(n.forEach(e=>e.forEach(r.add,r)),r.delete(e),{minX:(t?.minX??0)/this.#canvasWidth,maxX:(t?.maxX??this.#canvasWidth)/this.#canvasWidth,minY:(t?.minY??0)/this.#canvasHeight,maxY:(t?.maxY??this.#canvasHeight)/this.#canvasHeight,dependencies:Array.from(r).sort((e,t)=>e-t),idx:e}))}},aS=class e{#dependencyTracker;#opIdx;#nestingLevel=0;#outerDependencies;#savesLevel=0;constructor(t,n){if(t instanceof e)return t;this.#dependencyTracker=t,this.#outerDependencies=t._takePendingDependencies(),this.#opIdx=n}save(e){return this.#savesLevel++,this.#dependencyTracker.save(this.#opIdx),this}restore(e){return this.#savesLevel>0&&(this.#dependencyTracker.restore(this.#opIdx),this.#savesLevel--),this}recordOpenMarker(e){return this.#nestingLevel++,this}getOpenMarker(){return this.#nestingLevel>0?this.#opIdx:this.#dependencyTracker.getOpenMarker()}recordCloseMarker(e){return this.#nestingLevel--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return this.#dependencyTracker.pushBaseTransform(e),this}popBaseTransform(){return this.#dependencyTracker.popBaseTransform(),this}recordSimpleData(e,t){return this.#dependencyTracker.recordSimpleData(e,this.#opIdx),this}recordIncrementalData(e,t){return this.#dependencyTracker.recordIncrementalData(e,this.#opIdx),this}resetIncrementalData(e,t){return this.#dependencyTracker.resetIncrementalData(e,this.#opIdx),this}recordNamedData(e,t){return this}recordFutureForcedDependency(e,t){return this.#dependencyTracker.recordFutureForcedDependency(e,this.#opIdx),this}inheritSimpleDataAsFutureForcedDependencies(e){return this.#dependencyTracker.inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#dependencyTracker.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return this.#dependencyTracker.hasPendingBBox||this.#dependencyTracker.resetBBox(this.#opIdx),this}get hasPendingBBox(){return this.#dependencyTracker.hasPendingBBox}recordClipBox(e,t,n,r,i,a){return this.#dependencyTracker.recordClipBox(this.#opIdx,t,n,r,i,a),this}recordBBox(e,t,n,r,i,a){return this.#dependencyTracker.recordBBox(this.#opIdx,t,n,r,i,a),this}recordCharacterBBox(e,t,n,r,i,a,o){return this.#dependencyTracker.recordCharacterBBox(this.#opIdx,t,n,r,i,a,o),this}recordFullPageBBox(e){return this.#dependencyTracker.recordFullPageBBox(this.#opIdx),this}getSimpleIndex(e){return this.#dependencyTracker.getSimpleIndex(e)}recordDependencies(e,t){return this.#dependencyTracker.recordDependencies(this.#opIdx,t),this}copyDependenciesFromIncrementalOperation(e,t){return this.#dependencyTracker.copyDependenciesFromIncrementalOperation(this.#opIdx,t),this}recordNamedDependency(e,t){return this.#dependencyTracker.recordNamedDependency(this.#opIdx,t),this}recordOperation(e){this.#dependencyTracker.recordOperation(this.#opIdx,!0);let t=this.#dependencyTracker._extractOperation(this.#opIdx);for(let e of t.dependencies)this.#outerDependencies.add(e);return this.#outerDependencies.delete(this.#opIdx),this.#outerDependencies.delete(null),this}bboxToClipBoxDropOperation(e){return this.#dependencyTracker.bboxToClipBoxDropOperation(this.#opIdx),this}recordNestedDependencies(){this.#dependencyTracker._pushPendingDependencies(this.#outerDependencies)}take(){throw Error(`Unreachable`)}},oS={stroke:[`path`,`transform`,`filter`,`strokeColor`,`strokeAlpha`,`lineWidth`,`lineCap`,`lineJoin`,`miterLimit`,`dash`],fill:[`path`,`transform`,`filter`,`fillColor`,`fillAlpha`,`globalCompositeOperation`,`SMask`],imageXObject:[`transform`,`SMask`,`filter`,`fillAlpha`,`strokeAlpha`,`globalCompositeOperation`],rawFillPath:[`filter`,`fillColor`,`fillAlpha`],showText:[`transform`,`leading`,`charSpacing`,`wordSpacing`,`hScale`,`textRise`,`moveText`,`textMatrix`,`font`,`filter`,`fillColor`,`textRenderingMode`,`SMask`,`fillAlpha`,`strokeAlpha`,`globalCompositeOperation`],transform:[`transform`],transformAndFill:[`transform`,`fillColor`]},sS={FILL:`Fill`,STROKE:`Stroke`,SHADING:`Shading`};function cS(e,t){if(!t)return;let n=t[2]-t[0],r=t[3]-t[1],i=new Path2D;i.rect(t[0],t[1],n,r),e.clip(i)}var lS=class{isModifyingCurrentTransform(){return!1}getPattern(){cb("Abstract method `getPattern` called.")}},uS=class extends lS{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type===`axial`?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type===`radial`&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let e of this._colorStops)t.addColorStop(e[0],e[1]);return t}getPattern(e,t,n,r){let i;if(r===sS.STROKE||r===sS.FILL){let a=t.current.getClippedPathBoundingBox(r,nx(e))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,s=Math.ceil(a[3]-a[1])||1,c=t.cachedCanvases.getCanvas(`pattern`,o,s),l=c.context;l.clearRect(0,0,l.canvas.width,l.canvas.height),l.beginPath(),l.rect(0,0,l.canvas.width,l.canvas.height),l.translate(-a[0],-a[1]),n=Q.transform(n,[1,0,0,1,a[0],a[1]]),l.transform(...t.baseTransform),this.matrix&&l.transform(...this.matrix),cS(l,this._bbox),l.fillStyle=this._createGradient(l),l.fill(),i=e.createPattern(c.canvas,`no-repeat`);let u=new DOMMatrix(n);i.setTransform(u)}else cS(e,this._bbox),i=this._createGradient(e);return i}};function dS(e,t,n,r,i,a,o,s){let c=t.coords,l=t.colors,u=e.data,d=e.width*4,f;c[n+1]>c[r+1]&&(f=n,n=r,r=f,f=a,a=o,o=f),c[r+1]>c[i+1]&&(f=r,r=i,i=f,f=o,o=s,s=f),c[n+1]>c[r+1]&&(f=n,n=r,r=f,f=a,a=o,o=f);let p=(c[n]+t.offsetX)*t.scaleX,m=(c[n+1]+t.offsetY)*t.scaleY,h=(c[r]+t.offsetX)*t.scaleX,g=(c[r+1]+t.offsetY)*t.scaleY,_=(c[i]+t.offsetX)*t.scaleX,v=(c[i+1]+t.offsetY)*t.scaleY;if(m>=v)return;let y=l[a],b=l[a+1],x=l[a+2],S=l[o],C=l[o+1],w=l[o+2],T=l[s],E=l[s+1],D=l[s+2],O=Math.round(m),ee=Math.round(v),k,te,ne,re,ie,ae,A,j;for(let e=O;e<=ee;e++){if(e<g){let t=e<m?0:(m-e)/(m-g);k=p-(p-h)*t,te=y-(y-S)*t,ne=b-(b-C)*t,re=x-(x-w)*t}else{let t;t=e>v?1:g===v?0:(g-e)/(g-v),k=h-(h-_)*t,te=S-(S-T)*t,ne=C-(C-E)*t,re=w-(w-D)*t}let t;t=e<m?0:e>v?1:(m-e)/(m-v),ie=p-(p-_)*t,ae=y-(y-T)*t,A=b-(b-E)*t,j=x-(x-D)*t;let n=Math.round(Math.min(k,ie)),r=Math.round(Math.max(k,ie)),i=d*e+n*4;for(let e=n;e<=r;e++)t=(k-e)/(k-ie),t<0?t=0:t>1&&(t=1),u[i++]=te-(te-ae)*t|0,u[i++]=ne-(ne-A)*t|0,u[i++]=re-(re-j)*t|0,u[i++]=255}}function fS(e,t,n){let r=t.coords,i=t.colors,a,o;switch(t.type){case`lattice`:let s=t.verticesPerRow,c=Math.floor(r.length/s)-1,l=s-1;for(a=0;a<c;a++){let t=a*s;for(let a=0;a<l;a++,t++)dS(e,n,r[t],r[t+1],r[t+s],i[t],i[t+1],i[t+s]),dS(e,n,r[t+s+1],r[t+1],r[t+s],i[t+s+1],i[t+1],i[t+s])}break;case`triangles`:for(a=0,o=r.length;a<o;a+=3)dS(e,n,r[a],r[a+1],r[a+2],i[a],i[a+1],i[a+2]);break;default:throw Error(`illegal figure`)}}var pS=class extends lS{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,n){let r=1.1,i=3e3,a=Math.floor(this._bounds[0]),o=Math.floor(this._bounds[1]),s=Math.ceil(this._bounds[2])-a,c=Math.ceil(this._bounds[3])-o,l=Math.min(Math.ceil(Math.abs(s*e[0]*r)),i),u=Math.min(Math.ceil(Math.abs(c*e[1]*r)),i),d=s/l,f=c/u,p={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-o,scaleX:1/d,scaleY:1/f},m=l+4,h=u+4,g=n.getCanvas(`mesh`,m,h),_=g.context,v=_.createImageData(l,u);if(t){let e=v.data;for(let n=0,r=e.length;n<r;n+=4)e[n]=t[0],e[n+1]=t[1],e[n+2]=t[2],e[n+3]=255}for(let e of this._figures)fS(v,e,p);return _.putImageData(v,2,2),{canvas:g.canvas,offsetX:a-2*d,offsetY:o-2*f,scaleX:d,scaleY:f}}isModifyingCurrentTransform(){return!0}getPattern(e,t,n,r){cS(e,this._bbox);let i=new Float32Array(2);if(r===sS.SHADING)Q.singularValueDecompose2dScale(nx(e),i);else if(this.matrix){Q.singularValueDecompose2dScale(this.matrix,i);let[e,n]=i;Q.singularValueDecompose2dScale(t.baseTransform,i),i[0]*=e,i[1]*=n}else Q.singularValueDecompose2dScale(t.baseTransform,i);let a=this._createMeshCanvas(i,r===sS.SHADING?null:this._background,t.cachedCanvases);return r!==sS.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(a.offsetX,a.offsetY),e.scale(a.scaleX,a.scaleY),e.createPattern(a.canvas,`no-repeat`)}},mS=class extends lS{getPattern(){return`hotpink`}};function hS(e){switch(e[0]){case`RadialAxial`:return new uS(e);case`Mesh`:return new pS(e);case`Dummy`:return new mS}throw Error(`Unknown IR type: ${e[0]}`)}var gS={COLORED:1,UNCOLORED:2},_S=class e{static MAX_PATTERN_SIZE=3e3;constructor(e,t,n,r){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=n,this.baseTransform=r}createPatternCanvas(e){let{bbox:t,operatorList:n,paintType:r,tilingType:i,color:a,canvasGraphicsFactory:o}=this,{xstep:s,ystep:c}=this;s=Math.abs(s),c=Math.abs(c),sb(`TilingType: `+i);let l=t[0],u=t[1],d=t[2],f=t[3],p=d-l,m=f-u,h=new Float32Array(2);Q.singularValueDecompose2dScale(this.matrix,h);let[g,_]=h;Q.singularValueDecompose2dScale(this.baseTransform,h);let v=g*h[0],y=_*h[1],b=p,x=m,S=!1,C=!1,w=Math.ceil(s*v),T=Math.ceil(c*y),E=Math.ceil(p*v),D=Math.ceil(m*y);w>=E?b=s:S=!0,T>=D?x=c:C=!0;let O=this.getSizeAndScale(b,this.ctx.canvas.width,v),ee=this.getSizeAndScale(x,this.ctx.canvas.height,y),k=e.cachedCanvases.getCanvas(`pattern`,O.size,ee.size),te=k.context,ne=o.createCanvasGraphics(te);if(ne.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(ne,r,a),te.translate(-O.scale*l,-ee.scale*u),ne.transform(0,O.scale,0,0,ee.scale,0,0),te.save(),ne.dependencyTracker?.save(),this.clipBbox(ne,l,u,d,f),ne.baseTransform=nx(ne.ctx),ne.executeOperatorList(n),ne.endDrawing(),ne.dependencyTracker?.restore().recordNestedDependencies?.(),te.restore(),S||C){let t=k.canvas;S&&(b=s),C&&(x=c);let n=this.getSizeAndScale(b,this.ctx.canvas.width,v),r=this.getSizeAndScale(x,this.ctx.canvas.height,y),i=n.size,a=r.size,o=e.cachedCanvases.getCanvas(`pattern-workaround`,i,a),d=o.context,f=S?Math.floor(p/s):0,h=C?Math.floor(m/c):0;for(let e=0;e<=f;e++)for(let n=0;n<=h;n++)d.drawImage(t,i*e,a*n,i,a,0,0,i,a);return{canvas:o.canvas,scaleX:n.scale,scaleY:r.scale,offsetX:l,offsetY:u}}return{canvas:k.canvas,scaleX:O.scale,scaleY:ee.scale,offsetX:l,offsetY:u}}getSizeAndScale(t,n,r){let i=Math.max(e.MAX_PATTERN_SIZE,n),a=Math.ceil(t*r);return a>=i?a=i:r=a/t,{scale:r,size:a}}clipBbox(e,t,n,r,i){let a=r-t,o=i-n;e.ctx.rect(t,n,a,o),Q.axialAlignedBoundingBox([t,n,r,i],nx(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){let r=e.ctx,i=e.current;switch(t){case gS.COLORED:let{fillStyle:e,strokeStyle:a}=this.ctx;r.fillStyle=i.fillColor=e,r.strokeStyle=i.strokeColor=a;break;case gS.UNCOLORED:r.fillStyle=r.strokeStyle=n,i.fillColor=i.strokeColor=n;break;default:throw new yb(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,n,r){let i=n;r!==sS.SHADING&&(i=Q.transform(i,t.baseTransform),this.matrix&&(i=Q.transform(i,this.matrix)));let a=this.createPatternCanvas(t),o=new DOMMatrix(i);o=o.translate(a.offsetX,a.offsetY),o=o.scale(1/a.scaleX,1/a.scaleY);let s=e.createPattern(a.canvas,`repeat`);return s.setTransform(o),s}};function vS({src:e,srcPos:t=0,dest:n,width:r,height:i,nonBlackColor:a=4294967295,inverseDecode:o=!1}){let s=Eb.isLittleEndian?4278190080:255,[c,l]=o?[a,s]:[s,a],u=r>>3,d=r&7,f=e.length;n=new Uint32Array(n.buffer);let p=0;for(let r=0;r<i;r++){for(let r=t+u;t<r;t++){let r=t<f?e[t]:255;n[p++]=r&128?l:c,n[p++]=r&64?l:c,n[p++]=r&32?l:c,n[p++]=r&16?l:c,n[p++]=r&8?l:c,n[p++]=r&4?l:c,n[p++]=r&2?l:c,n[p++]=r&1?l:c}if(d===0)continue;let r=t<f?e[t++]:255;for(let e=0;e<d;e++)n[p++]=r&1<<7-e?l:c}return{srcPos:t,destPos:p}}var yS=16,bS=100,xS=15,SS=10,CS=16,wS=new DOMMatrix,TS=new Float32Array(2),ES=new Float32Array([1/0,1/0,-1/0,-1/0]);function DS(e,t){if(e._removeMirroring)throw Error(`Context is already forwarding operations.`);e.__originalSave=e.save,e.__originalRestore=e.restore,e.__originalRotate=e.rotate,e.__originalScale=e.scale,e.__originalTranslate=e.translate,e.__originalTransform=e.transform,e.__originalSetTransform=e.setTransform,e.__originalResetTransform=e.resetTransform,e.__originalClip=e.clip,e.__originalMoveTo=e.moveTo,e.__originalLineTo=e.lineTo,e.__originalBezierCurveTo=e.bezierCurveTo,e.__originalRect=e.rect,e.__originalClosePath=e.closePath,e.__originalBeginPath=e.beginPath,e._removeMirroring=()=>{e.save=e.__originalSave,e.restore=e.__originalRestore,e.rotate=e.__originalRotate,e.scale=e.__originalScale,e.translate=e.__originalTranslate,e.transform=e.__originalTransform,e.setTransform=e.__originalSetTransform,e.resetTransform=e.__originalResetTransform,e.clip=e.__originalClip,e.moveTo=e.__originalMoveTo,e.lineTo=e.__originalLineTo,e.bezierCurveTo=e.__originalBezierCurveTo,e.rect=e.__originalRect,e.closePath=e.__originalClosePath,e.beginPath=e.__originalBeginPath,delete e._removeMirroring},e.save=function(){t.save(),this.__originalSave()},e.restore=function(){t.restore(),this.__originalRestore()},e.translate=function(e,n){t.translate(e,n),this.__originalTranslate(e,n)},e.scale=function(e,n){t.scale(e,n),this.__originalScale(e,n)},e.transform=function(e,n,r,i,a,o){t.transform(e,n,r,i,a,o),this.__originalTransform(e,n,r,i,a,o)},e.setTransform=function(e,n,r,i,a,o){t.setTransform(e,n,r,i,a,o),this.__originalSetTransform(e,n,r,i,a,o)},e.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},e.rotate=function(e){t.rotate(e),this.__originalRotate(e)},e.clip=function(e){t.clip(e),this.__originalClip(e)},e.moveTo=function(e,n){t.moveTo(e,n),this.__originalMoveTo(e,n)},e.lineTo=function(e,n){t.lineTo(e,n),this.__originalLineTo(e,n)},e.bezierCurveTo=function(e,n,r,i,a,o){t.bezierCurveTo(e,n,r,i,a,o),this.__originalBezierCurveTo(e,n,r,i,a,o)},e.rect=function(e,n,r,i){t.rect(e,n,r,i),this.__originalRect(e,n,r,i)},e.closePath=function(){t.closePath(),this.__originalClosePath()},e.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}var OS=class{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let r;return this.cache[e]===void 0?(r=this.canvasFactory.create(t,n),this.cache[e]=r):(r=this.cache[e],this.canvasFactory.reset(r,t,n)),r}delete(e){delete this.cache[e]}clear(){for(let e in this.cache){let t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}};function kS(e,t,n,r,i,a,o,s,c,l){let[u,d,f,p,m,h]=nx(e);if(d===0&&f===0){let g=o*u+m,_=Math.round(g),v=s*p+h,y=Math.round(v),b=(o+c)*u+m,x=Math.abs(Math.round(b)-_)||1,S=(s+l)*p+h,C=Math.abs(Math.round(S)-y)||1;return e.setTransform(Math.sign(u),0,0,Math.sign(p),_,y),e.drawImage(t,n,r,i,a,0,0,x,C),e.setTransform(u,d,f,p,m,h),[x,C]}if(u===0&&p===0){let g=s*f+m,_=Math.round(g),v=o*d+h,y=Math.round(v),b=(s+l)*f+m,x=Math.abs(Math.round(b)-_)||1,S=(o+c)*d+h,C=Math.abs(Math.round(S)-y)||1;return e.setTransform(0,Math.sign(d),Math.sign(f),0,_,y),e.drawImage(t,n,r,i,a,0,0,C,x),e.setTransform(u,d,f,p,m,h),[C,x]}e.drawImage(t,n,r,i,a,o,s,c,l);let g=Math.hypot(u,d),_=Math.hypot(f,p);return[g*c,_*l]}var AS=class{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=Uy;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=Xy.FILL;textRise=0;fillColor=`#000000`;strokeColor=`#000000`;patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps=`none`;constructor(e,t,n){n?.(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=ES.slice()}clone(){let e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=sS.FILL,t=null){let n=this.minMax.slice();if(e===sS.STROKE){t||cb(`Stroke bounding box must include transform.`),Q.singularValueDecompose2dScale(t,TS);let e=TS[0]*this.lineWidth/2,r=TS[1]*this.lineWidth/2;n[0]-=e,n[1]-=r,n[2]+=e,n[3]+=r}return n}updateClipFromPath(){let e=Q.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(ES,0)}getClippedPathBoundingBox(e=sS.FILL,t=null){return Q.intersect(this.clipBox,this.getPathBoundingBox(e,t))}};function jS(e,t){if(t instanceof ImageData){e.putImageData(t,0,0);return}let n=t.height,r=t.width,i=n%CS,a=(n-i)/CS,o=i===0?a:a+1,s=e.createImageData(r,CS),c=0,l,u=t.data,d=s.data,f,p,m,h;if(t.kind===Zy.GRAYSCALE_1BPP){let t=u.byteLength,n=new Uint32Array(d.buffer,0,d.byteLength>>2),h=n.length,g=r+7>>3,_=4294967295,v=Eb.isLittleEndian?4278190080:255;for(f=0;f<o;f++){for(m=f<a?CS:i,l=0,p=0;p<m;p++){let e=t-c,i=0,a=e>g?r:e*8-7,o=a&-8,s=0,d=0;for(;i<o;i+=8)d=u[c++],n[l++]=d&128?_:v,n[l++]=d&64?_:v,n[l++]=d&32?_:v,n[l++]=d&16?_:v,n[l++]=d&8?_:v,n[l++]=d&4?_:v,n[l++]=d&2?_:v,n[l++]=d&1?_:v;for(;i<a;i++)s===0&&(d=u[c++],s=128),n[l++]=d&s?_:v,s>>=1}for(;l<h;)n[l++]=0;e.putImageData(s,0,f*CS)}}else if(t.kind===Zy.RGBA_32BPP){for(p=0,h=r*CS*4,f=0;f<a;f++)d.set(u.subarray(c,c+h)),c+=h,e.putImageData(s,0,p),p+=CS;f<o&&(h=r*i*4,d.set(u.subarray(c,c+h)),e.putImageData(s,0,p))}else if(t.kind===Zy.RGB_24BPP)for(m=CS,h=r*m,f=0;f<o;f++){for(f>=a&&(m=i,h=r*m),l=0,p=h;p--;)d[l++]=u[c++],d[l++]=u[c++],d[l++]=u[c++],d[l++]=255;e.putImageData(s,0,f*CS)}else throw Error(`bad image kind: ${t.kind}`)}function MS(e,t){if(t.bitmap){e.drawImage(t.bitmap,0,0);return}let n=t.height,r=t.width,i=n%CS,a=(n-i)/CS,o=i===0?a:a+1,s=e.createImageData(r,CS),c=0,l=t.data,u=s.data;for(let t=0;t<o;t++){let n=t<a?CS:i;({srcPos:c}=vS({src:l,srcPos:c,dest:u,width:r,height:n,nonBlackColor:0})),e.putImageData(s,0,t*CS)}}function NS(e,t){for(let n of[`strokeStyle`,`fillStyle`,`fillRule`,`globalAlpha`,`lineWidth`,`lineCap`,`lineJoin`,`miterLimit`,`globalCompositeOperation`,`font`,`filter`])e[n]!==void 0&&(t[n]=e[n]);e.setLineDash!==void 0&&(t.setLineDash(e.getLineDash()),t.lineDashOffset=e.lineDashOffset)}function PS(e){e.strokeStyle=e.fillStyle=`#000000`,e.fillRule=`nonzero`,e.globalAlpha=1,e.lineWidth=1,e.lineCap=`butt`,e.lineJoin=`miter`,e.miterLimit=10,e.globalCompositeOperation=`source-over`,e.font=`10px sans-serif`,e.setLineDash!==void 0&&(e.setLineDash([]),e.lineDashOffset=0);let{filter:t}=e;t!==`none`&&t!==``&&(e.filter=`none`)}function FS(e,t){if(t)return!0;Q.singularValueDecompose2dScale(e,TS);let n=Math.fround(ax.pixelRatio*zb.PDF_TO_CSS_UNITS);return TS[0]<=n&&TS[1]<=n}var IS=[`butt`,`round`,`square`],LS=[`miter`,`round`,`bevel`],RS={},zS={},BS=class e{constructor(e,t,n,r,i,{optionalContentConfig:a,markedContentStack:o=null},s,c,l){this.ctx=e,this.current=new AS(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=r,this.filterFactory=i,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new OS(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=s,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=l??null}getObject(e,t,n=null){return typeof t==`string`?(this.dependencyTracker?.recordNamedDependency(e,t),t.startsWith(`g_`)?this.commonObjs.get(t):this.objs.get(t)):n}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:r=null}){let i=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=r||`#ffffff`,this.ctx.fillRect(0,0,i,a),this.ctx.fillStyle=o,n){let e=this.cachedCanvases.getCanvas(`transparent`,i,a);this.compositeCtx=this.ctx,this.transparentCanvas=e.canvas,this.ctx=e.context,this.ctx.save(),this.ctx.transform(...nx(this.compositeCtx))}this.ctx.save(),PS(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=nx(this.ctx)}executeOperatorList(e,t,n,r,i){let a=e.argsArray,o=e.fnArray,s=t||0,c=a.length;if(c===s)return s;let l=c-s>SS&&typeof n==`function`,u=l?Date.now()+xS:0,d=0,f=this.commonObjs,p=this.objs,m,h;for(;;){if(r!==void 0&&s===r.nextBreakPoint)return r.breakIt(s,n),s;if(!i||i.has(s))if(m=o[s],h=a[s]??null,m!==tb.dependency)h===null?this[m](s):this[m](s,...h);else for(let e of h){this.dependencyTracker?.recordNamedData(e,s);let t=e.startsWith(`g_`)?f:p;if(!t.has(e))return t.get(e,n),s}if(s++,s===c)return s;if(l&&++d>SS){if(Date.now()>u)return n(),s;d=0}}}#restoreInitialState(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&=(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),null)}endDrawing(){this.#restoreInitialState(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let e of this._cachedBitmapsMap.values()){for(let t of e.values())typeof HTMLCanvasElement<`u`&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#drawFilter()}#drawFilter(){if(this.pageColors){let e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!==`none`){let t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){let n=e.width??e.displayWidth,r=e.height??e.displayHeight,i=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),o=n,s=r,c=`prescale1`,l,u;for(;i>2&&o>1||a>2&&s>1;){let t=o,n=s;i>2&&o>1&&(t=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),i/=o/t),a>2&&s>1&&(n=s>=16384?Math.floor(s/2)-1||1:Math.ceil(s)/2,a/=s/n),l=this.cachedCanvases.getCanvas(c,t,n),u=l.context,u.clearRect(0,0,t,n),u.drawImage(e,0,0,o,s,0,0,t,n),e=l.canvas,o=t,s=n,c=c===`prescale1`?`prescale2`:`prescale1`}return{img:e,paintWidth:o,paintHeight:s}}_createMaskCanvas(e,t){let n=this.ctx,{width:r,height:i}=t,a=this.current.fillColor,o=this.current.patternFill,s=nx(n),c,l,u,d;if((t.bitmap||t.data)&&t.count>1){let n=t.bitmap||t.data.buffer;l=JSON.stringify(o?s:[s.slice(0,4),a]),c=this._cachedBitmapsMap.get(n),c||(c=new Map,this._cachedBitmapsMap.set(n,c));let r=c.get(l);if(r&&!o){let t=Math.round(Math.min(s[0],s[2])+s[4]),n=Math.round(Math.min(s[1],s[3])+s[5]);return this.dependencyTracker?.recordDependencies(e,oS.transformAndFill),{canvas:r,offsetX:t,offsetY:n}}u=r}u||(d=this.cachedCanvases.getCanvas(`maskCanvas`,r,i),MS(d.context,t));let f=Q.transform(s,[1/r,0,0,-1/i,0,0]);f=Q.transform(f,[1,0,0,1,0,-i]);let p=ES.slice();Q.axialAlignedBoundingBox([0,0,r,i],f,p);let[m,h,g,_]=p,v=Math.round(g-m)||1,y=Math.round(_-h)||1,b=this.cachedCanvases.getCanvas(`fillCanvas`,v,y),x=b.context,S=m,C=h;x.translate(-S,-C),x.transform(...f),u||(u=this._scaleImage(d.canvas,rx(x)),u=u.img,c&&o&&c.set(l,u)),x.imageSmoothingEnabled=FS(nx(x),t.interpolate),kS(x,u,0,0,u.width,u.height,0,0,r,i),x.globalCompositeOperation=`source-in`;let w=Q.transform(rx(x),[1,0,0,1,-S,-C]);return x.fillStyle=o?a.getPattern(n,this,w,sS.FILL):a,x.fillRect(0,0,r,i),c&&!o&&(this.cachedCanvases.delete(`fillCanvas`),c.set(l,b.canvas)),this.dependencyTracker?.recordDependencies(e,oS.transformAndFill),{canvas:b.canvas,offsetX:Math.round(S),offsetY:Math.round(C)}}setLineWidth(e,t){this.dependencyTracker?.recordSimpleData(`lineWidth`,e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){this.dependencyTracker?.recordSimpleData(`lineCap`,e),this.ctx.lineCap=IS[t]}setLineJoin(e,t){this.dependencyTracker?.recordSimpleData(`lineJoin`,e),this.ctx.lineJoin=LS[t]}setMiterLimit(e,t){this.dependencyTracker?.recordSimpleData(`miterLimit`,e),this.ctx.miterLimit=t}setDash(e,t,n){this.dependencyTracker?.recordSimpleData(`dash`,e);let r=this.ctx;r.setLineDash!==void 0&&(r.setLineDash(t),r.lineDashOffset=n)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){for(let[n,r]of t)switch(n){case`LW`:this.setLineWidth(e,r);break;case`LC`:this.setLineCap(e,r);break;case`LJ`:this.setLineJoin(e,r);break;case`ML`:this.setMiterLimit(e,r);break;case`D`:this.setDash(e,r[0],r[1]);break;case`RI`:this.setRenderingIntent(e,r);break;case`FL`:this.setFlatness(e,r);break;case`Font`:this.setFont(e,r[0],r[1]);break;case`CA`:this.dependencyTracker?.recordSimpleData(`strokeAlpha`,e),this.current.strokeAlpha=r;break;case`ca`:this.dependencyTracker?.recordSimpleData(`fillAlpha`,e),this.ctx.globalAlpha=this.current.fillAlpha=r;break;case`BM`:this.dependencyTracker?.recordSimpleData(`globalCompositeOperation`,e),this.ctx.globalCompositeOperation=r;break;case`SMask`:this.dependencyTracker?.recordSimpleData(`SMask`,e),this.current.activeSMask=r?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case`TR`:this.dependencyTracker?.recordSimpleData(`filter`,e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(r);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw Error(`beginSMaskMode called while already in smask mode`);let t=this.ctx.canvas.width,n=this.ctx.canvas.height,r=`smaskGroupAt`+this.groupLevel,i=this.cachedCanvases.getCanvas(r,t,n);this.suspendedCtx=this.ctx;let a=this.ctx=i.context;a.setTransform(this.suspendedCtx.getTransform()),NS(this.suspendedCtx,a),DS(a,this.suspendedCtx),this.setGState(e,[[`BM`,`source-over`]])}endSMaskMode(){if(!this.inSMaskMode)throw Error(`endSMaskMode called while not in smask mode`);this.ctx._removeMirroring(),NS(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,r){let i=r[0],a=r[1],o=r[2]-i,s=r[3]-a;o===0||s===0||(this.genericComposeSMask(t.context,n,o,s,t.subtype,t.backdrop,t.transferMap,i,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation=`source-over`,e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,r,i,a,o,s,c,l,u){let d=e.canvas,f=s-l,p=c-u;if(a)if(f<0||p<0||f+n>d.width||p+r>d.height){let e=this.cachedCanvases.getCanvas(`maskExtension`,n,r),t=e.context;t.drawImage(d,-f,-p),t.globalCompositeOperation=`destination-atop`,t.fillStyle=a,t.fillRect(0,0,n,r),t.globalCompositeOperation=`source-over`,d=e.canvas,f=p=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);let t=new Path2D;t.rect(f,p,n,r),e.clip(t),e.globalCompositeOperation=`destination-atop`,e.fillStyle=a,e.fillRect(f,p,n,r),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),i===`Alpha`&&o?t.filter=this.filterFactory.addAlphaFilter(o):i===`Luminosity`&&(t.filter=this.filterFactory.addLuminosityFilter(o));let m=new Path2D;m.rect(s,c,n,r),t.clip(m),t.globalCompositeOperation=`destination-in`,t.drawImage(d,f,p,n,r,s,c,n,r),t.restore()}save(e){this.inSMaskMode&&NS(this.ctx,this.suspendedCtx),this.ctx.save();let t=this.current;this.stateStack.push(t),this.current=t.clone(),this.dependencyTracker?.save(e)}restore(e){if(this.dependencyTracker?.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&NS(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,n,r,i,a,o){this.dependencyTracker?.recordIncrementalData(`transform`,e),this.ctx.transform(t,n,r,i,a,o),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n,r){let[i]=n;if(!r){i||=n[0]=new Path2D,this[t](e,i);return}if(this.dependencyTracker!==null){let n=t===tb.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,r[0]-n,r[2]+n,r[1]-n,r[3]+n).recordDependencies(e,[`transform`])}if(!(i instanceof Path2D)){let e=n[0]=new Path2D;for(let t=0,n=i.length;t<n;)switch(i[t++]){case nb.moveTo:e.moveTo(i[t++],i[t++]);break;case nb.lineTo:e.lineTo(i[t++],i[t++]);break;case nb.curveTo:e.bezierCurveTo(i[t++],i[t++],i[t++],i[t++],i[t++],i[t++]);break;case nb.closePath:e.closePath();break;default:Z(`Unrecognized drawing path operator: ${i[t-1]}`);break}i=e}Q.axialAlignedBoundingBox(r,nx(this.ctx),this.current.minMax),this[t](e,i),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,n=!0){let r=this.ctx,i=this.current.strokeColor;if(r.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof i==`object`&&i?.getPattern){let e=i.isModifyingCurrentTransform()?r.getTransform():null;if(r.save(),r.strokeStyle=i.getPattern(r,this,rx(r),sS.STROKE),e){let n=new Path2D;n.addPath(t,r.getTransform().invertSelf().multiplySelf(e)),t=n}this.rescaleAndStroke(t,!1),r.restore()}else this.rescaleAndStroke(t,!0);this.dependencyTracker?.recordDependencies(e,oS.stroke),n&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(sS.STROKE,nx(this.ctx))),r.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,n=!0){let r=this.ctx,i=this.current.fillColor,a=this.current.patternFill,o=!1;if(a){let n=i.isModifyingCurrentTransform()?r.getTransform():null;if(this.dependencyTracker?.save(e),r.save(),r.fillStyle=i.getPattern(r,this,rx(r),sS.FILL),n){let e=new Path2D;e.addPath(t,r.getTransform().invertSelf().multiplySelf(n)),t=e}o=!0}let s=this.current.getClippedPathBoundingBox();this.contentVisible&&s!==null&&(this.pendingEOFill?(r.fill(t,`evenodd`),this.pendingEOFill=!1):r.fill(t)),this.dependencyTracker?.recordDependencies(e,oS.fill),o&&(r.restore(),this.dependencyTracker?.restore(e)),n&&this.consumePath(e,t,s)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){this.ctx.fill(t),this.dependencyTracker?.recordDependencies(e,oS.rawFillPath).recordOperation(e)}clip(e){this.dependencyTracker?.recordFutureForcedDependency(`clipMode`,e),this.pendingClip=RS}eoClip(e){this.dependencyTracker?.recordFutureForcedDependency(`clipMode`,e),this.pendingClip=zS}beginText(e){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(e).resetIncrementalData(`sameLineText`).resetIncrementalData(`moveText`,e)}endText(e){let t=this.pendingTextPaths,n=this.ctx;if(this.dependencyTracker){let{dependencyTracker:n}=this;t!==void 0&&n.recordFutureForcedDependency(`textClip`,n.getOpenMarker()).recordFutureForcedDependency(`textClip`,e),n.recordCloseMarker(e)}if(t!==void 0){let e=new Path2D,r=n.getTransform().invertSelf();for(let{transform:n,x:i,y:a,fontSize:o,path:s}of t){if(!s)continue;e.addPath(s,new DOMMatrix(n).preMultiplySelf(r).translate(i,a).scale(o,-o))}n.clip(e)}delete this.pendingTextPaths}setCharSpacing(e,t){this.dependencyTracker?.recordSimpleData(`charSpacing`,e),this.current.charSpacing=t}setWordSpacing(e,t){this.dependencyTracker?.recordSimpleData(`wordSpacing`,e),this.current.wordSpacing=t}setHScale(e,t){this.dependencyTracker?.recordSimpleData(`hScale`,e),this.current.textHScale=t/100}setLeading(e,t){this.dependencyTracker?.recordSimpleData(`leading`,e),this.current.leading=-t}setFont(e,t,n){this.dependencyTracker?.recordSimpleData(`font`,e).recordNamedDependency(e,t);let r=this.commonObjs.get(t),i=this.current;if(!r)throw Error(`Can't find font for ${t}`);if(i.fontMatrix=r.fontMatrix||Uy,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&Z(`Invalid font matrix for font `+t),n<0?(n=-n,i.fontDirection=-1):i.fontDirection=1,this.current.font=r,this.current.fontSize=n,r.isType3Font)return;let a=r.loadedName||`sans-serif`,o=r.systemFontInfo?.css||`"${a}", ${r.fallbackName}`,s=`normal`;r.black?s=`900`:r.bold&&(s=`bold`);let c=r.italic?`italic`:`normal`,l=n;n<yS?l=yS:n>bS&&(l=bS),this.current.fontSizeScale=n/l,this.ctx.font=`${c} ${s} ${l}px ${o}`}setTextRenderingMode(e,t){this.dependencyTracker?.recordSimpleData(`textRenderingMode`,e),this.current.textRenderingMode=t}setTextRise(e,t){this.dependencyTracker?.recordSimpleData(`textRise`,e),this.current.textRise=t}moveText(e,t,n){this.dependencyTracker?.resetIncrementalData(`sameLineText`).recordIncrementalData(`moveText`,e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=n}setLeadingMoveText(e,t,n){this.setLeading(e,-n),this.moveText(e,t,n)}setTextMatrix(e,t){this.dependencyTracker?.recordSimpleData(`textMatrix`,e);let{current:n}=this;n.textMatrix=t,n.textMatrixScale=Math.hypot(t[0],t[1]),n.x=n.lineX=0,n.y=n.lineY=0}nextLine(e){this.moveText(e,0,this.current.leading),this.dependencyTracker?.recordIncrementalData(`moveText`,this.dependencyTracker.getSimpleIndex(`leading`)??e)}#getScaledPath(e,t,n){let r=new Path2D;return r.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),r}paintChar(e,t,n,r,i,a){let o=this.ctx,s=this.current,c=s.font,l=s.textRenderingMode,u=s.fontSize/s.fontSizeScale,d=l&Xy.FILL_STROKE_MASK,f=!!(l&Xy.ADD_TO_PATH_FLAG),p=s.patternFill&&!c.missingFile,m=s.patternStroke&&!c.missingFile,h;if((c.disableFontFace||f||p||m)&&!c.missingFile&&(h=c.getPathGenerator(this.commonObjs,t)),h&&(c.disableFontFace||p||m)){o.save(),o.translate(n,r),o.scale(u,-u),this.dependencyTracker?.recordCharacterBBox(e,o,c);let t;if(d===Xy.FILL||d===Xy.FILL_STROKE)if(i){t=o.getTransform(),o.setTransform(...i);let e=this.#getScaledPath(h,t,i);o.fill(e)}else o.fill(h);if(d===Xy.STROKE||d===Xy.FILL_STROKE)if(a){t||=o.getTransform(),o.setTransform(...a);let{a:e,b:n,c:r,d:i}=t,s=Q.inverseTransform(a),c=Q.transform([e,n,r,i,0,0],s);Q.singularValueDecompose2dScale(c,TS),o.lineWidth*=Math.max(TS[0],TS[1])/u,o.stroke(this.#getScaledPath(h,t,a))}else o.lineWidth/=u,o.stroke(h);o.restore()}else (d===Xy.FILL||d===Xy.FILL_STROKE)&&(o.fillText(t,n,r),this.dependencyTracker?.recordCharacterBBox(e,o,c,u,n,r,()=>o.measureText(t))),(d===Xy.STROKE||d===Xy.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(e,o,c,u,n,r,()=>o.measureText(t)).recordDependencies(e,oS.stroke),o.strokeText(t,n,r));f&&((this.pendingTextPaths||=[]).push({transform:nx(o),x:n,y:r,fontSize:u,path:h}),this.dependencyTracker?.recordCharacterBBox(e,o,c,u,n,r))}get isFontSubpixelAAEnabled(){let{context:e}=this.cachedCanvases.getCanvas(`isFontSubpixelAAEnabled`,10,10);e.scale(1.5,1),e.fillText(`I`,0,10);let t=e.getImageData(0,0,10,10).data,n=!1;for(let e=3;e<t.length;e+=4)if(t[e]>0&&t[e]<255){n=!0;break}return pb(this,`isFontSubpixelAAEnabled`,n)}showText(e,t){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,oS.showText).copyDependenciesFromIncrementalOperation(e,`sameLineText`).resetBBox(e),this.current.textRenderingMode&Xy.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency(`textClip`,e).inheritPendingDependenciesAsFutureForcedDependencies());let n=this.current,r=n.font;if(r.isType3Font){this.showType3Text(e,t),this.dependencyTracker?.recordOperation(e).recordIncrementalData(`sameLineText`,e);return}let i=n.fontSize;if(i===0){this.dependencyTracker?.recordOperation(e);return}let a=this.ctx,o=n.fontSizeScale,s=n.charSpacing,c=n.wordSpacing,l=n.fontDirection,u=n.textHScale*l,d=t.length,f=r.vertical,p=f?1:-1,m=r.defaultVMetrics,h=i*n.fontMatrix[0],g=n.textRenderingMode===Xy.FILL&&!r.disableFontFace&&!n.patternFill;a.save(),n.textMatrix&&a.transform(...n.textMatrix),a.translate(n.x,n.y+n.textRise),l>0?a.scale(u,-1):a.scale(u,1);let _,v;if(n.patternFill){a.save();let e=n.fillColor.getPattern(a,this,rx(a),sS.FILL);_=nx(a),a.restore(),a.fillStyle=e}if(n.patternStroke){a.save();let e=n.strokeColor.getPattern(a,this,rx(a),sS.STROKE);v=nx(a),a.restore(),a.strokeStyle=e}let y=n.lineWidth,b=n.textMatrixScale;if(b===0||y===0){let e=n.textRenderingMode&Xy.FILL_STROKE_MASK;(e===Xy.STROKE||e===Xy.FILL_STROKE)&&(y=this.getSinglePixelWidth())}else y/=b;if(o!==1&&(a.scale(o,o),y/=o),a.lineWidth=y,r.isInvalidPDFjsFont){let r=[],i=0;for(let e of t)r.push(e.unicode),i+=e.width;let o=r.join(``);if(a.fillText(o,0,0),this.dependencyTracker!==null){let t=a.measureText(o);this.dependencyTracker.recordBBox(e,this.ctx,-t.actualBoundingBoxLeft,t.actualBoundingBoxRight,-t.actualBoundingBoxAscent,t.actualBoundingBoxDescent).recordOperation(e).recordIncrementalData(`sameLineText`,e)}n.x+=i*h*u,a.restore(),this.compose();return}let x=0,S;for(S=0;S<d;++S){let n=t[S];if(typeof n==`number`){x+=p*n*i/1e3;continue}let u=!1,d=(n.isSpace?c:0)+s,y=n.fontChar,b=n.accent,C,w,T=n.width;if(f){let e=n.vmetric||m,t=-(n.vmetric?e[1]:T*.5)*h,r=e[2]*h;T=e?-e[0]:T,C=t/o,w=(x+r)/o}else C=x/o,w=0;let E;if(r.remeasure&&T>0){E=a.measureText(y);let e=E.width*1e3/i*o;if(T<e&&this.isFontSubpixelAAEnabled){let t=T/e;u=!0,a.save(),a.scale(t,1),C/=t}else T!==e&&(C+=(T-e)/2e3*i/o)}if(this.contentVisible&&(n.isInFont||r.missingFile)){if(g&&!b)a.fillText(y,C,w),this.dependencyTracker?.recordCharacterBBox(e,a,E?{bbox:null}:r,i/o,C,w,()=>E??a.measureText(y));else if(this.paintChar(e,y,C,w,_,v),b){let t=C+i*b.offset.x/o,n=w-i*b.offset.y/o;this.paintChar(e,b.fontChar,t,n,_,v)}}let D=f?T*h-d*l:T*h+d*l;x+=D,u&&a.restore()}f?n.y-=x:n.x+=x*u,a.restore(),this.compose(),this.dependencyTracker?.recordOperation(e).recordIncrementalData(`sameLineText`,e)}showType3Text(e,t){let n=this.ctx,r=this.current,i=r.font,a=r.fontSize,o=r.fontDirection,s=i.vertical?1:-1,c=r.charSpacing,l=r.wordSpacing,u=r.textHScale*o,d=r.fontMatrix||Uy,f=t.length,p=r.textRenderingMode===Xy.INVISIBLE,m,h,g,_;if(p||a===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),r.textMatrix&&n.transform(...r.textMatrix),n.translate(r.x,r.y+r.textRise),n.scale(u,o);let v=this.dependencyTracker;for(this.dependencyTracker=v?new aS(v,e):null,m=0;m<f;++m){if(h=t[m],typeof h==`number`){_=s*h*a/1e3,this.ctx.translate(_,0),r.x+=_*u;continue}let e=(h.isSpace?l:0)+c,o=i.charProcOperatorList[h.operatorListId];o?this.contentVisible&&(this.save(),n.scale(a,a),n.transform(...d),this.executeOperatorList(o),this.restore()):Z(`Type3 character "${h.operatorListId}" is not available.`);let f=[h.width,0];Q.applyTransform(f,d),g=f[0]*a+e,n.translate(g,0),r.x+=g*u}n.restore(),v&&(this.dependencyTracker.recordNestedDependencies(),this.dependencyTracker=v)}setCharWidth(e,t,n){}setCharWidthAndBounds(e,t,n,r,i,a,o){let s=new Path2D;s.rect(r,i,a-r,o-i),this.ctx.clip(s),this.dependencyTracker?.recordBBox(e,this.ctx,r,a,i,o).recordClipBox(e,this.ctx,r,a,i,o),this.endPath(e)}getColorN_Pattern(t,n){let r;if(n[0]===`TilingPattern`){let i=this.baseTransform||nx(this.ctx);r=new _S(n,this.ctx,{createCanvasGraphics:n=>new e(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new aS(this.dependencyTracker,t):null)},i)}else r=this._getPattern(t,n[1],n[2]);return r}setStrokeColorN(e,...t){this.dependencyTracker?.recordSimpleData(`strokeColor`,e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){this.dependencyTracker?.recordSimpleData(`fillColor`,e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){this.dependencyTracker?.recordSimpleData(`strokeColor`,e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){this.dependencyTracker?.recordSimpleData(`strokeColor`,e),this.ctx.strokeStyle=this.current.strokeColor=`transparent`,this.current.patternStroke=!1}setFillRGBColor(e,t){this.dependencyTracker?.recordSimpleData(`fillColor`,e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){this.dependencyTracker?.recordSimpleData(`fillColor`,e),this.ctx.fillStyle=this.current.fillColor=`transparent`,this.current.patternFill=!1}_getPattern(e,t,n=null){let r;return this.cachedPatterns.has(t)?r=this.cachedPatterns.get(t):(r=hS(this.getObject(e,t)),this.cachedPatterns.set(t,r)),n&&(r.matrix=n),r}shadingFill(e,t){if(!this.contentVisible)return;let n=this.ctx;this.save(e),n.fillStyle=this._getPattern(e,t).getPattern(n,this,rx(n),sS.SHADING);let r=rx(n);if(r){let{width:e,height:t}=n.canvas,i=ES.slice();Q.axialAlignedBoundingBox([0,0,e,t],r,i);let[a,o,s,c]=i;this.ctx.fillRect(a,o,s-a,c-o)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,oS.transform).recordDependencies(e,oS.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){cb(`Should not call beginInlineImage`)}beginImageData(){cb(`Should not call beginImageData`)}paintFormXObjectBegin(e,t,n){if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=nx(this.ctx),n)){Q.axialAlignedBoundingBox(n,this.baseTransform,this.current.minMax);let[t,r,i,a]=n,o=new Path2D;o.rect(t,r,i-t,a-r),this.ctx.clip(o),this.dependencyTracker?.recordClipBox(e,this.ctx,t,i,r,a),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let n=this.ctx;t.isolated||sb(`TODO: Support non-isolated groups.`),t.knockout&&Z(`Knockout groups not supported.`);let r=nx(n);if(t.matrix&&n.transform(...t.matrix),!t.bbox)throw Error(`Bounding box is required.`);let i=ES.slice();Q.axialAlignedBoundingBox(t.bbox,nx(n),i);let a=[0,0,n.canvas.width,n.canvas.height];i=Q.intersect(i,a)||[0,0,0,0];let o=Math.floor(i[0]),s=Math.floor(i[1]),c=Math.max(Math.ceil(i[2])-o,1),l=Math.max(Math.ceil(i[3])-s,1);this.current.startNewPathAndClipBox([0,0,c,l]);let u=`groupAt`+this.groupLevel;t.smask&&(u+=`_smask_`+ this.smaskCounter++%2);let d=this.cachedCanvases.getCanvas(u,c,l),f=d.context;f.translate(-o,-s),f.transform(...r);let p=new Path2D,[m,h,g,_]=t.bbox;if(p.rect(m,h,g-m,_-h),t.matrix){let e=new Path2D;e.addPath(p,new DOMMatrix(t.matrix)),p=e}f.clip(p),t.smask&&this.smaskStack.push({canvas:d.canvas,context:f,offsetX:o,offsetY:s,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(n.setTransform(1,0,0,1,0,0),n.translate(o,s),n.save()),NS(n,f),this.ctx=f,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies([`fillAlpha`,`strokeAlpha`,`globalCompositeOperation`]).pushBaseTransform(n),this.setGState(e,[[`BM`,`source-over`],[`ca`,1],[`CA`,1]]),this.groupStack.push(n),this.groupLevel++}endGroup(e,t){if(!this.contentVisible)return;this.groupLevel--;let n=this.ctx;if(this.ctx=this.groupStack.pop(),this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();let t=nx(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...t);let r=ES.slice();Q.axialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],t,r),this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(e,t,n,r,i,a){if(this.#restoreInitialState(),PS(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),n){let i=n[2]-n[0],o=n[3]-n[1];if(a&&this.annotationCanvasMap){r=r.slice(),r[4]-=n[0],r[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=i,n[3]=o,Q.singularValueDecompose2dScale(nx(this.ctx),TS);let{viewportScale:e}=this,a=Math.ceil(i*this.outputScaleX*e),s=Math.ceil(o*this.outputScaleY*e);this.annotationCanvas=this.canvasFactory.create(a,s);let{canvas:c,context:l}=this.annotationCanvas;this.annotationCanvasMap.set(t,c),this.annotationCanvas.savedCtx=this.ctx,this.ctx=l,this.ctx.save(),this.ctx.setTransform(TS[0],0,0,-TS[1],0,o*TS[1]),PS(this.ctx)}else{PS(this.ctx),this.endPath(e);let t=new Path2D;t.rect(n[0],n[1],i,o),this.ctx.clip(t)}}this.current=new AS(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...r),this.transform(e,...i)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),this.#drawFilter(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){if(!this.contentVisible)return;let n=t.count;t=this.getObject(e,t.data,t),t.count=n;let r=this.ctx,i=this._createMaskCanvas(e,t),a=i.canvas;r.save(),r.setTransform(1,0,0,1,0,0),r.drawImage(a,i.offsetX,i.offsetY),this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,i.offsetX,i.offsetX+a.width,i.offsetY,i.offsetY+a.height).recordOperation(e),r.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n,r=0,i=0,a,o){if(!this.contentVisible)return;t=this.getObject(e,t.data,t);let s=this.ctx;s.save();let c=nx(s);s.transform(n,r,i,a,0,0);let l=this._createMaskCanvas(e,t);s.setTransform(1,0,0,1,l.offsetX-c[4],l.offsetY-c[5]),this.dependencyTracker?.resetBBox(e);for(let t=0,u=o.length;t<u;t+=2){let u=Q.transform(c,[n,r,i,a,o[t],o[t+1]]);s.drawImage(l.canvas,u[4],u[5]),this.dependencyTracker?.recordBBox(e,this.ctx,u[4],u[4]+l.canvas.width,u[5],u[5]+l.canvas.height)}s.restore(),this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageMaskXObjectGroup(e,t){if(!this.contentVisible)return;let n=this.ctx,r=this.current.fillColor,i=this.current.patternFill;this.dependencyTracker?.resetBBox(e).recordDependencies(e,oS.transformAndFill);for(let a of t){let{data:t,width:o,height:s,transform:c}=a,l=this.cachedCanvases.getCanvas(`maskCanvas`,o,s),u=l.context;u.save();let d=this.getObject(e,t,a);MS(u,d),u.globalCompositeOperation=`source-in`,u.fillStyle=i?r.getPattern(u,this,rx(n),sS.FILL):r,u.fillRect(0,0,o,s),u.restore(),n.save(),n.transform(...c),n.scale(1,-1),kS(n,l.canvas,0,0,o,s,0,-1,1,1),this.dependencyTracker?.recordBBox(e,n,0,o,0,s),n.restore()}this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;let n=this.getObject(e,t);if(!n){Z(`Dependent image isn't ready yet`);return}this.paintInlineImageXObject(e,n)}paintImageXObjectRepeat(e,t,n,r,i){if(!this.contentVisible)return;let a=this.getObject(e,t);if(!a){Z(`Dependent image isn't ready yet`);return}let o=a.width,s=a.height,c=[];for(let e=0,t=i.length;e<t;e+=2)c.push({transform:[n,0,0,r,i[e],i[e+1]],x:0,y:0,w:o,h:s});this.paintInlineImageXObjectGroup(e,a,c)}applyTransferMapsToCanvas(e){return this.current.transferMaps!==`none`&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter=`none`),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps===`none`)return e.bitmap;let{bitmap:t,width:n,height:r}=e,i=this.cachedCanvases.getCanvas(`inlineImage`,n,r),a=i.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter=`none`,i.canvas}paintInlineImageXObject(e,t){if(!this.contentVisible)return;let n=t.width,r=t.height,i=this.ctx;this.save(e);let{filter:a}=i;a!==`none`&&a!==``&&(i.filter=`none`),i.scale(1/n,-1/r);let o;if(t.bitmap)o=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement==`function`&&t instanceof HTMLElement||!t.data)o=t;else{let e=this.cachedCanvases.getCanvas(`inlineImage`,n,r).context;jS(e,t),o=this.applyTransferMapsToCanvas(e)}let s=this._scaleImage(o,rx(i));i.imageSmoothingEnabled=FS(nx(i),t.interpolate),this.dependencyTracker?.resetBBox(e).recordBBox(e,i,0,n,-r,0).recordDependencies(e,oS.imageXObject).recordOperation(e),kS(i,s.img,0,0,s.paintWidth,s.paintHeight,0,-r,n,r),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,n){if(!this.contentVisible)return;let r=this.ctx,i;if(t.bitmap)i=t.bitmap;else{let e=t.width,n=t.height,r=this.cachedCanvases.getCanvas(`inlineImage`,e,n).context;jS(r,t),i=this.applyTransferMapsToCanvas(r)}this.dependencyTracker?.resetBBox(e);for(let t of n)r.save(),r.transform(...t.transform),r.scale(1,-1),kS(r,i,t.x,t.y,t.w,t.h,0,-1,1,1),this.dependencyTracker?.recordBBox(e,r,0,1,-1,0),r.restore();this.dependencyTracker?.recordOperation(e),this.compose()}paintSolidColorImageMask(e){this.contentVisible&&(this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,oS.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,n){}beginMarkedContent(e,t){this.dependencyTracker?.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,n){this.dependencyTracker?.beginMarkedContent(e),t===`OC`?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){this.dependencyTracker?.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,n){let r=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(n);let i=this.ctx;this.pendingClip?(r||(this.pendingClip===zS?i.clip(t,`evenodd`):i.clip(t)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(e).recordFutureForcedDependency(`clipPath`,e)):this.dependencyTracker?.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let e=nx(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{let t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),r=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,r)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){let{lineWidth:e}=this.current,{a:t,b:n,c:r,d:i}=this.ctx.getTransform(),a,o;if(n===0&&r===0){let n=Math.abs(t),r=Math.abs(i);if(n===r)if(e===0)a=o=1/n;else{let t=n*e;a=o=t<1?1/t:1}else if(e===0)a=1/n,o=1/r;else{let t=n*e,i=r*e;a=t<1?1/t:1,o=i<1?1/i:1}}else{let s=Math.abs(t*i-n*r),c=Math.hypot(t,n),l=Math.hypot(r,i);if(e===0)a=l/s,o=c/s;else{let t=e*s;a=l>t?l/t:1,o=c>t?c/t:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(e,t){let{ctx:n,current:{lineWidth:r}}=this,[i,a]=this.getScaleForStroking();if(i===a){n.lineWidth=(r||1)*i,n.stroke(e);return}let o=n.getLineDash();t&&n.save(),n.scale(i,a),wS.a=1/i,wS.d=1/a;let s=new Path2D;if(s.addPath(e,wS),o.length>0){let e=Math.max(i,a);n.setLineDash(o.map(t=>t/e)),n.lineDashOffset/=e}n.lineWidth=r||1,n.stroke(s),t&&n.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};for(let e in tb)BS.prototype[e]!==void 0&&(BS.prototype[tb[e]]=BS.prototype[e]);var VS=class{static#port=null;static#src=``;static get workerPort(){return this.#port}static set workerPort(e){if(!(typeof Worker<`u`&&e instanceof Worker)&&e!==null)throw Error("Invalid `workerPort` type.");this.#port=e}static get workerSrc(){return this.#src}static set workerSrc(e){if(typeof e!=`string`)throw Error("Invalid `workerSrc` type.");this.#src=e}},HS=class{#map;#data;constructor({parsedData:e,rawData:t}){this.#map=e,this.#data=t}getRaw(){return this.#data}get(e){return this.#map.get(e)??null}[Symbol.iterator](){return this.#map.entries()}},US=Symbol(`INTERNAL`),WS=class{#isDisplay=!1;#isPrint=!1;#userSet=!1;#visible=!0;constructor(e,{name:t,intent:n,usage:r,rbGroups:i}){this.#isDisplay=!!(e&Gy.DISPLAY),this.#isPrint=!!(e&Gy.PRINT),this.name=t,this.intent=n,this.usage=r,this.rbGroups=i}get visible(){if(this.#userSet)return this.#visible;if(!this.#visible)return!1;let{print:e,view:t}=this.usage;return this.#isDisplay?t?.viewState!==`OFF`:this.#isPrint?e?.printState!==`OFF`:!0}_setVisible(e,t,n=!1){e!==US&&cb("Internal method `_setVisible` called."),this.#userSet=n,this.#visible=t}},GS=class{#cachedGetHash=null;#groups=new Map;#initialHash=null;#order=null;constructor(e,t=Gy.DISPLAY){if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,this.#order=e.order;for(let n of e.groups)this.#groups.set(n.id,new WS(t,n));if(e.baseState===`OFF`)for(let e of this.#groups.values())e._setVisible(US,!1);for(let t of e.on)this.#groups.get(t)._setVisible(US,!0);for(let t of e.off)this.#groups.get(t)._setVisible(US,!1);this.#initialHash=this.getHash()}}#evaluateVisibilityExpression(e){let t=e.length;if(t<2)return!0;let n=e[0];for(let r=1;r<t;r++){let t=e[r],i;if(Array.isArray(t))i=this.#evaluateVisibilityExpression(t);else if(this.#groups.has(t))i=this.#groups.get(t).visible;else return Z(`Optional content group not found: ${t}`),!0;switch(n){case`And`:if(!i)return!1;break;case`Or`:if(i)return!0;break;case`Not`:return!i;default:return!0}}return n===`And`}isVisible(e){if(this.#groups.size===0)return!0;if(!e)return sb(`Optional content group not defined.`),!0;if(e.type===`OCG`)return this.#groups.has(e.id)?this.#groups.get(e.id).visible:(Z(`Optional content group not found: ${e.id}`),!0);if(e.type===`OCMD`){if(e.expression)return this.#evaluateVisibilityExpression(e.expression);if(!e.policy||e.policy===`AnyOn`){for(let t of e.ids){if(!this.#groups.has(t))return Z(`Optional content group not found: ${t}`),!0;if(this.#groups.get(t).visible)return!0}return!1}else if(e.policy===`AllOn`){for(let t of e.ids){if(!this.#groups.has(t))return Z(`Optional content group not found: ${t}`),!0;if(!this.#groups.get(t).visible)return!1}return!0}else if(e.policy===`AnyOff`){for(let t of e.ids){if(!this.#groups.has(t))return Z(`Optional content group not found: ${t}`),!0;if(!this.#groups.get(t).visible)return!0}return!1}else if(e.policy===`AllOff`){for(let t of e.ids){if(!this.#groups.has(t))return Z(`Optional content group not found: ${t}`),!0;if(this.#groups.get(t).visible)return!1}return!0}return Z(`Unknown optional content policy ${e.policy}.`),!0}return Z(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,n=!0){let r=this.#groups.get(e);if(!r){Z(`Optional content group not found: ${e}`);return}if(n&&t&&r.rbGroups.length)for(let t of r.rbGroups)for(let n of t)n!==e&&this.#groups.get(n)?._setVisible(US,!1,!0);r._setVisible(US,!!t,!0),this.#cachedGetHash=null}setOCGState({state:e,preserveRB:t}){let n;for(let r of e){switch(r){case`ON`:case`OFF`:case`Toggle`:n=r;continue}let e=this.#groups.get(r);if(!e)continue;switch(n){case`ON`:this.setVisibility(r,!0,t);break;case`OFF`:this.setVisibility(r,!1,t);break;case`Toggle`:this.setVisibility(r,!e.visible,t);break}}this.#cachedGetHash=null}get hasInitialVisibility(){return this.#initialHash===null||this.getHash()===this.#initialHash}getOrder(){return this.#groups.size?this.#order?this.#order.slice():[...this.#groups.keys()]:null}getGroup(e){return this.#groups.get(e)||null}getHash(){if(this.#cachedGetHash!==null)return this.#cachedGetHash;let e=new wx;for(let[t,n]of this.#groups)e.update(`${t}:${n.visible}`);return this.#cachedGetHash=e.hexdigest()}[Symbol.iterator](){return this.#groups.entries()}},KS=class{constructor(e,{disableRange:t=!1,disableStream:n=!1}){lb(e,`PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.`);let{length:r,initialData:i,progressiveDone:a,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,i?.length>0){let e=i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer;this._queuedChunks.push(e)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!n,this._isRangeSupported=!t,this._contentLength=r,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((e,t)=>{this._onReceiveData({begin:e,chunk:t})}),e.addProgressListener((e,t)=>{this._onProgress({loaded:e,total:t})}),e.addProgressiveReadListener(e=>{this._onReceiveData({chunk:e})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){let n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{let t=this._rangeReaders.some(function(t){return t._begin===e?(t._enqueue(n),!0):!1});lb(t,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){e.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){let t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){lb(!this._fullRequestReader,`PDFDataTransportStream.getFullReader can only be called once.`);let e=this._queuedChunks;return this._queuedChunks=null,new qS(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new JS(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}},qS=class{constructor(e,t,n=!1,r=null){this._stream=e,this._done=n||!1,this._filename=Wb(r)?r:null,this._queuedChunks=t||[],this._loaded=0;for(let e of this._queuedChunks)this._loaded+=e.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||=!0}},JS=class{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}};function YS(e){let t=!0,n=r(`filename\\*`,`i`).exec(e);if(n){n=n[1];let e=s(n);return e=unescape(e),e=c(e),e=l(e),a(e)}if(n=o(e),n){let e=l(n);return a(e)}if(n=r(`filename`,`i`).exec(e),n){n=n[1];let e=s(n);return e=l(e),a(e)}function r(e,t){return RegExp(`(?:^|;)\\s*`+e+`\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)`,t)}function i(e,n){if(e){if(!/^[\x00-\xFF]+$/.test(n))return n;try{let r=new TextDecoder(e,{fatal:!0}),i=Sb(n);n=r.decode(i),t=!1}catch{}}return n}function a(e){return t&&/[\x80-\xff]/.test(e)&&(e=i(`utf-8`,e),t&&(e=i(`iso-8859-1`,e))),e}function o(e){let t=[],n,i=r(`filename\\*((?!0\\d)\\d+)(\\*?)`,`ig`);for(;(n=i.exec(e))!==null;){let[,e,r,i]=n;if(e=parseInt(e,10),e in t){if(e===0)break;continue}t[e]=[r,i]}let a=[];for(let e=0;e<t.length&&e in t;++e){let[n,r]=t[e];r=s(r),n&&(r=unescape(r),e===0&&(r=c(r))),a.push(r)}return a.join(``)}function s(e){if(e.startsWith(`"`)){let t=e.slice(1).split(`\\"`);for(let e=0;e<t.length;++e){let n=t[e].indexOf(`"`);n!==-1&&(t[e]=t[e].slice(0,n),t.length=e+1),t[e]=t[e].replaceAll(/\\(.)/g,`$1`)}e=t.join(`"`)}return e}function c(e){let t=e.indexOf(`'`);if(t===-1)return e;let n=e.slice(0,t),r=e.slice(t+1).replace(/^[^']*'/,``);return i(n,r)}function l(e){return!e.startsWith(`=?`)||/[\x00-\x19\x80-\xff]/.test(e)?e:e.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(e,t,n,r){if(n===`q`||n===`Q`)return r=r.replaceAll(`_`,` `),r=r.replaceAll(/=([0-9a-fA-F]{2})/g,function(e,t){return String.fromCharCode(parseInt(t,16))}),i(t,r);try{r=atob(r)}catch{}return i(t,r)})}return``}function XS(e,t){let n=new Headers;if(!e||!t||typeof t!=`object`)return n;for(let e in t){let r=t[e];r!==void 0&&n.append(e,r)}return n}function ZS(e){return URL.parse(e)?.origin??null}function QS({responseHeaders:e,isHttp:t,rangeChunkSize:n,disableRange:r}){let i={allowRangeRequests:!1,suggestedLength:void 0},a=parseInt(e.get(`Content-Length`),10);return!Number.isInteger(a)||(i.suggestedLength=a,a<=2*n)||r||!t||e.get(`Accept-Ranges`)!==`bytes`||(e.get(`Content-Encoding`)||`identity`)!==`identity`||(i.allowRangeRequests=!0),i}function $S(e){let t=e.get(`Content-Disposition`);if(t){let e=YS(t);if(e.includes(`%`))try{e=decodeURIComponent(e)}catch{}if(Wb(e))return e}return null}function eC(e,t){return new vb(`Unexpected server response (${e}) while retrieving PDF "${t}".`,e,e===404||e===0&&t.startsWith(`file:`))}function tC(e){return e===200||e===206}function nC(e,t,n){return{method:`GET`,headers:e,signal:n.signal,mode:`cors`,credentials:t?`include`:`same-origin`,redirect:`follow`}}function rC(e){return e instanceof Uint8Array?e.buffer:e instanceof ArrayBuffer?e:(Z(`getArrayBuffer - unexpected data format: ${e}`),new Uint8Array(e).buffer)}var iC=class{_responseOrigin=null;constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=XS(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return lb(!this._fullRequestReader,`PDFFetchStream.getFullReader can only be called once.`),this._fullRequestReader=new aC(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new oC(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},aC=class{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;let t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;let n=new Headers(e.headers),r=t.url;fetch(r,nC(n,this._withCredentials,this._abortController)).then(t=>{if(e._responseOrigin=ZS(t.url),!tC(t.status))throw eC(t.status,r);this._reader=t.body.getReader(),this._headersCapability.resolve();let n=t.headers,{allowRangeRequests:i,suggestedLength:a}=QS({responseHeaders:n,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=i,this._contentLength=a||this._contentLength,this._filename=$S(n),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new bb(`Streaming is disabled.`))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;let{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:rC(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}},oC=class{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;let r=e.source;this._withCredentials=r.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!r.disableStream,this._abortController=new AbortController;let i=new Headers(e.headers);i.append(`Range`,`bytes=${t}-${n-1}`);let a=r.url;fetch(a,nC(i,this._withCredentials,this._abortController)).then(t=>{let n=ZS(t.url);if(n!==e._responseOrigin)throw Error(`Expected range response-origin "${n}" to match "${e._responseOrigin}".`);if(!tC(t.status))throw eC(t.status,a);this._readCapability.resolve(),this._reader=t.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;let{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:rC(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}},sC=200,cC=206;function lC(e){let t=e.response;return typeof t==`string`?Sb(t).buffer:t}var uC=class{_responseOrigin=null;constructor({url:e,httpHeaders:t,withCredentials:n}){this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=XS(this.isHttp,t),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){let t=new XMLHttpRequest,n=this.currXhrId++,r=this.pendingRequests[n]={xhr:t};t.open(`GET`,this.url),t.withCredentials=this.withCredentials;for(let[e,n]of this.headers)t.setRequestHeader(e,n);return this.isHttp&&`begin`in e&&`end`in e?(t.setRequestHeader(`Range`,`bytes=${e.begin}-${e.end-1}`),r.expectedStatus=cC):r.expectedStatus=sC,t.responseType=`arraybuffer`,lb(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),r.onHeadersReceived=e.onHeadersReceived,r.onDone=e.onDone,r.onError=e.onError,r.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){let n=this.pendingRequests[e];n&&n.onProgress?.(t)}onStateChange(e,t){let n=this.pendingRequests[e];if(!n)return;let r=n.xhr;if(r.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),r.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],r.status===0&&this.isHttp){n.onError(r.status);return}let i=r.status||sC;if(!(i===sC&&n.expectedStatus===cC)&&i!==n.expectedStatus){n.onError(r.status);return}let a=lC(r);if(i===cC){let e=r.getResponseHeader(`Content-Range`),t=/bytes (\d+)-(\d+)\/(\d+)/.exec(e);t?n.onDone({begin:parseInt(t[1],10),chunk:a}):(Z(`Missing or invalid "Content-Range" header.`),n.onError(0))}else a?n.onDone({begin:0,chunk:a}):n.onError(r.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){let t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}},dC=class{constructor(e){this._source=e,this._manager=new uC(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){let t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return lb(!this._fullRequestReader,`PDFNetworkStream.getFullReader can only be called once.`),this._fullRequestReader=new fC(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){let n=new pC(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},fC=class{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=ZS(t.responseURL);let n=t.getAllResponseHeaders(),r=new Headers(n?n.trimStart().replace(/[^\S ]+$/,``).split(/[\r\n]+/).map(e=>{let[t,...n]=e.split(`: `);return[t,n.join(`: `)]}):[]),{allowRangeRequests:i,suggestedLength:a}=QS({responseHeaders:r,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});i&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=$S(r),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=eC(e,this._url),this._headersCapability.reject(this._storedError);for(let e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}},pC=class{constructor(e,t,n){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){let e=ZS(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){let t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??=eC(e,this._url);for(let e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};let e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(let e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}},mC=/^[a-z][a-z0-9\-+.]+:/i;function hC(e){if(mC.test(e))return new URL(e);let t=process.getBuiltinModule(`url`);return new URL(t.pathToFileURL(e))}var gC=class{constructor(e){this.source=e,this.url=hC(e.url),lb(this.url.protocol===`file:`,`PDFNodeStream only supports file:// URLs.`),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return lb(!this._fullRequestReader,`PDFNodeStream.getFullReader can only be called once.`),this._fullRequestReader=new _C(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;let n=new vC(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(let t of this._rangeRequestReaders.slice(0))t.cancel(e)}},_C=class{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;let t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();let n=process.getBuiltinModule(`fs`);n.promises.lstat(this._url).then(e=>{this._contentLength=e.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},e=>{e.code===`ENOENT`&&(e=eC(0,this._url.href)),this._storedError=e,this._headersCapability.reject(e)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on(`readable`,()=>{this._readCapability.resolve()}),e.on(`end`,()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on(`error`,e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new bb(`streaming is disabled`)),this._storedError&&this._readableStream.destroy(this._storedError)}},vC=class{constructor(e,t,n){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!e.source.disableStream;let r=process.getBuiltinModule(`fs`);this._setReadableStream(r.createReadStream(this._url,{start:t,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on(`readable`,()=>{this._readCapability.resolve()}),e.on(`end`,()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on(`error`,e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}},yC=Symbol(`INITIAL_DATA`),bC=class{#objs=Object.create(null);#ensureObj(e){return this.#objs[e]||={...Promise.withResolvers(),data:yC}}get(e,t=null){if(t){let n=this.#ensureObj(e);return n.promise.then(()=>t(n.data)),null}let n=this.#objs[e];if(!n||n.data===yC)throw Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){let t=this.#objs[e];return!!t&&t.data!==yC}delete(e){let t=this.#objs[e];return!t||t.data===yC?!1:(delete this.#objs[e],!0)}resolve(e,t=null){let n=this.#ensureObj(e);n.data=t,n.resolve()}clear(){for(let e in this.#objs){let{data:t}=this.#objs[e];t?.bitmap?.close()}this.#objs=Object.create(null)}*[Symbol.iterator](){for(let e in this.#objs){let{data:t}=this.#objs[e];if(t===yC)continue;yield[e,t]}}},xC=1e5,SC=30,CC=class e{#capability=Promise.withResolvers();#container=null;#disableProcessItems=!1;#fontInspectorEnabled=!!globalThis.FontInspector?.enabled;#lang=null;#layoutTextParams=null;#pageHeight=0;#pageWidth=0;#reader=null;#rootContainer=null;#rotation=0;#scale=0;#styleCache=Object.create(null);#textContentItemsStr=[];#textContentSource=null;#textDivs=[];#textDivProperties=new WeakMap;#transform=null;static#ascentCache=new Map;static#canvasContexts=new Map;static#canvasCtxFonts=new WeakMap;static#minFontSize=null;static#pendingTextLayers=new Set;constructor({textContentSource:t,container:n,viewport:r}){if(t instanceof ReadableStream)this.#textContentSource=t;else if(typeof t==`object`)this.#textContentSource=new ReadableStream({start(e){e.enqueue(t),e.close()}});else throw Error(`No "textContentSource" parameter specified.`);this.#container=this.#rootContainer=n,this.#scale=r.scale*ax.pixelRatio,this.#rotation=r.rotation,this.#layoutTextParams={div:null,properties:null,ctx:null};let{pageWidth:i,pageHeight:a,pageX:o,pageY:s}=r.rawDims;this.#transform=[1,0,0,-1,-o,s+a],this.#pageWidth=i,this.#pageHeight=a,e.#ensureMinFontSizeComputed(),ix(n,r),this.#capability.promise.finally(()=>{e.#pendingTextLayers.delete(this),this.#layoutTextParams=null,this.#styleCache=null}).catch(()=>{})}static get fontFamilyMap(){let{isWindows:e,isFirefox:t}=Eb.platform;return pb(this,`fontFamilyMap`,new Map([[`sans-serif`,`${e&&t?`Calibri, `:``}sans-serif`],[`monospace`,`${e&&t?`Lucida Console, `:``}monospace`]]))}render(){let t=()=>{this.#reader.read().then(({value:e,done:n})=>{if(n){this.#capability.resolve();return}this.#lang??=e.lang,Object.assign(this.#styleCache,e.styles),this.#processItems(e.items),t()},this.#capability.reject)};return this.#reader=this.#textContentSource.getReader(),e.#pendingTextLayers.add(this),t(),this.#capability.promise}update({viewport:t,onBefore:n=null}){let r=t.scale*ax.pixelRatio,i=t.rotation;if(i!==this.#rotation&&(n?.(),this.#rotation=i,ix(this.#rootContainer,{rotation:i})),r!==this.#scale){n?.(),this.#scale=r;let t={div:null,properties:null,ctx:e.#getCtx(this.#lang)};for(let e of this.#textDivs)t.properties=this.#textDivProperties.get(e),t.div=e,this.#layout(t)}}cancel(){let e=new bb(`TextLayer task cancelled.`);this.#reader?.cancel(e).catch(()=>{}),this.#reader=null,this.#capability.reject(e)}get textDivs(){return this.#textDivs}get textContentItemsStr(){return this.#textContentItemsStr}#processItems(t){if(this.#disableProcessItems)return;this.#layoutTextParams.ctx??=e.#getCtx(this.#lang);let n=this.#textDivs,r=this.#textContentItemsStr;for(let e of t){if(n.length>xC){Z(`Ignoring additional textDivs for performance reasons.`),this.#disableProcessItems=!0;return}if(e.str===void 0){if(e.type===`beginMarkedContentProps`||e.type===`beginMarkedContent`){let t=this.#container;this.#container=document.createElement(`span`),this.#container.classList.add(`markedContent`),e.id&&this.#container.setAttribute(`id`,`${e.id}`),t.append(this.#container)}else e.type===`endMarkedContent`&&(this.#container=this.#container.parentNode);continue}r.push(e.str),this.#appendText(e)}}#appendText(t){let n=document.createElement(`span`),r={angle:0,canvasWidth:0,hasText:t.str!==``,hasEOL:t.hasEOL,fontSize:0};this.#textDivs.push(n);let i=Q.transform(this.#transform,t.transform),a=Math.atan2(i[1],i[0]),o=this.#styleCache[t.fontName];o.vertical&&(a+=Math.PI/2);let s=this.#fontInspectorEnabled&&o.fontSubstitution||o.fontFamily;s=e.fontFamilyMap.get(s)||s;let c=Math.hypot(i[2],i[3]),l=c*e.#getAscent(s,o,this.#lang),u,d;a===0?(u=i[4],d=i[5]-l):(u=i[4]+l*Math.sin(a),d=i[5]-l*Math.cos(a));let f=`calc(var(--total-scale-factor) *`,p=n.style;this.#container===this.#rootContainer?(p.left=`${(100*u/this.#pageWidth).toFixed(2)}%`,p.top=`${(100*d/this.#pageHeight).toFixed(2)}%`):(p.left=`${f}${u.toFixed(2)}px)`,p.top=`${f}${d.toFixed(2)}px)`),p.fontSize=`${f}${(e.#minFontSize*c).toFixed(2)}px)`,p.fontFamily=s,r.fontSize=c,n.setAttribute(`role`,`presentation`),n.textContent=t.str,n.dir=t.dir,this.#fontInspectorEnabled&&(n.dataset.fontName=o.fontSubstitutionLoadedName||t.fontName),a!==0&&(r.angle=a*(180/Math.PI));let m=!1;if(t.str.length>1)m=!0;else if(t.str!==` `&&t.transform[0]!==t.transform[3]){let e=Math.abs(t.transform[0]),n=Math.abs(t.transform[3]);e!==n&&Math.max(e,n)/Math.min(e,n)>1.5&&(m=!0)}if(m&&(r.canvasWidth=o.vertical?t.height:t.width),this.#textDivProperties.set(n,r),this.#layoutTextParams.div=n,this.#layoutTextParams.properties=r,this.#layout(this.#layoutTextParams),r.hasText&&this.#container.append(n),r.hasEOL){let e=document.createElement(`br`);e.setAttribute(`role`,`presentation`),this.#container.append(e)}}#layout(t){let{div:n,properties:r,ctx:i}=t,{style:a}=n,o=``;if(e.#minFontSize>1&&(o=`scale(${1/e.#minFontSize})`),r.canvasWidth!==0&&r.hasText){let{fontFamily:t}=a,{canvasWidth:s,fontSize:c}=r;e.#ensureCtxFont(i,c*this.#scale,t);let{width:l}=i.measureText(n.textContent);l>0&&(o=`scaleX(${s*this.#scale/l}) ${o}`)}r.angle!==0&&(o=`rotate(${r.angle}deg) ${o}`),o.length>0&&(a.transform=o)}static cleanup(){if(!(this.#pendingTextLayers.size>0)){this.#ascentCache.clear();for(let{canvas:e}of this.#canvasContexts.values())e.remove();this.#canvasContexts.clear()}}static#getCtx(e=null){let t=this.#canvasContexts.get(e||=``);if(!t){let n=document.createElement(`canvas`);n.className=`hiddenCanvasElement`,n.lang=e,document.body.append(n),t=n.getContext(`2d`,{alpha:!1,willReadFrequently:!0}),this.#canvasContexts.set(e,t),this.#canvasCtxFonts.set(t,{size:0,family:``})}return t}static#ensureCtxFont(e,t,n){let r=this.#canvasCtxFonts.get(e);t===r.size&&n===r.family||(e.font=`${t}px ${n}`,r.size=t,r.family=n)}static#ensureMinFontSizeComputed(){if(this.#minFontSize!==null)return;let e=document.createElement(`div`);e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize=`1px`,e.style.position=`absolute`,e.textContent=`X`,document.body.append(e),this.#minFontSize=e.getBoundingClientRect().height,e.remove()}static#getAscent(e,t,n){let r=this.#ascentCache.get(e);if(r)return r;let i=this.#getCtx(n);i.canvas.width=i.canvas.height=SC,this.#ensureCtxFont(i,SC,e);let a=i.measureText(``),o=a.fontBoundingBoxAscent,s=Math.abs(a.fontBoundingBoxDescent);i.canvas.width=i.canvas.height=0;let c=.8;return o?c=o/(o+s):(Eb.platform.isFirefox&&Z("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?c=t.ascent:t.descent&&(c=1+t.descent)),this.#ascentCache.set(e,c),c}},wC=class e{static textContent(t){let n=[],r={items:n,styles:Object.create(null)};function i(t){if(!t)return;let r=null,a=t.name;if(a===`#text`)r=t.value;else if(e.shouldBuildText(a))t?.attributes?.textContent?r=t.attributes.textContent:t.value&&(r=t.value);else return;if(r!==null&&n.push({str:r}),t.children)for(let e of t.children)i(e)}return i(t),r}static shouldBuildText(e){return!(e===`textarea`||e===`input`||e===`option`||e===`select`)}},TC=100;function EC(e={}){typeof e==`string`||e instanceof URL?e={url:e}:(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});let t=new DC,{docId:n}=t,r=e.url?Ax(e.url):null,i=e.data?jx(e.data):null,a=e.httpHeaders||null,o=e.withCredentials===!0,s=e.password??null,c=e.range instanceof OC?e.range:null,l=Number.isInteger(e.rangeChunkSize)&&e.rangeChunkSize>0?e.rangeChunkSize:2**16,u=e.worker instanceof jC?e.worker:null,d=e.verbosity,f=typeof e.docBaseUrl==`string`&&!Ub(e.docBaseUrl)?e.docBaseUrl:null,p=Mx(e.cMapUrl),m=e.cMapPacked!==!1,h=e.CMapReaderFactory||(Hy?eS:Wx),g=Mx(e.iccUrl),_=Mx(e.standardFontDataUrl),v=e.StandardFontDataFactory||(Hy?tS:Jx),y=Mx(e.wasmUrl),b=e.WasmFactory||(Hy?nS:Xx),x=e.stopAtErrors!==!0,S=Number.isInteger(e.maxImageSize)&&e.maxImageSize>-1?e.maxImageSize:-1,C=e.isEvalSupported!==!1,w=typeof e.isOffscreenCanvasSupported==`boolean`?e.isOffscreenCanvasSupported:!Hy,T=typeof e.isImageDecoderSupported==`boolean`?e.isImageDecoderSupported:!Hy&&(Eb.platform.isFirefox||!globalThis.chrome),E=Number.isInteger(e.canvasMaxAreaInBytes)?e.canvasMaxAreaInBytes:-1,D=typeof e.disableFontFace==`boolean`?e.disableFontFace:Hy,O=e.fontExtraProperties===!0,ee=e.enableXfa===!0,k=e.ownerDocument||globalThis.document,te=e.disableRange===!0,ne=e.disableStream===!0,re=e.disableAutoFetch===!0,ie=e.pdfBug===!0,ae=e.CanvasFactory||(Hy?$x:Hx),A=e.FilterFactory||(Hy?Qx:Kx),j=e.enableHWA===!0,oe=e.useWasm!==!1,se=c?c.length:e.length??NaN,ce=typeof e.useSystemFonts==`boolean`?e.useSystemFonts:!Hy&&!D,le=typeof e.useWorkerFetch==`boolean`?e.useWorkerFetch:!!(h===Wx&&v===Jx&&b===Xx&&p&&_&&y&&Jb(p,document.baseURI)&&Jb(_,document.baseURI)&&Jb(y,document.baseURI));ab(d);let ue={canvasFactory:new ae({ownerDocument:k,enableHWA:j}),filterFactory:new A({docId:n,ownerDocument:k}),cMapReaderFactory:le?null:new h({baseUrl:p,isCompressed:m}),standardFontDataFactory:le?null:new v({baseUrl:_}),wasmFactory:le?null:new b({baseUrl:y})};u||(u=jC.create({verbosity:d,port:VS.workerPort}),t._worker=u);let M={docId:n,apiVersion:`5.4.149`,data:i,password:s,disableAutoFetch:re,rangeChunkSize:l,length:se,docBaseUrl:f,enableXfa:ee,evaluatorOptions:{maxImageSize:S,disableFontFace:D,ignoreErrors:x,isEvalSupported:C,isOffscreenCanvasSupported:w,isImageDecoderSupported:T,canvasMaxAreaInBytes:E,fontExtraProperties:O,useSystemFonts:ce,useWasm:oe,useWorkerFetch:le,cMapUrl:p,iccUrl:g,standardFontDataUrl:_,wasmUrl:y}},de={ownerDocument:k,pdfBug:ie,styleElement:null,loadingParams:{disableAutoFetch:re,enableXfa:ee}};return u.promise.then(function(){if(t.destroyed)throw Error(`Loading aborted`);if(u.destroyed)throw Error(`Worker was destroyed`);let e=u.messageHandler.sendWithPromise(`GetDocRequest`,M,i?[i.buffer]:null),s;if(c)s=new KS(c,{disableRange:te,disableStream:ne});else if(!i){if(!r)throw Error("getDocument - no `url` parameter provided.");s=new(Jb(r)?iC:Hy?gC:dC)({url:r,length:se,httpHeaders:a,withCredentials:o,rangeChunkSize:l,disableRange:te,disableStream:ne})}return e.then(e=>{if(t.destroyed)throw Error(`Loading aborted`);if(u.destroyed)throw Error(`Worker was destroyed`);let r=new Bx(n,e,u.port);t._transport=new MC(r,t,s,de,ue,j),r.send(`Ready`,null)})}).catch(t._capability.reject),t}var DC=class e{static#docId=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${e.#docId++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}},OC=class{#capability=Promise.withResolvers();#progressiveDoneListeners=[];#progressiveReadListeners=[];#progressListeners=[];#rangeListeners=[];constructor(e,t,n=!1,r=null){this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=r}addRangeListener(e){this.#rangeListeners.push(e)}addProgressListener(e){this.#progressListeners.push(e)}addProgressiveReadListener(e){this.#progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this.#progressiveDoneListeners.push(e)}onDataRange(e,t){for(let n of this.#rangeListeners)n(e,t)}onDataProgress(e,t){this.#capability.promise.then(()=>{for(let n of this.#progressListeners)n(e,t)})}onDataProgressiveRead(e){this.#capability.promise.then(()=>{for(let t of this.#progressiveReadListeners)t(e)})}onDataProgressiveDone(){this.#capability.promise.then(()=>{for(let e of this.#progressiveDoneListeners)e()})}transportReady(){this.#capability.resolve()}requestDataRange(e,t){cb(`Abstract method PDFDataRangeTransport.requestDataRange`)}abort(){}},kC=class{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return pb(this,`isPureXfa`,!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e=`display`}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}},AC=class{#pendingCleanup=!1;constructor(e,t,n,r=!1){this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=r?new qb:null,this._pdfBug=r,this.commonObjs=n.commonObjs,this.objs=new bC,this._intentStates=new Map,this.destroyed=!1,this.recordedGroups=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:r=0,dontFlip:i=!1}={}){return new Vb({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:i})}getAnnotations({intent:e=`display`}={}){let{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return pb(this,`isPureXfa`,!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,canvas:t=e.canvas,viewport:n,intent:r=`display`,annotationMode:i=Ky.ENABLE,transform:a=null,background:o=null,optionalContentConfigPromise:s=null,annotationCanvasMap:c=null,pageColors:l=null,printAnnotationStorage:u=null,isEditing:d=!1,recordOperations:f=!1,filteredOperationIndexes:p=null}){this._stats?.time(`Overall`);let m=this._transport.getRenderingIntent(r,i,u,d),{renderingIntent:h,cacheKey:g}=m;this.#pendingCleanup=!1,s||=this._transport.getOptionalContentConfig(h);let _=this._intentStates.get(g);_||(_=Object.create(null),this._intentStates.set(g,_)),_.streamReaderCancelTimeout&&=(clearTimeout(_.streamReaderCancelTimeout),null);let v=!!(h&Gy.PRINT);_.displayReadyCapability||(_.displayReadyCapability=Promise.withResolvers(),_.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time(`Page Request`),this._pumpOperatorList(m));let y=!this.recordedGroups&&(f||this._pdfBug&&globalThis.StepperManager?.enabled),b=e=>{if(_.renderTasks.delete(x),y){let e=x.gfx?.dependencyTracker.take();e?(x.stepper?.setOperatorGroups(e),f&&(this.recordedGroups=e)):f&&(this.recordedGroups=[])}v&&(this.#pendingCleanup=!0),this.#tryCleanup(),e?(x.capability.reject(e),this._abortOperatorList({intentState:_,reason:e instanceof Error?e:Error(e)})):x.capability.resolve(),this._stats&&(this._stats.timeEnd(`Rendering`),this._stats.timeEnd(`Overall`),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},x=new PC({callback:b,params:{canvas:t,canvasContext:e,dependencyTracker:y?new iS(t):null,viewport:n,transform:a,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:_.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!v,pdfBug:this._pdfBug,pageColors:l,enableHWA:this._transport.enableHWA,filteredOperationIndexes:p});(_.renderTasks||=new Set).add(x);let S=x.task;return Promise.all([_.displayReadyCapability.promise,s]).then(([e,t])=>{if(this.destroyed){b();return}if(this._stats?.time(`Rendering`),!(t.renderingIntent&h))throw Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");x.initializeGraphics({transparency:e,optionalContentConfig:t}),x.operatorListChanged()}).catch(b),S}getOperatorList({intent:e=`display`,annotationMode:t=Ky.ENABLE,printAnnotationStorage:n=null,isEditing:r=!1}={}){function i(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(s))}let a=this._transport.getRenderingIntent(e,t,n,r,!0),o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let s;return o.opListReadCapability||(s=Object.create(null),s.operatorListChanged=i,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||=new Set).add(s),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time(`Page Request`),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream(`GetTextContent`,{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(e){return e.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(e=>wC.textContent(e));let t=this.streamTextContent(e);return new Promise(function(e,n){function r(){i.read().then(function({value:t,done:n}){if(n){e(a);return}a.lang??=t.lang,Object.assign(a.styles,t.styles),a.items.push(...t.items),r()},n)}let i=t.getReader(),a={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let e=[];for(let t of this._intentStates.values()){if(this._abortOperatorList({intentState:t,reason:Error(`Page was destroyed.`),force:!0}),t.opListReadCapability)continue;for(let n of t.renderTasks)e.push(n.completed),n.cancel()}return this.objs.clear(),this.#pendingCleanup=!1,Promise.all(e)}cleanup(e=!1){this.#pendingCleanup=!0;let t=this.#tryCleanup();return e&&t&&(this._stats&&=new qb),t}#tryCleanup(){if(!this.#pendingCleanup||this.destroyed)return!1;for(let{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#pendingCleanup=!1,!0}_startRenderPage(e,t){let n=this._intentStates.get(t);n&&(this._stats?.timeEnd(`Page Request`),n.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let n=0,r=e.length;n<r;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(let e of t.renderTasks)e.operatorListChanged();e.lastChunk&&this.#tryCleanup()}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n,modifiedIds:r}){let{map:i,transfer:a}=n,o=this._transport.messageHandler.sendWithStream(`GetOperatorList`,{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:i,modifiedIds:r},a).getReader(),s=this._intentStates.get(t);s.streamReader=o;let c=()=>{o.read().then(({value:e,done:t})=>{if(t){s.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(e,s),c())},e=>{if(s.streamReader=null,!this._transport.destroyed){if(s.operatorList){s.operatorList.lastChunk=!0;for(let e of s.renderTasks)e.operatorListChanged();this.#tryCleanup()}if(s.displayReadyCapability)s.displayReadyCapability.reject(e);else if(s.opListReadCapability)s.opListReadCapability.reject(e);else throw e}})};c()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&=(clearTimeout(e.streamReaderCancelTimeout),null),!n){if(e.renderTasks.size>0)return;if(t instanceof Hb){let n=TC;t.extraDelay>0&&t.extraDelay<1e3&&(n+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},n);return}}if(e.streamReader.cancel(new bb(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(let[t,n]of this._intentStates)if(n===e){this._intentStates.delete(t);break}this.cleanup()}}}get stats(){return this._stats}},jC=class e{#capability=Promise.withResolvers();#messageHandler=null;#port=null;#webWorker=null;static#fakeWorkerId=0;static#isWorkerDisabled=!1;static#workerPorts=new WeakMap;static{Hy&&(this.#isWorkerDisabled=!0,VS.workerSrc||=`./pdf.worker.mjs`),this._isSameOrigin=(e,t)=>{let n=URL.parse(e);if(!n?.origin||n.origin===`null`)return!1;let r=new URL(t,n);return n.origin===r.origin},this._createCDNWrapper=e=>{let t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:`text/javascript`}))},this.fromPort=e=>{if(Zb("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!e?.port)throw Error(`PDFWorker.fromPort - invalid method signature.`);return this.create(e)}}constructor({name:t=null,port:n=null,verbosity:r=ob()}={}){if(this.name=t,this.destroyed=!1,this.verbosity=r,n){if(e.#workerPorts.has(n))throw Error(`Cannot use more than one PDFWorker per port.`);e.#workerPorts.set(n,this),this.#initializeFromPort(n)}else this.#initialize()}get promise(){return this.#capability.promise}#resolve(){this.#capability.resolve(),this.#messageHandler.send(`configure`,{verbosity:this.verbosity})}get port(){return this.#port}get messageHandler(){return this.#messageHandler}#initializeFromPort(e){this.#port=e,this.#messageHandler=new Bx(`main`,`worker`,e),this.#messageHandler.on(`ready`,()=>{}),this.#resolve()}#initialize(){if(e.#isWorkerDisabled||e.#mainThreadWorkerMessageHandler){this.#setupFakeWorker();return}let{workerSrc:t}=e;try{e._isSameOrigin(window.location,t)||(t=e._createCDNWrapper(new URL(t,window.location).href));let n=new Worker(t,{type:`module`}),r=new Bx(`main`,`worker`,n),i=()=>{a.abort(),r.destroy(),n.terminate(),this.destroyed?this.#capability.reject(Error(`Worker was destroyed`)):this.#setupFakeWorker()},a=new AbortController;n.addEventListener(`error`,()=>{this.#webWorker||i()},{signal:a.signal}),r.on(`test`,e=>{if(a.abort(),this.destroyed||!e){i();return}this.#messageHandler=r,this.#port=n,this.#webWorker=n,this.#resolve()}),r.on(`ready`,e=>{if(a.abort(),this.destroyed){i();return}try{o()}catch{this.#setupFakeWorker()}});let o=()=>{let e=new Uint8Array;r.send(`test`,e,[e.buffer])};o();return}catch{sb(`The worker has been disabled.`)}this.#setupFakeWorker()}#setupFakeWorker(){e.#isWorkerDisabled||=(Z(`Setting up fake worker.`),!0),e._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){this.#capability.reject(Error(`Worker was destroyed`));return}let n=new Fx;this.#port=n;let r=`fake${e.#fakeWorkerId++}`,i=new Bx(r+`_worker`,r,n);t.setup(i,n),this.#messageHandler=new Bx(r,r+`_worker`,n),this.#resolve()}).catch(e=>{this.#capability.reject(Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){this.destroyed=!0,this.#webWorker?.terminate(),this.#webWorker=null,e.#workerPorts.delete(this.#port),this.#port=null,this.#messageHandler?.destroy(),this.#messageHandler=null}static create(t){let n=this.#workerPorts.get(t?.port);if(n){if(n._pendingDestroy)throw Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return n}return new e(t)}static get workerSrc(){if(VS.workerSrc)return VS.workerSrc;throw Error(`No "GlobalWorkerOptions.workerSrc" specified.`)}static get#mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){return pb(this,`_setupFakeWorkerGlobal`,(async()=>this.#mainThreadWorkerMessageHandler?this.#mainThreadWorkerMessageHandler:(await x(()=>import(this.workerSrc),[])).WorkerMessageHandler)())}},MC=class{#methodPromises=new Map;#pageCache=new Map;#pagePromises=new Map;#pageRefCache=new Map;#passwordCapability=null;constructor(e,t,n,r,i,a){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new bC,this.fontLoader=new Ox({ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this.loadingParams=r.loadingParams,this._params=r,this.canvasFactory=i.canvasFactory,this.filterFactory=i.filterFactory,this.cMapReaderFactory=i.cMapReaderFactory,this.standardFontDataFactory=i.standardFontDataFactory,this.wasmFactory=i.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=a,this.setupMessageHandler()}#cacheSimpleMethod(e,t=null){let n=this.#methodPromises.get(e);if(n)return n;let r=this.messageHandler.sendWithPromise(e,t);return this.#methodPromises.set(e,r),r}get annotationStorage(){return pb(this,`annotationStorage`,new Ex)}getRenderingIntent(e,t=Ky.ENABLE,n=null,r=!1,i=!1){let a=Gy.DISPLAY,o=Tx;switch(e){case`any`:a=Gy.ANY;break;case`display`:break;case`print`:a=Gy.PRINT;break;default:Z(`getRenderingIntent - invalid intent: ${e}`)}let s=a&Gy.PRINT&&n instanceof Dx?n:this.annotationStorage;switch(t){case Ky.DISABLE:a+=Gy.ANNOTATIONS_DISABLE;break;case Ky.ENABLE:break;case Ky.ENABLE_FORMS:a+=Gy.ANNOTATIONS_FORMS;break;case Ky.ENABLE_STORAGE:a+=Gy.ANNOTATIONS_STORAGE,o=s.serializable;break;default:Z(`getRenderingIntent - invalid annotationMode: ${t}`)}r&&(a+=Gy.IS_EDITING),i&&(a+=Gy.OPLIST);let{ids:c,hash:l}=s.modifiedIds,u=[a,o.hash,l];return{renderingIntent:a,cacheKey:u.join(`_`),annotationStorageSerializable:o,modifiedIds:c}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#passwordCapability?.reject(Error(`Worker was destroyed during onPassword callback`));let e=[];for(let t of this.#pageCache.values())e.push(t._destroy());this.#pageCache.clear(),this.#pagePromises.clear(),this.#pageRefCache.clear(),this.hasOwnProperty(`annotationStorage`)&&this.annotationStorage.resetModified();let t=this.messageHandler.sendWithPromise(`Terminate`,null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#methodPromises.clear(),this.filterFactory.destroy(),CC.cleanup(),this._networkStream?.cancelAllRequests(new bb(`Worker was terminated.`)),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:e,loadingTask:t}=this;e.on(`GetReader`,(e,t)=>{lb(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=e=>{this._lastProgress={loaded:e.loaded,total:e.total}},t.onPull=()=>{this._fullReader.read().then(function({value:e,done:n}){if(n){t.close();return}lb(e instanceof ArrayBuffer,`GetReader - expected an ArrayBuffer.`),t.enqueue(new Uint8Array(e),1,[e])}).catch(e=>{t.error(e)})},t.onCancel=e=>{this._fullReader.cancel(e),t.ready.catch(e=>{if(!this.destroyed)throw e})}}),e.on(`ReaderHeadersReady`,async e=>{await this._fullReader.headersReady;let{isStreamingSupported:n,isRangeSupported:r,contentLength:i}=this._fullReader;return(!n||!r)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),this._fullReader.onProgress=e=>{t.onProgress?.({loaded:e.loaded,total:e.total})}),{isStreamingSupported:n,isRangeSupported:r,contentLength:i}}),e.on(`GetRangeReader`,(e,t)=>{lb(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let n=this._networkStream.getRangeReader(e.begin,e.end);if(!n){t.close();return}t.onPull=()=>{n.read().then(function({value:e,done:n}){if(n){t.close();return}lb(e instanceof ArrayBuffer,`GetRangeReader - expected an ArrayBuffer.`),t.enqueue(new Uint8Array(e),1,[e])}).catch(e=>{t.error(e)})},t.onCancel=e=>{n.cancel(e),t.ready.catch(e=>{if(!this.destroyed)throw e})}}),e.on(`GetDoc`,({pdfInfo:e})=>{this._numPages=e.numPages,this._htmlForXfa=e.htmlForXfa,delete e.htmlForXfa,t._capability.resolve(new kC(e,this))}),e.on(`DocException`,e=>{t._capability.reject(zx(e))}),e.on(`PasswordRequest`,e=>{this.#passwordCapability=Promise.withResolvers();try{if(!t.onPassword)throw zx(e);t.onPassword(e=>{e instanceof Error?this.#passwordCapability.reject(e):this.#passwordCapability.resolve({password:e})},e.code)}catch(e){this.#passwordCapability.reject(e)}return this.#passwordCapability.promise}),e.on(`DataLoaded`,e=>{t.onProgress?.({loaded:e.length,total:e.length}),this.downloadInfoCapability.resolve(e)}),e.on(`StartRenderPage`,e=>{this.destroyed||this.#pageCache.get(e.pageIndex)._startRenderPage(e.transparency,e.cacheKey)}),e.on(`commonobj`,([t,n,r])=>{if(this.destroyed||this.commonObjs.has(t))return null;switch(n){case`Font`:if(`error`in r){let e=r.error;Z(`Error during font loading: ${e}`),this.commonObjs.resolve(t,e);break}let i=this._params.pdfBug&&globalThis.FontInspector?.enabled?(e,t)=>globalThis.FontInspector.fontAdded(e,t):null,a=new kx(r,i);this.fontLoader.bind(a).catch(()=>e.sendWithPromise(`FontFallback`,{id:t})).finally(()=>{!a.fontExtraProperties&&a.data&&(a.data=null),this.commonObjs.resolve(t,a)});break;case`CopyLocalImage`:let{imageRef:o}=r;lb(o,`The imageRef must be defined.`);for(let e of this.#pageCache.values())for(let[,n]of e.objs){if(n?.ref!==o)continue;return n.dataLen?(this.commonObjs.resolve(t,structuredClone(n)),n.dataLen):null}break;case`FontPath`:case`Image`:case`Pattern`:this.commonObjs.resolve(t,r);break;default:throw Error(`Got unknown common object type ${n}`)}return null}),e.on(`obj`,([e,t,n,r])=>{if(this.destroyed)return;let i=this.#pageCache.get(t);if(!i.objs.has(e)){if(i._intentStates.size===0){r?.bitmap?.close();return}switch(n){case`Image`:case`Pattern`:i.objs.resolve(e,r);break;default:throw Error(`Got unknown object type ${n}`)}}}),e.on(`DocProgress`,e=>{this.destroyed||t.onProgress?.({loaded:e.loaded,total:e.total})}),e.on(`FetchBinaryData`,async e=>{if(this.destroyed)throw Error(`Worker was destroyed.`);let t=this[e.type];if(!t)throw Error(`${e.type} not initialized, see the \`useWorkerFetch\` parameter.`);return t.fetch(e)})}getData(){return this.messageHandler.sendWithPromise(`GetData`,null)}saveDocument(){this.annotationStorage.size<=0&&Z("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise(`SaveDocument`,{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(Error(`Invalid page request.`));let t=e-1,n=this.#pagePromises.get(t);if(n)return n;let r=this.messageHandler.sendWithPromise(`GetPage`,{pageIndex:t}).then(n=>{if(this.destroyed)throw Error(`Transport destroyed`);n.refStr&&this.#pageRefCache.set(n.refStr,e);let r=new AC(t,n,this,this._params.pdfBug);return this.#pageCache.set(t,r),r});return this.#pagePromises.set(t,r),r}getPageIndex(e){return Nx(e)?this.messageHandler.sendWithPromise(`GetPageIndex`,{num:e.num,gen:e.gen}):Promise.reject(Error(`Invalid pageIndex request.`))}getAnnotations(e,t){return this.messageHandler.sendWithPromise(`GetAnnotations`,{pageIndex:e,intent:t})}getFieldObjects(){return this.#cacheSimpleMethod(`GetFieldObjects`)}hasJSActions(){return this.#cacheSimpleMethod(`HasJSActions`)}getCalculationOrderIds(){return this.messageHandler.sendWithPromise(`GetCalculationOrderIds`,null)}getDestinations(){return this.messageHandler.sendWithPromise(`GetDestinations`,null)}getDestination(e){return typeof e==`string`?this.messageHandler.sendWithPromise(`GetDestination`,{id:e}):Promise.reject(Error(`Invalid destination request.`))}getPageLabels(){return this.messageHandler.sendWithPromise(`GetPageLabels`,null)}getPageLayout(){return this.messageHandler.sendWithPromise(`GetPageLayout`,null)}getPageMode(){return this.messageHandler.sendWithPromise(`GetPageMode`,null)}getViewerPreferences(){return this.messageHandler.sendWithPromise(`GetViewerPreferences`,null)}getOpenAction(){return this.messageHandler.sendWithPromise(`GetOpenAction`,null)}getAttachments(){return this.messageHandler.sendWithPromise(`GetAttachments`,null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise(`GetAnnotationsByType`,{types:e,pageIndexesToSkip:t})}getDocJSActions(){return this.#cacheSimpleMethod(`GetDocJSActions`)}getPageJSActions(e){return this.messageHandler.sendWithPromise(`GetPageJSActions`,{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise(`GetStructTree`,{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise(`GetOutline`,null)}getOptionalContentConfig(e){return this.#cacheSimpleMethod(`GetOptionalContentConfig`).then(t=>new GS(t,e))}getPermissions(){return this.messageHandler.sendWithPromise(`GetPermissions`,null)}getMetadata(){let e=`GetMetadata`,t=this.#methodPromises.get(e);if(t)return t;let n=this.messageHandler.sendWithPromise(e,null).then(e=>({info:e[0],metadata:e[1]?new HS(e[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#methodPromises.set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise(`GetMarkInfo`,null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise(`Cleanup`,null);for(let e of this.#pageCache.values())if(!e.cleanup())throw Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#methodPromises.clear(),this.filterFactory.destroy(!0),CC.cleanup()}}cachedPageNumber(e){if(!Nx(e))return null;let t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return this.#pageRefCache.get(t)??null}},NC=class{#internalRenderTask=null;onContinue=null;onError=null;constructor(e){this.#internalRenderTask=e}get promise(){return this.#internalRenderTask.capability.promise}cancel(e=0){this.#internalRenderTask.cancel(null,e)}get separateAnnots(){let{separateAnnots:e}=this.#internalRenderTask.operatorList;if(!e)return!1;let{annotationCanvasMap:t}=this.#internalRenderTask;return e.form||e.canvas&&t?.size>0}},PC=class e{#rAF=null;static#canvasInUse=new WeakSet;constructor({callback:e,params:t,objs:n,commonObjs:r,annotationCanvasMap:i,operatorList:a,pageIndex:o,canvasFactory:s,filterFactory:c,useRequestAnimationFrame:l=!1,pdfBug:u=!1,pageColors:d=null,enableHWA:f=!1,filteredOperationIndexes:p=null}){this.callback=e,this.params=t,this.objs=n,this.commonObjs=r,this.annotationCanvasMap=i,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=s,this.filterFactory=c,this._pdfBug=u,this.pageColors=d,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=l===!0&&typeof window<`u`,this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new NC(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=f,this._dependencyTracker=t.dependencyTracker,this._filteredOperationIndexes=p}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:n}){if(this.cancelled)return;if(this._canvas){if(e.#canvasInUse.has(this._canvas))throw Error(`Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.`);e.#canvasInUse.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{viewport:r,transform:i,background:a,dependencyTracker:o}=this.params,s=this._canvasContext||this._canvas.getContext(`2d`,{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new BS(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:n},this.annotationCanvasMap,this.pageColors,o),this.gfx.beginDrawing({transform:i,viewport:r,transparency:t,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,n=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#rAF&&=(window.cancelAnimationFrame(this.#rAF),null),e.#canvasInUse.delete(this._canvas),t||=new Hb(`Rendering cancelled, page ${this._pageIndex+1}`,n),this.callback(t),this.task.onError?.(t)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#rAF=window.requestAnimationFrame(()=>{this.#rAF=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._filteredOperationIndexes),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),e.#canvasInUse.delete(this._canvas),this.callback())))}},FC=`5.4.149`,IC=`9e2e9e209`,LC=class e{#button=null;#buttonSwatch=null;#defaultColor;#dropdown=null;#dropdownWasFromKeyboard=!1;#isMainColorPicker=!1;#editor=null;#eventBus;#openDropdownAC=null;#uiManager=null;static#l10nColor=null;static get _keyboardManager(){return pb(this,`_keyboardManager`,new px([[[`Escape`,`mac+Escape`],e.prototype._hideDropdownFromKeyboard],[[` `,`mac+ `],e.prototype._colorSelectFromKeyboard],[[`ArrowDown`,`ArrowRight`,`mac+ArrowDown`,`mac+ArrowRight`],e.prototype._moveToNext],[[`ArrowUp`,`ArrowLeft`,`mac+ArrowUp`,`mac+ArrowLeft`],e.prototype._moveToPrevious],[[`Home`,`mac+Home`],e.prototype._moveToBeginning],[[`End`,`mac+End`],e.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:n=null}){t?(this.#isMainColorPicker=!1,this.#editor=t):this.#isMainColorPicker=!0,this.#uiManager=t?._uiManager||n,this.#eventBus=this.#uiManager._eventBus,this.#defaultColor=t?.color?.toUpperCase()||this.#uiManager?.highlightColors.values().next().value||`#FFFF98`,e.#l10nColor||=Object.freeze({blue:`pdfjs-editor-colorpicker-blue`,green:`pdfjs-editor-colorpicker-green`,pink:`pdfjs-editor-colorpicker-pink`,red:`pdfjs-editor-colorpicker-red`,yellow:`pdfjs-editor-colorpicker-yellow`})}renderButton(){let e=this.#button=document.createElement(`button`);e.className=`colorPicker`,e.tabIndex=`0`,e.setAttribute(`data-l10n-id`,`pdfjs-editor-colorpicker-button`),e.ariaHasPopup=`true`,this.#editor&&(e.ariaControls=`${this.#editor.id}_colorpicker_dropdown`);let t=this.#uiManager._signal;e.addEventListener(`click`,this.#openDropdown.bind(this),{signal:t}),e.addEventListener(`keydown`,this.#keyDown.bind(this),{signal:t});let n=this.#buttonSwatch=document.createElement(`span`);return n.className=`swatch`,n.ariaHidden=`true`,n.style.backgroundColor=this.#defaultColor,e.append(n),e}renderMainDropdown(){let e=this.#dropdown=this.#getDropdownRoot();return e.ariaOrientation=`horizontal`,e.ariaLabelledBy=`highlightColorPickerLabel`,e}#getDropdownRoot(){let t=document.createElement(`div`),n=this.#uiManager._signal;t.addEventListener(`contextmenu`,Yb,{signal:n}),t.className=`dropdown`,t.role=`listbox`,t.ariaMultiSelectable=`false`,t.ariaOrientation=`vertical`,t.setAttribute(`data-l10n-id`,`pdfjs-editor-colorpicker-dropdown`),this.#editor&&(t.id=`${this.#editor.id}_colorpicker_dropdown`);for(let[r,i]of this.#uiManager.highlightColors){let a=document.createElement(`button`);a.tabIndex=`0`,a.role=`option`,a.setAttribute(`data-color`,i),a.title=r,a.setAttribute(`data-l10n-id`,e.#l10nColor[r]);let o=document.createElement(`span`);a.append(o),o.className=`swatch`,o.style.backgroundColor=i,a.ariaSelected=i===this.#defaultColor,a.addEventListener(`click`,this.#colorSelect.bind(this,i),{signal:n}),t.append(a)}return t.addEventListener(`keydown`,this.#keyDown.bind(this),{signal:n}),t}#colorSelect(e,t){t.stopPropagation(),this.#eventBus.dispatch(`switchannotationeditorparams`,{source:this,type:Jy.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)}_colorSelectFromKeyboard(e){if(e.target===this.#button){this.#openDropdown(e);return}let t=e.target.getAttribute(`data-color`);t&&this.#colorSelect(t,e)}_moveToNext(e){if(!this.#isDropdownVisible){this.#openDropdown(e);return}if(e.target===this.#button){this.#dropdown.firstChild?.focus();return}e.target.nextSibling?.focus()}_moveToPrevious(e){if(e.target===this.#dropdown?.firstChild||e.target===this.#button){this.#isDropdownVisible&&this._hideDropdownFromKeyboard();return}this.#isDropdownVisible||this.#openDropdown(e),e.target.previousSibling?.focus()}_moveToBeginning(e){if(!this.#isDropdownVisible){this.#openDropdown(e);return}this.#dropdown.firstChild?.focus()}_moveToEnd(e){if(!this.#isDropdownVisible){this.#openDropdown(e);return}this.#dropdown.lastChild?.focus()}#keyDown(t){e._keyboardManager.exec(this,t)}#openDropdown(e){if(this.#isDropdownVisible){this.hideDropdown();return}if(this.#dropdownWasFromKeyboard=e.detail===0,this.#openDropdownAC||(this.#openDropdownAC=new AbortController,window.addEventListener(`pointerdown`,this.#pointerDown.bind(this),{signal:this.#uiManager.combinedSignal(this.#openDropdownAC)})),this.#button.ariaExpanded=`true`,this.#dropdown){this.#dropdown.classList.remove(`hidden`);return}let t=this.#dropdown=this.#getDropdownRoot();this.#button.append(t)}#pointerDown(e){this.#dropdown?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#dropdown?.classList.add(`hidden`),this.#button.ariaExpanded=`false`,this.#openDropdownAC?.abort(),this.#openDropdownAC=null}get#isDropdownVisible(){return this.#dropdown&&!this.#dropdown.classList.contains(`hidden`)}_hideDropdownFromKeyboard(){if(!this.#isMainColorPicker){if(!this.#isDropdownVisible){this.#editor?.unselect();return}this.hideDropdown(),this.#button.focus({preventScroll:!0,focusVisible:this.#dropdownWasFromKeyboard})}}updateColor(e){if(this.#buttonSwatch&&(this.#buttonSwatch.style.backgroundColor=e),!this.#dropdown)return;let t=this.#uiManager.highlightColors.values();for(let n of this.#dropdown.children)n.ariaSelected=t.next().value===e.toUpperCase()}destroy(){this.#button?.remove(),this.#button=null,this.#buttonSwatch=null,this.#dropdown?.remove(),this.#dropdown=null}},RC=class e{#input=null;#editor=null;#uiManager=null;static#l10nColor=null;constructor(t){this.#editor=t,this.#uiManager=t._uiManager,e.#l10nColor||=Object.freeze({freetext:`pdfjs-editor-color-picker-free-text-input`,ink:`pdfjs-editor-color-picker-ink-input`})}renderButton(){if(this.#input)return this.#input;let{editorType:t,colorType:n,colorValue:r}=this.#editor,i=this.#input=document.createElement(`input`);return i.type=`color`,i.value=r||`#000000`,i.className=`basicColorPicker`,i.tabIndex=0,i.setAttribute(`data-l10n-id`,e.#l10nColor[t]),i.addEventListener(`input`,()=>{this.#uiManager.updateParams(n,i.value)},{signal:this.#uiManager._signal}),i}update(e){this.#input&&(this.#input.value=e)}destroy(){this.#input?.remove(),this.#input=null}hideDropdown(){}};function zC(e){return Math.floor(Math.max(0,Math.min(1,e))*255).toString(16).padStart(2,`0`)}function BC(e){return Math.max(0,Math.min(255,255*e))}var VC=class{static CMYK_G([e,t,n,r]){return[`G`,1-Math.min(1,.3*e+.59*n+.11*t+r)]}static G_CMYK([e]){return[`CMYK`,0,0,0,1-e]}static G_RGB([e]){return[`RGB`,e,e,e]}static G_rgb([e]){return e=BC(e),[e,e,e]}static G_HTML([e]){let t=zC(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return[`G`,.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(BC)}static RGB_HTML(e){return`#${e.map(zC).join(``)}`}static T_HTML(){return`#00000000`}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,r]){return[`RGB`,1-Math.min(1,e+r),1-Math.min(1,n+r),1-Math.min(1,t+r)]}static CMYK_rgb([e,t,n,r]){return[BC(1-Math.min(1,e+r)),BC(1-Math.min(1,n+r)),BC(1-Math.min(1,t+r))]}static CMYK_HTML(e){let t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){let r=1-e,i=1-t,a=1-n;return[`CMYK`,r,i,a,Math.min(r,i,a)]}},HC=class{create(e,t,n=!1){if(e<=0||t<=0)throw Error(`Invalid SVG dimensions`);let r=this._createSVG(`svg:svg`);return r.setAttribute(`version`,`1.1`),n||(r.setAttribute(`width`,`${e}px`),r.setAttribute(`height`,`${t}px`)),r.setAttribute(`preserveAspectRatio`,`none`),r.setAttribute(`viewBox`,`0 0 ${e} ${t}`),r}createElement(e){if(typeof e!=`string`)throw Error(`Invalid SVG element type`);return this._createSVG(e)}_createSVG(e){cb("Abstract method `_createSVG` called.")}},UC=class extends HC{_createSVG(e){return document.createElementNS(Rb,e)}},WC=class{static setupStorage(e,t,n,r,i){let a=r.getValue(t,{value:null});switch(n.name){case`textarea`:if(a.value!==null&&(e.textContent=a.value),i===`print`)break;e.addEventListener(`input`,e=>{r.setValue(t,{value:e.target.value})});break;case`input`:if(n.attributes.type===`radio`||n.attributes.type===`checkbox`){if(a.value===n.attributes.xfaOn?e.setAttribute(`checked`,!0):a.value===n.attributes.xfaOff&&e.removeAttribute(`checked`),i===`print`)break;e.addEventListener(`change`,e=>{r.setValue(t,{value:e.target.checked?e.target.getAttribute(`xfaOn`):e.target.getAttribute(`xfaOff`)})})}else{if(a.value!==null&&e.setAttribute(`value`,a.value),i===`print`)break;e.addEventListener(`input`,e=>{r.setValue(t,{value:e.target.value})})}break;case`select`:if(a.value!==null){e.setAttribute(`value`,a.value);for(let e of n.children)e.attributes.value===a.value?e.attributes.selected=!0:e.attributes.hasOwnProperty(`selected`)&&delete e.attributes.selected}e.addEventListener(`input`,e=>{let n=e.target.options,i=n.selectedIndex===-1?``:n[n.selectedIndex].value;r.setValue(t,{value:i})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:r,linkService:i}){let{attributes:a}=t,o=e instanceof HTMLAnchorElement;a.type===`radio`&&(a.name=`${a.name}-${r}`);for(let[t,n]of Object.entries(a)){if(n==null)continue;switch(t){case`class`:n.length&&e.setAttribute(t,n.join(` `));break;case`dataId`:break;case`id`:e.setAttribute(`data-element-id`,n);break;case`style`:Object.assign(e.style,n);break;case`textContent`:e.textContent=n;break;default:(!o||t!==`href`&&t!==`newWindow`)&&e.setAttribute(t,n)}}o&&i.addLinkAttributes(e,a.href,a.newWindow),n&&a.dataId&&this.setupStorage(e,a.dataId,t,n)}static render(e){let t=e.annotationStorage,n=e.linkService,r=e.xfaHtml,i=e.intent||`display`,a=document.createElement(r.name);r.attributes&&this.setAttributes({html:a,element:r,intent:i,linkService:n});let o=i!==`richText`,s=e.div;if(s.append(a),e.viewport){let t=`matrix(${e.viewport.transform.join(`,`)})`;s.style.transform=t}o&&s.setAttribute(`class`,`xfaLayer xfaFont`);let c=[];if(r.children.length===0){if(r.value){let e=document.createTextNode(r.value);a.append(e),o&&wC.shouldBuildText(r.name)&&c.push(e)}return{textDivs:c}}let l=[[r,-1,a]];for(;l.length>0;){let[e,r,a]=l.at(-1);if(r+1===e.children.length){l.pop();continue}let s=e.children[++l.at(-1)[1]];if(s===null)continue;let{name:u}=s;if(u===`#text`){let e=document.createTextNode(s.value);c.push(e),a.append(e);continue}let d=s?.attributes?.xmlns?document.createElementNS(s.attributes.xmlns,u):document.createElement(u);if(a.append(d),s.attributes&&this.setAttributes({html:d,element:s,storage:t,intent:i,linkService:n}),s.children?.length>0)l.push([s,-1,d]);else if(s.value){let e=document.createTextNode(s.value);o&&wC.shouldBuildText(u)&&c.push(e),d.append(e)}}for(let e of s.querySelectorAll(`.xfaNonInteractive input, .xfaNonInteractive textarea`))e.setAttribute(`readOnly`,!0);return{textDivs:c}}static update(e){let t=`matrix(${e.viewport.transform.join(`,`)})`;e.div.style.transform=t,e.div.hidden=!1}},GC=9,KC=new WeakSet,qC=new Date().getTimezoneOffset()*60*1e3,JC=class{static create(e){switch(e.data.annotationType){case Qy.LINK:return new XC(e);case Qy.TEXT:return new ZC(e);case Qy.WIDGET:switch(e.data.fieldType){case`Tx`:return new $C(e);case`Btn`:return e.data.radioButton?new nw(e):e.data.checkBox?new tw(e):new rw(e);case`Ch`:return new iw(e);case`Sig`:return new ew(e)}return new QC(e);case Qy.POPUP:return new aw(e);case Qy.FREETEXT:return new sw(e);case Qy.LINE:return new cw(e);case Qy.SQUARE:return new lw(e);case Qy.CIRCLE:return new uw(e);case Qy.POLYLINE:return new dw(e);case Qy.CARET:return new pw(e);case Qy.INK:return new mw(e);case Qy.POLYGON:return new fw(e);case Qy.HIGHLIGHT:return new hw(e);case Qy.UNDERLINE:return new gw(e);case Qy.SQUIGGLY:return new _w(e);case Qy.STRIKEOUT:return new vw(e);case Qy.STAMP:return new yw(e);case Qy.FILEATTACHMENT:return new bw(e);default:return new YC(e)}}},YC=class e{#updates=null;#hasBorder=!1;#popupElement=null;constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:r=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(n)),r&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e?.str||t?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return e._hasPopupData(this.data)}get hasCommentButton(){return this.enableComment&&this._isEditable&&this.hasPopupElement}get commentButtonPosition(){let{quadPoints:e,rect:t}=this.data,n=-1/0,r=-1/0;if(e?.length>=8){for(let t=0;t<e.length;t+=8)e[t+1]>r?(r=e[t+1],n=e[t+2]):e[t+1]===r&&(n=Math.max(n,e[t+2]));return[n,r]}return t?[t[2],t[3]]:null}get commentButtonColor(){if(!this.data.color)return null;let[e,t,n]=this.data.color,r=255*(1-(this.data.opacity??1));return this.#changeLightness(Math.min(e+r,255),Math.min(t+r,255),Math.min(n+r,255))}#changeLightness(e,t,n){e/=255,t/=255,n/=255;let r=Math.max(e,t,n),i=Math.min(e,t,n),a=(r+i)/2,o=((1+Math.sqrt(a))/2*100).toFixed(2);if(r===i)return`hsl(0, 0%, ${o}%)`;let s=r-i,c;c=r===e?(t-n)/s+(t<n?6:0):r===t?(n-e)/s+2:(e-t)/s+4,c=(c*60).toFixed(2);let l=(s/(1-Math.abs(2*a-1))*100).toFixed(2);return`hsl(${c}, ${l}%, ${o}%)`}_normalizePoint(e){let{page:{view:t},viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:i,pageY:a}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-i)/n,e[1]=100*(e[1]-a)/r,e}updateEdited(e){if(!this.container)return;e.rect&&(this.#updates||={rect:this.data.rect.slice(0)});let{rect:t,popup:n}=e;t&&this.#setRectEdited(t);let r=this.#popupElement?.popup||this.popup;!r&&n?.text&&(this._createPopup(n),r=this.#popupElement.popup),r&&(r.updateEdited(e),n?.deleted&&(r.remove(),this.#popupElement=null,this.popup=null))}resetEdited(){this.#updates&&=(this.#setRectEdited(this.#updates.rect),this.#popupElement?.popup.resetEdited(),null)}#setRectEdited(e){let{container:{style:t},data:{rect:n,rotation:r},parent:{viewport:{rawDims:{pageWidth:i,pageHeight:a,pageX:o,pageY:s}}}}=this;n?.splice(0,4,...e),t.left=`${100*(e[0]-o)/i}%`,t.top=`${100*(a-e[3]+s)/a}%`,r===0?(t.width=`${100*(e[2]-e[0])/i}%`,t.height=`${100*(e[3]-e[1])/a}%`):this.setRotation(r)}_createContainer(e){let{data:t,parent:{page:n,viewport:r}}=this,i=document.createElement(`section`);i.setAttribute(`data-annotation-id`,t.id),!(this instanceof QC)&&!(this instanceof XC)&&(i.tabIndex=0);let{style:a}=i;if(a.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(i.title=t.alternativeText),t.noRotate&&i.classList.add(`norotate`),!t.rect||this instanceof aw){let{rotation:e}=t;return!t.hasOwnCanvas&&e!==0&&this.setRotation(e,i),i}let{width:o,height:s}=this;if(!e&&t.borderStyle.width>0){a.borderWidth=`${t.borderStyle.width}px`;let e=t.borderStyle.horizontalCornerRadius,n=t.borderStyle.verticalCornerRadius;switch(e>0||n>0?a.borderRadius=`calc(${e}px * var(--total-scale-factor)) / calc(${n}px * var(--total-scale-factor))`:this instanceof nw&&(a.borderRadius=`calc(${o}px * var(--total-scale-factor)) / calc(${s}px * var(--total-scale-factor))`),t.borderStyle.style){case $y.SOLID:a.borderStyle=`solid`;break;case $y.DASHED:a.borderStyle=`dashed`;break;case $y.BEVELED:Z(`Unimplemented border style: beveled`);break;case $y.INSET:Z(`Unimplemented border style: inset`);break;case $y.UNDERLINE:a.borderBottomStyle=`solid`;break;default:break}let r=t.borderColor||null;r?(this.#hasBorder=!0,a.borderColor=Q.makeHexColor(r[0]|0,r[1]|0,r[2]|0)):a.borderWidth=0}let c=Q.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:l,pageHeight:u,pageX:d,pageY:f}=r.rawDims;a.left=`${100*(c[0]-d)/l}%`,a.top=`${100*(c[1]-f)/u}%`;let{rotation:p}=t;return t.hasOwnCanvas||p===0?(a.width=`${100*o/l}%`,a.height=`${100*s/u}%`):this.setRotation(p,i),i}setRotation(e,t=this.container){if(!this.data.rect)return;let{pageWidth:n,pageHeight:r}=this.parent.viewport.rawDims,{width:i,height:a}=this;e%180!=0&&([i,a]=[a,i]),t.style.width=`${100*i/n}%`,t.style.height=`${100*a/r}%`,t.setAttribute(`data-main-rotation`,(360-e)%360)}get _commonActions(){let e=(e,t,n)=>{let r=n.detail[e],i=r[0],a=r.slice(1);n.target.style[t]=VC[`${i}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[t]:VC[`${i}_rgb`](a)})};return pb(this,`_commonActions`,{display:e=>{let{display:t}=e.detail,n=t%2==1;this.container.style.visibility=n?`hidden`:`visible`,this.annotationStorage.setValue(this.data.id,{noView:n,noPrint:t===1||t===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{let{hidden:t}=e.detail;this.container.style.visibility=t?`hidden`:`visible`,this.annotationStorage.setValue(this.data.id,{noPrint:t,noView:t})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:t=>{e(`bgColor`,`backgroundColor`,t)},fillColor:t=>{e(`fillColor`,`backgroundColor`,t)},fgColor:t=>{e(`fgColor`,`color`,t)},textColor:t=>{e(`textColor`,`color`,t)},borderColor:t=>{e(`borderColor`,`borderColor`,t)},strokeColor:t=>{e(`strokeColor`,`borderColor`,t)},rotation:e=>{let t=e.detail.rotation;this.setRotation(t),this.annotationStorage.setValue(this.data.id,{rotation:t})}})}_dispatchEventFromSandbox(e,t){let n=this._commonActions;for(let r of Object.keys(t.detail))(e[r]||n[r])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;let t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;let n=this._commonActions;for(let[r,i]of Object.entries(t)){let a=n[r];a&&(a({detail:{[r]:i},target:e}),delete t[r])}}_createQuadrilaterals(){if(!this.container)return;let{quadPoints:e}=this.data;if(!e)return;let[t,n,r,i]=this.data.rect.map(e=>Math.fround(e));if(e.length===8){let[a,o,s,c]=e.subarray(2,6);if(r===a&&i===o&&t===s&&n===c)return}let{style:a}=this.container,o;if(this.#hasBorder){let{borderColor:e,borderWidth:t}=a;a.borderWidth=0,o=[`url('data:image/svg+xml;utf8,`,`<svg xmlns="http://www.w3.org/2000/svg"`,` preserveAspectRatio="none" viewBox="0 0 1 1">`,`<g fill="transparent" stroke="${e}" stroke-width="${t}">`],this.container.classList.add(`hasBorder`)}let s=r-t,c=i-n,{svgFactory:l}=this,u=l.createElement(`svg`);u.classList.add(`quadrilateralsContainer`),u.setAttribute(`width`,0),u.setAttribute(`height`,0),u.role=`none`;let d=l.createElement(`defs`);u.append(d);let f=l.createElement(`clipPath`),p=`clippath_${this.data.id}`;f.setAttribute(`id`,p),f.setAttribute(`clipPathUnits`,`objectBoundingBox`),d.append(f);for(let n=2,r=e.length;n<r;n+=8){let r=e[n],a=e[n+1],u=e[n+2],d=e[n+3],p=l.createElement(`rect`),m=(u-t)/s,h=(i-a)/c,g=(r-u)/s,_=(a-d)/c;p.setAttribute(`x`,m),p.setAttribute(`y`,h),p.setAttribute(`width`,g),p.setAttribute(`height`,_),f.append(p),o?.push(`<rect vector-effect="non-scaling-stroke" x="${m}" y="${h}" width="${g}" height="${_}"/>`)}this.#hasBorder&&(o.push(`</g></svg>')`),a.backgroundImage=o.join(``)),this.container.append(u),this.container.style.clipPath=`url(#${p})`}_createPopup(e=null){let{data:t}=this,n,r;e?(n={str:e.text},r=e.date):(n=t.contentsObj,r=t.modificationDate);let i=this.#popupElement=new aw({data:{color:t.color,titleObj:t.titleObj,modificationDate:r,contentsObj:n,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]});this.parent.div.append(i.render())}get hasPopupElement(){return!!(this.#popupElement||this.popup||this.data.popupRef)}render(){cb("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){let n=[];if(this._fieldObjects){let r=this._fieldObjects[e];if(r)for(let{page:e,id:i,exportValues:a}of r){if(e===-1||i===t)continue;let r=typeof a==`string`?a:null,o=document.querySelector(`[data-element-id="${i}"]`);if(o&&!KC.has(o)){Z(`_getElementsByName - element not allowed: ${i}`);continue}n.push({id:i,exportValue:r,domElement:o})}return n}for(let r of document.getElementsByName(e)){let{exportValue:e}=r,i=r.getAttribute(`data-element-id`);if(i===t||!KC.has(r))continue;n.push({id:i,exportValue:e,domElement:r})}return n}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(let t of e)t.classList.add(`highlightArea`);else e.classList.add(`highlightArea`)}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener(`dblclick`,()=>{this.linkService.eventBus?.dispatch(`switchannotationeditormode`,{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}},XC=class extends YC{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){let{data:e,linkService:t}=this,n=document.createElement(`a`);n.setAttribute(`data-element-id`,e.id);let r=!1;return e.url?(t.addLinkAttributes(n,e.url,e.newWindow),r=!0):e.action?(this._bindNamedAction(n,e.action,e.overlaidText),r=!0):e.attachment?(this.#bindAttachment(n,e.attachment,e.overlaidText,e.attachmentDest),r=!0):e.setOCGState?(this.#bindSetOCGState(n,e.setOCGState,e.overlaidText),r=!0):e.dest?(this._bindLink(n,e.dest,e.overlaidText),r=!0):(e.actions&&(e.actions.Action||e.actions[`Mouse Up`]||e.actions[`Mouse Down`])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,e),r=!0),e.resetForm?(this._bindResetFormAction(n,e.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(n,``),r=!0)),this.container.classList.add(`linkAnnotation`),r&&this.container.append(n),this.container}#setInternalLink(){this.container.setAttribute(`data-internal-link`,``)}_bindLink(e,t,n=``){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||t===``)&&this.#setInternalLink(),n&&(e.title=n)}_bindNamedAction(e,t,n=``){e.href=this.linkService.getAnchorUrl(``),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),n&&(e.title=n),this.#setInternalLink()}#bindAttachment(e,t,n=``,r=null){e.href=this.linkService.getAnchorUrl(``),t.description?e.title=t.description:n&&(e.title=n),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,r),!1),this.#setInternalLink()}#bindSetOCGState(e,t,n=``){e.href=this.linkService.getAnchorUrl(``),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),n&&(e.title=n),this.#setInternalLink()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl(``);let n=new Map([[`Action`,`onclick`],[`Mouse Up`,`onmouseup`],[`Mouse Down`,`onmousedown`]]);for(let r of Object.keys(t.actions)){let i=n.get(r);if(!i)continue;e[i]=()=>(this.linkService.eventBus?.dispatch(`dispatcheventinsandbox`,{source:this,detail:{id:t.id,name:r}}),!1)}t.overlaidText&&(e.title=t.overlaidText),e.onclick||=()=>!1,this.#setInternalLink()}_bindResetFormAction(e,t){let n=e.onclick;if(n||(e.href=this.linkService.getAnchorUrl(``)),this.#setInternalLink(),!this._fieldObjects){Z('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),n||(e.onclick=()=>!1);return}e.onclick=()=>{n?.();let{fields:e,refs:r,include:i}=t,a=[];if(e.length!==0||r.length!==0){let t=new Set(r);for(let n of e){let e=this._fieldObjects[n]||[];for(let{id:n}of e)t.add(n)}for(let e of Object.values(this._fieldObjects))for(let n of e)t.has(n.id)===i&&a.push(n)}else for(let e of Object.values(this._fieldObjects))a.push(...e);let o=this.annotationStorage,s=[];for(let e of a){let{id:t}=e;switch(s.push(t),e.type){case`text`:{let n=e.defaultValue||``;o.setValue(t,{value:n});break}case`checkbox`:case`radiobutton`:{let n=e.defaultValue===e.exportValues;o.setValue(t,{value:n});break}case`combobox`:case`listbox`:{let n=e.defaultValue||``;o.setValue(t,{value:n});break}default:continue}let n=document.querySelector(`[data-element-id="${t}"]`);if(n){if(!KC.has(n)){Z(`_bindResetFormAction - element not allowed: ${t}`);continue}}else continue;n.dispatchEvent(new Event(`resetform`))}return this.enableScripting&&this.linkService.eventBus?.dispatch(`dispatcheventinsandbox`,{source:this,detail:{id:`app`,ids:s,name:`ResetForm`}}),!1}}},ZC=class extends YC{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add(`textAnnotation`);let e=document.createElement(`img`);return e.src=this.imageResourcesPath+`annotation-`+this.data.name.toLowerCase()+`.svg`,e.setAttribute(`data-l10n-id`,`pdfjs-text-annotation-type`),e.setAttribute(`data-l10n-args`,JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}},QC=class extends YC{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName===`CANVAS`&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Eb.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,r,i){n.includes(`mouse`)?e.addEventListener(n,e=>{this.linkService.eventBus?.dispatch(`dispatcheventinsandbox`,{source:this,detail:{id:this.data.id,name:r,value:i(e),shift:e.shiftKey,modifier:this._getKeyModifier(e)}})}):e.addEventListener(n,e=>{if(n===`blur`){if(!t.focused||!e.relatedTarget)return;t.focused=!1}else if(n===`focus`){if(t.focused)return;t.focused=!0}i&&this.linkService.eventBus?.dispatch(`dispatcheventinsandbox`,{source:this,detail:{id:this.data.id,name:r,value:i(e)}})})}_setEventListeners(e,t,n,r){for(let[i,a]of n)(a===`Action`||this.data.actions?.[a])&&((a===`Focus`||a===`Blur`)&&(t||={focused:!1}),this._setEventListener(e,t,i,a,r),a===`Focus`&&!this.data.actions?.Blur?this._setEventListener(e,t,`blur`,`Blur`,null):a===`Blur`&&!this.data.actions?.Focus&&this._setEventListener(e,t,`focus`,`Focus`,null))}_setBackgroundColor(e){let t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?`transparent`:Q.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){let t=[`left`,`center`,`right`],{fontColor:n}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||GC,i=e.style,a,o=e=>Math.round(10*e)/10;if(this.data.multiLine){let e=Math.abs(this.data.rect[3]-this.data.rect[1]-2),t=Math.round(e/(Wy*r))||1,n=e/t;a=Math.min(r,o(n/Wy))}else{let e=Math.abs(this.data.rect[3]-this.data.rect[1]-2);a=Math.min(r,o(e/Wy))}i.fontSize=`calc(${a}px * var(--total-scale-factor))`,i.color=Q.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(i.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute(`required`,!0):e.removeAttribute(`required`),e.setAttribute(`aria-required`,t)}},$C=class extends QC{constructor(e){let t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,r){let i=this.annotationStorage;for(let a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=n),i.setValue(a.id,{[r]:n})}render(){let e=this.annotationStorage,t=this.data.id;this.container.classList.add(`textWidgetAnnotation`);let n=null;if(this.renderForms){let r=e.getValue(t,{value:this.data.fieldValue}),i=r.value||``,a=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;a&&i.length>a&&(i=i.slice(0,a));let o=r.formattedValue||this.data.textContent?.join(`
`)||null;o&&this.data.comb&&(o=o.replaceAll(/\s+/g,``));let s={userValue:i,formattedValue:o,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement(`textarea`),n.textContent=o??i,this.data.doNotScroll&&(n.style.overflowY=`hidden`)):(n=document.createElement(`input`),n.type=this.data.password?`password`:`text`,n.setAttribute(`value`,o??i),this.data.doNotScroll&&(n.style.overflowX=`hidden`)),this.data.hasOwnCanvas&&(n.hidden=!0),KC.add(n),n.setAttribute(`data-element-id`,t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;let{datetimeFormat:c,datetimeType:l,timeStep:u}=this.data,d=!!l&&this.enableScripting;c&&(n.title=c),this._setRequired(n,this.data.required),a&&(n.maxLength=a),n.addEventListener(`input`,r=>{e.setValue(t,{value:r.target.value}),this.setPropertyOnSiblings(n,`value`,r.target.value,`value`),s.formattedValue=null}),n.addEventListener(`resetform`,e=>{n.value=s.userValue=this.data.defaultFieldValue??``,s.formattedValue=null});let f=e=>{let{formattedValue:t}=s;t!=null&&(e.target.value=t),e.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener(`focus`,e=>{if(s.focused)return;let{target:t}=e;if(d&&(t.type=l,u&&(t.step=u)),s.userValue){let e=s.userValue;if(d)if(l===`time`){let n=new Date(e);t.value=[n.getHours(),n.getMinutes(),n.getSeconds()].map(e=>e.toString().padStart(2,`0`)).join(`:`)}else t.value=new Date(e-qC).toISOString().split(l===`date`?`T`:`.`,1)[0];else t.value=e}s.lastCommittedValue=t.value,s.commitKey=1,this.data.actions?.Focus||(s.focused=!0)}),n.addEventListener(`updatefromsandbox`,n=>{this.showElementAndHideCanvas(n.target),this._dispatchEventFromSandbox({value(n){s.userValue=n.detail.value??``,d||e.setValue(t,{value:s.userValue.toString()}),n.target.value=s.userValue},formattedValue(n){let{formattedValue:r}=n.detail;s.formattedValue=r,r!=null&&n.target!==document.activeElement&&(n.target.value=r);let i={formattedValue:r};d&&(i.value=r),e.setValue(t,i)},selRange(e){e.target.setSelectionRange(...e.detail.selRange)},charLimit:n=>{let{charLimit:r}=n.detail,{target:i}=n;if(r===0){i.removeAttribute(`maxLength`);return}i.setAttribute(`maxLength`,r);let a=s.userValue;!a||a.length<=r||(a=a.slice(0,r),i.value=s.userValue=a,e.setValue(t,{value:a}),this.linkService.eventBus?.dispatch(`dispatcheventinsandbox`,{source:this,detail:{id:t,name:`Keystroke`,value:a,willCommit:!0,commitKey:1,selStart:i.selectionStart,selEnd:i.selectionEnd}}))}},n)}),n.addEventListener(`keydown`,e=>{s.commitKey=1;let n=-1;if(e.key===`Escape`?n=0:e.key===`Enter`&&!this.data.multiLine?n=2:e.key===`Tab`&&(s.commitKey=3),n===-1)return;let{value:r}=e.target;s.lastCommittedValue!==r&&(s.lastCommittedValue=r,s.userValue=r,this.linkService.eventBus?.dispatch(`dispatcheventinsandbox`,{source:this,detail:{id:t,name:`Keystroke`,value:r,willCommit:!0,commitKey:n,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}))});let r=f;f=null,n.addEventListener(`blur`,e=>{if(!s.focused||!e.relatedTarget)return;this.data.actions?.Blur||(s.focused=!1);let{target:n}=e,{value:i}=n;if(d){if(i&&l===`time`){let e=i.split(`:`).map(e=>parseInt(e,10));i=new Date(2e3,0,1,e[0],e[1],e[2]||0).valueOf(),n.step=``}else i=new Date(i).valueOf();n.type=`text`}s.userValue=i,s.lastCommittedValue!==i&&this.linkService.eventBus?.dispatch(`dispatcheventinsandbox`,{source:this,detail:{id:t,name:`Keystroke`,value:i,willCommit:!0,commitKey:s.commitKey,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}),r(e)}),this.data.actions?.Keystroke&&n.addEventListener(`beforeinput`,e=>{s.lastCommittedValue=null;let{data:n,target:r}=e,{value:i,selectionStart:a,selectionEnd:o}=r,c=a,l=o;switch(e.inputType){case`deleteWordBackward`:{let e=i.substring(0,a).match(/\w*[^\w]*$/);e&&(c-=e[0].length);break}case`deleteWordForward`:{let e=i.substring(a).match(/^[^\w]*\w*/);e&&(l+=e[0].length);break}case`deleteContentBackward`:a===o&&--c;break;case`deleteContentForward`:a===o&&(l+=1);break}e.preventDefault(),this.linkService.eventBus?.dispatch(`dispatcheventinsandbox`,{source:this,detail:{id:t,name:`Keystroke`,value:i,change:n||``,willCommit:!1,selStart:c,selEnd:l}})}),this._setEventListeners(n,s,[[`focus`,`Focus`],[`blur`,`Blur`],[`mousedown`,`Mouse Down`],[`mouseenter`,`Mouse Enter`],[`mouseleave`,`Mouse Exit`],[`mouseup`,`Mouse Up`]],e=>e.target.value)}if(f&&n.addEventListener(`blur`,f),this.data.comb){let e=(this.data.rect[2]-this.data.rect[0])/a;n.classList.add(`comb`),n.style.letterSpacing=`calc(${e}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement(`div`),n.textContent=this.data.fieldValue,n.style.verticalAlign=`middle`,n.style.display=`table-cell`,this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}},ew=class extends QC{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}},tw=class extends QC{constructor(e){super(e,{isRenderable:e.renderForms})}render(){let e=this.annotationStorage,t=this.data,n=t.id,r=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof r==`string`&&(r=r!==`Off`,e.setValue(n,{value:r})),this.container.classList.add(`buttonWidgetAnnotation`,`checkBox`);let i=document.createElement(`input`);return KC.add(i),i.setAttribute(`data-element-id`,n),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type=`checkbox`,i.name=t.fieldName,r&&i.setAttribute(`checked`,!0),i.setAttribute(`exportValue`,t.exportValue),i.tabIndex=0,i.addEventListener(`change`,r=>{let{name:i,checked:a}=r.target;for(let r of this._getElementsByName(i,n)){let n=a&&r.exportValue===t.exportValue;r.domElement&&(r.domElement.checked=n),e.setValue(r.id,{value:n})}e.setValue(n,{value:a})}),i.addEventListener(`resetform`,e=>{let n=t.defaultFieldValue||`Off`;e.target.checked=n===t.exportValue}),this.enableScripting&&this.hasJSActions&&(i.addEventListener(`updatefromsandbox`,t=>{this._dispatchEventFromSandbox({value(t){t.target.checked=t.detail.value!==`Off`,e.setValue(n,{value:t.target.checked})}},t)}),this._setEventListeners(i,null,[[`change`,`Validate`],[`change`,`Action`],[`focus`,`Focus`],[`blur`,`Blur`],[`mousedown`,`Mouse Down`],[`mouseenter`,`Mouse Enter`],[`mouseleave`,`Mouse Exit`],[`mouseup`,`Mouse Up`]],e=>e.target.checked)),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}},nw=class extends QC{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add(`buttonWidgetAnnotation`,`radioButton`);let e=this.annotationStorage,t=this.data,n=t.id,r=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof r==`string`&&(r=r!==t.buttonValue,e.setValue(n,{value:r})),r)for(let r of this._getElementsByName(t.fieldName,n))e.setValue(r.id,{value:!1});let i=document.createElement(`input`);if(KC.add(i),i.setAttribute(`data-element-id`,n),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type=`radio`,i.name=t.fieldName,r&&i.setAttribute(`checked`,!0),i.tabIndex=0,i.addEventListener(`change`,t=>{let{name:r,checked:i}=t.target;for(let t of this._getElementsByName(r,n))e.setValue(t.id,{value:!1});e.setValue(n,{value:i})}),i.addEventListener(`resetform`,e=>{let n=t.defaultFieldValue;e.target.checked=n!=null&&n===t.buttonValue}),this.enableScripting&&this.hasJSActions){let r=t.buttonValue;i.addEventListener(`updatefromsandbox`,t=>{this._dispatchEventFromSandbox({value:t=>{let i=r===t.detail.value;for(let r of this._getElementsByName(t.target.name)){let t=i&&r.id===n;r.domElement&&(r.domElement.checked=t),e.setValue(r.id,{value:t})}}},t)}),this._setEventListeners(i,null,[[`change`,`Validate`],[`change`,`Action`],[`focus`,`Focus`],[`blur`,`Blur`],[`mousedown`,`Mouse Down`],[`mouseenter`,`Mouse Enter`],[`mouseleave`,`Mouse Exit`],[`mouseup`,`Mouse Up`]],e=>e.target.checked)}return this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}},rw=class extends XC{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){let e=super.render();e.classList.add(`buttonWidgetAnnotation`,`pushButton`);let t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener(`updatefromsandbox`,e=>{this._dispatchEventFromSandbox({},e)})),e}},iw=class extends QC{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add(`choiceWidgetAnnotation`);let e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),r=document.createElement(`select`);KC.add(r),r.setAttribute(`data-element-id`,t),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.fieldName,r.tabIndex=0;let i=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener(`resetform`,e=>{let t=this.data.defaultFieldValue;for(let e of r.options)e.selected=e.value===t});for(let e of this.data.options){let t=document.createElement(`option`);t.textContent=e.displayValue,t.value=e.exportValue,n.value.includes(e.exportValue)&&(t.setAttribute(`selected`,!0),i=!1),r.append(t)}let a=null;if(i){let e=document.createElement(`option`);e.value=` `,e.setAttribute(`hidden`,!0),e.setAttribute(`selected`,!0),r.prepend(e),a=()=>{e.remove(),r.removeEventListener(`input`,a),a=null},r.addEventListener(`input`,a)}let o=e=>{let t=e?`value`:`textContent`,{options:n,multiple:i}=r;return i?Array.prototype.filter.call(n,e=>e.selected).map(e=>e[t]):n.selectedIndex===-1?null:n[n.selectedIndex][t]},s=o(!1),c=e=>{let t=e.target.options;return Array.prototype.map.call(t,e=>({displayValue:e.textContent,exportValue:e.value}))};return this.enableScripting&&this.hasJSActions?(r.addEventListener(`updatefromsandbox`,n=>{this._dispatchEventFromSandbox({value(n){a?.();let i=n.detail.value,c=new Set(Array.isArray(i)?i:[i]);for(let e of r.options)e.selected=c.has(e.value);e.setValue(t,{value:o(!0)}),s=o(!1)},multipleSelection(e){r.multiple=!0},remove(n){let i=r.options,a=n.detail.remove;i[a].selected=!1,r.remove(a),i.length>0&&Array.prototype.findIndex.call(i,e=>e.selected)===-1&&(i[0].selected=!0),e.setValue(t,{value:o(!0),items:c(n)}),s=o(!1)},clear(n){for(;r.length!==0;)r.remove(0);e.setValue(t,{value:null,items:[]}),s=o(!1)},insert(n){let{index:i,displayValue:a,exportValue:l}=n.detail.insert,u=r.children[i],d=document.createElement(`option`);d.textContent=a,d.value=l,u?u.before(d):r.append(d),e.setValue(t,{value:o(!0),items:c(n)}),s=o(!1)},items(n){let{items:i}=n.detail;for(;r.length!==0;)r.remove(0);for(let e of i){let{displayValue:t,exportValue:n}=e,i=document.createElement(`option`);i.textContent=t,i.value=n,r.append(i)}r.options.length>0&&(r.options[0].selected=!0),e.setValue(t,{value:o(!0),items:c(n)}),s=o(!1)},indices(n){let r=new Set(n.detail.indices);for(let e of n.target.options)e.selected=r.has(e.index);e.setValue(t,{value:o(!0)}),s=o(!1)},editable(e){e.target.disabled=!e.detail.editable}},n)}),r.addEventListener(`input`,n=>{let r=o(!0),i=o(!1);e.setValue(t,{value:r}),n.preventDefault(),this.linkService.eventBus?.dispatch(`dispatcheventinsandbox`,{source:this,detail:{id:t,name:`Keystroke`,value:s,change:i,changeEx:r,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(r,null,[[`focus`,`Focus`],[`blur`,`Blur`],[`mousedown`,`Mouse Down`],[`mouseenter`,`Mouse Enter`],[`mouseleave`,`Mouse Exit`],[`mouseup`,`Mouse Up`],[`input`,`Action`],[`input`,`Validate`]],e=>e.target.value)):r.addEventListener(`input`,function(n){e.setValue(t,{value:o(!0)})}),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}},aw=class extends YC{constructor(e){let{data:t,elements:n}=e;super(e,{isRenderable:YC._hasPopupData(t)}),this.elements=n,this.popup=null}render(){let{container:e}=this;e.classList.add(`popupAnnotation`),e.role=`comment`;let t=this.popup=new ow({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,eventBus:this.linkService.eventBus}),n=[];for(let e of this.elements)e.popup=t,e.container.ariaHasPopup=`dialog`,n.push(e.data.id),e.addHighlightArea();return this.container.setAttribute(`aria-controls`,n.map(e=>`${Nb}${e}`).join(`,`)),this.container}},ow=class{#boundKeyDown=this.#keyDown.bind(this);#boundHide=this.#hide.bind(this);#boundShow=this.#show.bind(this);#boundToggle=this.#toggle.bind(this);#color=null;#container=null;#contentsObj=null;#dateObj=null;#elements=null;#eventBus=null;#parent=null;#parentRect=null;#pinned=!1;#popup=null;#popupAbortController=null;#position=null;#commentButton=null;#commentButtonPosition=null;#commentButtonColor=null;#rect=null;#richText=null;#titleObj=null;#updates=null;#wasVisible=!1;constructor({container:e,color:t,elements:n,titleObj:r,modificationDate:i,contentsObj:a,richText:o,parent:s,rect:c,parentRect:l,open:u,eventBus:d=null}){this.#container=e,this.#titleObj=r,this.#contentsObj=a,this.#richText=o,this.#parent=s,this.#color=t,this.#rect=c,this.#parentRect=l,this.#elements=n,this.#eventBus=d,this.#dateObj=Qb.toDateObject(i),this.trigger=n.flatMap(e=>e.getElementsToTriggerPopup()),this.#addEventListeners(),this.#container.hidden=!0,u&&this.#toggle()}#addEventListeners(){if(this.#popupAbortController)return;this.#popupAbortController=new AbortController;let{signal:e}=this.#popupAbortController;for(let t of this.trigger)t.addEventListener(`click`,this.#boundToggle,{signal:e}),t.addEventListener(`mouseenter`,this.#boundShow,{signal:e}),t.addEventListener(`mouseleave`,this.#boundHide,{signal:e}),t.classList.add(`popupTriggerArea`);for(let t of this.#elements)t.container?.addEventListener(`keydown`,this.#boundKeyDown,{signal:e});this.#renderCommentButton()}#setCommentButtonPosition(){let e=this.#elements.find(e=>e.hasCommentButton);e&&(this.#commentButtonPosition=e._normalizePoint(e.commentButtonPosition),this.#commentButtonColor=e.commentButtonColor)}#renderCommentButton(){if(this.#commentButton||(this.#commentButtonPosition||this.#setCommentButtonPosition(),!this.#commentButtonPosition))return;let e=this.#commentButton=document.createElement(`button`);e.className=`annotationCommentButton`;let t=this.#elements[0].container;e.style.zIndex=t.style.zIndex+1,e.tabIndex=0;let{signal:n}=this.#popupAbortController;e.addEventListener(`hover`,this.#boundToggle,{signal:n}),e.addEventListener(`keydown`,this.#boundKeyDown,{signal:n}),e.addEventListener(`click`,()=>{let[{data:{id:e},annotationEditorType:t}]=this.#elements;this.#eventBus?.dispatch(`switchannotationeditormode`,{source:this,editId:e,mode:t,editComment:!0})},{signal:n});let{style:r}=e;r.left=`calc(${this.#commentButtonPosition[0]}%)`,r.top=`calc(${this.#commentButtonPosition[1]}% - var(--comment-button-dim))`,this.#commentButtonColor&&(r.backgroundColor=this.#commentButtonColor),t.after(e)}render(){if(this.#popup)return;let e=this.#popup=document.createElement(`div`);if(e.className=`popup`,this.#color){let t=e.style.outlineColor=Q.makeHexColor(...this.#color);e.style.backgroundColor=`color-mix(in srgb, ${t} 30%, white)`}let t=document.createElement(`span`);if(t.className=`header`,this.#titleObj?.str){let e=document.createElement(`span`);e.className=`title`,t.append(e),{dir:e.dir,str:e.textContent}=this.#titleObj}if(e.append(t),this.#dateObj){let e=document.createElement(`time`);e.className=`popupDate`,e.setAttribute(`data-l10n-id`,`pdfjs-annotation-date-time-string`),e.setAttribute(`data-l10n-args`,JSON.stringify({dateObj:this.#dateObj.valueOf()})),e.dateTime=this.#dateObj.toISOString(),t.append(e)}let n=this.#html;if(n)WC.render({xfaHtml:n,intent:`richText`,div:e}),e.lastChild.classList.add(`richText`,`popupContent`);else{let t=this._formatContents(this.#contentsObj);e.append(t)}this.#container.append(e)}get#html(){let e=this.#richText,t=this.#contentsObj;return e?.str&&(!t?.str||t.str===e.str)&&this.#richText.html||null}get#fontSize(){return this.#html?.attributes?.style?.fontSize||0}get#fontColor(){return this.#html?.attributes?.style?.color||null}#makePopupContent(e){let t=[],n={str:e,html:{name:`div`,attributes:{dir:`auto`},children:[{name:`p`,children:t}]}},r={style:{color:this.#fontColor,fontSize:this.#fontSize?`calc(${this.#fontSize}px * var(--total-scale-factor))`:``}};for(let n of e.split(`
`))t.push({name:`span`,value:n,attributes:r});return n}_formatContents({str:e,dir:t}){let n=document.createElement(`p`);n.classList.add(`popupContent`),n.dir=t;let r=e.split(/(?:\r\n?|\n)/);for(let e=0,t=r.length;e<t;++e){let i=r[e];n.append(document.createTextNode(i)),e<t-1&&n.append(document.createElement(`br`))}return n}#keyDown(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key===`Enter`||e.key===`Escape`&&this.#pinned)&&this.#toggle()}updateEdited({rect:e,popup:t,deleted:n}){if(n||t?.deleted){this.remove();return}this.#addEventListeners(),this.#updates||={contentsObj:this.#contentsObj,richText:this.#richText},e&&(this.#position=null),t&&(this.#richText=this.#makePopupContent(t.text),this.#dateObj=Qb.toDateObject(t.date),this.#contentsObj=null),this.#popup?.remove(),this.#popup=null}resetEdited(){this.#updates&&({contentsObj:this.#contentsObj,richText:this.#richText}=this.#updates,this.#updates=null,this.#popup?.remove(),this.#popup=null,this.#position=null)}remove(){this.#popupAbortController?.abort(),this.#popupAbortController=null,this.#popup?.remove(),this.#popup=null,this.#wasVisible=!1,this.#pinned=!1;for(let e of this.trigger)e.classList.remove(`popupTriggerArea`)}#setPosition(){if(this.#position!==null)return;let{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:r,pageY:i}}}=this.#parent,a=!!this.#parentRect,o=a?this.#parentRect:this.#rect;for(let e of this.#elements)if(!o||Q.intersect(e.data.rect,o)!==null){o=e.data.rect,a=!0;break}let s=Q.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),c=a?o[2]-o[0]+5:0,l=s[0]+c,u=s[1];this.#position=[100*(l-r)/t,100*(u-i)/n];let{style:d}=this.#container;d.left=`${this.#position[0]}%`,d.top=`${this.#position[1]}%`}#toggle(){this.#pinned=!this.#pinned,this.#pinned?(this.#show(),this.#container.addEventListener(`click`,this.#boundToggle),this.#container.addEventListener(`keydown`,this.#boundKeyDown)):(this.#hide(),this.#container.removeEventListener(`click`,this.#boundToggle),this.#container.removeEventListener(`keydown`,this.#boundKeyDown))}#show(){this.#popup||this.render(),this.isVisible?this.#pinned&&this.#container.classList.add(`focused`):(this.#setPosition(),this.#container.hidden=!1,this.#container.style.zIndex=parseInt(this.#container.style.zIndex)+1e3)}#hide(){this.#container.classList.remove(`focused`),!(this.#pinned||!this.isVisible)&&(this.#container.hidden=!0,this.#container.style.zIndex=parseInt(this.#container.style.zIndex)-1e3)}forceHide(){this.#wasVisible=this.isVisible,this.#wasVisible&&(this.#container.hidden=!0)}maybeShow(){this.#addEventListeners(),this.#wasVisible&&(this.#popup||this.#show(),this.#wasVisible=!1,this.#container.hidden=!1)}get isVisible(){return this.#container.hidden===!1}},sw=class extends YC{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=X.FREETEXT}render(){if(this.container.classList.add(`freeTextAnnotation`),this.textContent){let e=document.createElement(`div`);e.classList.add(`annotationTextContent`),e.setAttribute(`role`,`comment`);for(let t of this.textContent){let n=document.createElement(`span`);n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},cw=class extends YC{#line=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add(`lineAnnotation`);let{data:e,width:t,height:n}=this,r=this.svgFactory.create(t,n,!0),i=this.#line=this.svgFactory.createElement(`svg:line`);return i.setAttribute(`x1`,e.rect[2]-e.lineCoordinates[0]),i.setAttribute(`y1`,e.rect[3]-e.lineCoordinates[1]),i.setAttribute(`x2`,e.rect[2]-e.lineCoordinates[2]),i.setAttribute(`y2`,e.rect[3]-e.lineCoordinates[3]),i.setAttribute(`stroke-width`,e.borderStyle.width||1),i.setAttribute(`stroke`,`transparent`),i.setAttribute(`fill`,`transparent`),r.append(i),this.container.append(r),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#line}addHighlightArea(){this.container.classList.add(`highlightArea`)}},lw=class extends YC{#square=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add(`squareAnnotation`);let{data:e,width:t,height:n}=this,r=this.svgFactory.create(t,n,!0),i=e.borderStyle.width,a=this.#square=this.svgFactory.createElement(`svg:rect`);return a.setAttribute(`x`,i/2),a.setAttribute(`y`,i/2),a.setAttribute(`width`,t-i),a.setAttribute(`height`,n-i),a.setAttribute(`stroke-width`,i||1),a.setAttribute(`stroke`,`transparent`),a.setAttribute(`fill`,`transparent`),r.append(a),this.container.append(r),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#square}addHighlightArea(){this.container.classList.add(`highlightArea`)}},uw=class extends YC{#circle=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add(`circleAnnotation`);let{data:e,width:t,height:n}=this,r=this.svgFactory.create(t,n,!0),i=e.borderStyle.width,a=this.#circle=this.svgFactory.createElement(`svg:ellipse`);return a.setAttribute(`cx`,t/2),a.setAttribute(`cy`,n/2),a.setAttribute(`rx`,t/2-i/2),a.setAttribute(`ry`,n/2-i/2),a.setAttribute(`stroke-width`,i||1),a.setAttribute(`stroke`,`transparent`),a.setAttribute(`fill`,`transparent`),r.append(a),this.container.append(r),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#circle}addHighlightArea(){this.container.classList.add(`highlightArea`)}},dw=class extends YC{#polyline=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName=`polylineAnnotation`,this.svgElementName=`svg:polyline`}render(){this.container.classList.add(this.containerClassName);let{data:{rect:e,vertices:t,borderStyle:n,popupRef:r},width:i,height:a}=this;if(!t)return this.container;let o=this.svgFactory.create(i,a,!0),s=[];for(let n=0,r=t.length;n<r;n+=2){let r=t[n]-e[0],i=e[3]-t[n+1];s.push(`${r},${i}`)}s=s.join(` `);let c=this.#polyline=this.svgFactory.createElement(this.svgElementName);return c.setAttribute(`points`,s),c.setAttribute(`stroke-width`,n.width||1),c.setAttribute(`stroke`,`transparent`),c.setAttribute(`fill`,`transparent`),o.append(c),this.container.append(o),!r&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#polyline}addHighlightArea(){this.container.classList.add(`highlightArea`)}},fw=class extends dw{constructor(e){super(e),this.containerClassName=`polygonAnnotation`,this.svgElementName=`svg:polygon`}},pw=class extends YC{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add(`caretAnnotation`),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},mw=class extends YC{#polylinesGroupElement=null;#polylines=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName=`inkAnnotation`,this.svgElementName=`svg:polyline`,this.annotationEditorType=this.data.it===`InkHighlight`?X.HIGHLIGHT:X.INK}#getTransform(e,t){switch(e){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}}render(){this.container.classList.add(this.containerClassName);let{data:{rect:e,rotation:t,inkLists:n,borderStyle:r,popupRef:i}}=this,{transform:a,width:o,height:s}=this.#getTransform(t,e),c=this.svgFactory.create(o,s,!0),l=this.#polylinesGroupElement=this.svgFactory.createElement(`svg:g`);c.append(l),l.setAttribute(`stroke-width`,r.width||1),l.setAttribute(`stroke-linecap`,`round`),l.setAttribute(`stroke-linejoin`,`round`),l.setAttribute(`stroke-miterlimit`,10),l.setAttribute(`stroke`,`transparent`),l.setAttribute(`fill`,`transparent`),l.setAttribute(`transform`,a);for(let e=0,t=n.length;e<t;e++){let t=this.svgFactory.createElement(this.svgElementName);this.#polylines.push(t),t.setAttribute(`points`,n[e].join(`,`)),l.append(t)}return!i&&this.hasPopupData&&this._createPopup(),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);let{thickness:t,points:n,rect:r}=e,i=this.#polylinesGroupElement;if(t>=0&&i.setAttribute(`stroke-width`,t||1),n)for(let e=0,t=this.#polylines.length;e<t;e++)this.#polylines[e].setAttribute(`points`,n[e].join(`,`));if(r){let{transform:e,width:t,height:n}=this.#getTransform(this.data.rotation,r);i.parentElement.setAttribute(`viewBox`,`0 0 ${t} ${n}`),i.setAttribute(`transform`,e)}}getElementsToTriggerPopup(){return this.#polylines}addHighlightArea(){this.container.classList.add(`highlightArea`)}get commentButtonPosition(){let{inkLists:e,rect:t}=this.data;if(e?.length>=1){let t=-1/0,n=-1/0;for(let r of e)for(let e=0,i=r.length;e<i;e+=2)r[e+1]>n?(n=r[e+1],t=r[e]):r[e+1]===n&&(t=Math.max(t,r[e]));if(t!==1/0)return[t,n]}return t?[t[2],t[3]]:null}},hw=class extends YC{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=X.HIGHLIGHT}render(){let{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add(`highlightAnnotation`),this._editOnDoubleClick(),e){let t=document.createElement(`mark`);t.classList.add(`overlaidText`),t.textContent=e,this.container.append(t)}return this.container}},gw=class extends YC{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){let{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add(`underlineAnnotation`),e){let t=document.createElement(`u`);t.classList.add(`overlaidText`),t.textContent=e,this.container.append(t)}return this.container}},_w=class extends YC{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){let{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add(`squigglyAnnotation`),e){let t=document.createElement(`u`);t.classList.add(`overlaidText`),t.textContent=e,this.container.append(t)}return this.container}},vw=class extends YC{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){let{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add(`strikeoutAnnotation`),e){let t=document.createElement(`s`);t.classList.add(`overlaidText`),t.textContent=e,this.container.append(t)}return this.container}},yw=class extends YC{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=X.STAMP}render(){return this.container.classList.add(`stampAnnotation`),this.container.setAttribute(`role`,`img`),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}},bw=class extends YC{#trigger=null;constructor(e){super(e,{isRenderable:!0});let{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch(`fileattachmentannotation`,{source:this,...t})}render(){this.container.classList.add(`fileAttachmentAnnotation`);let{container:e,data:t}=this,n;t.hasAppearance||t.fillAlpha===0?n=document.createElement(`div`):(n=document.createElement(`img`),n.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?`paperclip`:`pushpin`}.svg`,t.fillAlpha&&t.fillAlpha<1&&(n.style=`filter: opacity(${Math.round(t.fillAlpha*100)}%);`)),n.addEventListener(`dblclick`,this.#download.bind(this)),this.#trigger=n;let{isMac:r}=Eb.platform;return e.addEventListener(`keydown`,e=>{e.key===`Enter`&&(r?e.metaKey:e.ctrlKey)&&this.#download()}),!t.popupRef&&this.hasPopupData?this._createPopup():n.classList.add(`popupTriggerArea`),e.append(n),e}getElementsToTriggerPopup(){return this.#trigger}addHighlightArea(){this.container.classList.add(`highlightArea`)}#download(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}},xw=class e{#accessibilityManager=null;#annotationCanvasMap=null;#editableAnnotations=new Map;#structTreeLayer=null;constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:r,page:i,viewport:a,structTreeLayer:o}){this.div=e,this.#accessibilityManager=t,this.#annotationCanvasMap=n,this.#structTreeLayer=o||null,this.page=i,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=r}hasEditableAnnotations(){return this.#editableAnnotations.size>0}async#appendElement(e,t,n){let r=e.firstChild||e,i=r.id=`${Nb}${t}`,a=await this.#structTreeLayer?.getAriaAttributes(i);if(a)for(let[e,t]of a)r.setAttribute(e,t);n?n.at(-1).container.after(e):(this.div.append(e),this.#accessibilityManager?.moveElementInDOM(this.div,e,r,!1))}async render(e){let{annotations:t}=e,n=this.div;ix(n,this.viewport);let r=new Map,i={data:null,layer:n,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||``,renderForms:e.renderForms!==!1,svgFactory:new UC,annotationStorage:e.annotationStorage||new Ex,enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(let e of t){if(e.noHTML)continue;let t=e.annotationType===Qy.POPUP;if(t){let t=r.get(e.id);if(!t)continue;i.elements=t}else if(e.rect[2]===e.rect[0]||e.rect[3]===e.rect[1])continue;i.data=e;let n=JC.create(i);if(!n.isRenderable)continue;if(!t&&e.popupRef){let t=r.get(e.popupRef);t?t.push(n):r.set(e.popupRef,[n])}let a=n.render();e.hidden&&(a.style.visibility=`hidden`),await this.#appendElement(a,e.id,i.elements),n._isEditable&&(this.#editableAnnotations.set(n.data.id,n),this._annotationEditorUIManager?.renderAnnotationElement(n))}this.#setAnnotationCanvasMap()}async addLinkAnnotations(t,n){let r={data:null,layer:this.div,linkService:n,svgFactory:new UC,parent:this};for(let n of t){n.borderStyle||=e._defaultBorderStyle,r.data=n;let t=JC.create(r);if(!t.isRenderable)continue;let i=t.render();await this.#appendElement(i,n.id,null)}}update({viewport:e}){let t=this.div;this.viewport=e,ix(t,{rotation:e.rotation}),this.#setAnnotationCanvasMap(),t.hidden=!1}#setAnnotationCanvasMap(){if(!this.#annotationCanvasMap)return;let e=this.div;for(let[t,n]of this.#annotationCanvasMap){let r=e.querySelector(`[data-annotation-id="${t}"]`);if(!r)continue;n.className=`annotationContent`;let{firstChild:i}=r;i?i.nodeName===`CANVAS`?i.replaceWith(n):i.classList.contains(`annotationContent`)?i.after(n):i.before(n):r.append(n);let a=this.#editableAnnotations.get(t);if(!a)continue;a._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(t,r.id,n),a._hasNoCanvas=!1):a.canvas=n}this.#annotationCanvasMap.clear()}getEditableAnnotations(){return Array.from(this.#editableAnnotations.values())}getEditableAnnotation(e){return this.#editableAnnotations.get(e)}static get _defaultBorderStyle(){return pb(this,`_defaultBorderStyle`,Object.freeze({width:1,rawWidth:1,style:$y.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}},Sw=/\r\n?|\n/g,Cw=class e extends yx{#color;#content=``;#editorDivId=`${this.id}-editor`;#editModeAC=null;#fontSize;_colorPicker=null;static _freeTextDefaultContent=``;static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){let t=e.prototype,n=e=>e.isEmpty(),r=hx.TRANSLATE_SMALL,i=hx.TRANSLATE_BIG;return pb(this,`_keyboardManager`,new px([[[`ctrl+s`,`mac+meta+s`,`ctrl+p`,`mac+meta+p`],t.commitOrRemove,{bubbles:!0}],[[`ctrl+Enter`,`mac+meta+Enter`,`Escape`,`mac+Escape`],t.commitOrRemove],[[`ArrowLeft`,`mac+ArrowLeft`],t._translateEmpty,{args:[-r,0],checker:n}],[[`ctrl+ArrowLeft`,`mac+shift+ArrowLeft`],t._translateEmpty,{args:[-i,0],checker:n}],[[`ArrowRight`,`mac+ArrowRight`],t._translateEmpty,{args:[r,0],checker:n}],[[`ctrl+ArrowRight`,`mac+shift+ArrowRight`],t._translateEmpty,{args:[i,0],checker:n}],[[`ArrowUp`,`mac+ArrowUp`],t._translateEmpty,{args:[0,-r],checker:n}],[[`ctrl+ArrowUp`,`mac+shift+ArrowUp`],t._translateEmpty,{args:[0,-i],checker:n}],[[`ArrowDown`,`mac+ArrowDown`],t._translateEmpty,{args:[0,r],checker:n}],[[`ctrl+ArrowDown`,`mac+shift+ArrowDown`],t._translateEmpty,{args:[0,i],checker:n}]]))}static _type=`freetext`;static _editorType=X.FREETEXT;constructor(t){super({...t,name:`freeTextEditor`}),this.#color=t.color||e._defaultColor||yx._defaultLineColor,this.#fontSize=t.fontSize||e._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-freetext-added-alert`)}static initialize(e,t){yx.initialize(e,t);let n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue(`--freetext-padding`))}static updateDefaultParams(t,n){switch(t){case Jy.FREETEXT_SIZE:e._defaultFontSize=n;break;case Jy.FREETEXT_COLOR:e._defaultColor=n;break}}updateParams(e,t){switch(e){case Jy.FREETEXT_SIZE:this.#updateFontSize(t);break;case Jy.FREETEXT_COLOR:this.#updateColor(t);break}}static get defaultPropertiesToUpdate(){return[[Jy.FREETEXT_SIZE,e._defaultFontSize],[Jy.FREETEXT_COLOR,e._defaultColor||yx._defaultLineColor]]}get propertiesToUpdate(){return[[Jy.FREETEXT_SIZE,this.#fontSize],[Jy.FREETEXT_COLOR,this.#color]]}get toolbarButtons(){return this._colorPicker||=new RC(this),[[`colorPicker`,this._colorPicker]]}get colorType(){return Jy.FREETEXT_COLOR}get colorValue(){return this.#color}#updateFontSize(e){let t=e=>{this.editorDiv.style.fontSize=`calc(${e}px * var(--total-scale-factor))`,this.translate(0,-(e-this.#fontSize)*this.parentScale),this.#fontSize=e,this.#setEditorDimensions()},n=this.#fontSize;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Jy.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#updateColor(e){let t=e=>{this.#color=this.editorDiv.style.color=e,this._colorPicker?.update(e)},n=this.#color;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Jy.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){let t=this.parentScale;return[-e._internalPadding*t,-(e._internalPadding+this.#fontSize)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove(`enabled`),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute(`aria-activedescendant`),this.#editModeAC=new AbortController;let e=this._uiManager.combinedSignal(this.#editModeAC);return this.editorDiv.addEventListener(`keydown`,this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener(`focus`,this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener(`blur`,this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener(`input`,this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener(`paste`,this.editorDivPaste.bind(this),{signal:e}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add(`enabled`),this.editorDiv.contentEditable=!1,this.div.setAttribute(`aria-activedescendant`,this.#editorDivId),this._isDraggable=!0,this.#editModeAC?.abort(),this.#editModeAC=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add(`freetextEditing`),!0):!1}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===``}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add(`freetextEditing`)),super.remove()}#extractText(){let t=[];this.editorDiv.normalize();let n=null;for(let r of this.editorDiv.childNodes){if(n?.nodeType===Node.TEXT_NODE&&r.nodeName===`BR`)continue;t.push(e.#getNodeContent(r)),n=r}return t.join(`
`)}#setEditorDimensions(){let[e,t]=this.parentDimensions,n;if(this.isAttachedToDOM)n=this.div.getBoundingClientRect();else{let{currentLayer:e,div:t}=this,r=t.style.display,i=t.classList.contains(`hidden`);t.classList.remove(`hidden`),t.style.display=`hidden`,e.div.append(this.div),n=t.getBoundingClientRect(),t.remove(),t.style.display=r,t.classList.toggle(`hidden`,i)}this.rotation%180==this.parentRotation%180?(this.width=n.width/e,this.height=n.height/t):(this.width=n.height/e,this.height=n.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let e=this.#content,t=this.#content=this.#extractText().trimEnd();if(e===t)return;let n=e=>{if(this.#content=e,!e){this.remove();return}this.#setContent(),this._uiManager.rebuild(this),this.#setEditorDimensions()};this.addCommands({cmd:()=>{n(t)},undo:()=>{n(e)},mustExec:!1}),this.#setEditorDimensions()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&e.key===`Enter`&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(t){e._keyboardManager.exec(this,t)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle(`freetextEditing`,this.isEmpty())}disableEditing(){this.editorDiv.setAttribute(`role`,`comment`),this.editorDiv.removeAttribute(`aria-multiline`)}enableEditing(){this.editorDiv.setAttribute(`role`,`textbox`),this.editorDiv.setAttribute(`aria-multiline`,!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let e,t;(this._isCopy||this.annotationElementId)&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement(`div`),this.editorDiv.className=`internal`,this.editorDiv.setAttribute(`id`,this.#editorDivId),this.editorDiv.setAttribute(`data-l10n-id`,`pdfjs-free-text2`),this.editorDiv.setAttribute(`data-l10n-attrs`,`default-content`),this.enableEditing(),this.editorDiv.contentEditable=!0;let{style:n}=this.editorDiv;if(n.fontSize=`calc(${this.#fontSize}px * var(--total-scale-factor))`,n.color=this.#color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement(`div`),this.overlayDiv.classList.add(`overlay`,`enabled`),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){let[n,r]=this.parentDimensions;if(this.annotationElementId){let{position:i}=this._initialData,[a,o]=this.getInitialTranslation();[a,o]=this.pageTranslationToScreen(a,o);let[s,c]=this.pageDimensions,[l,u]=this.pageTranslation,d,f;switch(this.rotation){case 0:d=e+(i[0]-l)/s,f=t+this.height-(i[1]-u)/c;break;case 90:d=e+(i[0]-l)/s,f=t-(i[1]-u)/c,[a,o]=[o,-a];break;case 180:d=e-this.width+(i[0]-l)/s,f=t-(i[1]-u)/c,[a,o]=[-a,-o];break;case 270:d=e+(i[0]-l-this.height*c)/s,f=t+(i[1]-u-this.width*s)/c,[a,o]=[-o,a];break}this.setAt(d*n,f*r,a,o)}else this._moveAfterPaste(e,t);this.#setContent(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#getNodeContent(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Sw,``)}editorDivPaste(t){let n=t.clipboardData||window.clipboardData,{types:r}=n;if(r.length===1&&r[0]===`text/plain`)return;t.preventDefault();let i=e.#deserializeContent(n.getData(`text`)||``).replaceAll(Sw,`
`);if(!i)return;let a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();let o=a.getRangeAt(0);if(!i.includes(`
`)){o.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),a.collapseToStart();return}let{startContainer:s,startOffset:c}=o,l=[],u=[];if(s.nodeType===Node.TEXT_NODE){let t=s.parentElement;if(u.push(s.nodeValue.slice(c).replaceAll(Sw,``)),t!==this.editorDiv){let n=l;for(let r of this.editorDiv.childNodes){if(r===t){n=u;continue}n.push(e.#getNodeContent(r))}}l.push(s.nodeValue.slice(0,c).replaceAll(Sw,``))}else if(s===this.editorDiv){let t=l,n=0;for(let r of this.editorDiv.childNodes)n++===c&&(t=u),t.push(e.#getNodeContent(r))}this.#content=`${l.join(`
`)}${i}${u.join(`
`)}`,this.#setContent();let d=new Range,f=Math.sumPrecise(l.map(e=>e.length));for(let{firstChild:e}of this.editorDiv.childNodes)if(e.nodeType===Node.TEXT_NODE){let t=e.nodeValue.length;if(f<=t){d.setStart(e,f),d.setEnd(e,f);break}f-=t}a.removeAllRanges(),a.addRange(d)}#setContent(){if(this.editorDiv.replaceChildren(),this.#content)for(let e of this.#content.split(`
`)){let t=document.createElement(`div`);t.append(e?document.createTextNode(e):document.createElement(`br`)),this.editorDiv.append(t)}}#serializeContent(){return this.#content.replaceAll(`\xA0`,` `)}static#deserializeContent(e){return e.replaceAll(` `,`\xA0`)}get contentDiv(){return this.editorDiv}getPDFRect(){let t=e._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,n,r){let i=null;if(t instanceof sw){let{data:{defaultAppearanceData:{fontSize:e,fontColor:n},rect:r,rotation:a,id:o,popupRef:s,contentsObj:c},textContent:l,textPosition:u,parent:{page:{pageNumber:d}}}=t;if(!l||l.length===0)return null;i=t={annotationType:X.FREETEXT,color:Array.from(n),fontSize:e,value:l.join(`
`),position:u,pageIndex:d-1,rect:r.slice(0),rotation:a,annotationElementId:o,id:o,deleted:!1,popupRef:s,comment:c?.str||null}}let a=await super.deserialize(t,n,r);return a.#fontSize=t.fontSize,a.#color=Q.makeHexColor(...t.color),a.#content=e.#deserializeContent(t.value),a._initialData=i,t.comment&&a.setCommentData(t.comment),a}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let t=this.getPDFRect(),n=yx._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#color),r={annotationType:X.FREETEXT,color:n,fontSize:this.#fontSize,value:this.#serializeContent(),pageIndex:this.pageIndex,rect:t,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(r),e?(r.isCopy=!0,r):this.annotationElementId&&!this.#hasElementChanged(r)?null:(r.id=this.annotationElementId,r)}#hasElementChanged(e){let{value:t,fontSize:n,color:r,pageIndex:i}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||e.value!==t||e.fontSize!==n||e.color.some((e,t)=>e!==r[t])||e.pageIndex!==i}renderAnnotationElement(e){let t=super.renderAnnotationElement(e);if(!t)return null;let{style:n}=t;n.fontSize=`calc(${this.#fontSize}px * var(--total-scale-factor))`,n.color=this.#color,t.replaceChildren();for(let e of this.#content.split(`
`)){let n=document.createElement(`div`);n.append(e?document.createTextNode(e):document.createElement(`br`)),t.append(n)}let r={rect:this.getPDFRect()};return r.popup=this.hasEditedComment?this.comment:{text:this.#content},e.updateEdited(r),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}},$=class{static PRECISION=1e-4;toSVGPath(){cb("Abstract method `toSVGPath` must be implemented.")}get box(){cb("Abstract getter `box` must be implemented.")}serialize(e,t){cb("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,r,i,a){a||=new Float32Array(e.length);for(let o=0,s=e.length;o<s;o+=2)a[o]=t+e[o]*r,a[o+1]=n+e[o+1]*i;return a}static _rescaleAndSwap(e,t,n,r,i,a){a||=new Float32Array(e.length);for(let o=0,s=e.length;o<s;o+=2)a[o]=t+e[o+1]*r,a[o+1]=n+e[o]*i;return a}static _translate(e,t,n,r){r||=new Float32Array(e.length);for(let i=0,a=e.length;i<a;i+=2)r[i]=t+e[i],r[i+1]=n+e[i+1];return r}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,n,r,i){switch(i){case 90:return[1-t/n,e/r];case 180:return[1-e/n,1-t/r];case 270:return[t/n,1-e/r];default:return[e/n,t/r]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,r,i,a){return[(e+5*n)/6,(t+5*r)/6,(5*n+i)/6,(5*r+a)/6,(n+i)/2,(r+a)/2]}},ww=class e{#box;#bottom=[];#innerMargin;#isLTR;#top=[];#last=new Float32Array(18);#lastX;#lastY;#min;#min_dist;#scaleFactor;#thickness;#points=[];static#MIN_DIST=8;static#MIN_DIFF=2;static#MIN=e.#MIN_DIST+e.#MIN_DIFF;constructor({x:t,y:n},r,i,a,o,s=0){this.#box=r,this.#thickness=a*i,this.#isLTR=o,this.#last.set([NaN,NaN,NaN,NaN,t,n],6),this.#innerMargin=s,this.#min_dist=e.#MIN_DIST*i,this.#min=e.#MIN*i,this.#scaleFactor=i,this.#points.push(t,n)}isEmpty(){return isNaN(this.#last[8])}#getLastCoords(){let e=this.#last.subarray(4,6),t=this.#last.subarray(16,18),[n,r,i,a]=this.#box;return[(this.#lastX+(e[0]-t[0])/2-n)/i,(this.#lastY+(e[1]-t[1])/2-r)/a,(this.#lastX+(t[0]-e[0])/2-n)/i,(this.#lastY+(t[1]-e[1])/2-r)/a]}add({x:e,y:t}){this.#lastX=e,this.#lastY=t;let[n,r,i,a]=this.#box,[o,s,c,l]=this.#last.subarray(8,12),u=e-c,d=t-l,f=Math.hypot(u,d);if(f<this.#min)return!1;let p=f-this.#min_dist,m=p/f,h=m*u,g=m*d,_=o,v=s;o=c,s=l,c+=h,l+=g,this.#points?.push(e,t);let y=-g/p,b=h/p,x=y*this.#thickness,S=b*this.#thickness;return this.#last.set(this.#last.subarray(2,8),0),this.#last.set([c+x,l+S],4),this.#last.set(this.#last.subarray(14,18),12),this.#last.set([c-x,l-S],16),isNaN(this.#last[6])?(this.#top.length===0&&(this.#last.set([o+x,s+S],2),this.#top.push(NaN,NaN,NaN,NaN,(o+x-n)/i,(s+S-r)/a),this.#last.set([o-x,s-S],14),this.#bottom.push(NaN,NaN,NaN,NaN,(o-x-n)/i,(s-S-r)/a)),this.#last.set([_,v,o,s,c,l],6),!this.isEmpty()):(this.#last.set([_,v,o,s,c,l],6),Math.abs(Math.atan2(v-s,_-o)-Math.atan2(g,h))<Math.PI/2?([o,s,c,l]=this.#last.subarray(2,6),this.#top.push(NaN,NaN,NaN,NaN,((o+c)/2-n)/i,((s+l)/2-r)/a),[o,s,_,v]=this.#last.subarray(14,18),this.#bottom.push(NaN,NaN,NaN,NaN,((_+o)/2-n)/i,((v+s)/2-r)/a),!0):([_,v,o,s,c,l]=this.#last.subarray(0,6),this.#top.push(((_+5*o)/6-n)/i,((v+5*s)/6-r)/a,((5*o+c)/6-n)/i,((5*s+l)/6-r)/a,((o+c)/2-n)/i,((s+l)/2-r)/a),[c,l,o,s,_,v]=this.#last.subarray(12,18),this.#bottom.push(((_+5*o)/6-n)/i,((v+5*s)/6-r)/a,((5*o+c)/6-n)/i,((5*s+l)/6-r)/a,((o+c)/2-n)/i,((s+l)/2-r)/a),!0))}toSVGPath(){if(this.isEmpty())return``;let e=this.#top,t=this.#bottom;if(isNaN(this.#last[6])&&!this.isEmpty())return this.#toSVGPathTwoPoints();let n=[];n.push(`M${e[4]} ${e[5]}`);for(let t=6;t<e.length;t+=6)isNaN(e[t])?n.push(`L${e[t+4]} ${e[t+5]}`):n.push(`C${e[t]} ${e[t+1]} ${e[t+2]} ${e[t+3]} ${e[t+4]} ${e[t+5]}`);this.#toSVGPathEnd(n);for(let e=t.length-6;e>=6;e-=6)isNaN(t[e])?n.push(`L${t[e+4]} ${t[e+5]}`):n.push(`C${t[e]} ${t[e+1]} ${t[e+2]} ${t[e+3]} ${t[e+4]} ${t[e+5]}`);return this.#toSVGPathStart(n),n.join(` `)}#toSVGPathTwoPoints(){let[e,t,n,r]=this.#box,[i,a,o,s]=this.#getLastCoords();return`M${(this.#last[2]-e)/n} ${(this.#last[3]-t)/r} L${(this.#last[4]-e)/n} ${(this.#last[5]-t)/r} L${i} ${a} L${o} ${s} L${(this.#last[16]-e)/n} ${(this.#last[17]-t)/r} L${(this.#last[14]-e)/n} ${(this.#last[15]-t)/r} Z`}#toSVGPathStart(e){let t=this.#bottom;e.push(`L${t[4]} ${t[5]} Z`)}#toSVGPathEnd(e){let[t,n,r,i]=this.#box,a=this.#last.subarray(4,6),o=this.#last.subarray(16,18),[s,c,l,u]=this.#getLastCoords();e.push(`L${(a[0]-t)/r} ${(a[1]-n)/i} L${s} ${c} L${l} ${u} L${(o[0]-t)/r} ${(o[1]-n)/i}`)}newFreeDrawOutline(e,t,n,r,i,a){return new Tw(e,t,n,r,i,a)}getOutlines(){let e=this.#top,t=this.#bottom,n=this.#last,[r,i,a,o]=this.#box,s=new Float32Array((this.#points?.length??0)+2);for(let e=0,t=s.length-2;e<t;e+=2)s[e]=(this.#points[e]-r)/a,s[e+1]=(this.#points[e+1]-i)/o;if(s[s.length-2]=(this.#lastX-r)/a,s[s.length-1]=(this.#lastY-i)/o,isNaN(n[6])&&!this.isEmpty())return this.#getOutlineTwoPoints(s);let c=new Float32Array(this.#top.length+24+this.#bottom.length),l=e.length;for(let t=0;t<l;t+=2){if(isNaN(e[t])){c[t]=c[t+1]=NaN;continue}c[t]=e[t],c[t+1]=e[t+1]}l=this.#getOutlineEnd(c,l);for(let e=t.length-6;e>=6;e-=6)for(let n=0;n<6;n+=2){if(isNaN(t[e+n])){c[l]=c[l+1]=NaN,l+=2;continue}c[l]=t[e+n],c[l+1]=t[e+n+1],l+=2}return this.#getOutlineStart(c,l),this.newFreeDrawOutline(c,s,this.#box,this.#scaleFactor,this.#innerMargin,this.#isLTR)}#getOutlineTwoPoints(e){let t=this.#last,[n,r,i,a]=this.#box,[o,s,c,l]=this.#getLastCoords(),u=new Float32Array(36);return u.set([NaN,NaN,NaN,NaN,(t[2]-n)/i,(t[3]-r)/a,NaN,NaN,NaN,NaN,(t[4]-n)/i,(t[5]-r)/a,NaN,NaN,NaN,NaN,o,s,NaN,NaN,NaN,NaN,c,l,NaN,NaN,NaN,NaN,(t[16]-n)/i,(t[17]-r)/a,NaN,NaN,NaN,NaN,(t[14]-n)/i,(t[15]-r)/a],0),this.newFreeDrawOutline(u,e,this.#box,this.#scaleFactor,this.#innerMargin,this.#isLTR)}#getOutlineStart(e,t){let n=this.#bottom;return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+=6}#getOutlineEnd(e,t){let n=this.#last.subarray(4,6),r=this.#last.subarray(16,18),[i,a,o,s]=this.#box,[c,l,u,d]=this.#getLastCoords();return e.set([NaN,NaN,NaN,NaN,(n[0]-i)/o,(n[1]-a)/s,NaN,NaN,NaN,NaN,c,l,NaN,NaN,NaN,NaN,u,d,NaN,NaN,NaN,NaN,(r[0]-i)/o,(r[1]-a)/s],t),t+=24}},Tw=class extends ${#box;#bbox=new Float32Array(4);#innerMargin;#isLTR;#points;#scaleFactor;#outline;constructor(e,t,n,r,i,a){super(),this.#outline=e,this.#points=t,this.#box=n,this.#scaleFactor=r,this.#innerMargin=i,this.#isLTR=a,this.lastPoint=[NaN,NaN],this.#computeMinMax(a);let[o,s,c,l]=this.#bbox;for(let t=0,n=e.length;t<n;t+=2)e[t]=(e[t]-o)/c,e[t+1]=(e[t+1]-s)/l;for(let e=0,n=t.length;e<n;e+=2)t[e]=(t[e]-o)/c,t[e+1]=(t[e+1]-s)/l}toSVGPath(){let e=[`M${this.#outline[4]} ${this.#outline[5]}`];for(let t=6,n=this.#outline.length;t<n;t+=6){if(isNaN(this.#outline[t])){e.push(`L${this.#outline[t+4]} ${this.#outline[t+5]}`);continue}e.push(`C${this.#outline[t]} ${this.#outline[t+1]} ${this.#outline[t+2]} ${this.#outline[t+3]} ${this.#outline[t+4]} ${this.#outline[t+5]}`)}return e.push(`Z`),e.join(` `)}serialize([e,t,n,r],i){let a=n-e,o=r-t,s,c;switch(i){case 0:s=$._rescale(this.#outline,e,r,a,-o),c=$._rescale(this.#points,e,r,a,-o);break;case 90:s=$._rescaleAndSwap(this.#outline,e,t,a,o),c=$._rescaleAndSwap(this.#points,e,t,a,o);break;case 180:s=$._rescale(this.#outline,n,t,-a,o),c=$._rescale(this.#points,n,t,-a,o);break;case 270:s=$._rescaleAndSwap(this.#outline,n,r,-a,-o),c=$._rescaleAndSwap(this.#points,n,r,-a,-o);break}return{outline:Array.from(s),points:[Array.from(c)]}}#computeMinMax(e){let t=this.#outline,n=t[4],r=t[5],i=[n,r,n,r],a=n,o=r,s=e?Math.max:Math.min;for(let e=6,c=t.length;e<c;e+=6){let c=t[e+4],l=t[e+5];if(isNaN(t[e]))Q.pointBoundingBox(c,l,i),o<l?(a=c,o=l):o===l&&(a=s(a,c));else{let c=[1/0,1/0,-1/0,-1/0];Q.bezierBoundingBox(n,r,...t.slice(e,e+6),c),Q.rectBoundingBox(...c,i),o<c[3]?(a=c[2],o=c[3]):o===c[3]&&(a=s(a,c[2]))}n=c,r=l}let c=this.#bbox;c[0]=i[0]-this.#innerMargin,c[1]=i[1]-this.#innerMargin,c[2]=i[2]-i[0]+2*this.#innerMargin,c[3]=i[3]-i[1]+2*this.#innerMargin,this.lastPoint=[a,o]}get box(){return this.#bbox}newOutliner(e,t,n,r,i,a=0){return new ww(e,t,n,r,i,a)}getNewOutline(e,t){let[n,r,i,a]=this.#bbox,[o,s,c,l]=this.#box,u=i*c,d=a*l,f=n*c+o,p=r*l+s,m=this.newOutliner({x:this.#points[0]*u+f,y:this.#points[1]*d+p},this.#box,this.#scaleFactor,e,this.#isLTR,t??this.#innerMargin);for(let e=2;e<this.#points.length;e+=2)m.add({x:this.#points[e]*u+f,y:this.#points[e+1]*d+p});return m.getOutlines()}},Ew=class{#box;#lastPoint;#verticalEdges=[];#intervals=[];constructor(e,t=0,n=0,r=!0){let i=[1/0,1/0,-1/0,-1/0],a=10**-4;for(let{x:n,y:r,width:o,height:s}of e){let e=Math.floor((n-t)/a)*a,c=Math.ceil((n+o+t)/a)*a,l=Math.floor((r-t)/a)*a,u=Math.ceil((r+s+t)/a)*a,d=[e,l,u,!0],f=[c,l,u,!1];this.#verticalEdges.push(d,f),Q.rectBoundingBox(e,l,c,u,i)}let o=i[2]-i[0]+2*n,s=i[3]-i[1]+2*n,c=i[0]-n,l=i[1]-n,u=this.#verticalEdges.at(r?-1:-2),d=[u[0],u[2]];for(let e of this.#verticalEdges){let[t,n,r]=e;e[0]=(t-c)/o,e[1]=(n-l)/s,e[2]=(r-l)/s}this.#box=new Float32Array([c,l,o,s]),this.#lastPoint=d}getOutlines(){this.#verticalEdges.sort((e,t)=>e[0]-t[0]||e[1]-t[1]||e[2]-t[2]);let e=[];for(let t of this.#verticalEdges)t[3]?(e.push(...this.#breakEdge(t)),this.#insert(t)):(this.#remove(t),e.push(...this.#breakEdge(t)));return this.#getOutlines(e)}#getOutlines(e){let t=[],n=new Set;for(let n of e){let[e,r,i]=n;t.push([e,r,n],[e,i,n])}t.sort((e,t)=>e[1]-t[1]||e[0]-t[0]);for(let e=0,r=t.length;e<r;e+=2){let r=t[e][2],i=t[e+1][2];r.push(i),i.push(r),n.add(r),n.add(i)}let r=[],i;for(;n.size>0;){let e=n.values().next().value,[t,a,o,s,c]=e;n.delete(e);let l=t,u=a;for(i=[t,o],r.push(i);;){let e;if(n.has(s))e=s;else if(n.has(c))e=c;else break;n.delete(e),[t,a,o,s,c]=e,l!==t&&(i.push(l,u,t,u===a?a:o),l=t),u=u===a?o:a}i.push(l,u)}return new Dw(r,this.#box,this.#lastPoint)}#binarySearch(e){let t=this.#intervals,n=0,r=t.length-1;for(;n<=r;){let i=n+r>>1,a=t[i][0];if(a===e)return i;a<e?n=i+1:r=i-1}return r+1}#insert([,e,t]){let n=this.#binarySearch(e);this.#intervals.splice(n,0,[e,t])}#remove([,e,t]){let n=this.#binarySearch(e);for(let r=n;r<this.#intervals.length;r++){let[n,i]=this.#intervals[r];if(n!==e)break;if(n===e&&i===t){this.#intervals.splice(r,1);return}}for(let r=n-1;r>=0;r--){let[n,i]=this.#intervals[r];if(n!==e)break;if(n===e&&i===t){this.#intervals.splice(r,1);return}}}#breakEdge(e){let[t,n,r]=e,i=[[t,n,r]],a=this.#binarySearch(r);for(let e=0;e<a;e++){let[n,r]=this.#intervals[e];for(let e=0,a=i.length;e<a;e++){let[,o,s]=i[e];if(!(r<=o||s<=n)){if(o>=n){if(s>r)i[e][1]=r;else{if(a===1)return[];i.splice(e,1),e--,a--}continue}i[e][2]=n,s>r&&i.push([t,r,s])}}}return i}},Dw=class extends ${#box;#outlines;constructor(e,t,n){super(),this.#outlines=e,this.#box=t,this.lastPoint=n}toSVGPath(){let e=[];for(let t of this.#outlines){let[n,r]=t;e.push(`M${n} ${r}`);for(let i=2;i<t.length;i+=2){let a=t[i],o=t[i+1];a===n?(e.push(`V${o}`),r=o):o===r&&(e.push(`H${a}`),n=a)}e.push(`Z`)}return e.join(` `)}serialize([e,t,n,r],i){let a=[],o=n-e,s=r-t;for(let t of this.#outlines){let n=Array(t.length);for(let i=0;i<t.length;i+=2)n[i]=e+t[i]*o,n[i+1]=r-t[i+1]*s;a.push(n)}return a}get box(){return this.#box}get classNamesForOutlining(){return[`highlightOutline`]}},Ow=class extends ww{newFreeDrawOutline(e,t,n,r,i,a){return new kw(e,t,n,r,i,a)}},kw=class extends Tw{newOutliner(e,t,n,r,i,a=0){return new Ow(e,t,n,r,i,a)}},Aw=class e extends yx{#anchorNode=null;#anchorOffset=0;#boxes;#clipPathId=null;#colorPicker=null;#focusOutlines=null;#focusNode=null;#focusOffset=0;#highlightDiv=null;#highlightOutlines=null;#id=null;#isFreeHighlight=!1;#lastPoint=null;#opacity;#outlineId=null;#text=``;#thickness;#methodOfCreation=``;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type=`highlight`;static _editorType=X.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId=``;static get _keyboardManager(){let t=e.prototype;return pb(this,`_keyboardManager`,new px([[[`ArrowLeft`,`mac+ArrowLeft`],t._moveCaret,{args:[0]}],[[`ArrowRight`,`mac+ArrowRight`],t._moveCaret,{args:[1]}],[[`ArrowUp`,`mac+ArrowUp`],t._moveCaret,{args:[2]}],[[`ArrowDown`,`mac+ArrowDown`],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:`highlightEditor`}),this.color=t.color||e._defaultColor,this.#thickness=t.thickness||e._defaultThickness,this.#opacity=t.opacity||e._defaultOpacity,this.#boxes=t.boxes||null,this.#methodOfCreation=t.methodOfCreation||``,this.#text=t.text||``,this._isDraggable=!1,this.defaultL10nId=`pdfjs-editor-highlight-editor`,t.highlightId>-1?(this.#isFreeHighlight=!0,this.#createFreeOutlines(t),this.#addToDrawLayer()):this.#boxes&&(this.#anchorNode=t.anchorNode,this.#anchorOffset=t.anchorOffset,this.#focusNode=t.focusNode,this.#focusOffset=t.focusOffset,this.#createOutlines(),this.#addToDrawLayer(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-highlight-added-alert`)}get telemetryInitialData(){return{action:`added`,type:this.#isFreeHighlight?`free_highlight`:`highlight`,color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#thickness,methodOfCreation:this.#methodOfCreation}}get telemetryFinalData(){return{type:`highlight`,color:this._uiManager.getNonHCMColorName(this.color)}}get commentColor(){return this.color}static computeTelemetryFinalData(e){return{numberOfColors:e.get(`color`).size}}#createOutlines(){this.#highlightOutlines=new Ew(this.#boxes,.001).getOutlines(),[this.x,this.y,this.width,this.height]=this.#highlightOutlines.box,this.#focusOutlines=new Ew(this.#boxes,.0025,.001,this._uiManager.direction===`ltr`).getOutlines();let{lastPoint:e}=this.#focusOutlines;this.#lastPoint=[(e[0]-this.x)/this.width,(e[1]-this.y)/this.height]}#createFreeOutlines({highlightOutlines:t,highlightId:n,clipPathId:r}){if(this.#highlightOutlines=t,this.#focusOutlines=t.getNewOutline(this.#thickness/2+1.5,.0025),n>=0)this.#id=n,this.#clipPathId=r,this.parent.drawLayer.finalizeDraw(n,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#outlineId=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#focusOutlines.box,path:{d:this.#focusOutlines.toSVGPath()}},!0);else if(this.parent){let n=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#id,{bbox:e.#rotateBbox(this.#highlightOutlines.box,(n-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#outlineId,{bbox:e.#rotateBbox(this.#focusOutlines.box,n),path:{d:this.#focusOutlines.toSVGPath()}})}let[i,a,o,s]=t.box;switch(this.rotation){case 0:this.x=i,this.y=a,this.width=o,this.height=s;break;case 90:{let[e,t]=this.parentDimensions;this.x=a,this.y=1-i,this.width=o*t/e,this.height=s*e/t;break}case 180:this.x=1-i,this.y=1-a,this.width=o,this.height=s;break;case 270:{let[e,t]=this.parentDimensions;this.x=1-a,this.y=i,this.width=o*t/e,this.height=s*e/t;break}}let{lastPoint:c}=this.#focusOutlines;this.#lastPoint=[(c[0]-i)/o,(c[1]-a)/s]}static initialize(t,n){yx.initialize(t,n),e._defaultColor||=n.highlightColors?.values().next().value||`#fff066`}static updateDefaultParams(t,n){switch(t){case Jy.HIGHLIGHT_COLOR:e._defaultColor=n;break;case Jy.HIGHLIGHT_THICKNESS:e._defaultThickness=n;break}}translateInPage(e,t){}get toolbarPosition(){return this.#lastPoint}updateParams(e,t){switch(e){case Jy.HIGHLIGHT_COLOR:this.#updateColor(t);break;case Jy.HIGHLIGHT_THICKNESS:this.#updateThickness(t);break}}static get defaultPropertiesToUpdate(){return[[Jy.HIGHLIGHT_COLOR,e._defaultColor],[Jy.HIGHLIGHT_THICKNESS,e._defaultThickness]]}get propertiesToUpdate(){return[[Jy.HIGHLIGHT_COLOR,this.color||e._defaultColor],[Jy.HIGHLIGHT_THICKNESS,this.#thickness||e._defaultThickness],[Jy.HIGHLIGHT_FREE,this.#isFreeHighlight]]}#updateColor(t){let n=(e,t)=>{this.color=e,this.#opacity=t,this.parent?.drawLayer.updateProperties(this.#id,{root:{fill:e,"fill-opacity":t}}),this.#colorPicker?.updateColor(e)},r=this.color,i=this.#opacity;this.addCommands({cmd:n.bind(this,t,e._defaultOpacity),undo:n.bind(this,r,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Jy.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:`color_changed`,color:this._uiManager.getNonHCMColorName(t)},!0)}#updateThickness(e){let t=this.#thickness,n=e=>{this.#thickness=e,this.#changeThickness(e)};this.addCommands({cmd:n.bind(this,e),undo:n.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Jy.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:`thickness_changed`,thickness:e},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[[`colorPicker`,this.#colorPicker=new LC({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle(`disabled`,!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle(`disabled`,!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#getRotation())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#getRotation())}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){this.#cleanDrawLayer(),this._reportTelemetry({action:`deleted`}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#addToDrawLayer(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#cleanDrawLayer():e&&(this.#addToDrawLayer(e),t=!this.parent&&this.div?.classList.contains(`selectedEditor`)),super.setParent(e),this.show(this._isVisible),t&&this.select()}#changeThickness(e){if(!this.#isFreeHighlight)return;this.#createFreeOutlines({highlightOutlines:this.#highlightOutlines.getNewOutline(e/2)}),this.fixAndSetPosition();let[t,n]=this.parentDimensions;this.setDims(this.width*t,this.height*n)}#cleanDrawLayer(){this.#id===null||!this.parent||(this.parent.drawLayer.remove(this.#id),this.#id=null,this.parent.drawLayer.remove(this.#outlineId),this.#outlineId=null)}#addToDrawLayer(e=this.parent){this.#id===null&&({id:this.#id,clipPathId:this.#clipPathId}=e.drawLayer.draw({bbox:this.#highlightOutlines.box,root:{viewBox:`0 0 1 1`,fill:this.color,"fill-opacity":this.#opacity},rootClass:{highlight:!0,free:this.#isFreeHighlight},path:{d:this.#highlightOutlines.toSVGPath()}},!1,!0),this.#outlineId=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#isFreeHighlight},bbox:this.#focusOutlines.box,path:{d:this.#focusOutlines.toSVGPath()}},this.#isFreeHighlight),this.#highlightDiv&&(this.#highlightDiv.style.clipPath=this.#clipPathId))}static#rotateBbox([e,t,n,r],i){switch(i){case 90:return[1-t-r,e,r,n];case 180:return[1-e-n,1-t-r,n,r];case 270:return[t,1-e-n,r,n]}return[e,t,n,r]}rotate(t){let{drawLayer:n}=this.parent,r;this.#isFreeHighlight?(t=(t-this.rotation+360)%360,r=e.#rotateBbox(this.#highlightOutlines.box,t)):r=e.#rotateBbox([this.x,this.y,this.width,this.height],t),n.updateProperties(this.#id,{bbox:r,root:{"data-main-rotation":t}}),n.updateProperties(this.#outlineId,{bbox:e.#rotateBbox(this.#focusOutlines.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;let e=super.render();this.#text&&(e.setAttribute(`aria-label`,this.#text),e.setAttribute(`role`,`mark`)),this.#isFreeHighlight?e.classList.add(`free`):this.div.addEventListener(`keydown`,this.#keydown.bind(this),{signal:this._uiManager._signal});let t=this.#highlightDiv=document.createElement(`div`);e.append(t),t.setAttribute(`aria-hidden`,`true`),t.className=`internal`,t.style.clipPath=this.#clipPathId;let[n,r]=this.parentDimensions;return this.setDims(this.width*n,this.height*r),lx(this,this.#highlightDiv,[`pointerover`,`pointerleave`]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#outlineId,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#outlineId,{rootClass:{hovered:!1}})}#keydown(t){e._keyboardManager.exec(this,t)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#setCaret(!0);break;case 1:case 3:this.#setCaret(!1);break}}#setCaret(e){if(!this.#anchorNode)return;let t=window.getSelection();e?t.setPosition(this.#anchorNode,this.#anchorOffset):t.setPosition(this.#focusNode,this.#focusOffset)}select(){super.select(),this.#outlineId&&this.parent?.drawLayer.updateProperties(this.#outlineId,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#outlineId&&(this.parent?.drawLayer.updateProperties(this.#outlineId,{rootClass:{selected:!1}}),this.#isFreeHighlight||this.#setCaret(!1))}get _mustFixPosition(){return!this.#isFreeHighlight}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#id,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#outlineId,{rootClass:{hidden:!e}}))}#getRotation(){return this.#isFreeHighlight?this.rotation:0}#serializeBoxes(){if(this.#isFreeHighlight)return null;let[e,t]=this.pageDimensions,[n,r]=this.pageTranslation,i=this.#boxes,a=new Float32Array(i.length*8),o=0;for(let{x:s,y:c,width:l,height:u}of i){let i=s*e+n,d=(1-c)*t+r;a[o]=a[o+4]=i,a[o+1]=a[o+3]=d,a[o+2]=a[o+6]=i+l*e,a[o+5]=a[o+7]=d-u*t,o+=8}return a}#serializeOutlines(e){return this.#highlightOutlines.serialize(e,this.#getRotation())}static startHighlighting(e,t,{target:n,x:r,y:i}){let{x:a,y:o,width:s,height:c}=n.getBoundingClientRect(),l=new AbortController,u=e.combinedSignal(l),d=t=>{l.abort(),this.#endHighlight(e,t)};window.addEventListener(`blur`,d,{signal:u}),window.addEventListener(`pointerup`,d,{signal:u}),window.addEventListener(`pointerdown`,Xb,{capture:!0,passive:!1,signal:u}),window.addEventListener(`contextmenu`,Yb,{signal:u}),n.addEventListener(`pointermove`,this.#highlightMove.bind(this,e),{signal:u}),this._freeHighlight=new Ow({x:r,y:i},[a,o,s,c],e.scale,this._defaultThickness/2,t,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:`0 0 1 1`,fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#highlightMove(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#endHighlight(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:`main_toolbar`}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=``}static async deserialize(e,t,n){let r=null;if(e instanceof hw){let{data:{quadPoints:t,rect:n,rotation:i,id:a,color:o,opacity:s,popupRef:c,contentsObj:l},parent:{page:{pageNumber:u}}}=e;r=e={annotationType:X.HIGHLIGHT,color:Array.from(o),opacity:s,quadPoints:t,boxes:null,pageIndex:u-1,rect:n.slice(0),rotation:i,annotationElementId:a,id:a,deleted:!1,popupRef:c,comment:l?.str||null}}else if(e instanceof mw){let{data:{inkLists:t,rect:n,rotation:i,id:a,color:o,borderStyle:{rawWidth:s},popupRef:c,contentsObj:l},parent:{page:{pageNumber:u}}}=e;r=e={annotationType:X.HIGHLIGHT,color:Array.from(o),thickness:s,inkLists:t,boxes:null,pageIndex:u-1,rect:n.slice(0),rotation:i,annotationElementId:a,id:a,deleted:!1,popupRef:c,comment:l?.str||null}}let{color:i,quadPoints:a,inkLists:o,opacity:s}=e,c=await super.deserialize(e,t,n);c.color=Q.makeHexColor(...i),c.#opacity=s||1,o&&(c.#thickness=e.thickness),c._initialData=r,e.comment&&c.setCommentData(e.comment);let[l,u]=c.pageDimensions,[d,f]=c.pageTranslation;if(a){let e=c.#boxes=[];for(let t=0;t<a.length;t+=8)e.push({x:(a[t]-d)/l,y:1-(a[t+1]-f)/u,width:(a[t+2]-a[t])/l,height:(a[t+1]-a[t+5])/u});c.#createOutlines(),c.#addToDrawLayer(),c.rotate(c.rotation)}else if(o){c.#isFreeHighlight=!0;let e=o[0],n={x:e[0]-d,y:u-(e[1]-f)},r=new Ow(n,[0,0,l,u],1,c.#thickness/2,!0,.001);for(let t=0,i=e.length;t<i;t+=2)n.x=e[t]-d,n.y=u-(e[t+1]-f),r.add(n);let{id:i,clipPathId:a}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:`0 0 1 1`,fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:r.toSVGPath()}},!0,!0);c.#createFreeOutlines({highlightOutlines:r.getOutlines(),highlightId:i,clipPathId:a}),c.#addToDrawLayer(),c.rotate(c.parentRotation)}return c}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();let t=this.getPDFRect(),n=yx._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),r={annotationType:X.HIGHLIGHT,color:n,opacity:this.#opacity,thickness:this.#thickness,quadPoints:this.#serializeBoxes(),outlines:this.#serializeOutlines(t),pageIndex:this.pageIndex,rect:t,rotation:this.#getRotation(),structTreeParentId:this._structTreeParentId};return this.addComment(r),this.annotationElementId&&!this.#hasElementChanged(r)?null:(r.id=this.annotationElementId,r)}#hasElementChanged(e){let{color:t}=this._initialData;return this.hasEditedComment||e.color.some((e,n)=>e!==t[n])}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t={rect:this.getPDFRect()};return this.hasEditedComment&&(t.popup=this.comment),e.updateEdited(t),null}static canCreateNewEmptyEditor(){return!1}},jw=class{#svgProperties=Object.create(null);updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(let[t,n]of Object.entries(e))t.startsWith(`_`)||this.updateProperty(t,n)}updateSVGProperty(e,t){this.#svgProperties[e]=t}toSVGProperties(){let e=this.#svgProperties;return this.#svgProperties=Object.create(null),{root:e}}reset(){this.#svgProperties=Object.create(null)}updateAll(e=this){this.updateProperties(e)}clone(){cb(`Not implemented`)}},Mw=class e extends yx{#drawOutlines=null;#mustBeCommitted;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#currentDraw=null;static#currentDrawingAC=null;static#currentDrawingOptions=null;static#currentPointerId=NaN;static#currentPointerType=null;static#currentPointerIds=null;static#currentMoveTimestamp=NaN;static _INNER_MARGIN=3;constructor(e){super(e),this.#mustBeCommitted=e.mustBeCommitted||!1,this._addOutlines(e)}_addOutlines(e){e.drawOutlines&&(this.#createDrawOutlines(e),this.#addToDrawLayer())}#createDrawOutlines({drawOutlines:e,drawId:t,drawingOptions:n}){this.#drawOutlines=e,this._drawingOptions||=n,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),t>=0?(this._drawId=t,this.parent.drawLayer.finalizeDraw(t,e.defaultProperties)):this._drawId=this.#createDrawing(e,this.parent),this.#updateBbox(e.box)}#createDrawing(t,n){let{id:r}=n.drawLayer.draw(e._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return r}static _mergeSVGProperties(e,t){let n=new Set(Object.keys(e));for(let[r,i]of Object.entries(t))n.has(r)?Object.assign(e[r],i):e[r]=i;return e}static getDefaultDrawingOptions(e){cb(`Not implemented`)}static get typesMap(){cb(`Not implemented`)}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,n){let r=this.typesMap.get(t);r&&this._defaultDrawingOptions.updateProperty(r,n),this._currentParent&&(e.#currentDraw.updateProperty(r,n),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,t){let n=this.constructor.typesMap.get(e);n&&this._updateProperty(e,n,t)}static get defaultPropertiesToUpdate(){let e=[],t=this._defaultDrawingOptions;for(let[n,r]of this.typesMap)e.push([n,t[r]]);return e}get propertiesToUpdate(){let e=[],{_drawingOptions:t}=this;for(let[n,r]of this.constructor.typesMap)e.push([n,t[r]]);return e}_updateProperty(e,t,n){let r=this._drawingOptions,i=r[t],a=n=>{r.updateProperty(t,n);let i=this.#drawOutlines.updateProperty(t,n);i&&this.#updateBbox(i),this.parent?.drawLayer.updateProperties(this._drawId,r.toSVGProperties()),e===this.colorType&&this._colorPicker?.update(n)};this.addCommands({cmd:a.bind(this,n),undo:a.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,e._mergeSVGProperties(this.#drawOutlines.getPathResizingSVGProperties(this.#convertToDrawSpace()),{bbox:this.#rotateBox()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,e._mergeSVGProperties(this.#drawOutlines.getPathResizedSVGProperties(this.#convertToDrawSpace()),{bbox:this.#rotateBox()}))}_onTranslating(e,t){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#rotateBox()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,e._mergeSVGProperties(this.#drawOutlines.getPathTranslatedSVGProperties(this.#convertToDrawSpace(),this.parentDimensions),{bbox:this.#rotateBox()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle(`disabled`,!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle(`disabled`,!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#mustBeCommitted&&(this.#mustBeCommitted=!1,this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){this.#cleanDrawLayer(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#addToDrawLayer(),this.#updateBbox(this.#drawOutlines.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),this.#cleanDrawLayer()):e&&(this._uiManager.addShouldRescale(this),this.#addToDrawLayer(e),t=!this.parent&&this.div?.classList.contains(`selectedEditor`)),super.setParent(e),t&&this.select()}#cleanDrawLayer(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#addToDrawLayer(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#createDrawing(this.#drawOutlines,e)}}#convertToParentSpace([e,t,n,r]){let{parentDimensions:[i,a],rotation:o}=this;switch(o){case 90:return[t,1-e,n*(a/i),r*(i/a)];case 180:return[1-e,1-t,n,r];case 270:return[1-t,e,n*(a/i),r*(i/a)];default:return[e,t,n,r]}}#convertToDrawSpace(){let{x:e,y:t,width:n,height:r,parentDimensions:[i,a],rotation:o}=this;switch(o){case 90:return[1-t,e,n*(i/a),r*(a/i)];case 180:return[1-e,1-t,n,r];case 270:return[t,1-e,n*(i/a),r*(a/i)];default:return[e,t,n,r]}}#updateBbox(e){if([this.x,this.y,this.width,this.height]=this.#convertToParentSpace(e),this.div){this.fixAndSetPosition();let[e,t]=this.parentDimensions;this.setDims(this.width*e,this.height*t)}this._onResized()}#rotateBox(){let{x:e,y:t,width:n,height:r,rotation:i,parentRotation:a,parentDimensions:[o,s]}=this;switch((i*4+a)/90){case 1:return[1-t-r,e,r,n];case 2:return[1-e-n,1-t-r,n,r];case 3:return[t,1-e-n,r,n];case 4:return[e,t-n*(o/s),r*(s/o),n*(o/s)];case 5:return[1-t,e,n*(o/s),r*(s/o)];case 6:return[1-e-r*(s/o),1-t,r*(s/o),n*(o/s)];case 7:return[t-n*(o/s),1-e-r*(s/o),n*(o/s),r*(s/o)];case 8:return[e-n,t-r,n,r];case 9:return[1-t,e-n,r,n];case 10:return[1-e,1-t,n,r];case 11:return[t-r,1-e,r,n];case 12:return[e-r*(s/o),t,r*(s/o),n*(o/s)];case 13:return[1-t-n*(o/s),e-r*(s/o),n*(o/s),r*(s/o)];case 14:return[1-e,1-t-n*(o/s),r*(s/o),n*(o/s)];case 15:return[t,1-e,n*(o/s),r*(s/o)];default:return[e,t,n,r]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,e._mergeSVGProperties({bbox:this.#rotateBox()},this.#drawOutlines.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#updateBbox(this.#drawOutlines.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e,t;this._isCopy&&(e=this.x,t=this.y);let n=super.render();n.classList.add(`draw`);let r=document.createElement(`div`);n.append(r),r.setAttribute(`aria-hidden`,`true`),r.className=`internal`;let[i,a]=this.parentDimensions;return this.setDims(this.width*i,this.height*a),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,t),n}static createDrawerInstance(e,t,n,r,i){cb(`Not implemented`)}static startDrawing(t,n,r,i){let{target:a,offsetX:o,offsetY:s,pointerId:c,pointerType:l}=i;if(e.#currentPointerType&&e.#currentPointerType!==l)return;let{viewport:{rotation:u}}=t,{width:d,height:f}=a.getBoundingClientRect(),p=e.#currentDrawingAC=new AbortController,m=t.combinedSignal(p);if(e.#currentPointerId||=c,e.#currentPointerType??=l,window.addEventListener(`pointerup`,t=>{e.#currentPointerId===t.pointerId?this._endDraw(t):e.#currentPointerIds?.delete(t.pointerId)},{signal:m}),window.addEventListener(`pointercancel`,t=>{e.#currentPointerId===t.pointerId?this._currentParent.endDrawingSession():e.#currentPointerIds?.delete(t.pointerId)},{signal:m}),window.addEventListener(`pointerdown`,t=>{e.#currentPointerType===t.pointerType&&((e.#currentPointerIds||=new Set).add(t.pointerId),e.#currentDraw.isCancellable()&&(e.#currentDraw.removeLastElement(),e.#currentDraw.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:m}),window.addEventListener(`contextmenu`,Yb,{signal:m}),a.addEventListener(`pointermove`,this._drawMove.bind(this),{signal:m}),a.addEventListener(`touchmove`,t=>{t.timeStamp===e.#currentMoveTimestamp&&Xb(t)},{signal:m}),t.toggleDrawing(),n._editorUndoBar?.hide(),e.#currentDraw){t.drawLayer.updateProperties(this._currentDrawId,e.#currentDraw.startNew(o,s,d,f,u));return}n.updateUIForDefaultProperties(this),e.#currentDraw=this.createDrawerInstance(o,s,d,f,u),e.#currentDrawingOptions=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(e.#currentDrawingOptions.toSVGProperties(),e.#currentDraw.defaultSVGProperties),!0,!1)}static _drawMove(t){if(e.#currentMoveTimestamp=-1,!e.#currentDraw)return;let{offsetX:n,offsetY:r,pointerId:i}=t;if(e.#currentPointerId===i){if(e.#currentPointerIds?.size>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,e.#currentDraw.add(n,r)),e.#currentMoveTimestamp=t.timeStamp,Xb(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,e.#currentDraw=null,e.#currentDrawingOptions=null,e.#currentPointerType=null,e.#currentMoveTimestamp=NaN),e.#currentDrawingAC&&(e.#currentDrawingAC.abort(),e.#currentDrawingAC=null,e.#currentPointerId=NaN,e.#currentPointerIds=null)}static _endDraw(t){let n=this._currentParent;if(n){if(n.toggleDrawing(!0),this._cleanup(!1),t?.target===n.div&&n.drawLayer.updateProperties(this._currentDrawId,e.#currentDraw.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){let t=e.#currentDraw,r=this._currentDrawId,i=t.getLastElement();n.addCommands({cmd:()=>{n.drawLayer.updateProperties(r,t.setLastElement(i))},undo:()=>{n.drawLayer.updateProperties(r,t.removeLastElement())},mustExec:!1,type:Jy.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){let n=this._currentParent;if(!n)return null;if(n.toggleDrawing(!0),n.cleanUndoStack(Jy.DRAW_STEP),!e.#currentDraw.isEmpty()){let{pageDimensions:[r,i],scale:a}=n,o=n.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:e.#currentDraw.getOutlines(r*a,i*a,a,this._INNER_MARGIN),drawingOptions:e.#currentDrawingOptions,mustBeCommitted:!t});return this._cleanup(!0),o}return n.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,t,n,r,i,a){cb(`Not implemented`)}static async deserialize(e,t,n){let{rawDims:{pageWidth:r,pageHeight:i,pageX:a,pageY:o}}=t.viewport,s=this.deserializeDraw(a,o,r,i,this._INNER_MARGIN,e),c=await super.deserialize(e,t,n);return c.createDrawingOptions(e),c.#createDrawOutlines({drawOutlines:s}),c.#addToDrawLayer(),c.onScaleChanging(),c.rotate(),c}serializeDraw(e){let[t,n]=this.pageTranslation,[r,i]=this.pageDimensions;return this.#drawOutlines.serialize([t,n,r,i],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}},Nw=class{#last=new Float64Array(6);#line;#lines;#rotation;#thickness;#points;#lastSVGPath=``;#lastIndex=0;#outlines=new Pw;#parentWidth;#parentHeight;constructor(e,t,n,r,i,a){this.#parentWidth=n,this.#parentHeight=r,this.#rotation=i,this.#thickness=a,[e,t]=this.#normalizePoint(e,t);let o=this.#line=[NaN,NaN,NaN,NaN,e,t];this.#points=[e,t],this.#lines=[{line:o,points:this.#points}],this.#last.set(o,0)}updateProperty(e,t){e===`stroke-width`&&(this.#thickness=t)}#normalizePoint(e,t){return $._normalizePoint(e,t,this.#parentWidth,this.#parentHeight,this.#rotation)}isEmpty(){return!this.#lines||this.#lines.length===0}isCancellable(){return this.#points.length<=10}add(e,t){[e,t]=this.#normalizePoint(e,t);let[n,r,i,a]=this.#last.subarray(2,6),o=e-i,s=t-a;return Math.hypot(this.#parentWidth*o,this.#parentHeight*s)<=2?null:(this.#points.push(e,t),isNaN(n)?(this.#last.set([i,a,e,t],2),this.#line.push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(this.#last[0])&&this.#line.splice(6,6),this.#last.set([n,r,i,a,e,t],0),this.#line.push(...$.createBezierPoints(n,r,i,a,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){return this.add(e,t)||(this.#points.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,r,i){this.#parentWidth=n,this.#parentHeight=r,this.#rotation=i,[e,t]=this.#normalizePoint(e,t);let a=this.#line=[NaN,NaN,NaN,NaN,e,t];this.#points=[e,t];let o=this.#lines.at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),this.#lines.push({line:a,points:this.#points}),this.#last.set(a,0),this.#lastIndex=0,this.toSVGPath(),null}getLastElement(){return this.#lines.at(-1)}setLastElement(e){return this.#lines?(this.#lines.push(e),this.#line=e.line,this.#points=e.points,this.#lastIndex=0,{path:{d:this.toSVGPath()}}):this.#outlines.setLastElement(e)}removeLastElement(){if(!this.#lines)return this.#outlines.removeLastElement();this.#lines.pop(),this.#lastSVGPath=``;for(let e=0,t=this.#lines.length;e<t;e++){let{line:t,points:n}=this.#lines[e];this.#line=t,this.#points=n,this.#lastIndex=0,this.toSVGPath()}return{path:{d:this.#lastSVGPath}}}toSVGPath(){let e=$.svgRound(this.#line[4]),t=$.svgRound(this.#line[5]);if(this.#points.length===2)return this.#lastSVGPath=`${this.#lastSVGPath} M ${e} ${t} Z`,this.#lastSVGPath;if(this.#points.length<=6){let n=this.#lastSVGPath.lastIndexOf(`M`);this.#lastSVGPath=`${this.#lastSVGPath.slice(0,n)} M ${e} ${t}`,this.#lastIndex=6}if(this.#points.length===4){let e=$.svgRound(this.#line[10]),t=$.svgRound(this.#line[11]);return this.#lastSVGPath=`${this.#lastSVGPath} L ${e} ${t}`,this.#lastIndex=12,this.#lastSVGPath}let n=[];this.#lastIndex===0&&(n.push(`M ${e} ${t}`),this.#lastIndex=6);for(let e=this.#lastIndex,t=this.#line.length;e<t;e+=6){let[t,r,i,a,o,s]=this.#line.slice(e,e+6).map($.svgRound);n.push(`C${t} ${r} ${i} ${a} ${o} ${s}`)}return this.#lastSVGPath+=n.join(` `),this.#lastIndex=this.#line.length,this.#lastSVGPath}getOutlines(e,t,n,r){let i=this.#lines.at(-1);return i.line=new Float32Array(i.line),i.points=new Float32Array(i.points),this.#outlines.build(this.#lines,e,t,n,this.#rotation,this.#thickness,r),this.#last=null,this.#line=null,this.#lines=null,this.#lastSVGPath=null,this.#outlines}get defaultSVGProperties(){return{root:{viewBox:`0 0 10000 10000`},rootClass:{draw:!0},bbox:[0,0,1,1]}}},Pw=class extends ${#bbox;#currentRotation=0;#innerMargin;#lines;#parentWidth;#parentHeight;#parentScale;#rotation;#thickness;build(e,t,n,r,i,a,o){this.#parentWidth=t,this.#parentHeight=n,this.#parentScale=r,this.#rotation=i,this.#thickness=a,this.#innerMargin=o??0,this.#lines=e,this.#computeBbox()}get thickness(){return this.#thickness}setLastElement(e){return this.#lines.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#lines.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){let e=[];for(let{line:t}of this.#lines){if(e.push(`M${$.svgRound(t[4])} ${$.svgRound(t[5])}`),t.length===6){e.push(`Z`);continue}if(t.length===12&&isNaN(t[6])){e.push(`L${$.svgRound(t[10])} ${$.svgRound(t[11])}`);continue}for(let n=6,r=t.length;n<r;n+=6){let[r,i,a,o,s,c]=t.subarray(n,n+6).map($.svgRound);e.push(`C${r} ${i} ${a} ${o} ${s} ${c}`)}}return e.join(``)}serialize([e,t,n,r],i){let a=[],o=[],[s,c,l,u]=this.#getBBoxWithNoMargin(),d,f,p,m,h,g,_,v,y;switch(this.#rotation){case 0:y=$._rescale,d=e,f=t+r,p=n,m=-r,h=e+s*n,g=t+(1-c-u)*r,_=e+(s+l)*n,v=t+(1-c)*r;break;case 90:y=$._rescaleAndSwap,d=e,f=t,p=n,m=r,h=e+c*n,g=t+s*r,_=e+(c+u)*n,v=t+(s+l)*r;break;case 180:y=$._rescale,d=e+n,f=t,p=-n,m=r,h=e+(1-s-l)*n,g=t+c*r,_=e+(1-s)*n,v=t+(c+u)*r;break;case 270:y=$._rescaleAndSwap,d=e+n,f=t+r,p=-n,m=-r,h=e+(1-c-u)*n,g=t+(1-s-l)*r,_=e+(1-c)*n,v=t+(1-s)*r;break}for(let{line:e,points:t}of this.#lines)a.push(y(e,d,f,p,m,i?Array(e.length):null)),o.push(y(t,d,f,p,m,i?Array(t.length):null));return{lines:a,points:o,rect:[h,g,_,v]}}static deserialize(e,t,n,r,i,{paths:{lines:a,points:o},rotation:s,thickness:c}){let l=[],u,d,f,p,m;switch(s){case 0:m=$._rescale,u=-e/n,d=t/r+1,f=1/n,p=-1/r;break;case 90:m=$._rescaleAndSwap,u=-t/r,d=-e/n,f=1/r,p=1/n;break;case 180:m=$._rescale,u=e/n+1,d=-t/r,f=-1/n,p=1/r;break;case 270:m=$._rescaleAndSwap,u=t/r+1,d=e/n+1,f=-1/r,p=-1/n;break}if(!a){a=[];for(let e of o){let t=e.length;if(t===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,e[0],e[1]]));continue}if(t===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,e[0],e[1],NaN,NaN,NaN,NaN,e[2],e[3]]));continue}let n=new Float32Array(3*(t-2));a.push(n);let[r,i,o,s]=e.subarray(0,4);n.set([NaN,NaN,NaN,NaN,r,i],0);for(let a=4;a<t;a+=2){let t=e[a],c=e[a+1];n.set($.createBezierPoints(r,i,o,s,t,c),(a-2)*3),[r,i,o,s]=[o,s,t,c]}}}for(let e=0,t=a.length;e<t;e++)l.push({line:m(a[e].map(e=>e??NaN),u,d,f,p),points:m(o[e].map(e=>e??NaN),u,d,f,p)});let h=new this.prototype.constructor;return h.build(l,n,r,1,s,c,i),h}#getMarginComponents(e=this.#thickness){let t=this.#innerMargin+e/2*this.#parentScale;return this.#rotation%180==0?[t/this.#parentWidth,t/this.#parentHeight]:[t/this.#parentHeight,t/this.#parentWidth]}#getBBoxWithNoMargin(){let[e,t,n,r]=this.#bbox,[i,a]=this.#getMarginComponents(0);return[e+i,t+a,n-2*i,r-2*a]}#computeBbox(){let e=this.#bbox=new Float32Array([1/0,1/0,-1/0,-1/0]);for(let{line:t}of this.#lines){if(t.length<=12){for(let n=4,r=t.length;n<r;n+=6)Q.pointBoundingBox(t[n],t[n+1],e);continue}let n=t[4],r=t[5];for(let i=6,a=t.length;i<a;i+=6){let[a,o,s,c,l,u]=t.subarray(i,i+6);Q.bezierBoundingBox(n,r,a,o,s,c,l,u,e),n=l,r=u}}let[t,n]=this.#getMarginComponents();e[0]=Fb(e[0]-t,0,1),e[1]=Fb(e[1]-n,0,1),e[2]=Fb(e[2]+t,0,1),e[3]=Fb(e[3]+n,0,1),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#bbox}updateProperty(e,t){return e===`stroke-width`?this.#updateThickness(t):null}#updateThickness(e){let[t,n]=this.#getMarginComponents();this.#thickness=e;let[r,i]=this.#getMarginComponents(),[a,o]=[r-t,i-n],s=this.#bbox;return s[0]-=a,s[1]-=o,s[2]+=2*a,s[3]+=2*o,s}updateParentDimensions([e,t],n){let[r,i]=this.#getMarginComponents();this.#parentWidth=e,this.#parentHeight=t,this.#parentScale=n;let[a,o]=this.#getMarginComponents(),s=a-r,c=o-i,l=this.#bbox;return l[0]-=s,l[1]-=c,l[2]+=2*s,l[3]+=2*c,l}updateRotation(e){return this.#currentRotation=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#bbox.map($.svgRound).join(` `)}get defaultProperties(){let[e,t]=this.#bbox;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${$.svgRound(e)} ${$.svgRound(t)}`}}}get rotationTransform(){let[,,e,t]=this.#bbox,n=0,r=0,i=0,a=0,o=0,s=0;switch(this.#currentRotation){case 90:r=t/e,i=-e/t,o=e;break;case 180:n=-1,a=-1,o=e,s=t;break;case 270:r=-t/e,i=e/t,s=t;break;default:return``}return`matrix(${n} ${r} ${i} ${a} ${$.svgRound(o)} ${$.svgRound(s)})`}getPathResizingSVGProperties([e,t,n,r]){let[i,a]=this.#getMarginComponents(),[o,s,c,l]=this.#bbox;if(Math.abs(c-i)<=$.PRECISION||Math.abs(l-a)<=$.PRECISION){let i=e+n/2-(o+c/2),a=t+r/2-(s+l/2);return{path:{"transform-origin":`${$.svgRound(e)} ${$.svgRound(t)}`,transform:`${this.rotationTransform} translate(${i} ${a})`}}}let u=(n-2*i)/(c-2*i),d=(r-2*a)/(l-2*a),f=c/n,p=l/r;return{path:{"transform-origin":`${$.svgRound(o)} ${$.svgRound(s)}`,transform:`${this.rotationTransform} scale(${f} ${p}) translate(${$.svgRound(i)} ${$.svgRound(a)}) scale(${u} ${d}) translate(${$.svgRound(-i)} ${$.svgRound(-a)})`}}}getPathResizedSVGProperties([e,t,n,r]){let[i,a]=this.#getMarginComponents(),o=this.#bbox,[s,c,l,u]=o;if(o[0]=e,o[1]=t,o[2]=n,o[3]=r,Math.abs(l-i)<=$.PRECISION||Math.abs(u-a)<=$.PRECISION){let i=e+n/2-(s+l/2),a=t+r/2-(c+u/2);for(let{line:e,points:t}of this.#lines)$._translate(e,i,a,e),$._translate(t,i,a,t);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${$.svgRound(e)} ${$.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}let d=(n-2*i)/(l-2*i),f=(r-2*a)/(u-2*a),p=-d*(s+i)+e+i,m=-f*(c+a)+t+a;if(d!==1||f!==1||p!==0||m!==0)for(let{line:e,points:t}of this.#lines)$._rescale(e,p,m,d,f,e),$._rescale(t,p,m,d,f,t);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${$.svgRound(e)} ${$.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,t],n){let[r,i]=n,a=this.#bbox,o=e-a[0],s=t-a[1];if(this.#parentWidth===r&&this.#parentHeight===i)for(let{line:e,points:t}of this.#lines)$._translate(e,o,s,e),$._translate(t,o,s,t);else{let e=this.#parentWidth/r,t=this.#parentHeight/i;this.#parentWidth=r,this.#parentHeight=i;for(let{line:n,points:r}of this.#lines)$._rescale(n,o,s,e,t,n),$._rescale(r,o,s,e,t,r);a[2]*=e,a[3]*=t}return a[0]=e,a[1]=t,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${$.svgRound(e)} ${$.svgRound(t)}`}}}get defaultSVGProperties(){let e=this.#bbox;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${$.svgRound(e[0])} ${$.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}},Fw=class e extends jw{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:`none`,stroke:yx._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":`round`,"stroke-linejoin":`round`,"stroke-miterlimit":10})}updateSVGProperty(e,t){e===`stroke-width`&&(t??=this[`stroke-width`],t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){let t=new e(this._viewParameters);return t.updateAll(this),t}},Iw=class e extends Mw{static _type=`ink`;static _editorType=X.INK;static _defaultDrawingOptions=null;constructor(e){super({...e,name:`inkEditor`}),this._willKeepAspectRatio=!0,this.defaultL10nId=`pdfjs-editor-ink-editor`}static initialize(e,t){yx.initialize(e,t),this._defaultDrawingOptions=new Fw(t.viewParameters)}static getDefaultDrawingOptions(e){let t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!0}static get typesMap(){return pb(this,`typesMap`,new Map([[Jy.INK_THICKNESS,`stroke-width`],[Jy.INK_COLOR,`stroke`],[Jy.INK_OPACITY,`stroke-opacity`]]))}static createDrawerInstance(e,t,n,r,i){return new Nw(e,t,n,r,i,this._defaultDrawingOptions[`stroke-width`])}static deserializeDraw(e,t,n,r,i,a){return Pw.deserialize(e,t,n,r,i,a)}static async deserialize(e,t,n){let r=null;if(e instanceof mw){let{data:{inkLists:t,rect:n,rotation:i,id:a,color:o,opacity:s,borderStyle:{rawWidth:c},popupRef:l,contentsObj:u},parent:{page:{pageNumber:d}}}=e;r=e={annotationType:X.INK,color:Array.from(o),thickness:c,opacity:s,paths:{points:t},boxes:null,pageIndex:d-1,rect:n.slice(0),rotation:i,annotationElementId:a,id:a,deleted:!1,popupRef:l,comment:u?.str||null}}let i=await super.deserialize(e,t,n);return i._initialData=r,e.comment&&i.setCommentData(e.comment),i}get toolbarButtons(){return this._colorPicker||=new RC(this),[[`colorPicker`,this._colorPicker]]}get colorType(){return Jy.INK_COLOR}get colorValue(){return this._drawingOptions.stroke}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();let{_drawId:e,_drawingOptions:t,parent:n}=this;t.updateSVGProperty(`stroke-width`),n.drawLayer.updateProperties(e,t.toSVGProperties())}static onScaleChangingWhenDrawing(){let e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty(`stroke-width`),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:n,opacity:r}){this._drawingOptions=e.getDefaultDrawingOptions({stroke:Q.makeHexColor(...t),"stroke-width":n,"stroke-opacity":r})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let{lines:t,points:n,rect:r}=this.serializeDraw(e),{_drawingOptions:{stroke:i,"stroke-opacity":a,"stroke-width":o}}=this,s={annotationType:X.INK,color:yx._colorManager.convert(i),opacity:a,thickness:o,paths:{lines:t,points:n},pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(s),e?(s.isCopy=!0,s):this.annotationElementId&&!this.#hasElementChanged(s)?null:(s.id=this.annotationElementId,s)}#hasElementChanged(e){let{color:t,thickness:n,opacity:r,pageIndex:i}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||e.color.some((e,n)=>e!==t[n])||e.thickness!==n||e.opacity!==r||e.pageIndex!==i}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let{points:t,rect:n}=this.serializeDraw(!1),r={rect:n,thickness:this._drawingOptions[`stroke-width`],points:t};return this.hasEditedComment&&(r.popup=this.comment),e.updateEdited(r),null}},Lw=class extends Pw{toSVGPath(){let e=super.toSVGPath();return e.endsWith(`Z`)||(e+=`Z`),e}},Rw=8,zw=3,Bw=class{static#PARAMETERS={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#neighborIndexToId(e,t,n,r){return n-=e,r-=t,n===0?r>0?0:4:n===1?r+6:2-r}static#neighborIdToIndex=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#clockwiseNonZero(e,t,n,r,i,a,o){let s=this.#neighborIndexToId(n,r,i,a);for(let i=0;i<8;i++){let a=(-i+s-o+16)%8,c=this.#neighborIdToIndex[2*a],l=this.#neighborIdToIndex[2*a+1];if(e[(n+c)*t+(r+l)]!==0)return a}return-1}static#counterClockwiseNonZero(e,t,n,r,i,a,o){let s=this.#neighborIndexToId(n,r,i,a);for(let i=0;i<8;i++){let a=(i+s+o+16)%8,c=this.#neighborIdToIndex[2*a],l=this.#neighborIdToIndex[2*a+1];if(e[(n+c)*t+(r+l)]!==0)return a}return-1}static#findContours(e,t,n,r){let i=e.length,a=new Int32Array(i);for(let t=0;t<i;t++)a[t]=e[t]<=r?1:0;for(let e=1;e<n-1;e++)a[e*t]=a[e*t+t-1]=0;for(let e=0;e<t;e++)a[e]=a[t*n-1-e]=0;let o=1,s,c=[];for(let e=1;e<n-1;e++){s=1;for(let n=1;n<t-1;n++){let r=e*t+n,i=a[r];if(i===0)continue;let l=e,u=n;if(i===1&&a[r-1]===0)o+=1,--u;else if(i>=1&&a[r+1]===0)o+=1,u+=1,i>1&&(s=i);else{i!==1&&(s=Math.abs(i));continue}let d=[n,e],f=u===n+1,p={isHole:f,points:d,id:o,parent:0};c.push(p);let m;for(let e of c)if(e.id===s){m=e;break}m?m.isHole?p.parent=f?m.parent:s:p.parent=f?s:m.parent:p.parent=f?s:0;let h=this.#clockwiseNonZero(a,t,e,n,l,u,0);if(h===-1){a[r]=-o,a[r]!==1&&(s=Math.abs(a[r]));continue}let g=this.#neighborIdToIndex[2*h],_=this.#neighborIdToIndex[2*h+1],v=e+g,y=n+_;l=v,u=y;let b=e,x=n;for(;;){let i=this.#counterClockwiseNonZero(a,t,b,x,l,u,1);g=this.#neighborIdToIndex[2*i],_=this.#neighborIdToIndex[2*i+1];let c=b+g,f=x+_;d.push(f,c);let p=b*t+x;if(a[p+1]===0?a[p]=-o:a[p]===1&&(a[p]=o),c===e&&f===n&&b===v&&x===y){a[r]!==1&&(s=Math.abs(a[r]));break}else l=b,u=x,b=c,x=f}}}return c}static#douglasPeuckerHelper(e,t,n,r){if(n-t<=4){for(let i=t;i<n-2;i+=2)r.push(e[i],e[i+1]);return}let i=e[t],a=e[t+1],o=e[n-4]-i,s=e[n-3]-a,c=Math.hypot(o,s),l=o/c,u=s/c,d=l*a-u*i,f=s/o,p=1/c,m=Math.atan(f),h=Math.cos(m),g=Math.sin(m),_=p*(Math.abs(h)+Math.abs(g)),v=p*(1-_+_**2),y=Math.max(Math.atan(Math.abs(g+h)*v),Math.atan(Math.abs(g-h)*v)),b=0,x=t;for(let r=t+2;r<n-2;r+=2){let t=Math.abs(d-l*e[r+1]+u*e[r]);t>b&&(x=r,b=t)}b>(c*y)**2?(this.#douglasPeuckerHelper(e,t,x+2,r),this.#douglasPeuckerHelper(e,x,n,r)):r.push(i,a)}static#douglasPeucker(e){let t=[],n=e.length;return this.#douglasPeuckerHelper(e,0,n,t),t.push(e[n-2],e[n-1]),t.length<=4?null:t}static#bilateralFilter(e,t,n,r,i,a){let o=new Float32Array(a**2),s=-2*r**2,c=a>>1;for(let e=0;e<a;e++){let t=(e-c)**2;for(let n=0;n<a;n++)o[e*a+n]=Math.exp((t+(n-c)**2)/s)}let l=new Float32Array(256),u=-2*i**2;for(let e=0;e<256;e++)l[e]=Math.exp(e**2/u);let d=e.length,f=new Uint8Array(d),p=new Uint32Array(256);for(let r=0;r<n;r++)for(let i=0;i<t;i++){let s=r*t+i,u=e[s],d=0,m=0;for(let s=0;s<a;s++){let f=r+s-c;if(!(f<0||f>=n))for(let n=0;n<a;n++){let r=i+n-c;if(r<0||r>=t)continue;let p=e[f*t+r],h=o[s*a+n]*l[Math.abs(p-u)];d+=p*h,m+=h}}let h=f[s]=Math.round(d/m);p[h]++}return[f,p]}static#getHistogram(e){let t=new Uint32Array(256);for(let n of e)t[n]++;return t}static#toUint8(e){let t=e.length,n=new Uint8ClampedArray(t>>2),r=-1/0,i=1/0;for(let t=0,a=n.length;t<a;t++){let a=n[t]=e[t<<2];r=Math.max(r,a),i=Math.min(i,a)}let a=255/(r-i);for(let e=0,t=n.length;e<t;e++)n[e]=(n[e]-i)*a;return n}static#guessThreshold(e){let t,n=-1/0,r=-1/0,i=e.findIndex(e=>e!==0),a=i,o=i;for(t=i;t<256;t++){let i=e[t];i>n&&(t-a>r&&(r=t-a,o=t-1),n=i,a=t)}for(t=o-1;t>=0&&!(e[t]>e[t+1]);t--);return t}static#getGrayPixels(e){let t=e,{width:n,height:r}=e,{maxDim:i}=this.#PARAMETERS,a=n,o=r;if(n>i||r>i){let s=n,c=r,l=Math.log2(Math.max(n,r)/i),u=Math.floor(l);l=l===u?u-1:u;for(let n=0;n<l;n++){a=Math.ceil(s/2),o=Math.ceil(c/2);let n=new OffscreenCanvas(a,o);n.getContext(`2d`).drawImage(e,0,0,s,c,0,0,a,o),s=a,c=o,e!==t&&e.close(),e=n.transferToImageBitmap()}let d=Math.min(i/a,i/o);a=Math.round(a*d),o=Math.round(o*d)}let s=new OffscreenCanvas(a,o).getContext(`2d`,{willReadFrequently:!0});s.fillStyle=`white`,s.fillRect(0,0,a,o),s.filter=`grayscale(1)`,s.drawImage(e,0,0,e.width,e.height,0,0,a,o);let c=s.getImageData(0,0,a,o).data;return[this.#toUint8(c),a,o]}static extractContoursFromText(e,{fontFamily:t,fontStyle:n,fontWeight:r},i,a,o,s){let c=new OffscreenCanvas(1,1),l=c.getContext(`2d`,{alpha:!1}),u=l.font=`${n} ${r} 200px ${t}`,{actualBoundingBoxLeft:d,actualBoundingBoxRight:f,actualBoundingBoxAscent:p,actualBoundingBoxDescent:m,fontBoundingBoxAscent:h,fontBoundingBoxDescent:g,width:_}=l.measureText(e),v=1.5,y=Math.ceil(Math.max(Math.abs(d)+Math.abs(f)||0,_)*v),b=Math.ceil(Math.max(Math.abs(p)+Math.abs(m)||200,Math.abs(h)+Math.abs(g)||200)*v);c=new OffscreenCanvas(y,b),l=c.getContext(`2d`,{alpha:!0,willReadFrequently:!0}),l.font=u,l.filter=`grayscale(1)`,l.fillStyle=`white`,l.fillRect(0,0,y,b),l.fillStyle=`black`,l.fillText(e,y*(v-1)/2,b*(3-v)/2);let x=this.#toUint8(l.getImageData(0,0,y,b).data),S=this.#getHistogram(x),C=this.#guessThreshold(S),w=this.#findContours(x,y,b,C);return this.processDrawnLines({lines:{curves:w,width:y,height:b},pageWidth:i,pageHeight:a,rotation:o,innerMargin:s,mustSmooth:!0,areContours:!0})}static process(e,t,n,r,i){let[a,o,s]=this.#getGrayPixels(e),[c,l]=this.#bilateralFilter(a,o,s,Math.hypot(o,s)*this.#PARAMETERS.sigmaSFactor,this.#PARAMETERS.sigmaR,this.#PARAMETERS.kernelSize),u=this.#guessThreshold(l),d=this.#findContours(c,o,s,u);return this.processDrawnLines({lines:{curves:d,width:o,height:s},pageWidth:t,pageHeight:n,rotation:r,innerMargin:i,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:n,rotation:r,innerMargin:i,mustSmooth:a,areContours:o}){r%180!=0&&([t,n]=[n,t]);let{curves:s,width:c,height:l}=e,u=e.thickness??0,d=[],f=Math.min(t/c,n/l),p=f/t,m=f/n,h=[];for(let{points:e}of s){let t=a?this.#douglasPeucker(e):e;if(!t)continue;h.push(t);let n=t.length,r=new Float32Array(n),i=new Float32Array(3*(n===2?2:n-2));if(d.push({line:i,points:r}),n===2){r[0]=t[0]*p,r[1]=t[1]*m,i.set([NaN,NaN,NaN,NaN,r[0],r[1]],0);continue}let[o,s,c,l]=t;o*=p,s*=m,c*=p,l*=m,r.set([o,s,c,l],0),i.set([NaN,NaN,NaN,NaN,o,s],0);for(let e=4;e<n;e+=2){let n=r[e]=t[e]*p,a=r[e+1]=t[e+1]*m;i.set($.createBezierPoints(o,s,c,l,n,a),(e-2)*3),[o,s,c,l]=[c,l,n,a]}}if(d.length===0)return null;let g=o?new Lw:new Pw;return g.build(d,t,n,1,r,o?0:u,i),{outline:g,newCurves:h,areContours:o,thickness:u,width:c,height:l}}static async compressSignature({outlines:e,areContours:t,thickness:n,width:r,height:i}){let a=1/0,o=-1/0,s=0;for(let t of e){s+=t.length;for(let e=2,n=t.length;e<n;e++){let n=t[e]-t[e-2];a=Math.min(a,n),o=Math.max(o,n)}}let c;c=a>=-128&&o<=127?Int8Array:a>=-32768&&o<=32767?Int16Array:Int32Array;let l=e.length,u=Rw+zw*l,d=new Uint32Array(u),f=0;d[f++]=u*Uint32Array.BYTES_PER_ELEMENT+(s-2*l)*c.BYTES_PER_ELEMENT,d[f++]=0,d[f++]=r,d[f++]=i,d[f++]=t?0:1,d[f++]=Math.max(0,Math.floor(n??0)),d[f++]=l,d[f++]=c.BYTES_PER_ELEMENT;for(let t of e)d[f++]=t.length-2,d[f++]=t[0],d[f++]=t[1];let p=new CompressionStream(`deflate-raw`),m=p.writable.getWriter();await m.ready,m.write(d);let h=c.prototype.constructor;for(let t of e){let e=new h(t.length-2);for(let n=2,r=t.length;n<r;n++)e[n-2]=t[n]-t[n-2];m.write(e)}m.close();let g=await new Response(p.readable).arrayBuffer(),_=new Uint8Array(g);return Ib(_)}static async decompressSignature(e){try{let t=Lb(e),{readable:n,writable:r}=new DecompressionStream(`deflate-raw`),i=r.getWriter();await i.ready,i.write(t).then(async()=>{await i.ready,await i.close()}).catch(()=>{});let a=null,o=0;for await(let e of n)a||=new Uint8Array(new Uint32Array(e.buffer,0,4)[0]),a.set(e,o),o+=e.length;let s=new Uint32Array(a.buffer,0,a.length>>2),c=s[1];if(c!==0)throw Error(`Invalid version: ${c}`);let l=s[2],u=s[3],d=s[4]===0,f=s[5],p=s[6],m=s[7],h=[],g=(Rw+zw*p)*Uint32Array.BYTES_PER_ELEMENT,_;switch(m){case Int8Array.BYTES_PER_ELEMENT:_=new Int8Array(a.buffer,g);break;case Int16Array.BYTES_PER_ELEMENT:_=new Int16Array(a.buffer,g);break;case Int32Array.BYTES_PER_ELEMENT:_=new Int32Array(a.buffer,g);break}o=0;for(let e=0;e<p;e++){let t=s[zw*e+Rw],n=new Float32Array(t+2);h.push(n);for(let t=0;t<zw-1;t++)n[t]=s[zw*e+Rw+t+1];for(let e=0;e<t;e++)n[e+2]=n[e]+_[o++]}return{areContours:d,thickness:f,outlines:h,width:l,height:u}}catch(e){return Z(`decompressSignature: ${e}`),null}}},Vw=class e extends jw{constructor(){super(),super.updateProperties({fill:yx._defaultLineColor,"stroke-width":0})}clone(){let t=new e;return t.updateAll(this),t}},Hw=class e extends Fw{constructor(e){super(e),super.updateProperties({stroke:yx._defaultLineColor,"stroke-width":1})}clone(){let t=new e(this._viewParameters);return t.updateAll(this),t}},Uw=class e extends Mw{#isExtracted=!1;#description=null;#signatureData=null;#signatureUUID=null;static _type=`signature`;static _editorType=X.SIGNATURE;static _defaultDrawingOptions=null;constructor(e){super({...e,mustBeCommitted:!0,name:`signatureEditor`}),this._willKeepAspectRatio=!0,this.#signatureData=e.signatureData||null,this.#description=null,this.defaultL10nId=`pdfjs-editor-signature-editor1`}static initialize(e,t){yx.initialize(e,t),this._defaultDrawingOptions=new Vw,this._defaultDrawnSignatureOptions=new Hw(t.viewParameters)}static getDefaultDrawingOptions(e){let t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!1}static get typesMap(){return pb(this,`typesMap`,new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:`signature`,hasDescription:!!this.#description}}static computeTelemetryFinalData(e){let t=e.get(`hasDescription`);return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,n,{_isCopy:r}=this;if(r&&(this._isCopy=!1,t=this.x,n=this.y),super.render(),this._drawId===null)if(this.#signatureData){let{lines:t,mustSmooth:n,areContours:r,description:i,uuid:a,heightInPage:o}=this.#signatureData,{rawDims:{pageWidth:s,pageHeight:c},rotation:l}=this.parent.viewport,u=Bw.processDrawnLines({lines:t,pageWidth:s,pageHeight:c,rotation:l,innerMargin:e._INNER_MARGIN,mustSmooth:n,areContours:r});this.addSignature(u,o,i,a)}else this.div.setAttribute(`data-l10n-args`,JSON.stringify({description:``})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute(`data-l10n-args`,JSON.stringify({description:this.#description||``}));return r&&(this._isCopy=!0,this._moveAfterPaste(t,n)),this.div}setUuid(e){this.#signatureUUID=e,this.addEditToolbar()}getUuid(){return this.#signatureUUID}get description(){return this.#description}set description(e){this.#description=e,this.div&&(this.div.setAttribute(`data-l10n-args`,JSON.stringify({description:e})),super.addEditToolbar().then(t=>{t?.updateEditSignatureButton(e)}))}getSignaturePreview(){let{newCurves:e,areContours:t,thickness:n,width:r,height:i}=this.#signatureData,a=Math.max(r,i),o=Bw.processDrawnLines({lines:{curves:e.map(e=>({points:e})),thickness:n,width:r,height:i},pageWidth:a,pageHeight:a,rotation:0,innerMargin:0,mustSmooth:!1,areContours:t});return{areContours:t,outline:o.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[[`editSignature`,this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,n,r,i){let{x:a,y:o}=this,{outline:s}=this.#signatureData=t;this.#isExtracted=s instanceof Lw,this.description=r;let c;this.#isExtracted?c=e.getDefaultDrawingOptions():(c=e._defaultDrawnSignatureOptions.clone(),c.updateProperties({"stroke-width":s.thickness})),this._addOutlines({drawOutlines:s,drawingOptions:c});let[l,u]=this.parentDimensions,[,d]=this.pageDimensions,f=n/d;f=f>=1?.5:f,this.width*=f/this.height,this.width>=1&&(f*=.9/this.width,this.width=.9),this.height=f,this.setDims(l*this.width,u*this.height),this.x=a,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(i),this._reportTelemetry({action:`pdfjs.signature.inserted`,data:{hasBeenSaved:!!i,hasDescription:!!r}}),this.div.hidden=!1}getFromImage(t){let{rawDims:{pageWidth:n,pageHeight:r},rotation:i}=this.parent.viewport;return Bw.process(t,n,r,i,e._INNER_MARGIN)}getFromText(t,n){let{rawDims:{pageWidth:r,pageHeight:i},rotation:a}=this.parent.viewport;return Bw.extractContoursFromText(t,n,r,i,a,e._INNER_MARGIN)}getDrawnSignature(t){let{rawDims:{pageWidth:n,pageHeight:r},rotation:i}=this.parent.viewport;return Bw.processDrawnLines({lines:t,pageWidth:n,pageHeight:r,rotation:i,innerMargin:e._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:n}){t?this._drawingOptions=e.getDefaultDrawingOptions():(this._drawingOptions=e._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":n}))}serialize(e=!1){if(this.isEmpty())return null;let{lines:t,points:n,rect:r}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":i}}=this,a={annotationType:X.SIGNATURE,isSignature:!0,areContours:this.#isExtracted,color:[0,0,0],thickness:this.#isExtracted?0:i,pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(a),e?(a.paths={lines:t,points:n},a.uuid=this.#signatureUUID,a.isCopy=!0):a.lines=t,this.#description&&(a.accessibilityData={type:`Figure`,alt:this.#description}),a}static deserializeDraw(e,t,n,r,i,a){return a.areContours?Lw.deserialize(e,t,n,r,i,a):Pw.deserialize(e,t,n,r,i,a)}static async deserialize(e,t,n){let r=await super.deserialize(e,t,n);return r.#isExtracted=e.areContours,r.description=e.accessibilityData?.alt||``,r.#signatureUUID=e.uuid,r}},Ww=class extends yx{#bitmap=null;#bitmapId=null;#bitmapPromise=null;#bitmapUrl=null;#bitmapFile=null;#bitmapFileName=``;#canvas=null;#missingCanvas=!1;#resizeTimeoutId=null;#isSvg=!1;#hasBeenAddedInUndoStack=!1;static _type=`stamp`;static _editorType=X.STAMP;constructor(e){super({...e,name:`stampEditor`}),this.#bitmapUrl=e.bitmapUrl,this.#bitmapFile=e.bitmapFile,this.defaultL10nId=`pdfjs-editor-stamp-editor`}static initialize(e,t){yx.initialize(e,t)}static isHandlingMimeForPasting(e){return ox.includes(e)}static paste(e,t){t.pasteEditor({mode:X.STAMP},{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:`stamp`,hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){let t=e.get(`hasAltText`);return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}#getBitmapFetched(e,t=!1){if(!e){this.remove();return}this.#bitmap=e.bitmap,t||(this.#bitmapId=e.id,this.#isSvg=e.isSvg),e.file&&(this.#bitmapFileName=e.file.name),this.#createCanvas()}#getBitmapDone(){if(this.#bitmapPromise=null,this._uiManager.enableWaiting(!1),this.#canvas){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#bitmap){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#bitmap){this._reportTelemetry({action:`pdfjs.image.image_added`,data:{alt_text_modal:!1,alt_text_type:`empty`}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(e=null,t=!0){if(this.hasAltTextData())return null;let{mlManager:n}=this._uiManager;if(!n)throw Error(`No ML.`);if(!await n.isEnabledFor(`altText`))throw Error(`ML isn't enabled for alt text.`);let{data:r,width:i,height:a}=e||this.copyCanvas(null,null,!0).imageData,o=await n.guess({name:`altText`,request:{data:r,width:i,height:a,channels:r.length/(i*a)}});if(!o)throw Error(`No response from the AI service.`);if(o.error)throw Error(`Error from the AI service.`);if(o.cancel)return null;if(!o.output)throw Error(`No valid response from the AI service.`);let s=o.output;return await this.setGuessedAltText(s),t&&!this.hasAltTextData()&&(this.altTextData={alt:s,decorative:!1}),s}#getBitmap(){if(this.#bitmapId){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#bitmapId).then(e=>this.#getBitmapFetched(e,!0)).finally(()=>this.#getBitmapDone());return}if(this.#bitmapUrl){let e=this.#bitmapUrl;this.#bitmapUrl=null,this._uiManager.enableWaiting(!0),this.#bitmapPromise=this._uiManager.imageManager.getFromUrl(e).then(e=>this.#getBitmapFetched(e)).finally(()=>this.#getBitmapDone());return}if(this.#bitmapFile){let e=this.#bitmapFile;this.#bitmapFile=null,this._uiManager.enableWaiting(!0),this.#bitmapPromise=this._uiManager.imageManager.getFromFile(e).then(e=>this.#getBitmapFetched(e)).finally(()=>this.#getBitmapDone());return}let e=document.createElement(`input`);e.type=`file`,e.accept=ox.join(`,`);let t=this._uiManager._signal;this.#bitmapPromise=new Promise(n=>{e.addEventListener(`change`,async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);let t=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:`pdfjs.image.image_selected`,data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#getBitmapFetched(t)}n()},{signal:t}),e.addEventListener(`cancel`,()=>{this.remove(),n()},{signal:t})}).finally(()=>this.#getBitmapDone()),e.click()}remove(){this.#bitmapId&&(this.#bitmap=null,this._uiManager.imageManager.deleteId(this.#bitmapId),this.#canvas?.remove(),this.#canvas=null,this.#resizeTimeoutId&&=(clearTimeout(this.#resizeTimeoutId),null)),super.remove()}rebuild(){if(!this.parent){this.#bitmapId&&this.#getBitmap();return}super.rebuild(),this.div!==null&&(this.#bitmapId&&this.#canvas===null&&this.#getBitmap(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(this.#bitmapPromise||this.#bitmap||this.#bitmapUrl||this.#bitmapFile||this.#bitmapId||this.#missingCanvas)}get toolbarButtons(){return[[`altText`,this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;return this._isCopy&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#missingCanvas||(this.#bitmap?this.#createCanvas():this.#getBitmap()),this._isCopy&&this._moveAfterPaste(e,t),this._uiManager.addShouldRescale(this),this.div}setCanvas(e,t){let{id:n,bitmap:r}=this._uiManager.imageManager.getFromCanvas(e,t);t.remove(),n&&this._uiManager.imageManager.isValidId(n)&&(this.#bitmapId=n,r&&(this.#bitmap=r),this.#missingCanvas=!1,this.#createCanvas())}_onResized(){this.onScaleChanging()}onScaleChanging(){this.parent&&(this.#resizeTimeoutId!==null&&clearTimeout(this.#resizeTimeoutId),this.#resizeTimeoutId=setTimeout(()=>{this.#resizeTimeoutId=null,this.#drawBitmap()},200))}#createCanvas(){let{div:e}=this,{width:t,height:n}=this.#bitmap,[r,i]=this.pageDimensions,a=.75;if(this.width)t=this.width*r,n=this.height*i;else if(t>a*r||n>a*i){let e=Math.min(a*r/t,a*i/n);t*=e,n*=e}let[o,s]=this.parentDimensions;this.setDims(t*o/r,n*s/i),this._uiManager.enableWaiting(!1);let c=this.#canvas=document.createElement(`canvas`);c.setAttribute(`role`,`img`),this.addContainer(c),this.width=t/r,this.height=n/i,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),this.#drawBitmap(),this.#hasBeenAddedInUndoStack||=(this.parent.addUndoableEditor(this),!0),this._reportTelemetry({action:`inserted_image`}),this.#bitmapFileName&&this.div.setAttribute(`aria-description`,this.#bitmapFileName),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-stamp-added-alert`)}copyCanvas(e,t,n=!1){e||=224;let{width:r,height:i}=this.#bitmap,a=new ax,o=this.#bitmap,s=r,c=i,l=null;if(t){if(r>t||i>t){let e=Math.min(t/r,t/i);s=Math.floor(r*e),c=Math.floor(i*e)}l=document.createElement(`canvas`);let e=l.width=Math.ceil(s*a.sx),n=l.height=Math.ceil(c*a.sy);this.#isSvg||(o=this.#scaleBitmap(e,n));let u=l.getContext(`2d`);u.filter=this._uiManager.hcmFilter;let d=`white`,f=`#cfcfd8`;this._uiManager.hcmFilter===`none`?window.matchMedia?.(`(prefers-color-scheme: dark)`).matches&&(d=`#8f8f9d`,f=`#42414d`):f=`black`;let p=15*a.sx,m=15*a.sy,h=new OffscreenCanvas(p*2,m*2),g=h.getContext(`2d`);g.fillStyle=d,g.fillRect(0,0,p*2,m*2),g.fillStyle=f,g.fillRect(0,0,p,m),g.fillRect(p,m,p,m),u.fillStyle=u.createPattern(h,`repeat`),u.fillRect(0,0,e,n),u.drawImage(o,0,0,o.width,o.height,0,0,e,n)}let u=null;if(n){let t,n;if(a.symmetric&&o.width<e&&o.height<e)t=o.width,n=o.height;else if(o=this.#bitmap,r>e||i>e){let a=Math.min(e/r,e/i);t=Math.floor(r*a),n=Math.floor(i*a),this.#isSvg||(o=this.#scaleBitmap(t,n))}let s=new OffscreenCanvas(t,n).getContext(`2d`,{willReadFrequently:!0});s.drawImage(o,0,0,o.width,o.height,0,0,t,n),u={width:t,height:n,data:s.getImageData(0,0,t,n).data}}return{canvas:l,width:s,height:c,imageData:u}}#scaleBitmap(e,t){let{width:n,height:r}=this.#bitmap,i=n,a=r,o=this.#bitmap;for(;i>2*e||a>2*t;){let n=i,r=a;i>2*e&&(i=i>=16384?Math.floor(i/2)-1:Math.ceil(i/2)),a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));let s=new OffscreenCanvas(i,a);s.getContext(`2d`).drawImage(o,0,0,n,r,0,0,i,a),o=s.transferToImageBitmap()}return o}#drawBitmap(){let[e,t]=this.parentDimensions,{width:n,height:r}=this,i=new ax,a=Math.ceil(n*e*i.sx),o=Math.ceil(r*t*i.sy),s=this.#canvas;if(!s||s.width===a&&s.height===o)return;s.width=a,s.height=o;let c=this.#isSvg?this.#bitmap:this.#scaleBitmap(a,o),l=s.getContext(`2d`);l.filter=this._uiManager.hcmFilter,l.drawImage(c,0,0,c.width,c.height,0,0,a,o)}#serializeBitmap(e){if(e){if(this.#isSvg){let e=this._uiManager.imageManager.getSvgUrl(this.#bitmapId);if(e)return e}let e=document.createElement(`canvas`);return{width:e.width,height:e.height}=this.#bitmap,e.getContext(`2d`).drawImage(this.#bitmap,0,0),e.toDataURL()}if(this.#isSvg){let[e,t]=this.pageDimensions,n=Math.round(this.width*e*zb.PDF_TO_CSS_UNITS),r=Math.round(this.height*t*zb.PDF_TO_CSS_UNITS),i=new OffscreenCanvas(n,r);return i.getContext(`2d`).drawImage(this.#bitmap,0,0,this.#bitmap.width,this.#bitmap.height,0,0,n,r),i.transferToImageBitmap()}return structuredClone(this.#bitmap)}static async deserialize(e,t,n){let r=null,i=!1;if(e instanceof yw){let{data:{rect:a,rotation:o,id:s,structParent:c,popupRef:l,contentsObj:u},container:d,parent:{page:{pageNumber:f}},canvas:p}=e,m,h;p?(delete e.canvas,{id:m,bitmap:h}=n.imageManager.getFromCanvas(d.id,p),p.remove()):(i=!0,e._hasNoCanvas=!0);let g=(await t._structTree.getAriaAttributes(`${Nb}${s}`))?.get(`aria-label`)||``;r=e={annotationType:X.STAMP,bitmapId:m,bitmap:h,pageIndex:f-1,rect:a.slice(0),rotation:o,annotationElementId:s,id:s,deleted:!1,accessibilityData:{decorative:!1,altText:g},isSvg:!1,structParent:c,popupRef:l,comment:u?.str||null}}let a=await super.deserialize(e,t,n),{rect:o,bitmap:s,bitmapUrl:c,bitmapId:l,isSvg:u,accessibilityData:d}=e;i?(n.addMissingCanvas(e.id,a),a.#missingCanvas=!0):l&&n.imageManager.isValidId(l)?(a.#bitmapId=l,s&&(a.#bitmap=s)):a.#bitmapUrl=c,a.#isSvg=u;let[f,p]=a.pageDimensions;return a.width=(o[2]-o[0])/f,a.height=(o[3]-o[1])/p,d&&(a.altTextData=d),a._initialData=r,e.comment&&a.setCommentData(e.comment),a.#hasBeenAddedInUndoStack=!!r,a}serialize(e=!1,t=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();let n={annotationType:X.STAMP,bitmapId:this.#bitmapId,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,isSvg:this.#isSvg,structTreeParentId:this._structTreeParentId};if(this.addComment(n),e)return n.bitmapUrl=this.#serializeBitmap(!0),n.accessibilityData=this.serializeAltText(!0),n.isCopy=!0,n;let{decorative:r,altText:i}=this.serializeAltText(!1);if(!r&&i&&(n.accessibilityData={type:`Figure`,alt:i}),this.annotationElementId){let e=this.#hasElementChanged(n);if(e.isSame)return null;e.isSameAltText?delete n.accessibilityData:n.accessibilityData.structParent=this._initialData.structParent??-1}if(n.id=this.annotationElementId,t===null)return n;t.stamps||=new Map;let a=this.#isSvg?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(!t.stamps.has(this.#bitmapId))t.stamps.set(this.#bitmapId,{area:a,serialized:n}),n.bitmap=this.#serializeBitmap(!1);else if(this.#isSvg){let e=t.stamps.get(this.#bitmapId);a>e.area&&(e.area=a,e.serialized.bitmap.close(),e.serialized.bitmap=this.#serializeBitmap(!1))}return n}#hasElementChanged(e){let{pageIndex:t,accessibilityData:{altText:n}}=this._initialData,r=e.pageIndex===t,i=(e.accessibilityData?.alt||``)===n;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&r&&i,isSameAltText:i}}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t={rect:this.getPDFRect()};return this.hasEditedComment&&(t.popup=this.comment),e.updateEdited(t),null}},Gw=class e{#accessibilityManager;#allowClick=!1;#annotationLayer=null;#clickAC=null;#editorFocusTimeoutId=null;#editors=new Map;#hadPointerDown=!1;#isDisabling=!1;#isEnabling=!1;#drawingAC=null;#focusedElement=null;#textLayer=null;#textSelectionAC=null;#textLayerDblClickAC=null;#lastPointerDownTimestamp=-1;#uiManager;static _initialized=!1;static#editorTypes=new Map([Cw,Iw,Ww,Aw,Uw].map(e=>[e._editorType,e]));constructor({uiManager:t,pageIndex:n,div:r,structTreeLayer:i,accessibilityManager:a,annotationLayer:o,drawLayer:s,textLayer:c,viewport:l,l10n:u}){let d=[...e.#editorTypes.values()];if(!e._initialized){e._initialized=!0;for(let e of d)e.initialize(u,t)}t.registerEditorTypes(d),this.#uiManager=t,this.pageIndex=n,this.div=r,this.#accessibilityManager=a,this.#annotationLayer=o,this.viewport=l,this.#textLayer=c,this.drawLayer=s,this._structTree=i,this.#uiManager.addLayer(this)}get isEmpty(){return this.#editors.size===0}get isInvisible(){return this.isEmpty&&this.#uiManager.getMode()===X.NONE}updateToolbar(e){this.#uiManager.updateToolbar(e)}updateMode(t=this.#uiManager.getMode()){switch(this.#cleanup(),t){case X.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case X.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case X.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);let{classList:n}=this.div;for(let r of e.#editorTypes.values())n.toggle(`${r._type}Editing`,t===r._editorType);this.div.hidden=!1}hasTextLayer(e){return e===this.#textLayer?.div}setEditingState(e){this.#uiManager.setEditingState(e)}addCommands(e){this.#uiManager.addCommands(e)}cleanUndoStack(e){this.#uiManager.cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle(`drawing`,!e)}togglePointerEvents(e=!1){this.div.classList.toggle(`disabled`,!e)}toggleAnnotationLayerPointerEvents(e=!1){this.#annotationLayer?.div.classList.toggle(`disabled`,!e)}async enable(){this.#isEnabling=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.#textLayerDblClickAC?.abort(),this.#textLayerDblClickAC=null;let e=new Set;for(let t of this.#editors.values())t.enableEditing(),t.show(!0),t.annotationElementId&&(this.#uiManager.removeChangedExistingAnnotation(t),e.add(t.annotationElementId));if(!this.#annotationLayer){this.#isEnabling=!1;return}let t=this.#annotationLayer.getEditableAnnotations();for(let n of t){if(n.hide(),this.#uiManager.isDeletedAnnotationElement(n.data.id)||e.has(n.data.id))continue;let t=await this.deserialize(n);if(!t)continue;this.addOrRebuild(t),t.enableEditing()}this.#isEnabling=!1}disable(){if(this.#isDisabling=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.#textLayer&&!this.#textLayerDblClickAC){this.#textLayerDblClickAC=new AbortController;let e=this.#uiManager.combinedSignal(this.#textLayerDblClickAC);this.#textLayer.div.addEventListener(`pointerdown`,e=>{let{clientX:t,clientY:n,timeStamp:r}=e,i=this.#lastPointerDownTimestamp;if(r-i>500){this.#lastPointerDownTimestamp=r;return}this.#lastPointerDownTimestamp=-1;let{classList:a}=this.div;a.toggle(`getElements`,!0);let o=document.elementsFromPoint(t,n);if(a.toggle(`getElements`,!1),!this.div.contains(o[0]))return;let s,c=RegExp(`^${qy}[0-9]+$`);for(let e of o)if(c.test(e.id)){s=e.id;break}if(!s)return;let l=this.#editors.get(s);l?.annotationElementId===null&&(e.stopPropagation(),e.preventDefault(),l.dblclick())},{signal:e,capture:!0})}let t=new Map,n=new Map;for(let e of this.#editors.values()){if(e.disableEditing(),!e.annotationElementId)continue;if(e.serialize()!==null){t.set(e.annotationElementId,e);continue}else n.set(e.annotationElementId,e);this.getEditableAnnotation(e.annotationElementId)?.show(),e.remove()}if(this.#annotationLayer){let e=this.#annotationLayer.getEditableAnnotations();for(let r of e){let{id:e}=r.data;if(this.#uiManager.isDeletedAnnotationElement(e)){r.updateEdited({deleted:!0});continue}let i=n.get(e);if(i){i.resetAnnotationElement(r),i.show(!1),r.show();continue}i=t.get(e),i&&(this.#uiManager.addChangedExistingAnnotation(i),i.renderAnnotationElement(r)&&i.show(!1)),r.show()}}this.#cleanup(),this.isEmpty&&(this.div.hidden=!0);let{classList:r}=this.div;for(let t of e.#editorTypes.values())r.remove(`${t._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#isDisabling=!1}getEditableAnnotation(e){return this.#annotationLayer?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#uiManager.getActive()!==e&&this.#uiManager.setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,this.#textLayer?.div&&!this.#textSelectionAC){this.#textSelectionAC=new AbortController;let e=this.#uiManager.combinedSignal(this.#textSelectionAC);this.#textLayer.div.addEventListener(`pointerdown`,this.#textLayerPointerDown.bind(this),{signal:e}),this.#textLayer.div.classList.add(`highlighting`)}}disableTextSelection(){this.div.tabIndex=0,this.#textLayer?.div&&this.#textSelectionAC&&(this.#textSelectionAC.abort(),this.#textSelectionAC=null,this.#textLayer.div.classList.remove(`highlighting`))}#textLayerPointerDown(e){this.#uiManager.unselectAll();let{target:t}=e;if(t===this.#textLayer.div||(t.getAttribute(`role`)===`img`||t.classList.contains(`endOfContent`))&&this.#textLayer.div.contains(t)){let{isMac:t}=Eb.platform;if(e.button!==0||e.ctrlKey&&t)return;this.#uiManager.showAllEditors(`highlight`,!0,!0),this.#textLayer.div.classList.add(`free`),this.toggleDrawing(),Aw.startHighlighting(this,this.#uiManager.direction===`ltr`,{target:this.#textLayer.div,x:e.x,y:e.y}),this.#textLayer.div.addEventListener(`pointerup`,()=>{this.#textLayer.div.classList.remove(`free`),this.toggleDrawing(!0)},{once:!0,signal:this.#uiManager._signal}),e.preventDefault()}}enableClick(){if(this.#clickAC)return;this.#clickAC=new AbortController;let e=this.#uiManager.combinedSignal(this.#clickAC);this.div.addEventListener(`pointerdown`,this.pointerdown.bind(this),{signal:e});let t=this.pointerup.bind(this);this.div.addEventListener(`pointerup`,t,{signal:e}),this.div.addEventListener(`pointercancel`,t,{signal:e})}disableClick(){this.#clickAC?.abort(),this.#clickAC=null}attach(e){this.#editors.set(e.id,e);let{annotationElementId:t}=e;t&&this.#uiManager.isDeletedAnnotationElement(t)&&this.#uiManager.removeDeletedAnnotationElement(e)}detach(e){this.#editors.delete(e.id),this.#accessibilityManager?.removePointerInTextLayer(e.contentDiv),!this.#isDisabling&&e.annotationElementId&&this.#uiManager.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#uiManager.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(this.#uiManager.addDeletedAnnotationElement(e.annotationElementId),yx.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),this.#uiManager.addEditor(e),this.attach(e),!e.isAttachedToDOM){let t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!this.#isEnabling),this.#uiManager.addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;let{activeElement:t}=document;e.div.contains(t)&&!this.#editorFocusTimeoutId&&(e._focusEventsAllowed=!1,this.#editorFocusTimeoutId=setTimeout(()=>{this.#editorFocusTimeoutId=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener(`focusin`,()=>{e._focusEventsAllowed=!0},{once:!0,signal:this.#uiManager._signal}),t.focus())},0)),e._structTreeParentId=this.#accessibilityManager?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){this.addCommands({cmd:()=>e._uiManager.rebuild(e),undo:()=>{e.remove()},mustExec:!1})}getNextId(){return this.#uiManager.getId()}get#currentEditorType(){return e.#editorTypes.get(this.#uiManager.getMode())}combinedSignal(e){return this.#uiManager.combinedSignal(e)}#createNewEditor(e){let t=this.#currentEditorType;return t?new t.prototype.constructor(e):null}canCreateNewEmptyEditor(){return this.#currentEditorType?.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await this.#uiManager.updateMode(e.mode);let{offsetX:n,offsetY:r}=this.#getCenterPoint(),i=this.getNextId(),a=this.#createNewEditor({parent:this,id:i,x:n,y:r,uiManager:this.#uiManager,isCentered:!0,...t});a&&this.add(a)}async deserialize(t){return await e.#editorTypes.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#uiManager)||null}createAndAddNewEditor(e,t,n={}){let r=this.getNextId(),i=this.#createNewEditor({parent:this,id:r,x:e.offsetX,y:e.offsetY,uiManager:this.#uiManager,isCentered:t,...n});return i&&this.add(i),i}#getCenterPoint(){let{x:e,y:t,width:n,height:r}=this.div.getBoundingClientRect(),i=Math.max(0,e),a=Math.max(0,t),o=Math.min(window.innerWidth,e+n),s=Math.min(window.innerHeight,t+r),c=(i+o)/2-e,l=(a+s)/2-t,[u,d]=this.viewport.rotation%180==0?[c,l]:[l,c];return{offsetX:u,offsetY:d}}addNewEditor(e={}){this.createAndAddNewEditor(this.#getCenterPoint(),!0,e)}setSelected(e){this.#uiManager.setSelected(e)}toggleSelected(e){this.#uiManager.toggleSelected(e)}unselect(e){this.#uiManager.unselect(e)}pointerup(e){let{isMac:t}=Eb.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!this.#hadPointerDown||(this.#hadPointerDown=!1,this.#currentEditorType?.isDrawer&&this.#currentEditorType.supportMultipleDrawings))return;if(!this.#allowClick){this.#allowClick=!0;return}let n=this.#uiManager.getMode();if(n===X.STAMP||n===X.SIGNATURE){this.#uiManager.unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){if(this.#uiManager.getMode()===X.HIGHLIGHT&&this.enableTextSelection(),this.#hadPointerDown){this.#hadPointerDown=!1;return}let{isMac:t}=Eb.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(this.#hadPointerDown=!0,this.#currentEditorType?.isDrawer){this.startDrawingSession(e);return}let n=this.#uiManager.getActive();this.#allowClick=!n||n.isEmpty()}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),this.#drawingAC){this.#currentEditorType.startDrawing(this,this.#uiManager,!1,e);return}this.#uiManager.setCurrentDrawingSession(this),this.#drawingAC=new AbortController;let t=this.#uiManager.combinedSignal(this.#drawingAC);this.div.addEventListener(`blur`,({relatedTarget:e})=>{e&&!this.div.contains(e)&&(this.#focusedElement=null,this.commitOrRemove())},{signal:t}),this.#currentEditorType.startDrawing(this,this.#uiManager,!1,e)}pause(e){if(e){let{activeElement:e}=document;this.div.contains(e)&&(this.#focusedElement=e);return}this.#focusedElement&&setTimeout(()=>{this.#focusedElement?.focus(),this.#focusedElement=null},0)}endDrawingSession(e=!1){return this.#drawingAC?(this.#uiManager.setCurrentDrawingSession(null),this.#drawingAC.abort(),this.#drawingAC=null,this.#focusedElement=null,this.#currentEditorType.endDrawing(e)):null}findNewParent(e,t,n){let r=this.#uiManager.findParent(t,n);return r===null||r===this?!1:(r.changeParent(e),!0)}commitOrRemove(){return this.#drawingAC?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#drawingAC&&this.#currentEditorType.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#uiManager.getActive()?.parent===this&&(this.#uiManager.commitOrRemove(),this.#uiManager.setActiveEditor(null)),this.#editorFocusTimeoutId&&=(clearTimeout(this.#editorFocusTimeoutId),null);for(let e of this.#editors.values())this.#accessibilityManager?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#editors.clear(),this.#uiManager.removeLayer(this)}#cleanup(){for(let e of this.#editors.values())e.isEmpty()&&e.remove()}render({viewport:e}){this.viewport=e,ix(this.div,e);for(let e of this.#uiManager.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:e}){this.#uiManager.commitOrRemove(),this.#cleanup();let t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,ix(this.div,{rotation:n}),t!==n)for(let e of this.#editors.values())e.rotate(n)}get pageDimensions(){let{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return this.#uiManager.viewParameters.realScale}},Kw=class e{#parent=null;#mapping=new Map;#toUpdate=new Map;static#id=0;constructor({pageIndex:e}){this.pageIndex=e}setParent(e){if(!this.#parent){this.#parent=e;return}if(this.#parent!==e){if(this.#mapping.size>0)for(let t of this.#mapping.values())t.remove(),e.append(t);this.#parent=e}}static get _svgFactory(){return pb(this,`_svgFactory`,new UC)}static#setBox(e,[t,n,r,i]){let{style:a}=e;a.top=`${100*n}%`,a.left=`${100*t}%`,a.width=`${100*r}%`,a.height=`${100*i}%`}#createSVG(){let t=e._svgFactory.create(1,1,!0);return this.#parent.append(t),t.setAttribute(`aria-hidden`,!0),t}#createClipPath(t,n){let r=e._svgFactory.createElement(`clipPath`);t.append(r);let i=`clip_${n}`;r.setAttribute(`id`,i),r.setAttribute(`clipPathUnits`,`objectBoundingBox`);let a=e._svgFactory.createElement(`use`);return r.append(a),a.setAttribute(`href`,`#${n}`),a.classList.add(`clip`),i}#updateProperties(e,t){for(let[n,r]of Object.entries(t))r===null?e.removeAttribute(n):e.setAttribute(n,r)}draw(t,n=!1,r=!1){let i=e.#id++,a=this.#createSVG(),o=e._svgFactory.createElement(`defs`);a.append(o);let s=e._svgFactory.createElement(`path`);o.append(s);let c=`path_p${this.pageIndex}_${i}`;s.setAttribute(`id`,c),s.setAttribute(`vector-effect`,`non-scaling-stroke`),n&&this.#toUpdate.set(i,s);let l=r?this.#createClipPath(o,c):null,u=e._svgFactory.createElement(`use`);return a.append(u),u.setAttribute(`href`,`#${c}`),this.updateProperties(a,t),this.#mapping.set(i,a),{id:i,clipPathId:`url(#${l})`}}drawOutline(t,n){let r=e.#id++,i=this.#createSVG(),a=e._svgFactory.createElement(`defs`);i.append(a);let o=e._svgFactory.createElement(`path`);a.append(o);let s=`path_p${this.pageIndex}_${r}`;o.setAttribute(`id`,s),o.setAttribute(`vector-effect`,`non-scaling-stroke`);let c;if(n){let t=e._svgFactory.createElement(`mask`);a.append(t),c=`mask_p${this.pageIndex}_${r}`,t.setAttribute(`id`,c),t.setAttribute(`maskUnits`,`objectBoundingBox`);let n=e._svgFactory.createElement(`rect`);t.append(n),n.setAttribute(`width`,`1`),n.setAttribute(`height`,`1`),n.setAttribute(`fill`,`white`);let i=e._svgFactory.createElement(`use`);t.append(i),i.setAttribute(`href`,`#${s}`),i.setAttribute(`stroke`,`none`),i.setAttribute(`fill`,`black`),i.setAttribute(`fill-rule`,`nonzero`),i.classList.add(`mask`)}let l=e._svgFactory.createElement(`use`);i.append(l),l.setAttribute(`href`,`#${s}`),c&&l.setAttribute(`mask`,`url(#${c})`);let u=l.cloneNode();return i.append(u),l.classList.add(`mainOutline`),u.classList.add(`secondaryOutline`),this.updateProperties(i,t),this.#mapping.set(r,i),r}finalizeDraw(e,t){this.#toUpdate.delete(e),this.updateProperties(e,t)}updateProperties(t,n){if(!n)return;let{root:r,bbox:i,rootClass:a,path:o}=n,s=typeof t==`number`?this.#mapping.get(t):t;if(s){if(r&&this.#updateProperties(s,r),i&&e.#setBox(s,i),a){let{classList:e}=s;for(let[t,n]of Object.entries(a))e.toggle(t,n)}if(o){let e=s.firstChild.firstChild;this.#updateProperties(e,o)}}}updateParent(e,t){if(t===this)return;let n=this.#mapping.get(e);n&&(t.#parent.append(n),this.#mapping.delete(e),t.#mapping.set(e,n))}remove(e){this.#toUpdate.delete(e),this.#parent!==null&&(this.#mapping.get(e).remove(),this.#mapping.delete(e))}destroy(){this.#parent=null;for(let e of this.#mapping.values())e.remove();this.#mapping.clear(),this.#toUpdate.clear()}};globalThis._pdfjsTestingUtils={HighlightOutliner:Ew},globalThis.pdfjsLib={AbortException:bb,AnnotationEditorLayer:Gw,AnnotationEditorParamsType:Jy,AnnotationEditorType:X,AnnotationEditorUIManager:hx,AnnotationLayer:xw,AnnotationMode:Ky,AnnotationType:Qy,build:IC,ColorPicker:LC,createValidAbsoluteUrl:db,DOMSVGFactory:UC,DrawLayer:Kw,FeatureTest:Eb,fetchData:Bb,getDocument:EC,getFilenameFromUrl:Gb,getPdfFilenameFromUrl:Kb,getRGB:ex,getUuid:Mb,getXfaPageViewport:$b,GlobalWorkerOptions:VS,ImageKind:Zy,InvalidPDFException:_b,isDataScheme:Ub,isPdfFile:Wb,isValidExplicitDest:Px,MathClamp:Fb,noContextMenu:Yb,normalizeUnicode:jb,OPS:tb,OutputScale:ax,PasswordResponses:rb,PDFDataRangeTransport:OC,PDFDateString:Qb,PDFWorker:jC,PermissionFlag:Yy,PixelsPerInch:zb,RenderingCancelledException:Hb,ResponseException:vb,setLayerDimensions:ix,shadow:pb,SignatureExtractor:Bw,stopEvent:Xb,SupportedImageMimeTypes:ox,TextLayer:CC,TouchManager:vx,updateUrlHash:fb,Util:Q,VerbosityLevel:eb,version:FC,XfaLayer:WC},VS.workerSrc=`/WatchTaskV2/pdf.worker.min.mjs`;async function qw(e){let t=await EC({url:URL.createObjectURL(e)}).promise,n=[];for(let e=0;e<t.numPages;e++){let r=await t.getPage(e+1),i=await Jw(r);n.push(i)}return n}async function Jw(e){let t=(await e.getTextContent()).items.map(e=>{let[,,,t,n,r]=e.transform;return{text:e.str,x:n,y:r,width:e.width,height:t}}).sort((e,t)=>Math.abs(e.y-t.y)>5?t.y-e.y:e.x-t.x),n=[],r=[],i=null;for(let e of t)i===null||Math.abs(e.y-i)<=5?(r.push(e),i=i===null?e.y:r.reduce((e,t)=>e+t.y,0)/r.length):(r.length&&n.push(r),r=[e],i=e.y);r.length&&n.push(r);let a=``;for(let e of n){e.sort((e,t)=>e.x-t.x);let t=``,n=null;for(let r of e)n!==null&&r.x-n>r.height*.2&&(t+=` `),t+=r.text,n=r.x+r.width;t.trim()&&(a+=t+`
`)}return a.trim()}function Yw(e){return!e||!Array.isArray(e)||e.length===0?(console.warn(`No se pudo extraer texto del PDF`),{}):e}function Xw(e){let t=[`Fecha Fin`,`Frec. Horas`,`F. Real de Ejecucion`,`Frec. Comb.`,`Incidencia`],n={"Numero orden":/Nmero orden\s+?(\d+)/,"Tipo de Orden":/[A-Z0-9]\nClase/,Clase:/Clase (.+?) Asignado a/,"Asignado a":/Asignado a (.+?)\n/,Descripcion:/Descripcin (.+?) Tipo/,Tipo:/Tipo (.+?) Estado/,Estado:/Estado (.+?) Frec/,"Frec. Dias":/Frec\. D[i]as ([0-9]+)/,"N Unidad":/N Unidad (.+?) Parte/,Parte:/Parte (.+?) F inicial/,"F inicial":/F inicial ([0-9/]+)/,"Frec. Comb.":/Frec\. Comb\. (.+?)/,Especialidad:/Especialidad (.+?) Elemento/,Elemento:/Elemento (.+?) FF\.\.RReeaall/,"F. Real de Ejecucion":/FF\.\.RReeaall EEjjeeccuucciioonn (.+?) Frec\. Km/,"Frec. Km":/Frec\. Km ([^ ]*)/,Modo:/Modo ([^ ]*?)(?:\s+(?:Fecha Fin|Frec\. Horas))/,"Fecha Fin":/Fecha Fin ([0-9/]+)/,"Frec. Horas":/Frec\. Horas ([^ ]*)/,Originador:/Originador\s+?([A-Z]+ [A-Za-z\s]+)\nIncidencia/,Incidencia:/Incidencia (.+?) Fecha Venc\./,"Fecha Venc.":/Fecha Venc\. ([0-9/]+)/,"Ultima Realiz.":/Ultima Realiz\.\s+?([0-9/]+)/,Linea:/Linea (.+?) Kit de Tareas/,"Kit de Tareas":/Kit de Tareas ([0-9]+)/,"Proximo Venc.":/Proximo Venc\. ([0-9/]+)/,"Fecha Prox Emision":/Fecha Prox Emisin ([0-9/]+)/,"N de Serie":/N de Serie (.+?) Planta/,Planta:/Planta (.+?) Tipo servici/,"Tipo servici":/Tipo servici ([A-Z0-9]+ [A-Za-z.]+)/,Prioridad:/Prioridad: ([A-Z\-a-z]+)/,"Seg. y Medio Ambiente":/Seg\. y Medio Ambiente ([A-Z0-9]+)/,Calidad:/Calidad ([A-Z0-9]+)/,Operacion:/Operacin ([A-Z0-9]+)/,Mantenimiento:/Mantenimiento ([A-Z0-9]+)/,Categorizacion:/Categorizacin\s+?([A-Z0-9]+)/,"Tipo de Servicio":/Tipo de Servicio (.+?)\n/},r={};t.forEach(e=>r[e]=null);for(let[t,i]of Object.entries(n)){let n=e.match(i);n&&(r[t]=n[1].trim())}let i=r[`Tipo de Servicio`];return i=i&&i.includes(`SYS`)?1:i&&i.includes(`CCL`)?2:3,r[`Frec. Dias`]=r[`Frec. Dias`]&&!isNaN(r[`Frec. Dias`])?parseInt(r[`Frec. Dias`]):null,r.prioridad=i,r.asignado_a_code=null,r.asignado_por_name=null,r.asignado_por_code=null,r.Especialidad===`ELP ELECTRICO DE PLANTA`?r.Especialidad_id=1:r.Especialidad===`MEP MECANICO DE PLANTA`&&(r.Especialidad_id=2),r.hs_reales=0,r.fecha_inicio=null,r.fecha_fin=null,r.observaciones=null,r.status=0,r.obs_anulada=null,r.code_orden_anulada=null,r.checkListDict={},r}function Zw(e){let t=e.split(`
`),n=[],r=0,i=/^([A-Za-z0-9]+)\s+(\S+)\s+(\d+)\s+(.*)\s+((?:\d+\.\d+|\.\d+))\s+(.+)/,a=/^([A-Za-z0-9]+)\s+([\d.]+)\s+(\d+)\s+(.+)/,o=0;for(let e=17;e<t.length;e++){let s=t[e],c=s.match(i);if(c){let e=parseFloat(c[5]);isNaN(e)&&(e=0);let t={Taller:c[1],"Numero sec oper":parseFloat(c[2]),"Tarea Standard":c[3],Descripcion:c[4],"Hs Estim":e,"Valor esperado":c[6],completed_by:null,date_completed:null,obs_assigned_by:null,obs_assigned_to:null,init_task:null,end_task:null,status:0,duration_seconds:null,pause:null};n.push(t),r++}else if(c=s.match(a),c){let e={Taller:c[1],"Numero sec oper":parseFloat(c[2]),"Tarea Standard":c[3],Descripcion:c[4],"Hs Estim":0,"Valor esperado":c[4],completed_by:null,date_completed:null,obs_assigned_by:null,obs_assigned_to:null,init_task:null,end_task:null,status:0,duration_seconds:null,pause:null};n.push(e),r++}else{try{o=n.reduce((e,t)=>e+(t[`Hs Estim`]||0),0),o=Math.round(o*1e3)/1e3}catch{o=0}return{data:n,Tasks_N:r,h_estimadas:o}}}try{o=n.reduce((e,t)=>e+(t[`Hs Estim`]||0),0),o=Math.round(o*1e3)/1e3}catch{o=0}return{data:n,Tasks_N:r,h_estimadas:o}}function Qw(e,t){let n=``,r=[`OT Generadas`,`Realizado por:`,`Firma:`];n=t.split(`
`).slice(e+17).join(`
`).trim();for(let e of r){let t=n.indexOf(e);if(t!==-1){n=n.slice(0,t).trim();break}}return n}function $w(e,t){t=Qw(e,t);let n=/^(.?.?T\d+)/im,r=/^(.?.?SEGURIDAD)|^(.?.?SGURIDAD)/im,i=[],a=``,o=``,s=0,c=0;for(let e of t.split(`
`))n.test(e)?(s===1&&(o===``||(a=o+`
`+a),i.push(a)),a=e,s=1,c=0):r.test(e)&&s===1&&c===0?a+=`
`+e:r.test(e)?c===1&&s===1?(a=o+`
`+a,i.push(a)):(o=e,s=2,c=1):s===1?a+=`
`+e:s===2&&(o+=`
`+e);return s===1?(o===``||(a=o+`
`+a),i.push(a)):s===2&&o!==``&&i.push(o),i}function eT(e){let t=Yw(e),n=/Nmero orden\s+?(\d+)/,r=/(\nOT Generadas)|(\nRealizado por:)|(\nFirma:)/g,i={};for(let e of t){let t;if((t=n.exec(e))!==null){let n=t[1];if(i[n]){let t=e.replace(r,``);t=t.split(`
`).slice(3).join(`
`),i[n].data+=`
`+t}else{i[n]={};let t=e.replace(r,``);i[n].data=t}}}for(let e in i)i[e].info=Xw(i[e].data),i[e].tasks=Zw(i[e].data),i[e].protocolos=$w(i[e].tasks.Tasks_N,i[e].data);return i}async function tT(e,t={}){let{sourceFileName:n}=t,r=[];Array.isArray(e)?r=e:typeof e==`object`&&e&&(r=Object.entries(e).map(([e,t])=>({id:e,...t})));let i=new Date().toISOString(),a=r.map(e=>({...e,id:String(e.id??e.Numero??e[`Numero orden`]??e?.info?.[`Numero orden`]??crypto.randomUUID?.()??`${Date.now()}-${Math.random()}`),meta:{...e.meta||{},fileName:n||e.meta?.fileName||null,processedAt:i}}));return await Ne(a),a}async function nT(e,t){let n=await qw(e),r=eT(n);await tT(r,{sourceFileName:e?.name});let i=Object.keys(r).length;return typeof t==`function`&&t(i),i}function rT({users:e,onToggleActive:t,onDelete:n}){return(0,Y.jsxs)(`table`,{className:`w-full text-sm`,children:[(0,Y.jsx)(`thead`,{children:(0,Y.jsxs)(`tr`,{className:`text-left border-b`,children:[(0,Y.jsx)(`th`,{className:`py-2`,children:`Cdigo`}),(0,Y.jsx)(`th`,{children:`Nombre`}),(0,Y.jsx)(`th`,{children:`Rol`}),(0,Y.jsx)(`th`,{children:`Especialidad`}),(0,Y.jsx)(`th`,{children:`Activo`}),(0,Y.jsx)(`th`,{})]})}),(0,Y.jsx)(`tbody`,{children:e.map(e=>(0,Y.jsxs)(`tr`,{className:`border-b`,children:[(0,Y.jsx)(`td`,{className:`py-2`,children:e.code}),(0,Y.jsx)(`td`,{children:e.name}),(0,Y.jsx)(`td`,{children:e.role}),(0,Y.jsx)(`td`,{children:e.speciality??`-`}),(0,Y.jsx)(`td`,{children:(0,Y.jsx)(`button`,{className:`btn btn-outline btn-sm`,onClick:()=>t(e),children:e.active?`Desactivar`:`Activar`})}),(0,Y.jsx)(`td`,{children:(0,Y.jsx)(`button`,{className:`btn btn-outline btn-sm`,onClick:()=>n(e),children:`Eliminar`})})]},e.code))})]})}function iT(){let{user:e,logout:t}=Iy(),[n,r]=(0,_.useState)([]),[i,a]=(0,_.useState)({code:``,name:``,role:`supervisor`,speciality:``,password:``}),[o,s]=(0,_.useState)(null),[c,l]=(0,_.useState)(!1),u=async()=>{let e=await ke();r(e)};return(0,_.useEffect)(()=>{u()},[]),e?(0,Y.jsxs)(`div`,{className:`max-w-5xl mx-auto p-4 space-y-6`,children:[(0,Y.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,Y.jsx)(`h2`,{className:`text-2xl font-semibold`,children:`Panel Admin`}),(0,Y.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,Y.jsxs)(`span`,{className:`text-sm text-gray-600`,children:[e.name,` (#`,e.code,`)`]}),(0,Y.jsx)(`button`,{className:`btn btn-outline`,onClick:t,children:`Salir`})]})]}),(0,Y.jsxs)(`section`,{className:`card p-4`,children:[(0,Y.jsx)(`h3`,{className:`text-lg font-semibold mb-3`,children:`Usuarios`}),(0,Y.jsxs)(`form`,{onSubmit:async e=>{e.preventDefault(),await Ae({code:Number(i.code),name:i.name,role:i.role,speciality:i.speciality?Number(i.speciality):null,active:!0,password:i.password||void 0}),a({code:``,name:``,role:`supervisor`,speciality:``,password:``}),await u()},className:`grid grid-cols-1 sm:grid-cols-6 gap-3 mb-4`,children:[(0,Y.jsx)(`input`,{className:`input`,placeholder:`Cdigo`,type:`number`,value:i.code,onChange:e=>a({...i,code:e.target.value}),required:!0}),(0,Y.jsx)(`input`,{className:`input`,placeholder:`Nombre`,value:i.name,onChange:e=>a({...i,name:e.target.value}),required:!0}),(0,Y.jsxs)(`select`,{className:`input`,value:i.role,onChange:e=>a({...i,role:e.target.value}),children:[(0,Y.jsx)(`option`,{value:`supervisor`,children:`Supervisor`}),(0,Y.jsx)(`option`,{value:`mantenedor`,children:`Mantenedor`})]}),(0,Y.jsxs)(`select`,{className:`input`,value:i.speciality,onChange:e=>a({...i,speciality:e.target.value}),children:[(0,Y.jsx)(`option`,{value:``,children:`Sin especialidad`}),(0,Y.jsx)(`option`,{value:`1`,children:`1 - Elctrico`}),(0,Y.jsx)(`option`,{value:`2`,children:`2 - Mecnico`})]}),(0,Y.jsx)(`input`,{className:`input`,placeholder:`Password (opcional)`,type:`password`,value:i.password,onChange:e=>a({...i,password:e.target.value})}),(0,Y.jsx)(`button`,{className:`btn btn-primary`,type:`submit`,children:`Agregar`})]}),(0,Y.jsx)(rT,{users:n,onToggleActive:async e=>{await je(e.code,{active:!e.active}),await u()},onDelete:async e=>{e.role!==`admin`&&(await Me(e.code),await u())}})]}),(0,Y.jsxs)(`section`,{className:`card p-4`,children:[(0,Y.jsx)(`h3`,{className:`text-lg font-semibold mb-3`,children:`Ingesta de PDF de rdenes`}),(0,Y.jsx)(`input`,{type:`file`,accept:`application/pdf`,onChange:async e=>{let t=e.target.files?.[0];if(t){l(!0);try{let e=await nT(t,e=>s(e));s(e)}finally{l(!1)}}}}),c&&(0,Y.jsx)(`p`,{className:`text-sm text-gray-600 mt-2`,children:`Procesando`}),o!=null&&!c&&(0,Y.jsxs)(`p`,{className:`text-sm text-green-700 mt-2`,children:[`rdenes procesadas: `,o]})]})]}):null}var aT=[{item:1,text:`Verific que retir todas las herramientas utilizadas en la mantencin y limpi antes de guardar?`},{item:2,text:`Verific que retir todos los insumos utilizados en la mquina? (Ej: grasas, trapos, envases, cartn, etc.)`},{item:3,text:`Verific que retir todos los repuestos de la mquina y los dej en el lugar correcto?`},{item:4,text:`Verific que se encuentran puestas todas las tapas y protecciones?`},{item:5,text:`Dej limpios y ordenados los sectores donde trabaj?`},{item:6,text:`Retir todos los dispositivos de bloqueo y/o lockout?`},{item:7,text:`Prob el equipo antes de la puesta en marcha?`}],oT=({order:e,task:t,taskIndex:n,user:r,initialData:i})=>{let a={order_id:e?.code??null,task_id:t?.Codigo??t?.code??t?.task_id??(typeof n==`number`?n+1:null),task_index:typeof n==`number`?n:null,detalle_mant:t?.Descripcion??e?.info?.Descripcion??e?.info?.detalle_mant??``,mantenedor_code:r?.code??``,mantenedor_name:r?.name??``,fecha:new Date().toISOString().slice(0,10)},o=aT.map(({item:e})=>({item:e,si:!1,no:!1,na:!1,obs:``})),s={nombre:r?.role===`supervisor`?r.name:``,fecha:r?.role===`supervisor`?new Date().toISOString().slice(0,10):``,firma:r?.role===`supervisor`?String(r.code):``};if(!i)return{meta:a,answers:o,otrasObservaciones:``,supervisor:s};let c=e=>{let t=i?.answers?.find(t=>t.item===e);if(!t)return o.find(t=>t.item===e);let n=String(t.estado||``).toUpperCase();return{item:e,si:n===`SI`,no:n===`NO`,na:n===`NA`||n===`N/A`,obs:t.obs??``}};return{meta:{...a,...i.meta||{},fecha:i?.meta?.fecha||a.fecha},answers:o.map(({item:e})=>c(e)),otrasObservaciones:i?.otrasObservaciones||``,supervisor:{...s,...i?.supervisor||{}}}},sT=e=>({meta:{...e.meta,fecha:e.meta?.fecha||new Date().toISOString().slice(0,10)},answers:e.answers.map(e=>({item:e.item,estado:e.si?`SI`:e.no?`NO`:e.na?`NA`:``,obs:(e.obs||``).trim()})),otrasObservaciones:(e.otrasObservaciones||``).trim(),supervisor:{nombre:(e.supervisor?.nombre||``).trim(),fecha:e.supervisor?.fecha||``,firma:(e.supervisor?.firma||``).trim()}});function cT({isOpen:e,order:t,task:n,taskIndex:r,user:i,initialData:a,onCancel:o,onSubmit:s,saving:c=!1,submitError:l=null}){let{user:u}=Iy(),d=i||u,f=(0,_.useCallback)(()=>oT({order:t,task:n,taskIndex:r,user:d,initialData:a}),[t,n,r,d,a]),[p,m]=(0,_.useState)(f);(0,_.useEffect)(()=>{m(f())},[f]),(0,_.useEffect)(()=>{d?.role===`supervisor`&&p.supervisor&&(!p.supervisor.nombre||!p.supervisor.fecha||!p.supervisor.firma)&&m(e=>({...e,supervisor:{nombre:d.name,fecha:new Date().toISOString().slice(0,10),firma:String(d.code)}}))},[d,p.supervisor]);let h=(0,_.useMemo)(()=>p.answers.every(e=>e.si||e.no||e.na),[p.answers]),g=(0,_.useCallback)((e,t)=>{m(n=>{let r=n.answers.map((n,r)=>r===e?{...n,si:t===`si`?!n.si:!1,no:t===`no`?!n.no:!1,na:t===`na`?!n.na:!1}:n);return{...n,answers:r}})},[]),v=(0,_.useCallback)((e,t)=>{m(n=>{let r=n.answers.map((n,r)=>r===e?{...n,obs:t}:n);return{...n,answers:r}})},[]),y=(0,_.useCallback)((e,t)=>{m(n=>({...n,supervisor:{...n.supervisor,[e]:t}}))},[]),b=(0,_.useCallback)(e=>{m(t=>({...t,otrasObservaciones:e}))},[]);return e?(0,Y.jsx)(`div`,{className:`fixed inset-0 z-50 flex items-center justify-center bg-slate-900/80 p-4`,children:(0,Y.jsxs)(`div`,{className:`flex w-full max-w-5xl max-h-[95vh] flex-col overflow-hidden rounded-2xl bg-white shadow-2xl`,children:[(0,Y.jsxs)(`header`,{className:`flex items-start justify-between gap-4 border-b border-slate-200 bg-slate-50 px-6 py-5`,children:[(0,Y.jsxs)(`div`,{className:`space-y-1`,children:[(0,Y.jsxs)(`p`,{className:`text-xs font-semibold uppercase tracking-wide text-blue-600`,children:[`Orden #`,t?.code??``]}),(0,Y.jsx)(`h2`,{className:`text-2xl font-semibold text-slate-900`,children:`Checklist trmino de mantencin`}),(0,Y.jsx)(`p`,{className:`text-sm text-slate-600`,children:`Complete el formulario para cerrar la orden. Revise cada punto y registre observaciones si corresponde.`})]}),(0,Y.jsx)(`button`,{type:`button`,className:`btn btn-outline btn-sm`,onClick:o,disabled:c,children:`Cerrar`})]}),(0,Y.jsx)(`div`,{className:`flex-1 overflow-y-auto bg-white px-6 py-6`,children:(0,Y.jsxs)(`div`,{className:`mx-auto flex w-full max-w-4xl flex-col gap-6`,children:[l?(0,Y.jsx)(`div`,{className:`rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700`,children:l}):null,(0,Y.jsxs)(`section`,{className:`grid gap-4 rounded-xl border border-slate-200 bg-slate-50 p-5 text-sm text-slate-700 md:grid-cols-2`,children:[(0,Y.jsxs)(`div`,{className:`space-y-2`,children:[(0,Y.jsxs)(`div`,{className:`flex flex-col`,children:[(0,Y.jsx)(`span`,{className:`text-xs font-semibold uppercase tracking-wide text-slate-500`,children:`Mquina / Cuerpo`}),(0,Y.jsx)(`span`,{className:`text-base font-semibold text-slate-900`,children:p.meta.detalle_mant||`-`})]}),(0,Y.jsxs)(`div`,{className:`flex flex-col`,children:[(0,Y.jsx)(`span`,{className:`text-xs font-semibold uppercase tracking-wide text-slate-500`,children:`Mantenedor`}),(0,Y.jsx)(`span`,{className:`text-base font-semibold text-slate-900`,children:p.meta.mantenedor_name||`-`})]}),(0,Y.jsxs)(`div`,{className:`flex flex-col`,children:[(0,Y.jsx)(`span`,{className:`text-xs font-semibold uppercase tracking-wide text-slate-500`,children:`Cdigo mantenedor`}),(0,Y.jsx)(`span`,{className:`text-base font-semibold text-slate-900`,children:p.meta.mantenedor_code||`-`})]})]}),(0,Y.jsxs)(`div`,{className:`space-y-2`,children:[(0,Y.jsxs)(`div`,{className:`flex flex-col`,children:[(0,Y.jsx)(`span`,{className:`text-xs font-semibold uppercase tracking-wide text-slate-500`,children:`Fecha`}),(0,Y.jsx)(`span`,{className:`text-base font-semibold text-slate-900`,children:new Date(p.meta.fecha||Date.now()).toLocaleDateString(`es-ES`)})]}),(0,Y.jsxs)(`div`,{className:`flex flex-col`,children:[(0,Y.jsx)(`span`,{className:`text-xs font-semibold uppercase tracking-wide text-slate-500`,children:`Orden`}),(0,Y.jsx)(`span`,{className:`text-base font-semibold text-slate-900`,children:t?.code??`-`})]})]})]}),(0,Y.jsxs)(`section`,{className:`space-y-4`,children:[(0,Y.jsx)(`div`,{className:`rounded-xl border border-blue-200 bg-blue-50 p-4 text-sm text-blue-800 shadow-sm`,children:`CONTESTE CON UNA "X" EN "S", "NO" O "N/A" SEGN LO OBSERVADO. SI SELECCIONA "NO", REGISTRE EL MOTIVO EN LAS OBSERVACIONES.`}),(0,Y.jsx)(`div`,{className:`overflow-hidden rounded-xl border border-slate-200 shadow-sm`,children:(0,Y.jsx)(`div`,{className:`max-h-[50vh] overflow-auto`,children:(0,Y.jsxs)(`table`,{className:`min-w-full divide-y divide-slate-200 text-sm text-slate-800`,children:[(0,Y.jsx)(`thead`,{className:`bg-slate-100 text-xs font-semibold uppercase tracking-wide text-slate-600`,children:(0,Y.jsxs)(`tr`,{children:[(0,Y.jsx)(`th`,{className:`w-16 px-4 py-3 text-center`,children:`Item`}),(0,Y.jsx)(`th`,{className:`px-4 py-3 text-left`,children:`Inspeccin primaria`}),(0,Y.jsx)(`th`,{className:`w-20 px-4 py-3 text-center`,children:`S`}),(0,Y.jsx)(`th`,{className:`w-20 px-4 py-3 text-center`,children:`No`}),(0,Y.jsx)(`th`,{className:`w-20 px-4 py-3 text-center`,children:`N/A`}),(0,Y.jsx)(`th`,{className:`px-4 py-3 text-left`,children:`Observaciones`})]})}),(0,Y.jsx)(`tbody`,{className:`divide-y divide-slate-100`,children:aT.map(({item:e,text:t})=>{let n=e-1,r=p.answers[n],i=`Item ${e}: ${t}`,a=`checklist-item-${e}-obs`;return(0,Y.jsxs)(`tr`,{className:`align-top`,children:[(0,Y.jsx)(`td`,{className:`px-4 py-3 text-center font-semibold text-slate-700`,children:e}),(0,Y.jsx)(`td`,{className:`px-4 py-3 text-slate-800`,children:t}),(0,Y.jsx)(`td`,{className:`px-4 py-3 text-center`,children:(0,Y.jsx)(`input`,{type:`checkbox`,className:`h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500`,checked:r.si,onChange:()=>g(n,`si`),disabled:c,"aria-label":`${i} - S`})}),(0,Y.jsx)(`td`,{className:`px-4 py-3 text-center`,children:(0,Y.jsx)(`input`,{type:`checkbox`,className:`h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500`,checked:r.no,onChange:()=>g(n,`no`),disabled:c,"aria-label":`${i} - No`})}),(0,Y.jsx)(`td`,{className:`px-4 py-3 text-center`,children:(0,Y.jsx)(`input`,{type:`checkbox`,className:`h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500`,checked:r.na,onChange:()=>g(n,`na`),disabled:c,"aria-label":`${i} - No aplica`})}),(0,Y.jsx)(`td`,{className:`px-4 py-3`,children:(0,Y.jsx)(`textarea`,{id:a,rows:2,className:`w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm transition focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 disabled:bg-slate-100`,value:r.obs,onChange:e=>v(n,e.target.value),disabled:c,"aria-label":`${i} - Observaciones`})})]},e)})})]})})})]}),(0,Y.jsxs)(`section`,{className:`rounded-xl border border-slate-200 bg-white p-5 shadow-sm`,children:[(0,Y.jsx)(`label`,{htmlFor:`otras-observaciones`,className:`text-sm font-semibold text-slate-700`,children:`Otras observaciones`}),(0,Y.jsx)(`textarea`,{id:`otras-observaciones`,rows:4,className:`mt-2 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm transition focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 disabled:bg-slate-100`,value:p.otrasObservaciones,onChange:e=>b(e.target.value),disabled:c})]}),(0,Y.jsxs)(`section`,{className:`rounded-xl border border-slate-200 bg-slate-50 p-5 shadow-sm`,children:[(0,Y.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,Y.jsx)(`h3`,{className:`text-sm font-semibold uppercase tracking-wide text-slate-600`,children:`Revisin por supervisor`}),(0,Y.jsx)(`span`,{className:`text-xs font-medium text-slate-500`,children:`Completar al cierre del turno`})]}),(0,Y.jsxs)(`div`,{className:`mt-4 grid gap-4 sm:grid-cols-2`,children:[(0,Y.jsxs)(`label`,{className:`flex flex-col gap-1 text-sm text-slate-700`,children:[`Nombre`,(0,Y.jsx)(`input`,{type:`text`,className:`rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm transition focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 disabled:bg-slate-100`,value:p.supervisor.nombre,onChange:e=>y(`nombre`,e.target.value),disabled:c||d?.role!==`supervisor`})]}),(0,Y.jsxs)(`label`,{className:`flex flex-col gap-1 text-sm text-slate-700`,children:[`Fecha`,(0,Y.jsx)(`input`,{type:`date`,className:`rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm transition focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 disabled:bg-slate-100`,value:p.supervisor.fecha,onChange:e=>y(`fecha`,e.target.value),disabled:c||d?.role!==`supervisor`})]}),(0,Y.jsxs)(`label`,{className:`sm:col-span-2 flex flex-col gap-1 text-sm text-slate-700`,children:[`Firma`,(0,Y.jsx)(`input`,{type:`text`,className:`rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm transition focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 disabled:bg-slate-100`,value:p.supervisor.firma,onChange:e=>y(`firma`,e.target.value),disabled:c||d?.role!==`supervisor`})]})]})]})]})}),(0,Y.jsxs)(`footer`,{className:`flex items-center justify-end gap-3 border-t border-slate-200 bg-slate-50 px-6 py-4`,children:[(0,Y.jsx)(`button`,{type:`button`,className:`btn btn-outline`,onClick:o,disabled:c,children:`Cancelar`}),(0,Y.jsx)(`button`,{type:`button`,className:`btn btn-primary`,onClick:async()=>{if(!h||c)return;let e=sT(p);try{await s?.(e)}catch{}},disabled:!h||c,children:c?`Guardando...`:`Guardar checklist`})]})]})}):null}var lT=e=>{let t=Array.isArray(e?.tasks?.data)?e.tasks.data:[];return t.length?t.every(e=>Number(e?.status)===2):!1};function uT({orders:e,maintainers:t,onAssign:n}){let[r,i]=(0,_.useState)([]),[a,o]=(0,_.useState)(null),[s,c]=(0,_.useState)(``),[l,u]=(0,_.useState)(``),[d,f]=(0,_.useState)(new Set),p=(0,_.useMemo)(()=>e.filter(e=>!e.info?.asignado_a_code).filter(e=>{let t=s?e.code.toString().includes(s):!0,n=l?(e.info?.Descripcion||``).toLowerCase().includes(l.toLowerCase()):!0;return t&&n}),[e,s,l]),m=e=>{i(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},h=()=>{r.length>0&&a&&(r.forEach(e=>{n(e,a.code)}),i([]),o(null))},g=e=>{a&&n(e,a.code)},v=e=>{f(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})},y=e=>{let t=Number(e);return t===2?`Completada`:t===1?`En Progreso`:t===3?`Anulada`:`Pendiente`};return(0,Y.jsxs)(`div`,{className:`space-y-4`,children:[(0,Y.jsx)(`h3`,{className:`text-lg font-semibold`,children:`Asignar rdenes a Mantenedores`}),(0,Y.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-4 mb-4`,children:[(0,Y.jsx)(`input`,{type:`text`,placeholder:`Buscar por cdigo`,className:`input`,value:s,onChange:e=>c(e.target.value)}),(0,Y.jsx)(`input`,{type:`text`,placeholder:`Buscar por descripcin`,className:`input`,value:l,onChange:e=>u(e.target.value)})]}),(0,Y.jsxs)(`div`,{className:`card p-4`,children:[(0,Y.jsx)(`h4`,{className:`font-medium mb-2`,children:`Mantenedor para Asignar`}),(0,Y.jsxs)(`select`,{className:`input w-full`,value:a?.code||``,onChange:e=>{let n=Number(e.target.value),r=t.find(e=>e.code===n);o(r)},children:[(0,Y.jsx)(`option`,{value:``,children:`Seleccionar Mantenedor`}),t.map(e=>(0,Y.jsxs)(`option`,{value:e.code,children:[`#`,e.code,` - `,e.name,` (`,e.speciality||`Sin especialidad`,`)`]},e.code))]})]}),(0,Y.jsxs)(`div`,{className:`space-y-2`,children:[(0,Y.jsxs)(`div`,{className:`flex justify-between items-center`,children:[(0,Y.jsxs)(`h4`,{className:`font-medium`,children:[`rdenes Disponibles (`,p.length,`)`]}),(0,Y.jsxs)(`button`,{className:`btn btn-primary`,onClick:h,disabled:r.length===0||!a,children:[`Asignar Seleccionadas (`,r.length,`)`]})]}),p.map(e=>(0,Y.jsxs)(`div`,{className:`border rounded-lg shadow p-4`,children:[(0,Y.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,Y.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,Y.jsx)(`input`,{type:`checkbox`,checked:r.includes(e.code),onChange:()=>m(e.code),className:`h-4 w-4`}),(0,Y.jsxs)(`span`,{className:`font-semibold`,children:[`#`,e.code]})]}),(0,Y.jsxs)(`div`,{className:`flex gap-2`,children:[(0,Y.jsx)(`button`,{className:`btn btn-outline btn-sm`,onClick:()=>v(e.code),children:d.has(e.code)?`Ocultar Tareas`:`Mostrar Tareas`}),(0,Y.jsx)(`button`,{className:`btn btn-outline btn-sm`,onClick:()=>g(e.code),disabled:!a,children:`Asignar`})]})]}),(0,Y.jsxs)(`div`,{className:`mt-2`,children:[(0,Y.jsxs)(`p`,{children:[(0,Y.jsx)(`strong`,{children:`Descripcin:`}),` `,e.info?.Descripcion||`Sin descripcin`]}),(0,Y.jsxs)(`p`,{children:[(0,Y.jsx)(`strong`,{children:`Unidad:`}),` `,e.info?.[`N Unidad`]||`N/A`]}),(0,Y.jsxs)(`p`,{children:[(0,Y.jsx)(`strong`,{children:`Tareas:`}),` `,Array.isArray(e.tasks?.data)?e.tasks.data.length:0]})]}),d.has(e.code)&&(0,Y.jsxs)(`div`,{className:`mt-4 border-t pt-4`,children:[(0,Y.jsx)(`h5`,{className:`font-medium mb-2`,children:`Tareas:`}),(0,Y.jsx)(`ul`,{className:`space-y-1`,children:Array.isArray(e.tasks?.data)?e.tasks.data.map((e,t)=>(0,Y.jsxs)(`li`,{className:`flex justify-between text-sm`,children:[(0,Y.jsx)(`span`,{children:e.Descripcion||`Sin descripcin`}),(0,Y.jsx)(`span`,{className:`text-gray-600`,children:y(e.status)})]},t)):(0,Y.jsx)(`li`,{children:`No hay tareas disponibles.`})})]})]},e.code))]})]})}function dT({orders:e,maintainers:t}){let n=e.filter(e=>e.info?.asignado_a_code),r=e.filter(e=>lT(e)),i=r.filter(e=>e.info?.checkListDict?.supervisor?.firma),a=r.filter(e=>!e.info?.checkListDict?.supervisor?.firma),o=e.filter(e=>e.info?.asignado_a_code&&!lT(e)),s=e.length,c=(0,_.useMemo)(()=>n.reduce((e,t)=>{let n=Array.isArray(t.tasks?.data)?t.tasks.data:[];return e+n.reduce((e,t)=>e+(Number(t[`Hs Estim`])||0),0)},0),[n]),l=(0,_.useMemo)(()=>{let e=t.reduce((e,t)=>{let n=t.speciality||`Sin especialidad`;return e[n]||(e[n]=[]),e[n].push(t),e},{});return Object.entries(e).map(([e,t])=>({speciality:e,count:t.length,availableHours:t.length*8}))},[t]),u=[{label:`Total rdenes`,value:s},{label:`rdenes Asignadas`,value:n.length},{label:`rdenes en Progreso`,value:o.length},{label:`rdenes Aprobadas`,value:i.length},{label:`Pendientes Aprobacin`,value:a.length}];return(0,Y.jsxs)(`div`,{className:`space-y-4`,children:[(0,Y.jsx)(`h3`,{className:`text-lg font-semibold`,children:`KPIs y Resumen`}),(0,Y.jsx)(`div`,{className:`grid grid-cols-1 md:grid-cols-5 gap-4`,children:u.map(e=>(0,Y.jsxs)(`div`,{className:`card p-4 text-center`,children:[(0,Y.jsx)(`div`,{className:`text-2xl font-bold`,children:e.value}),(0,Y.jsx)(`div`,{className:`text-sm text-gray-600`,children:e.label})]},e.label))}),(0,Y.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-4`,children:[(0,Y.jsxs)(`div`,{className:`card p-4`,children:[(0,Y.jsx)(`h4`,{className:`font-medium mb-2`,children:`Horas Asignadas vs Disponibles`}),(0,Y.jsxs)(`div`,{className:`text-lg`,children:[`Asignadas: `,c.toFixed(1),` HH`]}),(0,Y.jsxs)(`div`,{className:`text-sm text-gray-600`,children:[`Disponibles:`,` `,l.reduce((e,t)=>e+t.availableHours,0),` `,`HH/da`]})]}),(0,Y.jsxs)(`div`,{className:`card p-4`,children:[(0,Y.jsx)(`h4`,{className:`font-medium mb-2`,children:`Mantenedores por Especialidad`}),l.map(e=>(0,Y.jsxs)(`div`,{className:`flex justify-between text-sm`,children:[(0,Y.jsxs)(`span`,{children:[e.speciality,`:`]}),(0,Y.jsxs)(`span`,{children:[e.count,` mantenedores (`,e.availableHours,` HH/da)`]})]},e.speciality))]})]}),(0,Y.jsxs)(`div`,{className:`card p-4`,children:[(0,Y.jsx)(`h4`,{className:`font-medium mb-2`,children:`rdenes Asignadas`}),(0,Y.jsxs)(`table`,{className:`w-full text-sm`,children:[(0,Y.jsx)(`thead`,{children:(0,Y.jsxs)(`tr`,{className:`text-left border-b`,children:[(0,Y.jsx)(`th`,{className:`py-2`,children:`Cdigo`}),(0,Y.jsx)(`th`,{children:`Descripcin`}),(0,Y.jsx)(`th`,{children:`Asignado a`}),(0,Y.jsx)(`th`,{children:`Estado`}),(0,Y.jsx)(`th`,{children:`HH Estimadas`})]})}),(0,Y.jsx)(`tbody`,{children:n.map(e=>{let n=t.find(t=>t.code===e.info?.asignado_a_code),r=(Array.isArray(e.tasks?.data)?e.tasks.data:[]).reduce((e,t)=>e+(Number(t[`Hs Estim`])||0),0);return(0,Y.jsxs)(`tr`,{className:`border-b`,children:[(0,Y.jsx)(`td`,{className:`py-2`,children:e.code}),(0,Y.jsx)(`td`,{children:e.info?.Descripcion||`Sin descripcin`}),(0,Y.jsx)(`td`,{children:n?n.name:`Desconocido`}),(0,Y.jsx)(`td`,{children:lT(e)?`Completada`:e.info?.asignado_a_code?`En Progreso`:`Pendiente`}),(0,Y.jsx)(`td`,{children:r.toFixed(1)})]},e.code)})})]})]})]})}function fT({orders:e,maintainers:t,onChecklistSave:n}){let r=e.filter(e=>lT(e)),[i,a]=(0,_.useState)(!1),[o,s]=(0,_.useState)(null),[c,l]=(0,_.useState)(!1),[u,d]=(0,_.useState)(null),f=e=>{s(e),a(!0)};return(0,Y.jsxs)(`div`,{className:`space-y-4`,children:[(0,Y.jsx)(`h3`,{className:`text-lg font-semibold`,children:`rdenes Completadas - Revisin Supervisor`}),(0,Y.jsx)(`div`,{className:`space-y-2`,children:r.length===0?(0,Y.jsx)(`p`,{className:`text-gray-600`,children:`No hay rdenes completadas pendientes de revisin.`}):r.map(e=>{let n=t.find(t=>t.code===e.info?.asignado_a_code),r=Array.isArray(e.tasks?.data)?e.tasks.data:[],i=r.reduce((e,t)=>e+(Number(t[`Hs Estim`])||0),0),a=!!e.info?.checkListDict,o=e.info?.checkListDict?.supervisor?.firma;return(0,Y.jsxs)(`div`,{className:`border rounded-lg shadow p-4`,children:[(0,Y.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,Y.jsxs)(`div`,{children:[(0,Y.jsxs)(`span`,{className:`font-semibold`,children:[`#`,e.code]}),(0,Y.jsxs)(`span`,{className:`ml-2 text-sm text-gray-600`,children:[`Asignado a: `,n?n.name:`Desconocido`]})]}),(0,Y.jsxs)(`div`,{className:`flex gap-2`,children:[a&&(0,Y.jsx)(`span`,{className:`px-2 py-1 text-xs rounded ${o?`bg-green-100 text-green-800`:`bg-yellow-100 text-yellow-800`}`,children:o?`Aprobada`:`Pendiente Aprobacin`}),(0,Y.jsx)(`button`,{className:`btn btn-primary btn-sm`,onClick:()=>f(e),children:`Revisar Checklist`})]})]}),(0,Y.jsxs)(`div`,{className:`mt-2`,children:[(0,Y.jsxs)(`p`,{children:[(0,Y.jsx)(`strong`,{children:`Descripcin:`}),` `,e.info?.Descripcion||`Sin descripcin`]}),(0,Y.jsxs)(`p`,{children:[(0,Y.jsx)(`strong`,{children:`Horas Estimadas:`}),` `,i.toFixed(1),` HH`]}),(0,Y.jsxs)(`p`,{children:[(0,Y.jsx)(`strong`,{children:`Tareas Completadas:`}),` `,r.filter(e=>Number(e.status)===2).length,` /`,` `,r.length]})]})]},e.code)})}),i&&o&&(0,Y.jsx)(cT,{isOpen:i,order:o,task:null,taskIndex:null,user:null,initialData:o.info?.checkListDict,onCancel:()=>{d(null),a(!1),s(null)},onSubmit:async e=>{if(o)try{d(null),l(!0),await n(o.code,e),a(!1),s(null)}catch(e){console.error(`Failed to save checklist`,e),d(`No se pudo guardar el checklist. Intntalo nuevamente.`)}finally{l(!1)}},saving:c,submitError:u})]})}function pT(){let{user:e,logout:t}=Iy(),{broadcastSync:n,sendOrdersToUser:r}=Ny(),[i,a]=(0,_.useState)([]),[o,s]=(0,_.useState)([]),[c,l]=(0,_.useState)(`assignment`),[u,d]=(0,_.useState)(!1),f=async()=>{d(!0);try{let e=await Pe();a(e);let t=(await ke()).filter(e=>e.role===`mantenedor`&&e.active);s(t)}finally{d(!1)}};return(0,_.useEffect)(()=>{f()},[]),e?(0,Y.jsxs)(`div`,{className:`max-w-5xl mx-auto p-4 space-y-6`,children:[(0,Y.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,Y.jsx)(`h2`,{className:`text-2xl font-semibold`,children:`Panel Supervisor`}),(0,Y.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,Y.jsx)(`button`,{className:`btn btn-outline`,onClick:f,disabled:u,children:u?`Refrescando...`:`Refrescar`}),(0,Y.jsxs)(`span`,{className:`text-sm text-gray-600`,children:[e.name,` (#`,e.code,`)`]}),(0,Y.jsx)(`button`,{className:`btn btn-outline`,onClick:t,children:`Salir`})]})]}),(0,Y.jsxs)(`div`,{className:`flex gap-2`,children:[(0,Y.jsx)(`button`,{className:`btn ${c===`assignment`?`btn-primary`:`btn-outline`}`,onClick:()=>l(`assignment`),children:`Asignar rdenes`}),(0,Y.jsx)(`button`,{className:`btn ${c===`dashboard`?`btn-primary`:`btn-outline`}`,onClick:()=>l(`dashboard`),children:`Dashboard`}),(0,Y.jsx)(`button`,{className:`btn ${c===`completed`?`btn-primary`:`btn-outline`}`,onClick:()=>l(`completed`),children:`rdenes Completadas`})]}),c===`assignment`&&(0,Y.jsx)(uT,{orders:i,maintainers:o,onAssign:async(t,a)=>{let s=i.find(e=>e.code===t),c=o.find(e=>e.code===a);if(s&&c){let t={...s,info:{...s.info,asignado_a_code:a,asignado_a_name:c.name,asignado_por_code:e.code,asignado_por_name:e.name}};await Ne([t]),await n(),await r(c.code),await f()}}}),c===`dashboard`&&(0,Y.jsx)(dT,{orders:i,maintainers:o}),c===`completed`&&(0,Y.jsx)(fT,{orders:i,maintainers:o,onChecklistSave:async(e,t)=>{let r=await Re(e,t);a(t=>t.map(t=>t.code===e?r:t)),await n()}})]}):null}var mT=_.Activity??_.unstable_Activity;function hT({orders:e}){let t=Kt(),[n,r]=(0,_.useState)(!1),[i,a]=(0,_.useState)(null),[o,s]=(0,_.useState)(!1),[c,l]=(0,_.useState)(0),[u,d]=(0,_.useState)(null),[f,p]=(0,_.useState)({orderCode:null,index:null});if(!e||e==[])return;let m=e=>{if(i==e){r(!n),s(!1),d(null),p({orderCode:null,index:null});return}a(e),r(!0),s(!1),d(null),p({orderCode:null,index:null})},h=e=>{if(l(0),i==e){s(!o),r(!1),d(null),p({orderCode:null,index:null});return}a(e),s(!0),r(!1)},g=e=>{if(!e?.code)return;let n=e.fullOrder??e;t(`/mantenedor/orden/${e.code}`,{state:{order:n}})},v=e=>{let t=Number(e?.status);return t===2?`Ver tarea`:t===1?`Continuar`:t===3?`Anulada`:`Iniciar`},y=async(e,n,r)=>{if(!e?.code||Number(n?.status)===3)return;let i=!!n?.init_task,a=Number(n?.status)===2;try{d(null),p({orderCode:e.code,index:r});let n=e.fullOrder??e;if(!i&&!a){let{order:t}=await Le(e.code,r);n=t,e.fullOrder&&=t,t?.tasks&&(e.tasks=t.tasks),t?.info&&(e.info=t.info),Array.isArray(t?.protocolos)&&(e.protocolos=t.protocolos)}t(`/mantenedor/orden/${e.code}/tarea/${r}`,{state:{order:n,taskIndex:r}})}catch(e){console.error(`Failed to start task`,e),d(`No se pudo iniciar la tarea. Intntalo nuevamente.`)}finally{p({orderCode:null,index:null})}};return(0,Y.jsx)(`div`,{children:e.map(e=>(0,Y.jsxs)(`div`,{className:`border mb-2 rounded-lg shadow`,children:[(0,Y.jsxs)(`div`,{className:`space-x-reverse flex justify-between items-center top-0`,children:[(0,Y.jsx)(`span`,{className:`border rounded-tl-md rounded-br-md px-1 py-1 text-sm font-mono font-semibold`,children:e.code}),(0,Y.jsx)(`span`,{className:`border rounded-tr-md rounded-bl-md px-1 py-1 text-sm font-mono font-semibold`,children:e.tasks.data.filter(e=>e.status===2).length+`/`+e.tasks.Tasks_N})]}),(0,Y.jsxs)(`div`,{className:`flex justify-between flex-col`,children:[(0,Y.jsxs)(`span`,{className:`mb-2 px-2 font-semibold text-lg text-gray-700`,children:[`Descripcin: `,e.description]}),(0,Y.jsxs)(`span`,{className:`mb-2 px-2 font-semibold text-lg text-gray-700`,children:[`Unidad: `,e.unidad]})]}),(0,Y.jsxs)(`div`,{className:`relative flex justify-between items-center border-b border-gray-500 rounded-b-md`,children:[(0,Y.jsxs)(`button`,{className:`m-0 px-2 py-2 bg-blue-600 text-white  hover:bg-blue-700 cursor-pointer rounded-tr-md rounded-bl-md`,onClick:()=>m(e.code),children:[`Tareas |`,` `,e.tasks.data.length>0?[...new Set(e.tasks.data.map(e=>e.Taller).filter(e=>e))].join(`- `):`N/A`]}),(0,Y.jsx)(`button`,{className:`m-0 px-2 py-2 bg-blue-600 text-white  hover:bg-blue-700 cursor-pointer rounded-t-md`,onClick:()=>g(e),children:`VER ORDEN COMPLETA`}),(0,Y.jsxs)(`button`,{className:`m-0 px-2 py-2 bg-blue-600 text-white  hover:bg-blue-700 cursor-pointer rounded-tl-md rounded-br-md`,onClick:()=>h(e.code),children:[`Anexos: `,e.protocolos.length]})]}),(0,Y.jsx)(mT,{mode:n&&i==e.code?`visible`:`hidden`,children:(0,Y.jsxs)(`div`,{children:[u&&i==e.code&&n?(0,Y.jsx)(`div`,{className:`mb-2 rounded-md border border-red-200 bg-red-50 px-3 py-1 text-sm text-red-700`,children:u}):null,(0,Y.jsx)(`ul`,{className:`px-2 list-inside`,children:e.tasks.data.map((t,n)=>(0,Y.jsxs)(`li`,{className:`flex justify-between border-b border-gray-300 py-1`,children:[(0,Y.jsx)(`span`,{children:t.Descripcion}),(0,Y.jsx)(`div`,{children:(0,Y.jsx)(`button`,{type:`button`,className:`btn btn-primary btn-sm min-w-[7rem] justify-center`,onClick:()=>y(e,t,n),disabled:f.orderCode===e.code&&f.index===n||Number(t?.status)===3,children:v(t)})})]},n))})]})}),(0,Y.jsx)(mT,{mode:o&&i==e.code?`visible`:`hidden`,children:(0,Y.jsxs)(`div`,{children:[e.protocolos.length>1?(0,Y.jsx)(`select`,{name:``,id:``,className:`m-2 p-2 border rounded w-1/2 justify-center text-center align-middle relative left-1/2 -translate-x-1/2`,value:c,onChange:e=>l(e.target.value),children:e.protocolos.map((e,t)=>(0,Y.jsxs)(`option`,{value:t,children:[`Anexo `,t+1]},t))}):null,(0,Y.jsx)(`div`,{className:`bg-gray-50 p-4 rounded-md mt-2 border `,children:(0,Y.jsx)(`pre`,{className:`whitespace-pre-wrap text-sm font-mono text-gray-800`,children:e.protocolos.length>0?e.protocolos[c]:`No hay protocolos de seguridad definidos para esta orden.`})})]})})]},e.code))})}var gT=_.Activity??_.unstable_Activity;function _T(){let{user:e}=Iy(),[t,n]=(0,_.useState)([]),[r,i]=(0,_.useState)(!1),a=e=>{if(e==[]||!e)return;let t=e.map(e=>{let t=e?.tasks??{},n=Array.isArray(t.data)?t.data:[],r=Number.isFinite(t?.Tasks_N)?t.Tasks_N:n.length,i=Array.isArray(e?.protocolos)?e.protocolos:[];return{code:e.code,tasks:{data:n,Tasks_N:r},protocolos:i,description:e.info?.Descripcion||``,unidad:e.info?.[`N Unidad`]||``,info:e.info||{},fullOrder:e}});n(t)},o=(0,_.useCallback)(async()=>{if(e?.code){i(!0);try{let t=await Fe(e.code);a(t)}finally{i(!1)}}},[e?.code]);return(0,_.useEffect)(()=>{o()},[o]),(0,Y.jsxs)(`div`,{className:`max-w-6xl mx-auto p-4`,children:[(0,Y.jsxs)(`div`,{className:`flex justify-between items-center mb-4`,children:[(0,Y.jsx)(`h1`,{className:`text-2xl font-semibold text-slate-900`,children:`Mis rdenes`}),(0,Y.jsx)(`button`,{type:`button`,className:`btn btn-outline`,onClick:o,disabled:r,children:r?`Cargando...`:`Actualizar rdenes`})]}),(0,Y.jsx)(gT,{mode:t?`visible`:`hidden`,children:(0,Y.jsx)(hT,{orders:t})})]})}var vT={0:{label:`Pendiente`,chipClass:`inline-flex items-center gap-1 rounded-full bg-amber-100 px-2.5 py-0.5 text-xs font-semibold text-amber-800`},1:{label:`En progreso`,chipClass:`inline-flex items-center gap-1 rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-semibold text-blue-800`},2:{label:`Completada`,chipClass:`inline-flex items-center gap-1 rounded-full bg-emerald-100 px-2.5 py-0.5 text-xs font-semibold text-emerald-800`},3:{label:`Anulada`,chipClass:`inline-flex items-center gap-1 rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-semibold text-red-800`}},yT=(e,t=`N/A`)=>e==null||typeof e==`string`&&e.trim().length===0?t:e;function bT({orden:e,onUpdateOrder:t}){let n=e?.info??{},r=(0,_.useMemo)(()=>Array.isArray(e?.protocolos)?e.protocolos.filter(e=>typeof e==`string`&&e.trim()):[],[e]),i=(0,_.useMemo)(()=>Array.isArray(e?.tasks?.data)?e.tasks.data:[],[e]),a=(0,_.useMemo)(()=>{let t=Number.parseInt?.(e?.tasks?.Tasks_N,10);return Number.isFinite(t)?t:i.length},[e,i]),o=(0,_.useMemo)(()=>i.filter(e=>Number(e?.status)===2).length,[i]),s=yT(e?.tasks?.h_estimadas??n?.h_estimadas??n?.[`Hs Estim`],`N/A`),[c,l]=(0,_.useState)(!1),[u,d]=(0,_.useState)(0),[f,p]=(0,_.useState)(null),[m,h]=(0,_.useState)(null),g=Kt();(0,_.useEffect)(()=>{d(0)},[r.length]),(0,_.useEffect)(()=>{r.length||l(!1)},[r.length]);let v=n.asignado_a_name??n.assigned_to_name??n[`Asignado a`]??n.assigned_to_name??null,y=n.asignado_a_code??n.assigned_to??n[`Asignado a Code`]??n.assigned_to_code??null,b=yT([v,y].filter(Boolean).join(` `)||v,`N/A`),x=yT([n.asignado_por_name,n.asignado_por_code].filter(Boolean).join(` `),`Sin asignar`),S=yT(n.prioridad??n.Prioridad,`N/A`),C=yT(n[`Fecha Venc.`]??n[`F Venc.`]??n[`Proximo Venc.`],`N/A`),w=yT(n[`F inicial`]??n[`Fecha Inicio`],`N/A`),T=yT(n[`F Real Ejecucion`],`N/A`),E=yT(n[`Fecha Prox Emision`]??n[`Proximo Venc.`],`N/A`),D=[{label:`Descripcin`,value:n.Descripcion},{label:`Unidad`,value:n[`N Unidad`]},{label:`Especialidad`,value:n.Especialidad}],O=[{label:`Asignado a`,value:b},{label:`Asignado por`,value:x}],ee=[{label:`Originador`,value:n.Originador,preferred:`left`},{label:`Lnea`,value:n.Linea,preferred:`left`},{label:`N Serie`,value:n[`N de Serie`],preferred:`left`},{label:`Clase`,value:n.Clase,preferred:`left`},{label:`Tipo`,value:n.Tipo,preferred:`left`},{label:`Parte`,value:n.Parte,preferred:`left`},{label:`Elemento`,value:n.Elemento},{label:`Modo`,value:n.Modo},{label:`Incidencia`,value:n.Incidencia},{label:`Kit de Tareas`,value:n[`Kit de Tareas`]},{label:`Planta`,value:n.Planta},{label:`Tipo de Servicio`,value:n[`Tipo servici`]},{label:`Frec. Das`,value:n[`Frec. Dias`]},{label:`Frec. Horas`,value:n[`Frec. Horas`]},{label:`Frec. Km`,value:n[`Frec. Km`]},{label:`Fecha inicio`,value:w,preferred:`right`},{label:`Fecha real ejecucin`,value:T,preferred:`right`},{label:`Fecha vencimiento`,value:C,preferred:`right`},{label:`Prxima emisin`,value:E,preferred:`right`},{label:`Frecuencia comb.`,value:n[`Frec. Comb.`],preferred:`right`}],k=[...D],te=[...O],ne=(e,t)=>{if(!e)return;let n=k.length,r=te.length;if(t===`left`&&n<=r){k.push(e);return}if(t===`right`&&r<=n){te.push(e);return}n<=r?k.push(e):te.push(e)};ee.forEach(({preferred:e,...t})=>{ne(t,e)});let re=(e,t,n)=>{let r=!1;for(;e.length>t.length;){let i=e.findIndex((e,t)=>t>=n);if(i===-1)break;t.push(e.splice(i,1)[0]),r=!0}return r};re(k,te,D.length),re(te,k,O.length);let ie=Math.max(k.length,te.length),ae=Array.from({length:ie},(e,t)=>({left:k[t],right:te[t]}));(0,_.useEffect)(()=>{p(null),h(null)},[e?.code]);let A=async(n,r)=>{if(!e?.code&&e?.code!==0)return;let i=!!n?.init_task,a=Number(n?.status)===2,o=!i&&!a;try{h(r),p(null);let n=e;if(o){let{order:i}=await Le(e.code,r);n=i,t?.(i)}g(`/mantenedor/orden/${e.code}/tarea/${r}`,{state:{order:n,taskIndex:r}})}catch(e){console.error(`Failed to start task`,e),p(`No se pudo iniciar la tarea. Intntalo nuevamente.`)}finally{h(null)}},j=[{label:`Seg. y Medio Ambiente`,value:n[`Seg. y Medio Ambiente`]},{label:`Calidad`,value:n.Calidad},{label:`Operacin`,value:n.Operacion},{label:`Mantenimiento`,value:n.Mantenimiento},{label:`Categorizacin`,value:n.Categorizacion},{label:`Tipo de Servicio`,value:n[`Tipo de Servicio`]}],oe=yT(n.observaciones,`Sin observaciones`);return e?(0,Y.jsxs)(`div`,{className:`space-y-6`,children:[(0,Y.jsxs)(`section`,{className:`flex flex-col gap-4 border-b border-slate-200 pb-4 md:flex-row md:items-center md:justify-between`,children:[(0,Y.jsxs)(`div`,{children:[(0,Y.jsxs)(`h2`,{className:`text-2xl font-semibold text-slate-900`,children:[`Orden #`,yT(e.code,`N/A`)]}),(0,Y.jsxs)(`p`,{className:`text-sm text-slate-600`,children:[`Estado actual: `,yT(n.Estado,`N/A`)]})]}),(0,Y.jsxs)(`div`,{className:`flex flex-wrap items-center gap-3`,children:[(0,Y.jsxs)(`span`,{className:`inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-slate-700`,children:[`Tareas `,o,`/`,a]}),(0,Y.jsxs)(`span`,{className:`inline-flex items-center rounded-full bg-blue-50 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-blue-700`,children:[`Horas estimadas: `,s]}),(0,Y.jsxs)(`span`,{className:`inline-flex items-center rounded-full bg-indigo-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-indigo-700`,children:[`Prioridad: `,S]})]})]}),(0,Y.jsx)(`section`,{className:`grid grid-cols-1 gap-y-3 text-sm text-slate-800 md:grid-cols-2 md:gap-x-8`,children:ae.map(({left:e,right:t},n)=>(0,Y.jsxs)(_.Fragment,{children:[(0,Y.jsxs)(`div`,{className:`flex gap-2`,children:[(0,Y.jsx)(`span`,{className:`w-36 shrink-0 font-semibold text-slate-600`,children:e?.label?`${e.label}:`:``}),(0,Y.jsx)(`span`,{className:`flex-1 text-slate-900`,children:yT(e?.value)})]}),(0,Y.jsxs)(`div`,{className:`flex gap-2`,children:[(0,Y.jsx)(`span`,{className:`w-36 shrink-0 font-semibold text-slate-600`,children:t?.label?`${t.label}:`:``}),(0,Y.jsx)(`span`,{className:`flex-1 text-slate-900`,children:yT(t?.value)})]})]},`${e?.label??`left`}-${t?.label??`right`}-${n}`))}),(0,Y.jsx)(`section`,{className:`grid grid-cols-1 gap-4 border-t border-slate-200 pt-4 text-sm text-slate-800 md:grid-cols-3`,children:j.map(({label:e,value:t})=>(0,Y.jsxs)(`div`,{className:`rounded-md border border-slate-200 bg-white px-3 py-2 shadow-sm`,children:[(0,Y.jsx)(`p`,{className:`text-xs uppercase tracking-wide text-slate-600`,children:e}),(0,Y.jsx)(`p`,{className:`mt-1 font-medium text-slate-900`,children:yT(t)})]},e))}),(0,Y.jsxs)(`section`,{className:`space-y-3 border-t border-slate-200 pt-4 text-sm text-slate-800`,children:[(0,Y.jsx)(`h3`,{className:`text-base font-semibold text-slate-900`,children:`Observaciones`}),(0,Y.jsx)(`p`,{className:`rounded-md border border-slate-200 bg-slate-50 p-3 text-sm leading-relaxed text-slate-900`,children:oe}),(0,Y.jsxs)(`div`,{className:`flex flex-wrap items-center justify-center gap-3`,children:[(0,Y.jsx)(`button`,{type:`button`,className:`btn btn-danger`,children:`Anular Orden`}),(0,Y.jsx)(`button`,{type:`button`,className:`btn btn-primary`,onClick:()=>r.length&&l(!0),disabled:!r.length,children:r.length?`Ver anexos`:`Sin anexos`})]})]}),(0,Y.jsxs)(`section`,{className:`space-y-3 border-t border-slate-200 pt-4`,children:[(0,Y.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,Y.jsx)(`h3`,{className:`text-base font-semibold text-slate-900`,children:`Tareas de la orden`}),(0,Y.jsxs)(`span`,{className:`text-xs font-medium text-slate-600`,children:[i.length,` registros`]})]}),f&&(0,Y.jsx)(`div`,{className:`rounded-md border border-red-200 bg-red-50 px-4 py-2 text-sm text-red-700`,children:f}),(0,Y.jsx)(`div`,{className:`overflow-x-auto rounded-lg border border-slate-200 bg-white shadow-sm`,children:(0,Y.jsxs)(`table`,{className:`min-w-full divide-y divide-slate-200 text-left text-sm`,children:[(0,Y.jsx)(`thead`,{className:`bg-slate-50 text-xs uppercase tracking-wide text-slate-600`,children:(0,Y.jsxs)(`tr`,{children:[(0,Y.jsx)(`th`,{className:`px-4 py-2 font-semibold`,children:`#`}),(0,Y.jsx)(`th`,{className:`px-4 py-2 font-semibold`,children:`Taller`}),(0,Y.jsx)(`th`,{className:`px-4 py-2 font-semibold`,children:`Descripcin`}),(0,Y.jsx)(`th`,{className:`px-4 py-2 font-semibold`,children:`Hs estimadas`}),(0,Y.jsx)(`th`,{className:`px-4 py-2 font-semibold`,children:`Estado`}),(0,Y.jsx)(`th`,{className:`px-4 py-2 font-semibold text-right`,children:`Acciones`})]})}),(0,Y.jsx)(`tbody`,{className:`divide-y divide-slate-100 text-slate-800`,children:i.length===0?(0,Y.jsx)(`tr`,{children:(0,Y.jsx)(`td`,{colSpan:6,className:`px-4 py-4 text-center text-sm text-slate-600`,children:`No hay tareas registradas para esta orden.`})}):i.map((e,t)=>{let n=Number.isFinite(Number(e?.status))?Number(e.status):null,r=n===null?null:vT[n],i=!!e?.init_task,a=Number(e?.status)===2?`Ver tarea`:i?`Continuar`:`Iniciar`;return(0,Y.jsxs)(`tr`,{className:`hover:bg-slate-50`,children:[(0,Y.jsx)(`td`,{className:`px-4 py-3 font-mono text-sm text-slate-600`,children:t+1}),(0,Y.jsx)(`td`,{className:`px-4 py-3 whitespace-nowrap`,children:yT(e?.Taller,`-`)}),(0,Y.jsx)(`td`,{className:`px-4 py-3`,children:yT(e?.Descripcion,`-`)}),(0,Y.jsx)(`td`,{className:`px-4 py-3 whitespace-nowrap`,children:yT(e?.[`Hs Estim`],`-`)}),(0,Y.jsx)(`td`,{className:`px-4 py-3`,children:r?(0,Y.jsx)(`span`,{className:r.chipClass,children:r.label}):(0,Y.jsx)(`span`,{className:`inline-flex items-center rounded-full bg-slate-200 px-2.5 py-0.5 text-xs font-semibold text-slate-700`,children:`Sin estado`})}),(0,Y.jsx)(`td`,{className:`px-4 py-3 text-right`,children:(0,Y.jsx)(`button`,{type:`button`,className:`btn btn-primary btn-sm`,onClick:()=>A(e,t),disabled:m===t,children:m===t?`Abriendo...`:a})})]},t)})})]})})]}),r.length>0&&c&&(0,Y.jsx)(`div`,{className:`fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4`,children:(0,Y.jsxs)(`div`,{className:`relative max-h-[90vh] w-full max-w-3xl overflow-hidden rounded-xl bg-white shadow-2xl`,children:[(0,Y.jsxs)(`header`,{className:`flex items-start justify-between gap-4 border-b border-slate-200 px-5 py-4`,children:[(0,Y.jsxs)(`div`,{children:[(0,Y.jsx)(`h3`,{className:`text-lg font-semibold text-slate-900`,children:`Protocolos de seguridad`}),(0,Y.jsxs)(`p`,{className:`text-sm text-slate-600`,children:[`Anexos disponibles para la orden #`,yT(e.code,`N/A`),`.`]})]}),(0,Y.jsx)(`button`,{type:`button`,className:`btn btn-outline`,onClick:()=>l(!1),children:`Cerrar`})]}),(0,Y.jsxs)(`div`,{className:`flex flex-col gap-3 px-5 py-4`,children:[r.length>1&&(0,Y.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between`,children:[(0,Y.jsx)(`label`,{className:`text-sm font-medium text-slate-700`,htmlFor:`protocol-select`,children:`Seleccionar anexo`}),(0,Y.jsx)(`select`,{id:`protocol-select`,className:`w-full max-w-xs rounded-md border border-slate-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200`,value:u,onChange:e=>d(Number(e.target.value)),children:r.map((e,t)=>(0,Y.jsxs)(`option`,{value:t,children:[`Anexo `,t+1]},t))})]}),(0,Y.jsx)(`div`,{className:`max-h-[60vh] overflow-auto rounded-lg border border-slate-200 bg-slate-50 p-4`,children:(0,Y.jsx)(`pre`,{className:`whitespace-pre-wrap text-sm leading-relaxed text-slate-800`,children:yT(r[u],`No hay anexos disponibles`)})})]})]})})]}):null}var xT=_.Activity??_.unstable_Activity;function ST(){let{code:e}=Jt(),t=Ut(),n=(0,_.useMemo)(()=>t.state?.order??null,[t]),[r,i]=(0,_.useState)(n),[a,o]=(0,_.useState)(!n),[s,c]=(0,_.useState)(null);return(0,_.useEffect)(()=>{let t=!1;async function r(){if(n||!e){o(!1),e||c(`Cdigo de orden invlido`);return}try{o(!0);let n=await Ie(e);t||(n?i(n):c(`No se encontr la orden solicitada.`))}catch{t||c(`No se pudo cargar la orden.`)}finally{t||o(!1)}}return r(),()=>{t=!0}},[e,n]),(0,Y.jsxs)(`div`,{className:`max-w-5xl mx-auto p-4 space-y-4`,children:[(0,Y.jsx)(xT,{mode:a?`visible`:`hidden`,children:(0,Y.jsx)(`div`,{className:`bg-white border rounded-lg p-6 shadow`,children:(0,Y.jsx)(`p`,{className:`text-gray-600`,children:`Cargando orden...`})})}),(0,Y.jsx)(xT,{mode:!a&&s?`visible`:`hidden`,children:(0,Y.jsx)(`div`,{className:`bg-red-50 border border-red-200 rounded-lg p-6 shadow`,children:(0,Y.jsx)(`p`,{className:`text-red-700`,children:s})})}),(0,Y.jsx)(xT,{mode:!a&&r&&!s?`visible`:`hidden`,children:(0,Y.jsx)(`div`,{className:`bg-white border rounded-lg p-6 shadow`,children:(0,Y.jsx)(bT,{orden:r,onUpdateOrder:i})})})]})}var CT=_.Activity??_.unstable_Activity,wT={0:`Pendiente`,1:`En progreso`,2:`Completada`,3:`Anulada`},TT=(e,t=`N/A`)=>e==null||typeof e==`string`&&e.trim().length===0?t:e,ET=e=>{let t=Array.isArray(e?.tasks?.data)?e.tasks.data:[];return t.length?t.every(e=>Number(e?.status)===2):!1};function DT(){let{code:e,taskIndex:t}=Jt(),n=Ut(),r=Kt(),{user:i}=Iy(),a=(0,_.useMemo)(()=>{let e=Number.parseInt(t??``,10);return Number.isNaN(e)?null:e},[t]),o=n.state?.order??null,[s,c]=(0,_.useState)(o),[l,u]=(0,_.useState)(!o),[d,f]=(0,_.useState)(null),[p,m]=(0,_.useState)({checkbox:!1,obs:``,medicion:`0`,rangoDesde:``,rangoHasta:``}),[h,g]=(0,_.useState)(!1),[v,y]=(0,_.useState)(null),[b,x]=(0,_.useState)(!1),[S,C]=(0,_.useState)(!1),[w,T]=(0,_.useState)(!1),[E,D]=(0,_.useState)(null),[O,ee]=(0,_.useState)(!1);(0,_.useEffect)(()=>{let t=!1;async function n(){if(!e){f(`Cdigo de orden invlido`),u(!1);return}if(a===null||a<0){f(`ndice de tarea invlido`),u(!1);return}if(s){u(!1);return}try{u(!0);let n=await Ie(e);if(t)return;n?c(n):f(`No se encontr la orden solicitada.`)}catch{t||f(`No se pudo cargar la orden.`)}finally{t||u(!1)}}return n(),()=>{t=!0}},[e,a,s]);let k=(0,_.useMemo)(()=>!s||a===null?null:(Array.isArray(s?.tasks?.data)?s.tasks.data:[])[a]??null,[s,a]),te=(0,_.useMemo)(()=>!s||a===null?null:Array.isArray(s.protocolos)?s.protocolos[a]:null,[s,a]);(0,_.useEffect)(()=>{k&&m(e=>({checkbox:typeof k.accepted_protocol==`boolean`?k.accepted_protocol:Number(k?.status)===2?!0:e.checkbox,obs:typeof k.obs_assigned_to==`string`?k.obs_assigned_to:e.obs??``,medicion:k.medicion_result!==void 0&&k.medicion_result!==null?String(k.medicion_result):e.medicion??`0`,rangoDesde:typeof k.medicion_range_from==`string`?k.medicion_range_from:e.rangoDesde??``,rangoHasta:typeof k.medicion_range_to==`string`?k.medicion_range_to:e.rangoHasta??``}))},[k]),(0,_.useEffect)(()=>{if(!b)return;let e=setTimeout(()=>x(!1),3e3);return()=>clearTimeout(e)},[b]),(0,_.useEffect)(()=>{if(!O)return;let e=setTimeout(()=>ee(!1),3e3);return()=>clearTimeout(e)},[O]),(0,_.useEffect)(()=>{C(!1)},[s?.code,a]);let ne=(0,_.useMemo)(()=>{if(!k)return`N/A`;let e=Number(k.status);return wT[e]??TT(k.status,`N/A`)},[k]),re=(0,_.useMemo)(()=>Number(k?.status)===2,[k]),ie=p.checkbox&&p.medicion!==`0`&&!h&&!re&&!l&&!d,ae=()=>{r(`/mantenedor/orden/${e}`,{state:s?{order:s}:void 0})},A=e=>{m(t=>({...t,checkbox:e}))},j=(e,t)=>{m(n=>({...n,[e]:t}))},oe=async()=>{if(!s||a===null||!k)return;let t=s?.code??e;if(t!=null&&ie)try{g(!0),y(null),x(!1);let e={accepted:!0,obs:p.obs?.trim?.()??``,medicion:p.medicion,rangoDesde:p.rangoDesde?.trim?.()??``,rangoHasta:p.rangoHasta?.trim?.()??``},{order:n}=await L(t,a,e),r=n;if(!r)try{r=await Ie(t)}catch{}if(r){let e=Array.isArray(r?.tasks?.data)?r.tasks.data.map((e,t)=>{if(t===a)return{...e,status:2};if(typeof e?.status==`number`)return e;let n=Number(e?.status);return Number.isFinite(n)?{...e,status:n}:{...e}}):[],t={...r,tasks:{...r.tasks||{},data:e}};c(t),x(!0),ET(t)&&C(!0)}else x(!0)}catch(e){console.error(`Failed to complete task`,e),y(`No se pudo finalizar la tarea. Intenta nuevamente.`)}finally{g(!1)}},se=async t=>{if(!s)return;let n=s?.code??e;if(n!=null)try{D(null),T(!0);let e=await Re(n,t);c(e),ee(!0),C(!1)}catch(e){console.error(`Failed to save checklist`,e),D(`No se pudo guardar el checklist. Intntalo nuevamente.`)}finally{T(!1)}},ce=()=>{D(null),C(!1)};return(0,Y.jsxs)(`div`,{className:`max-w-4xl mx-auto p-4 space-y-4`,children:[(0,Y.jsx)(CT,{mode:l?`visible`:`hidden`,children:(0,Y.jsx)(`div`,{className:`bg-white border rounded-lg p-6 shadow`,children:(0,Y.jsx)(`p`,{className:`text-slate-600`,children:`Cargando tarea...`})})}),(0,Y.jsx)(CT,{mode:!l&&d?`visible`:`hidden`,children:(0,Y.jsx)(`div`,{className:`bg-red-50 border border-red-200 rounded-lg p-6 shadow`,children:(0,Y.jsx)(`p`,{className:`text-red-700`,children:d})})}),(0,Y.jsx)(CT,{mode:!l&&!d&&k?`visible`:`hidden`,children:(0,Y.jsxs)(`div`,{className:`space-y-4 bg-white border rounded-lg p-6 shadow`,children:[(0,Y.jsx)(`div`,{className:`flex justify-end`,children:(0,Y.jsx)(`button`,{type:`button`,className:`btn btn-outline btn-sm`,onClick:ae,children:`Volver a la orden`})}),(0,Y.jsxs)(`div`,{className:`flex flex-col gap-2 md:flex-row md:items-center md:justify-between`,children:[(0,Y.jsxs)(`div`,{children:[(0,Y.jsxs)(`h1`,{className:`text-2xl font-semibold text-slate-900`,children:[`Orden #`,TT(s?.code,`N/A`),`  Tarea #`,(a??0)+1]}),(0,Y.jsx)(`p`,{className:`text-sm text-slate-600`,children:TT(k?.Descripcion)})]}),(0,Y.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,Y.jsxs)(`span`,{className:`inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-slate-700`,children:[`Taller: `,TT(k?.Taller)]}),(0,Y.jsxs)(`span`,{className:`inline-flex items-center rounded-full bg-blue-50 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-blue-700`,children:[`Hs estimadas: `,TT(k?.[`Hs Estim`])]}),(0,Y.jsxs)(`span`,{className:`inline-flex items-center rounded-full bg-indigo-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-indigo-700`,children:[`Estado: `,ne]})]})]}),(0,Y.jsxs)(`section`,{className:`grid grid-cols-1 gap-4 md:grid-cols-2`,children:[(0,Y.jsxs)(`div`,{className:`space-y-2 text-sm text-slate-800`,children:[(0,Y.jsxs)(`div`,{className:`flex justify-between`,children:[(0,Y.jsx)(`span`,{className:`font-semibold text-slate-600`,children:`Tarea Standard:`}),(0,Y.jsx)(`span`,{className:`text-slate-900`,children:TT(k?.[`Tarea Standard`])})]}),(0,Y.jsxs)(`div`,{className:`flex justify-between`,children:[(0,Y.jsx)(`span`,{className:`font-semibold text-slate-600`,children:`N Sec. Oper.:`}),(0,Y.jsx)(`span`,{className:`text-slate-900`,children:TT(k?.[`Numero sec oper`])})]}),(0,Y.jsxs)(`div`,{className:`flex justify-between`,children:[(0,Y.jsx)(`span`,{className:`font-semibold text-slate-600`,children:`Valor esperado:`}),(0,Y.jsx)(`span`,{className:`text-slate-900`,children:TT(k?.[`Valor esperado`])})]})]}),(0,Y.jsxs)(`div`,{className:`space-y-2 text-sm text-slate-800`,children:[(0,Y.jsxs)(`div`,{children:[(0,Y.jsx)(`h2`,{className:`text-sm font-semibold text-slate-600`,children:`Observaciones del supervisor`}),(0,Y.jsx)(`p`,{className:`mt-1 rounded-md border border-slate-200 bg-slate-50 p-2 text-slate-900`,children:TT(k?.obs_assigned_by,`Sin observaciones`)})]}),(0,Y.jsxs)(`div`,{children:[(0,Y.jsx)(`h2`,{className:`text-sm font-semibold text-slate-600`,children:`Observaciones del mantenedor`}),(0,Y.jsx)(`p`,{className:`mt-1 rounded-md border border-slate-200 bg-slate-50 p-2 text-slate-900`,children:TT(k?.obs_assigned_to,`Sin observaciones`)})]})]})]}),(0,Y.jsxs)(`section`,{className:`space-y-2`,children:[(0,Y.jsx)(`h2`,{className:`text-base font-semibold text-slate-900`,children:`Anexo`}),(0,Y.jsx)(`div`,{className:`max-h-[50vh] overflow-auto rounded-md border border-slate-200 bg-slate-50 p-4`,children:(0,Y.jsx)(`pre`,{className:`whitespace-pre-wrap text-sm leading-relaxed text-slate-800`,children:TT(te,`No hay anexos disponibles para esta tarea.`)})})]}),(0,Y.jsxs)(`section`,{className:`space-y-4 rounded-lg border border-slate-200 bg-slate-50 p-4`,children:[(0,Y.jsx)(`h2`,{className:`text-base font-semibold text-slate-900`,children:`Confirmacin y cierre de la tarea`}),v&&(0,Y.jsx)(`div`,{className:`rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700`,children:v}),b&&(0,Y.jsx)(`div`,{className:`rounded-md border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm text-emerald-700`,children:`Tarea finalizada correctamente.`}),E&&(0,Y.jsx)(`div`,{className:`rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700`,children:E}),O&&(0,Y.jsx)(`div`,{className:`rounded-md border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm text-emerald-700`,children:`Checklist guardado correctamente.`}),(0,Y.jsx)(`div`,{children:(0,Y.jsxs)(`label`,{className:`flex items-start gap-2 text-sm text-slate-800`,children:[(0,Y.jsx)(`input`,{type:`checkbox`,className:`mt-1 h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500`,checked:p.checkbox,onChange:e=>A(e.target.checked),disabled:re}),(0,Y.jsx)(`span`,{children:`He ledo el protocolo y la tarea`})]})}),p.checkbox&&(0,Y.jsxs)(`div`,{className:`space-y-4`,children:[(0,Y.jsxs)(`div`,{children:[(0,Y.jsx)(`label`,{htmlFor:`SaveObs`,className:`block text-sm font-medium text-slate-700`,children:`Observaciones`}),(0,Y.jsx)(`textarea`,{id:`SaveObs`,value:p.obs,onChange:e=>j(`obs`,e.target.value),placeholder:`Escriba su observacin aqu...`,className:`mt-1 w-full rounded-md border border-slate-300 bg-white p-3 text-sm text-slate-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 disabled:bg-slate-100`,rows:4,disabled:re})]}),(0,Y.jsxs)(`div`,{className:`space-y-3 rounded-md border border-emerald-200 bg-emerald-50 p-4`,children:[(0,Y.jsxs)(`span`,{className:`inline-flex items-center gap-2 text-sm font-medium text-emerald-700`,children:[(0,Y.jsx)(`span`,{"aria-hidden":`true`,children:``}),`Protocolo y tarea aceptados`]}),(0,Y.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,Y.jsxs)(`div`,{className:`md:col-span-2 flex flex-col gap-1`,children:[(0,Y.jsx)(`span`,{className:`text-sm font-semibold text-slate-700`,children:`Medicin encontrada`}),(0,Y.jsxs)(`select`,{name:`medicion`,id:`medicion`,value:p.medicion,onChange:e=>j(`medicion`,e.target.value),className:`w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 disabled:bg-slate-100`,disabled:re,children:[(0,Y.jsx)(`option`,{value:`0`,children:`Seleccionar`}),(0,Y.jsx)(`option`,{value:`1`,children:`S`}),(0,Y.jsx)(`option`,{value:`2`,children:`No`}),(0,Y.jsx)(`option`,{value:`3`,children:`No aplica`})]})]}),(0,Y.jsxs)(`div`,{className:`flex flex-col gap-1`,children:[(0,Y.jsx)(`label`,{className:`text-sm font-medium text-slate-700`,children:`Rango desde`}),(0,Y.jsx)(`input`,{type:`text`,value:p.rangoDesde,onChange:e=>j(`rangoDesde`,e.target.value),className:`rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 disabled:bg-slate-100`,disabled:re})]}),(0,Y.jsxs)(`div`,{className:`flex flex-col gap-1`,children:[(0,Y.jsx)(`label`,{className:`text-sm font-medium text-slate-700`,children:`Rango hasta`}),(0,Y.jsx)(`input`,{type:`text`,value:p.rangoHasta,onChange:e=>j(`rangoHasta`,e.target.value),className:`rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-200 disabled:bg-slate-100`,disabled:re})]})]})]}),(0,Y.jsx)(`div`,{children:(0,Y.jsx)(`button`,{type:`button`,className:`btn btn-primary`,onClick:oe,disabled:!ie,children:h?`Guardando...`:`Finalizar tarea`})})]}),re&&(0,Y.jsx)(`p`,{className:`text-sm text-slate-600`,children:`Esta tarea ya se encuentra marcada como completada.`}),s?.info?.checkListDict&&!S&&(0,Y.jsx)(`div`,{children:(0,Y.jsx)(`button`,{type:`button`,className:`btn btn-outline btn-sm`,onClick:()=>C(!0),disabled:w,children:`Ver checklist de trmino`})})]})]})}),(0,Y.jsx)(cT,{isOpen:S,order:s,task:k,taskIndex:a,user:i,initialData:s?.info?.checkListDict,onCancel:ce,onSubmit:se,saving:w,submitError:E})]})}function OT({children:e,roles:t}){let{user:n,loading:r}=Iy();return r?null:!n||t&&!t.includes(n.role)?(0,Y.jsx)(_n,{to:`/login`,replace:!0}):e}function kT(){let{user:e,loading:t}=Iy();return t?null:e?e.role===`admin`?(0,Y.jsx)(_n,{to:`/admin`,replace:!0}):e.role===`supervisor`?(0,Y.jsx)(_n,{to:`/supervisor`,replace:!0}):e.role===`mantenedor`?(0,Y.jsx)(_n,{to:`/mantenedor`,replace:!0}):(0,Y.jsx)(_n,{to:`/login`,replace:!0}):(0,Y.jsx)(_n,{to:`/login`,replace:!0})}function AT(){let e=`/WatchTaskV2/`.replace(/\/+$/,``)||`/`;return(0,Y.jsx)(rr,{basename:e,children:(0,Y.jsx)(My,{children:(0,Y.jsx)(Fy,{children:(0,Y.jsxs)(`div`,{className:`min-h-dvh flex flex-col`,children:[(0,Y.jsx)(Ly,{}),(0,Y.jsxs)(`main`,{className:`flex-grow bg-gray-50 pt-12`,children:[(0,Y.jsxs)(bn,{children:[(0,Y.jsx)(vn,{path:`/login`,element:(0,Y.jsx)(By,{})}),(0,Y.jsx)(vn,{path:`/admin`,element:(0,Y.jsx)(OT,{roles:[`admin`],children:(0,Y.jsx)(iT,{})})}),(0,Y.jsx)(vn,{path:`/supervisor`,element:(0,Y.jsx)(OT,{roles:[`supervisor`],children:(0,Y.jsx)(pT,{})})}),(0,Y.jsx)(vn,{path:`/mantenedor`,element:(0,Y.jsx)(OT,{roles:[`mantenedor`],children:(0,Y.jsx)(_T,{})})}),(0,Y.jsx)(vn,{path:`/mantenedor/orden/:code`,element:(0,Y.jsx)(OT,{roles:[`mantenedor`],children:(0,Y.jsx)(ST,{})})}),(0,Y.jsx)(vn,{path:`/mantenedor/orden/:code/tarea/:taskIndex`,element:(0,Y.jsx)(OT,{roles:[`mantenedor`],children:(0,Y.jsx)(DT,{})})}),(0,Y.jsx)(vn,{path:`*`,element:(0,Y.jsx)(kT,{})})]}),(0,Y.jsx)(zy,{})]}),(0,Y.jsx)(Ry,{})]})})})})}var jT=AT,MT=E({immediate:!0,onNeedRefresh(){MT(!0).catch(e=>{console.error(`No se pudo actualizar el Service Worker de WatchTask`,e)})},onOfflineReady(){console.info(`WatchTask est listo para funcionar sin conexin.`)},onRegisterError(e){console.error(`Error al registrar el Service Worker de WatchTask`,e)}});fe().then(({supported:e,persisted:t,reason:n})=>{e?t?console.info(`WatchTask almacenar datos de IndexedDB como Persistent Storage.`):console.warn(`WatchTask: no se pudo obtener Persistent Storage (${n}); el navegador podra purgar datos offline.`):console.warn(`WatchTask: el navegador no soporta StorageManager.persist; se usar almacenamiento 'best-effort'.`)}).catch(e=>{console.error(`WatchTask: error al solicitar almacenamiento persistente.`,e)}),(0,g.createRoot)(document.getElementById(`root`)).render((0,Y.jsx)(_.StrictMode,{children:(0,Y.jsx)(jT,{})}));export{Zf as C,om as S,em as _,Xp as a,am as b,Qp as c,xm as d,fm as f,rm as g,um as h,bm as i,tm as l,nm as m,Tm as n,Zp as o,dm as p,$p as r,Fl as s,wm as t,Sm as u,im as v,$f as w,Co as x,_m as y};